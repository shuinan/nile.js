!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("Broadcaster",[],t):"object"==typeof exports?exports.Broadcaster=t():e.Broadcaster=t()}(window,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="dist",n(n.s=98)}([function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t){var n,r,i=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(e){if(n===setTimeout)return setTimeout(e,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(e){n=o}try{r="function"==typeof clearTimeout?clearTimeout:s}catch(e){r=s}}();var c,u=[],f=!1,h=-1;function l(){f&&c&&(f=!1,c.length?u=c.concat(u):h=-1,u.length&&d())}function d(){if(!f){var e=a(l);f=!0;for(var t=u.length;t;){for(c=u,u=[];++h<t;)c&&c[h].run();h=-1,t=u.length}c=null,f=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===s||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function g(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new p(e,t)),1!==u.length||f||a(d)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.prependListener=g,i.prependOnceListener=g,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,n){"use strict";var r=n(9),i=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};e.exports=h;var o=n(5);o.inherits=n(4);var s=n(36),a=n(19);o.inherits(h,s);for(var c=i(a.prototype),u=0;u<c.length;u++){var f=c[u];h.prototype[f]||(h.prototype[f]=a.prototype[f])}function h(e){if(!(this instanceof h))return new h(e);s.call(this,e),a.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",l)}function l(){this.allowHalfOpen||this._writableState.ended||r.nextTick(d,this)}function d(e){e.end()}Object.defineProperty(h.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(h.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}),h.prototype._destroy=function(e,t){this.push(null),this.end(),r.nextTick(t,e)}},function(e,t,n){(function(e){var r,i=n(59),o=n(28),s=n(60),a=n(61),c=n(62);e&&e.ArrayBuffer&&(r=n(63));var u="undefined"!=typeof navigator&&/Android/i.test(navigator.userAgent),f="undefined"!=typeof navigator&&/PhantomJS/i.test(navigator.userAgent),h=u||f;t.protocol=3;var l=t.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},d=i(l),p={type:"error",data:"parser error"},g=n(64);function m(e,t,n){for(var r=new Array(e.length),i=a(e.length,n),o=function(e,n,i){t(n,(function(t,n){r[e]=n,i(t,r)}))},s=0;s<e.length;s++)o(s,e[s],i)}t.encodePacket=function(n,r,i,o){"function"==typeof r&&(o=r,r=!1),"function"==typeof i&&(o=i,i=null);var s=void 0===n.data?void 0:n.data.buffer||n.data;if(e.ArrayBuffer&&s instanceof ArrayBuffer)return function(e,n,r){if(!n)return t.encodeBase64Packet(e,r);var i=e.data,o=new Uint8Array(i),s=new Uint8Array(1+i.byteLength);s[0]=l[e.type];for(var a=0;a<o.length;a++)s[a+1]=o[a];return r(s.buffer)}(n,r,o);if(g&&s instanceof e.Blob)return function(e,n,r){if(!n)return t.encodeBase64Packet(e,r);if(h)return function(e,n,r){if(!n)return t.encodeBase64Packet(e,r);var i=new FileReader;return i.onload=function(){e.data=i.result,t.encodePacket(e,n,!0,r)},i.readAsArrayBuffer(e.data)}(e,n,r);var i=new Uint8Array(1);i[0]=l[e.type];var o=new g([i.buffer,e.data]);return r(o)}(n,r,o);if(s&&s.base64)return function(e,n){var r="b"+t.packets[e.type]+e.data.data;return n(r)}(n,o);var a=l[n.type];return void 0!==n.data&&(a+=i?c.encode(String(n.data)):String(n.data)),o(""+a)},t.encodeBase64Packet=function(n,r){var i,o="b"+t.packets[n.type];if(g&&n.data instanceof e.Blob){var s=new FileReader;return s.onload=function(){var e=s.result.split(",")[1];r(o+e)},s.readAsDataURL(n.data)}try{i=String.fromCharCode.apply(null,new Uint8Array(n.data))}catch(e){for(var a=new Uint8Array(n.data),c=new Array(a.length),u=0;u<a.length;u++)c[u]=a[u];i=String.fromCharCode.apply(null,c)}return o+=e.btoa(i),r(o)},t.decodePacket=function(e,n,r){if(void 0===e)return p;if("string"==typeof e){if("b"==e.charAt(0))return t.decodeBase64Packet(e.substr(1),n);if(r&&!1===(e=function(e){try{e=c.decode(e)}catch(e){return!1}return e}(e)))return p;var i=e.charAt(0);return Number(i)==i&&d[i]?e.length>1?{type:d[i],data:e.substring(1)}:{type:d[i]}:p}i=new Uint8Array(e)[0];var o=s(e,1);return g&&"blob"===n&&(o=new g([o])),{type:d[i],data:o}},t.decodeBase64Packet=function(e,t){var n=d[e.charAt(0)];if(!r)return{type:n,data:{base64:!0,data:e.substr(1)}};var i=r.decode(e.substr(1));return"blob"===t&&g&&(i=new g([i])),{type:n,data:i}},t.encodePayload=function(e,n,r){"function"==typeof n&&(r=n,n=null);var i=o(e);if(n&&i)return g&&!h?t.encodePayloadAsBlob(e,r):t.encodePayloadAsArrayBuffer(e,r);if(!e.length)return r("0:");m(e,(function(e,r){t.encodePacket(e,!!i&&n,!0,(function(e){r(null,function(e){return e.length+":"+e}(e))}))}),(function(e,t){return r(t.join(""))}))},t.decodePayload=function(e,n,r){if("string"!=typeof e)return t.decodePayloadAsBinary(e,n,r);var i;if("function"==typeof n&&(r=n,n=null),""==e)return r(p,0,1);for(var o,s,a="",c=0,u=e.length;c<u;c++){var f=e.charAt(c);if(":"!=f)a+=f;else{if(""==a||a!=(o=Number(a)))return r(p,0,1);if(a!=(s=e.substr(c+1,o)).length)return r(p,0,1);if(s.length){if(i=t.decodePacket(s,n,!0),p.type==i.type&&p.data==i.data)return r(p,0,1);if(!1===r(i,c+o,u))return}c+=o,a=""}}return""!=a?r(p,0,1):void 0},t.encodePayloadAsArrayBuffer=function(e,n){if(!e.length)return n(new ArrayBuffer(0));m(e,(function(e,n){t.encodePacket(e,!0,!0,(function(e){return n(null,e)}))}),(function(e,t){var r=t.reduce((function(e,t){var n;return e+(n="string"==typeof t?t.length:t.byteLength).toString().length+n+2}),0),i=new Uint8Array(r),o=0;return t.forEach((function(e){var t="string"==typeof e,n=e;if(t){for(var r=new Uint8Array(e.length),s=0;s<e.length;s++)r[s]=e.charCodeAt(s);n=r.buffer}i[o++]=t?0:1;var a=n.byteLength.toString();for(s=0;s<a.length;s++)i[o++]=parseInt(a[s]);i[o++]=255;for(r=new Uint8Array(n),s=0;s<r.length;s++)i[o++]=r[s]})),n(i.buffer)}))},t.encodePayloadAsBlob=function(e,n){m(e,(function(e,n){t.encodePacket(e,!0,!0,(function(e){var t=new Uint8Array(1);if(t[0]=1,"string"==typeof e){for(var r=new Uint8Array(e.length),i=0;i<e.length;i++)r[i]=e.charCodeAt(i);e=r.buffer,t[0]=0}var o=(e instanceof ArrayBuffer?e.byteLength:e.size).toString(),s=new Uint8Array(o.length+1);for(i=0;i<o.length;i++)s[i]=parseInt(o[i]);if(s[o.length]=255,g){var a=new g([t.buffer,s.buffer,e]);n(null,a)}}))}),(function(e,t){return n(new g(t))}))},t.decodePayloadAsBinary=function(e,n,r){"function"==typeof n&&(r=n,n=null);for(var i=e,o=[],a=!1;i.byteLength>0;){for(var c=new Uint8Array(i),u=0===c[0],f="",h=1;255!=c[h];h++){if(f.length>310){a=!0;break}f+=c[h]}if(a)return r(p,0,1);i=s(i,2+f.length),f=parseInt(f);var l=s(i,0,f);if(u)try{l=String.fromCharCode.apply(null,new Uint8Array(l))}catch(e){var d=new Uint8Array(l);l="";for(h=0;h<d.length;h++)l+=String.fromCharCode(d[h])}o.push(l),i=s(i,f)}var g=o.length;o.forEach((function(e,i){r(t.decodePacket(e,n,!0),i,g)}))}}).call(this,n(0))},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}}},function(e,t,n){(function(e){function n(e){return Object.prototype.toString.call(e)}t.isArray=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===n(e)},t.isBoolean=function(e){return"boolean"==typeof e},t.isNull=function(e){return null===e},t.isNullOrUndefined=function(e){return null==e},t.isNumber=function(e){return"number"==typeof e},t.isString=function(e){return"string"==typeof e},t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=function(e){return void 0===e},t.isRegExp=function(e){return"[object RegExp]"===n(e)},t.isObject=function(e){return"object"==typeof e&&null!==e},t.isDate=function(e){return"[object Date]"===n(e)},t.isError=function(e){return"[object Error]"===n(e)||e instanceof Error},t.isFunction=function(e){return"function"==typeof e},t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=e.isBuffer}).call(this,n(16).Buffer)},function(e,t,n){(function(r){function i(){try{return t.storage.debug}catch(e){}if(void 0!==r&&"env"in r)return r.env.DEBUG}(t=e.exports=n(45)).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(){var e=arguments,n=this.useColors;if(e[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+e[0]+(n?"%c ":" ")+"+"+t.humanize(this.diff),!n)return e;var r="color: "+this.color;e=[e[0],r,"color: inherit"].concat(Array.prototype.slice.call(e,1));var i=0,o=0;return e[0].replace(/%[a-z%]/g,(function(e){"%%"!==e&&(i++,"%c"===e&&(o=i))})),e.splice(o,0,r),e},t.save=function(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}},t.load=i,t.useColors=function(){return"undefined"!=typeof document&&"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31},t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(i())}).call(this,n(1))},function(e,t){e.exports=function(e,t){var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},function(e,t,n){(function(r){function i(){try{return t.storage.debug}catch(e){}if(void 0!==r&&"env"in r)return r.env.DEBUG}(t=e.exports=n(65)).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(){var e=arguments,n=this.useColors;if(e[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+e[0]+(n?"%c ":" ")+"+"+t.humanize(this.diff),!n)return e;var r="color: "+this.color;e=[e[0],r,"color: inherit"].concat(Array.prototype.slice.call(e,1));var i=0,o=0;return e[0].replace(/%[a-z%]/g,(function(e){"%%"!==e&&(i++,"%c"===e&&(o=i))})),e.splice(o,0,r),e},t.save=function(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}},t.load=i,t.useColors=function(){return"undefined"!=typeof document&&"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31},t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(i())}).call(this,n(1))},function(e,t,n){"use strict";(function(t){void 0===t||!t.version||0===t.version.indexOf("v0.")||0===t.version.indexOf("v1.")&&0!==t.version.indexOf("v1.8.")?e.exports={nextTick:function(e,n,r,i){if("function"!=typeof e)throw new TypeError('"callback" argument must be a function');var o,s,a=arguments.length;switch(a){case 0:case 1:return t.nextTick(e);case 2:return t.nextTick((function(){e.call(null,n)}));case 3:return t.nextTick((function(){e.call(null,n,r)}));case 4:return t.nextTick((function(){e.call(null,n,r,i)}));default:for(o=new Array(a-1),s=0;s<o.length;)o[s++]=arguments[s];return t.nextTick((function(){e.apply(null,o)}))}}}:e.exports=t}).call(this,n(1))},function(e,t,n){var r=n(16),i=r.Buffer;function o(e,t){for(var n in e)t[n]=e[n]}function s(e,t,n){return i(e,t,n)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=r:(o(r,t),t.Buffer=s),o(i,s),s.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return i(e,t,n)},s.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var r=i(e);return void 0!==t?"string"==typeof n?r.fill(t,n):r.fill(t):r.fill(0),r},s.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i(e)},s.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r.SlowBuffer(e)}},function(e,t,n){var r=n(47)("socket.io-parser"),i=n(50),o=n(52),s=n(53),a=n(24);function c(){}function u(e){var n="",o=!1;return n+=e.type,t.BINARY_EVENT!=e.type&&t.BINARY_ACK!=e.type||(n+=e.attachments,n+="-"),e.nsp&&"/"!=e.nsp&&(o=!0,n+=e.nsp),null!=e.id&&(o&&(n+=",",o=!1),n+=e.id),null!=e.data&&(o&&(n+=","),n+=i.stringify(e.data)),r("encoded %j as %s",e,n),n}function f(){this.reconstructor=null}function h(e){this.reconPack=e,this.buffers=[]}function l(e){return{type:t.ERROR,data:"parser error"}}t.protocol=4,t.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],t.CONNECT=0,t.DISCONNECT=1,t.EVENT=2,t.ACK=3,t.ERROR=4,t.BINARY_EVENT=5,t.BINARY_ACK=6,t.Encoder=c,t.Decoder=f,c.prototype.encode=function(e,n){(r("encoding packet %j",e),t.BINARY_EVENT==e.type||t.BINARY_ACK==e.type)?function(e,t){s.removeBlobs(e,(function(e){var n=s.deconstructPacket(e),r=u(n.packet),i=n.buffers;i.unshift(r),t(i)}))}(e,n):n([u(e)])},o(f.prototype),f.prototype.add=function(e){var n;if("string"==typeof e)n=function(e){var n={},o=0;if(n.type=Number(e.charAt(0)),null==t.types[n.type])return l();if(t.BINARY_EVENT==n.type||t.BINARY_ACK==n.type){for(var s="";"-"!=e.charAt(++o)&&(s+=e.charAt(o),o!=e.length););if(s!=Number(s)||"-"!=e.charAt(o))throw new Error("Illegal attachments");n.attachments=Number(s)}if("/"==e.charAt(o+1))for(n.nsp="";++o;){if(","==(c=e.charAt(o)))break;if(n.nsp+=c,o==e.length)break}else n.nsp="/";var a=e.charAt(o+1);if(""!==a&&Number(a)==a){for(n.id="";++o;){var c;if(null==(c=e.charAt(o))||Number(c)!=c){--o;break}if(n.id+=e.charAt(o),o==e.length)break}n.id=Number(n.id)}e.charAt(++o)&&(n=function(e,t){try{e.data=i.parse(t)}catch(e){return l()}return e}(n,e.substr(o)));return r("decoded %s as %j",e,n),n}(e),t.BINARY_EVENT==n.type||t.BINARY_ACK==n.type?(this.reconstructor=new h(n),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",n)):this.emit("decoded",n);else{if(!a(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(n=this.reconstructor.takeBinaryData(e))&&(this.reconstructor=null,this.emit("decoded",n))}},f.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},h.prototype.takeBinaryData=function(e){if(this.buffers.push(e),this.buffers.length==this.reconPack.attachments){var t=s.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null},h.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}},function(e,t,n){(function(t){var r=n(57);e.exports=function(e){var n=e.xdomain,i=e.xscheme,o=e.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!n||r))return new XMLHttpRequest}catch(e){}try{if("undefined"!=typeof XDomainRequest&&!i&&o)return new XDomainRequest}catch(e){}if(!n)try{return new(t[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}}).call(this,n(0))},function(e,t,n){var r=n(3),i=n(14);function o(e){this.path=e.path,this.hostname=e.hostname,this.port=e.port,this.secure=e.secure,this.query=e.query,this.timestampParam=e.timestampParam,this.timestampRequests=e.timestampRequests,this.readyState="",this.agent=e.agent||!1,this.socket=e.socket,this.enablesXDR=e.enablesXDR,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.forceNode=e.forceNode,this.extraHeaders=e.extraHeaders,this.localAddress=e.localAddress}e.exports=o,i(o.prototype),o.prototype.onError=function(e,t){var n=new Error(e);return n.type="TransportError",n.description=t,this.emit("error",n),this},o.prototype.open=function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this},o.prototype.close=function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this},o.prototype.send=function(e){if("open"!==this.readyState)throw new Error("Transport not open");this.write(e)},o.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},o.prototype.onData=function(e){var t=r.decodePacket(e,this.socket.binaryType);this.onPacket(t)},o.prototype.onPacket=function(e){this.emit("packet",e)},o.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},function(e,t,n){function r(e){if(e)return function(e){for(var t in r.prototype)e[t]=r.prototype[t];return e}(e)}e.exports=r,r.prototype.on=r.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},r.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},r.prototype.off=r.prototype.removeListener=r.prototype.removeAllListeners=r.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,r=this._callbacks["$"+e];if(!r)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var i=0;i<r.length;i++)if((n=r[i])===t||n.fn===t){r.splice(i,1);break}return this},r.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),n=this._callbacks["$"+e];if(n)for(var r=0,i=(n=n.slice(0)).length;r<i;++r)n[r].apply(this,t);return this},r.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},r.prototype.hasListeners=function(e){return!!this.listeners(e).length}},function(e,t){t.encode=function(e){var t="";for(var n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t},t.decode=function(e){for(var t={},n=e.split("&"),r=0,i=n.length;r<i;r++){var o=n[r].split("=");t[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return t}},function(e,t,n){"use strict";(function(e){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <http://feross.org>
 * @license  MIT
 */
var r=n(76),i=n(77),o=n(35);function s(){return c.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function a(e,t){if(s()<t)throw new RangeError("Invalid typed array length");return c.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=c.prototype:(null===e&&(e=new c(t)),e.length=t),e}function c(e,t,n){if(!(c.TYPED_ARRAY_SUPPORT||this instanceof c))return new c(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return h(this,e)}return u(this,e,t,n)}function u(e,t,n,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,r){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r);c.TYPED_ARRAY_SUPPORT?(e=t).__proto__=c.prototype:e=l(e,t);return e}(e,t,n,r):"string"==typeof t?function(e,t,n){"string"==typeof n&&""!==n||(n="utf8");if(!c.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|p(t,n),i=(e=a(e,r)).write(t,n);i!==r&&(e=e.slice(0,i));return e}(e,t,n):function(e,t){if(c.isBuffer(t)){var n=0|d(t.length);return 0===(e=a(e,n)).length?e:(t.copy(e,0,0,n),e)}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(r=t.length)!=r?a(e,0):l(e,t);if("Buffer"===t.type&&o(t.data))return l(e,t.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function f(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function h(e,t){if(f(t),e=a(e,t<0?0:0|d(t)),!c.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function l(e,t){var n=t.length<0?0:0|d(t.length);e=a(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function d(e){if(e>=s())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s().toString(16)+" bytes");return 0|e}function p(e,t){if(c.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return H(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return F(e).length;default:if(r)return H(e).length;t=(""+t).toLowerCase(),r=!0}}function g(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return I(this,t,n);case"utf8":case"utf-8":return A(this,t,n);case"ascii":return T(this,t,n);case"latin1":case"binary":return B(this,t,n);case"base64":return S(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return R(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function m(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function y(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=c.from(t,r)),c.isBuffer(t))return 0===t.length?-1:v(e,t,n,r,i);if("number"==typeof t)return t&=255,c.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):v(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function v(e,t,n,r,i){var o,s=1,a=e.length,c=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;s=2,a/=2,c/=2,n/=2}function u(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(i){var f=-1;for(o=n;o<a;o++)if(u(e,o)===u(t,-1===f?0:o-f)){if(-1===f&&(f=o),o-f+1===c)return f*s}else-1!==f&&(o-=o-f),f=-1}else for(n+c>a&&(n=a-c),o=n;o>=0;o--){for(var h=!0,l=0;l<c;l++)if(u(e,o+l)!==u(t,l)){h=!1;break}if(h)return o}return-1}function b(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");r>o/2&&(r=o/2);for(var s=0;s<r;++s){var a=parseInt(t.substr(2*s,2),16);if(isNaN(a))return s;e[n+s]=a}return s}function _(e,t,n,r){return z(H(t,e.length-n),e,n,r)}function w(e,t,n,r){return z(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function k(e,t,n,r){return w(e,t,n,r)}function E(e,t,n,r){return z(F(t),e,n,r)}function x(e,t,n,r){return z(function(e,t){for(var n,r,i,o=[],s=0;s<e.length&&!((t-=2)<0);++s)n=e.charCodeAt(s),r=n>>8,i=n%256,o.push(i),o.push(r);return o}(t,e.length-n),e,n,r)}function S(e,t,n){return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function A(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var o,s,a,c,u=e[i],f=null,h=u>239?4:u>223?3:u>191?2:1;if(i+h<=n)switch(h){case 1:u<128&&(f=u);break;case 2:128==(192&(o=e[i+1]))&&(c=(31&u)<<6|63&o)>127&&(f=c);break;case 3:o=e[i+1],s=e[i+2],128==(192&o)&&128==(192&s)&&(c=(15&u)<<12|(63&o)<<6|63&s)>2047&&(c<55296||c>57343)&&(f=c);break;case 4:o=e[i+1],s=e[i+2],a=e[i+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&(c=(15&u)<<18|(63&o)<<12|(63&s)<<6|63&a)>65535&&c<1114112&&(f=c)}null===f?(f=65533,h=1):f>65535&&(f-=65536,r.push(f>>>10&1023|55296),f=56320|1023&f),r.push(f),i+=h}return function(e){var t=e.length;if(t<=C)return String.fromCharCode.apply(String,e);var n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=C));return n}(r)}t.Buffer=c,t.SlowBuffer=function(e){+e!=e&&(e=0);return c.alloc(+e)},t.INSPECT_MAX_BYTES=50,c.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=s(),c.poolSize=8192,c._augment=function(e){return e.__proto__=c.prototype,e},c.from=function(e,t,n){return u(null,e,t,n)},c.TYPED_ARRAY_SUPPORT&&(c.prototype.__proto__=Uint8Array.prototype,c.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&c[Symbol.species]===c&&Object.defineProperty(c,Symbol.species,{value:null,configurable:!0})),c.alloc=function(e,t,n){return function(e,t,n,r){return f(t),t<=0?a(e,t):void 0!==n?"string"==typeof r?a(e,t).fill(n,r):a(e,t).fill(n):a(e,t)}(null,e,t,n)},c.allocUnsafe=function(e){return h(null,e)},c.allocUnsafeSlow=function(e){return h(null,e)},c.isBuffer=function(e){return!(null==e||!e._isBuffer)},c.compare=function(e,t){if(!c.isBuffer(e)||!c.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,i=0,o=Math.min(n,r);i<o;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},c.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(e,t){if(!o(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return c.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=c.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var s=e[n];if(!c.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(r,i),i+=s.length}return r},c.byteLength=p,c.prototype._isBuffer=!0,c.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)m(this,t,t+1);return this},c.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)m(this,t,t+3),m(this,t+1,t+2);return this},c.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)m(this,t,t+7),m(this,t+1,t+6),m(this,t+2,t+5),m(this,t+3,t+4);return this},c.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?A(this,0,e):g.apply(this,arguments)},c.prototype.equals=function(e){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===c.compare(this,e)},c.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},c.prototype.compare=function(e,t,n,r,i){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(this===e)return 0;for(var o=(i>>>=0)-(r>>>=0),s=(n>>>=0)-(t>>>=0),a=Math.min(o,s),u=this.slice(r,i),f=e.slice(t,n),h=0;h<a;++h)if(u[h]!==f[h]){o=u[h],s=f[h];break}return o<s?-1:s<o?1:0},c.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},c.prototype.indexOf=function(e,t,n){return y(this,e,t,n,!0)},c.prototype.lastIndexOf=function(e,t,n){return y(this,e,t,n,!1)},c.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return b(this,e,t,n);case"utf8":case"utf-8":return _(this,e,t,n);case"ascii":return w(this,e,t,n);case"latin1":case"binary":return k(this,e,t,n);case"base64":return E(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return x(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var C=4096;function T(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function B(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function I(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",o=t;o<n;++o)i+=q(e[o]);return i}function R(e,t,n){for(var r=e.slice(t,n),i="",o=0;o<r.length;o+=2)i+=String.fromCharCode(r[o]+256*r[o+1]);return i}function L(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function O(e,t,n,r,i,o){if(!c.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function P(e,t,n,r){t<0&&(t=65535+t+1);for(var i=0,o=Math.min(e.length-n,2);i<o;++i)e[n+i]=(t&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function U(e,t,n,r){t<0&&(t=4294967295+t+1);for(var i=0,o=Math.min(e.length-n,4);i<o;++i)e[n+i]=t>>>8*(r?i:3-i)&255}function M(e,t,n,r,i,o){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function j(e,t,n,r,o){return o||M(e,0,n,4),i.write(e,t,n,r,23,4),n+4}function N(e,t,n,r,o){return o||M(e,0,n,8),i.write(e,t,n,r,52,8),n+8}c.prototype.slice=function(e,t){var n,r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),c.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=c.prototype;else{var i=t-e;n=new c(i,void 0);for(var o=0;o<i;++o)n[o]=this[o+e]}return n},c.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||L(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r},c.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||L(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},c.prototype.readUInt8=function(e,t){return t||L(e,1,this.length),this[e]},c.prototype.readUInt16LE=function(e,t){return t||L(e,2,this.length),this[e]|this[e+1]<<8},c.prototype.readUInt16BE=function(e,t){return t||L(e,2,this.length),this[e]<<8|this[e+1]},c.prototype.readUInt32LE=function(e,t){return t||L(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},c.prototype.readUInt32BE=function(e,t){return t||L(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},c.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||L(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},c.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||L(e,t,this.length);for(var r=t,i=1,o=this[e+--r];r>0&&(i*=256);)o+=this[e+--r]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},c.prototype.readInt8=function(e,t){return t||L(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},c.prototype.readInt16LE=function(e,t){t||L(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt16BE=function(e,t){t||L(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt32LE=function(e,t){return t||L(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},c.prototype.readInt32BE=function(e,t){return t||L(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},c.prototype.readFloatLE=function(e,t){return t||L(e,4,this.length),i.read(this,e,!0,23,4)},c.prototype.readFloatBE=function(e,t){return t||L(e,4,this.length),i.read(this,e,!1,23,4)},c.prototype.readDoubleLE=function(e,t){return t||L(e,8,this.length),i.read(this,e,!0,52,8)},c.prototype.readDoubleBE=function(e,t){return t||L(e,8,this.length),i.read(this,e,!1,52,8)},c.prototype.writeUIntLE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||O(this,e,t,n,Math.pow(2,8*n)-1,0);var i=1,o=0;for(this[t]=255&e;++o<n&&(i*=256);)this[t+o]=e/i&255;return t+n},c.prototype.writeUIntBE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||O(this,e,t,n,Math.pow(2,8*n)-1,0);var i=n-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+n},c.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,1,255,0),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},c.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):P(this,e,t,!0),t+2},c.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):P(this,e,t,!1),t+2},c.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):U(this,e,t,!0),t+4},c.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):U(this,e,t,!1),t+4},c.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);O(this,e,t,n,i-1,-i)}var o=0,s=1,a=0;for(this[t]=255&e;++o<n&&(s*=256);)e<0&&0===a&&0!==this[t+o-1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+n},c.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);O(this,e,t,n,i-1,-i)}var o=n-1,s=1,a=0;for(this[t+o]=255&e;--o>=0&&(s*=256);)e<0&&0===a&&0!==this[t+o+1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+n},c.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,1,127,-128),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},c.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):P(this,e,t,!0),t+2},c.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):P(this,e,t,!1),t+2},c.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,4,2147483647,-2147483648),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):U(this,e,t,!0),t+4},c.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):U(this,e,t,!1),t+4},c.prototype.writeFloatLE=function(e,t,n){return j(this,e,t,!0,n)},c.prototype.writeFloatBE=function(e,t,n){return j(this,e,t,!1,n)},c.prototype.writeDoubleLE=function(e,t,n){return N(this,e,t,!0,n)},c.prototype.writeDoubleBE=function(e,t,n){return N(this,e,t,!1,n)},c.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i,o=r-n;if(this===e&&n<t&&t<r)for(i=o-1;i>=0;--i)e[i+t]=this[i+n];else if(o<1e3||!c.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)e[i+t]=this[i+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+o),t);return o},c.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!c.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var o;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(o=t;o<n;++o)this[o]=e;else{var s=c.isBuffer(e)?e:H(new c(e,r).toString()),a=s.length;for(o=0;o<n-t;++o)this[o+t]=s[o%a]}return this};var D=/[^+\/0-9A-Za-z-_]/g;function q(e){return e<16?"0"+e.toString(16):e.toString(16)}function H(e,t){var n;t=t||1/0;for(var r=e.length,i=null,o=[],s=0;s<r;++s){if((n=e.charCodeAt(s))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(s+1===r){(t-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function F(e){return r.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(D,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function z(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}}).call(this,n(0))},function(e,t,n){"use strict";var r,i="object"==typeof Reflect?Reflect:null,o=i&&"function"==typeof i.apply?i.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};r=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var s=Number.isNaN||function(e){return e!=e};function a(){a.init.call(this)}e.exports=a,a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var c=10;function u(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function f(e,t,n,r){var i,o,s,a;if("function"!=typeof n)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n);if(void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),s=o[t]),void 0===s)s=o[t]=n,++e._eventsCount;else if("function"==typeof s?s=o[t]=r?[n,s]:[s,n]:r?s.unshift(n):s.push(n),(i=u(e))>0&&s.length>i&&!s.warned){s.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=s.length,a=c,console&&console.warn&&console.warn(a)}return e}function h(){for(var e=[],t=0;t<arguments.length;t++)e.push(arguments[t]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,o(this.listener,this.target,e))}function l(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=h.bind(r);return i.listener=n,r.wrapFn=i,i}function d(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):g(i,i.length)}function p(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function g(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");c=e}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return u(this)},a.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r="error"===e,i=this._events;if(void 0!==i)r=r&&void 0===i.error;else if(!r)return!1;if(r){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var c=i[e];if(void 0===c)return!1;if("function"==typeof c)o(c,this,t);else{var u=c.length,f=g(c,u);for(n=0;n<u;++n)o(f[n],this,t)}return!0},a.prototype.addListener=function(e,t){return f(this,e,t,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(e,t){return f(this,e,t,!0)},a.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.on(e,l(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.prependListener(e,l(this,e,t)),this},a.prototype.removeListener=function(e,t){var n,r,i,o,s;if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);if(void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){s=n[o].listener,i=o;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,s||t)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,o=Object.keys(n);for(r=0;r<o.length;++r)"removeListener"!==(i=o[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},a.prototype.listeners=function(e){return d(this,e,!0)},a.prototype.rawListeners=function(e){return d(this,e,!1)},a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},a.prototype.listenerCount=p,a.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},function(e,t,n){(t=e.exports=n(36)).Stream=t,t.Readable=t,t.Writable=n(19),t.Duplex=n(2),t.Transform=n(40),t.PassThrough=n(92)},function(e,t,n){"use strict";(function(t,r,i){var o=n(9);function s(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,n){var r=e.entry;e.entry=null;for(;r;){var i=r.callback;t.pendingcb--,i(n),r=r.next}t.corkedRequestsFree?t.corkedRequestsFree.next=e:t.corkedRequestsFree=e}(t,e)}}e.exports=v;var a,c=!t.browser&&["v0.10","v0.9."].indexOf(t.version.slice(0,5))>-1?r:o.nextTick;v.WritableState=y;var u=n(5);u.inherits=n(4);var f={deprecate:n(91)},h=n(37),l=n(10).Buffer,d=i.Uint8Array||function(){};var p,g=n(38);function m(){}function y(e,t){a=a||n(2),e=e||{};var r=t instanceof a;this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var i=e.highWaterMark,u=e.writableHighWaterMark,f=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:r&&(u||0===u)?u:f,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var h=!1===e.decodeStrings;this.decodeStrings=!h,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var n=e._writableState,r=n.sync,i=n.writecb;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(n),t)!function(e,t,n,r,i){--t.pendingcb,n?(o.nextTick(i,r),o.nextTick(x,e,t),e._writableState.errorEmitted=!0,e.emit("error",r)):(i(r),e._writableState.errorEmitted=!0,e.emit("error",r),x(e,t))}(e,n,r,t,i);else{var s=k(n);s||n.corked||n.bufferProcessing||!n.bufferedRequest||w(e,n),r?c(_,e,n,s,i):_(e,n,s,i)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new s(this)}function v(e){if(a=a||n(2),!(p.call(v,this)||this instanceof a))return new v(e);this._writableState=new y(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),h.call(this)}function b(e,t,n,r,i,o,s){t.writelen=r,t.writecb=s,t.writing=!0,t.sync=!0,n?e._writev(i,t.onwrite):e._write(i,o,t.onwrite),t.sync=!1}function _(e,t,n,r){n||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,r(),x(e,t)}function w(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var r=t.bufferedRequestCount,i=new Array(r),o=t.corkedRequestsFree;o.entry=n;for(var a=0,c=!0;n;)i[a]=n,n.isBuf||(c=!1),n=n.next,a+=1;i.allBuffers=c,b(e,t,!0,t.length,i,"",o.finish),t.pendingcb++,t.lastBufferedRequest=null,o.next?(t.corkedRequestsFree=o.next,o.next=null):t.corkedRequestsFree=new s(t),t.bufferedRequestCount=0}else{for(;n;){var u=n.chunk,f=n.encoding,h=n.callback;if(b(e,t,!1,t.objectMode?1:u.length,u,f,h),n=n.next,t.bufferedRequestCount--,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequest=n,t.bufferProcessing=!1}function k(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function E(e,t){e._final((function(n){t.pendingcb--,n&&e.emit("error",n),t.prefinished=!0,e.emit("prefinish"),x(e,t)}))}function x(e,t){var n=k(t);return n&&(!function(e,t){t.prefinished||t.finalCalled||("function"==typeof e._final?(t.pendingcb++,t.finalCalled=!0,o.nextTick(E,e,t)):(t.prefinished=!0,e.emit("prefinish")))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"))),n}u.inherits(v,h),y.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(y.prototype,"buffer",{get:f.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(p=Function.prototype[Symbol.hasInstance],Object.defineProperty(v,Symbol.hasInstance,{value:function(e){return!!p.call(this,e)||this===v&&(e&&e._writableState instanceof y)}})):p=function(e){return e instanceof this},v.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},v.prototype.write=function(e,t,n){var r,i=this._writableState,s=!1,a=!i.objectMode&&(r=e,l.isBuffer(r)||r instanceof d);return a&&!l.isBuffer(e)&&(e=function(e){return l.from(e)}(e)),"function"==typeof t&&(n=t,t=null),a?t="buffer":t||(t=i.defaultEncoding),"function"!=typeof n&&(n=m),i.ended?function(e,t){var n=new Error("write after end");e.emit("error",n),o.nextTick(t,n)}(this,n):(a||function(e,t,n,r){var i=!0,s=!1;return null===n?s=new TypeError("May not write null values to stream"):"string"==typeof n||void 0===n||t.objectMode||(s=new TypeError("Invalid non-string/buffer chunk")),s&&(e.emit("error",s),o.nextTick(r,s),i=!1),i}(this,i,e,n))&&(i.pendingcb++,s=function(e,t,n,r,i,o){if(!n){var s=function(e,t,n){e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=l.from(t,n));return t}(t,r,i);r!==s&&(n=!0,i="buffer",r=s)}var a=t.objectMode?1:r.length;t.length+=a;var c=t.length<t.highWaterMark;c||(t.needDrain=!0);if(t.writing||t.corked){var u=t.lastBufferedRequest;t.lastBufferedRequest={chunk:r,encoding:i,isBuf:n,callback:o,next:null},u?u.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else b(e,t,!1,a,r,i,o);return c}(this,i,a,e,t,n)),s},v.prototype.cork=function(){this._writableState.corked++},v.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||w(this,e))},v.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(v.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),v.prototype._write=function(e,t,n){n(new Error("_write() is not implemented"))},v.prototype._writev=null,v.prototype.end=function(e,t,n){var r=this._writableState;"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!=e&&this.write(e,t),r.corked&&(r.corked=1,this.uncork()),r.ending||r.finished||function(e,t,n){t.ending=!0,x(e,t),n&&(t.finished?o.nextTick(n):e.once("finish",n));t.ended=!0,e.writable=!1}(this,r,n)},Object.defineProperty(v.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),v.prototype.destroy=g.destroy,v.prototype._undestroy=g.undestroy,v.prototype._destroy=function(e,t){this.end(),t(e)}}).call(this,n(1),n(20).setImmediate,n(0))},function(e,t,n){(function(e){var r=void 0!==e&&e||"undefined"!=typeof self&&self||window,i=Function.prototype.apply;function o(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new o(i.call(setTimeout,r,arguments),clearTimeout)},t.setInterval=function(){return new o(i.call(setInterval,r,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},o.prototype.unref=o.prototype.ref=function(){},o.prototype.close=function(){this._clearFn.call(r,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout((function(){e._onTimeout&&e._onTimeout()}),t))},n(42),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(this,n(0))},function(e,t){var n=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,r=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];e.exports=function(e){var t=e,i=e.indexOf("["),o=e.indexOf("]");-1!=i&&-1!=o&&(e=e.substring(0,i)+e.substring(i,o).replace(/:/g,";")+e.substring(o,e.length));for(var s=n.exec(e||""),a={},c=14;c--;)a[r[c]]=s[c]||"";return-1!=i&&-1!=o&&(a.source=t,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a}},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t){e.exports=Array.isArray||function(e){return"[object Array]"==Object.prototype.toString.call(e)}},function(e,t,n){(function(t){e.exports=function(e){return t.Buffer&&t.Buffer.isBuffer(e)||t.ArrayBuffer&&e instanceof ArrayBuffer}}).call(this,n(0))},function(e,t,n){var r=n(54),i=n(31),o=n(32),s=n(11),a=n(33),c=n(34),u=n(6)("socket.io-client:manager"),f=n(30),h=n(72),l=Object.prototype.hasOwnProperty;function d(e,t){if(!(this instanceof d))return new d(e,t);e&&"object"==typeof e&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.nsps={},this.subs=[],this.opts=t,this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(t.randomizationFactor||.5),this.backoff=new h({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this.readyState="closed",this.uri=e,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[],this.encoder=new s.Encoder,this.decoder=new s.Decoder,this.autoConnect=!1!==t.autoConnect,this.autoConnect&&this.open()}e.exports=d,d.prototype.emitAll=function(){for(var e in this.emit.apply(this,arguments),this.nsps)l.call(this.nsps,e)&&this.nsps[e].emit.apply(this.nsps[e],arguments)},d.prototype.updateSocketIds=function(){for(var e in this.nsps)l.call(this.nsps,e)&&(this.nsps[e].id=this.engine.id)},o(d.prototype),d.prototype.reconnection=function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection},d.prototype.reconnectionAttempts=function(e){return arguments.length?(this._reconnectionAttempts=e,this):this._reconnectionAttempts},d.prototype.reconnectionDelay=function(e){return arguments.length?(this._reconnectionDelay=e,this.backoff&&this.backoff.setMin(e),this):this._reconnectionDelay},d.prototype.randomizationFactor=function(e){return arguments.length?(this._randomizationFactor=e,this.backoff&&this.backoff.setJitter(e),this):this._randomizationFactor},d.prototype.reconnectionDelayMax=function(e){return arguments.length?(this._reconnectionDelayMax=e,this.backoff&&this.backoff.setMax(e),this):this._reconnectionDelayMax},d.prototype.timeout=function(e){return arguments.length?(this._timeout=e,this):this._timeout},d.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},d.prototype.open=d.prototype.connect=function(e,t){if(u("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;u("opening %s",this.uri),this.engine=r(this.uri,this.opts);var n=this.engine,i=this;this.readyState="opening",this.skipReconnect=!1;var o=a(n,"open",(function(){i.onopen(),e&&e()})),s=a(n,"error",(function(t){if(u("connect_error"),i.cleanup(),i.readyState="closed",i.emitAll("connect_error",t),e){var n=new Error("Connection error");n.data=t,e(n)}else i.maybeReconnectOnOpen()}));if(!1!==this._timeout){var c=this._timeout;u("connect attempt will timeout after %d",c);var f=setTimeout((function(){u("connect attempt timed out after %d",c),o.destroy(),n.close(),n.emit("error","timeout"),i.emitAll("connect_timeout",c)}),c);this.subs.push({destroy:function(){clearTimeout(f)}})}return this.subs.push(o),this.subs.push(s),this},d.prototype.onopen=function(){u("open"),this.cleanup(),this.readyState="open",this.emit("open");var e=this.engine;this.subs.push(a(e,"data",c(this,"ondata"))),this.subs.push(a(e,"ping",c(this,"onping"))),this.subs.push(a(e,"pong",c(this,"onpong"))),this.subs.push(a(e,"error",c(this,"onerror"))),this.subs.push(a(e,"close",c(this,"onclose"))),this.subs.push(a(this.decoder,"decoded",c(this,"ondecoded")))},d.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},d.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},d.prototype.ondata=function(e){this.decoder.add(e)},d.prototype.ondecoded=function(e){this.emit("packet",e)},d.prototype.onerror=function(e){u("error",e),this.emitAll("error",e)},d.prototype.socket=function(e,t){var n=this.nsps[e];if(!n){n=new i(this,e,t),this.nsps[e]=n;var r=this;n.on("connecting",o),n.on("connect",(function(){n.id=r.engine.id})),this.autoConnect&&o()}function o(){~f(r.connecting,n)||r.connecting.push(n)}return n},d.prototype.destroy=function(e){var t=f(this.connecting,e);~t&&this.connecting.splice(t,1),this.connecting.length||this.close()},d.prototype.packet=function(e){u("writing packet %j",e);var t=this;e.query&&0===e.type&&(e.nsp+="?"+e.query),t.encoding?t.packetBuffer.push(e):(t.encoding=!0,this.encoder.encode(e,(function(n){for(var r=0;r<n.length;r++)t.engine.write(n[r],e.options);t.encoding=!1,t.processPacketQueue()})))},d.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var e=this.packetBuffer.shift();this.packet(e)}},d.prototype.cleanup=function(){u("cleanup");for(var e=this.subs.length,t=0;t<e;t++){this.subs.shift().destroy()}this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},d.prototype.close=d.prototype.disconnect=function(){u("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"===this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},d.prototype.onclose=function(e){u("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()},d.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var e=this;if(this.backoff.attempts>=this._reconnectionAttempts)u("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var t=this.backoff.duration();u("will wait %dms before reconnect attempt",t),this.reconnecting=!0;var n=setTimeout((function(){e.skipReconnect||(u("attempting reconnect"),e.emitAll("reconnect_attempt",e.backoff.attempts),e.emitAll("reconnecting",e.backoff.attempts),e.skipReconnect||e.open((function(t){t?(u("reconnect attempt error"),e.reconnecting=!1,e.reconnect(),e.emitAll("reconnect_error",t.data)):(u("reconnect success"),e.onreconnect())})))}),t);this.subs.push({destroy:function(){clearTimeout(n)}})}},d.prototype.onreconnect=function(){var e=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",e)}},function(e,t,n){(function(e){var r=n(12),i=n(58),o=n(67),s=n(68);t.polling=function(t){var n=!1,s=!1,a=!1!==t.jsonp;if(e.location){var c="https:"===location.protocol,u=location.port;u||(u=c?443:80),n=t.hostname!==location.hostname||u!==t.port,s=t.secure!==c}if(t.xdomain=n,t.xscheme=s,"open"in new r(t)&&!t.forceJSONP)return new i(t);if(!a)throw new Error("JSONP disabled");return new o(t)},t.websocket=s}).call(this,n(0))},function(e,t,n){var r=n(13),i=n(15),o=n(3),s=n(7),a=n(29),c=n(8)("engine.io-client:polling");e.exports=f;var u=null!=new(n(12))({xdomain:!1}).responseType;function f(e){var t=e&&e.forceBase64;u&&!t||(this.supportsBinary=!1),r.call(this,e)}s(f,r),f.prototype.name="polling",f.prototype.doOpen=function(){this.poll()},f.prototype.pause=function(e){var t=this;function n(){c("paused"),t.readyState="paused",e()}if(this.readyState="pausing",this.polling||!this.writable){var r=0;this.polling&&(c("we are currently polling - waiting to pause"),r++,this.once("pollComplete",(function(){c("pre-pause polling complete"),--r||n()}))),this.writable||(c("we are currently writing - waiting to pause"),r++,this.once("drain",(function(){c("pre-pause writing complete"),--r||n()})))}else n()},f.prototype.poll=function(){c("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},f.prototype.onData=function(e){var t=this;c("polling got data %s",e);o.decodePayload(e,this.socket.binaryType,(function(e,n,r){if("opening"===t.readyState&&t.onOpen(),"close"===e.type)return t.onClose(),!1;t.onPacket(e)})),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():c('ignoring poll - transport state "%s"',this.readyState))},f.prototype.doClose=function(){var e=this;function t(){c("writing close packet"),e.write([{type:"close"}])}"open"===this.readyState?(c("transport open - closing"),t()):(c("transport not open - deferring close"),this.once("open",t))},f.prototype.write=function(e){var t=this;this.writable=!1;var n=function(){t.writable=!0,t.emit("drain")};o.encodePayload(e,this.supportsBinary,(function(e){t.doWrite(e,n)}))},f.prototype.uri=function(){var e=this.query||{},t=this.secure?"https":"http",n="";return!1!==this.timestampRequests&&(e[this.timestampParam]=a()),this.supportsBinary||e.sid||(e.b64=1),e=i.encode(e),this.port&&("https"===t&&443!==Number(this.port)||"http"===t&&80!==Number(this.port))&&(n=":"+this.port),e.length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+e}},function(e,t,n){(function(t){var r=n(23);e.exports=function(e){return function e(n){if(!n)return!1;if(t.Buffer&&t.Buffer.isBuffer&&t.Buffer.isBuffer(n)||t.ArrayBuffer&&n instanceof ArrayBuffer||t.Blob&&n instanceof Blob||t.File&&n instanceof File)return!0;if(r(n)){for(var i=0;i<n.length;i++)if(e(n[i]))return!0}else if(n&&"object"==typeof n)for(var o in n.toJSON&&"function"==typeof n.toJSON&&(n=n.toJSON()),n)if(Object.prototype.hasOwnProperty.call(n,o)&&e(n[o]))return!0;return!1}(e)}}).call(this,n(0))},function(e,t,n){"use strict";var r,i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),o=64,s={},a=0,c=0;function u(e){var t="";do{t=i[e%o]+t,e=Math.floor(e/o)}while(e>0);return t}function f(){var e=u(+new Date);return e!==r?(a=0,r=e):e+"."+u(a++)}for(;c<o;c++)s[i[c]]=c;f.encode=u,f.decode=function(e){var t=0;for(c=0;c<e.length;c++)t=t*o+s[e.charAt(c)];return t},e.exports=f},function(e,t){var n=[].indexOf;e.exports=function(e,t){if(n)return e.indexOf(t);for(var r=0;r<e.length;++r)if(e[r]===t)return r;return-1}},function(e,t,n){var r=n(11),i=n(32),o=n(71),s=n(33),a=n(34),c=n(6)("socket.io-client:socket"),u=n(28);e.exports=l;var f={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},h=i.prototype.emit;function l(e,t,n){this.io=e,this.nsp=t,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,n&&n.query&&(this.query=n.query),this.io.autoConnect&&this.open()}i(l.prototype),l.prototype.subEvents=function(){if(!this.subs){var e=this.io;this.subs=[s(e,"open",a(this,"onopen")),s(e,"packet",a(this,"onpacket")),s(e,"close",a(this,"onclose"))]}},l.prototype.open=l.prototype.connect=function(){return this.connected?this:(this.subEvents(),this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting"),this)},l.prototype.send=function(){var e=o(arguments);return e.unshift("message"),this.emit.apply(this,e),this},l.prototype.emit=function(e){if(f.hasOwnProperty(e))return h.apply(this,arguments),this;var t=o(arguments),n=r.EVENT;u(t)&&(n=r.BINARY_EVENT);var i={type:n,data:t,options:{}};return i.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof t[t.length-1]&&(c("emitting packet with ack id %d",this.ids),this.acks[this.ids]=t.pop(),i.id=this.ids++),this.connected?this.packet(i):this.sendBuffer.push(i),delete this.flags,this},l.prototype.packet=function(e){e.nsp=this.nsp,this.io.packet(e)},l.prototype.onopen=function(){c("transport is open - connecting"),"/"!==this.nsp&&(this.query?this.packet({type:r.CONNECT,query:this.query}):this.packet({type:r.CONNECT}))},l.prototype.onclose=function(e){c("close (%s)",e),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",e)},l.prototype.onpacket=function(e){if(e.nsp===this.nsp)switch(e.type){case r.CONNECT:this.onconnect();break;case r.EVENT:case r.BINARY_EVENT:this.onevent(e);break;case r.ACK:case r.BINARY_ACK:this.onack(e);break;case r.DISCONNECT:this.ondisconnect();break;case r.ERROR:this.emit("error",e.data)}},l.prototype.onevent=function(e){var t=e.data||[];c("emitting event %j",t),null!=e.id&&(c("attaching ack callback to event"),t.push(this.ack(e.id))),this.connected?h.apply(this,t):this.receiveBuffer.push(t)},l.prototype.ack=function(e){var t=this,n=!1;return function(){if(!n){n=!0;var i=o(arguments);c("sending ack %j",i);var s=u(i)?r.BINARY_ACK:r.ACK;t.packet({type:s,id:e,data:i})}}},l.prototype.onack=function(e){var t=this.acks[e.id];"function"==typeof t?(c("calling ack %s with %j",e.id,e.data),t.apply(this,e.data),delete this.acks[e.id]):c("bad ack %s",e.id)},l.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},l.prototype.emitBuffered=function(){var e;for(e=0;e<this.receiveBuffer.length;e++)h.apply(this,this.receiveBuffer[e]);for(this.receiveBuffer=[],e=0;e<this.sendBuffer.length;e++)this.packet(this.sendBuffer[e]);this.sendBuffer=[]},l.prototype.ondisconnect=function(){c("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},l.prototype.destroy=function(){if(this.subs){for(var e=0;e<this.subs.length;e++)this.subs[e].destroy();this.subs=null}this.io.destroy(this)},l.prototype.close=l.prototype.disconnect=function(){return this.connected&&(c("performing disconnect (%s)",this.nsp),this.packet({type:r.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},l.prototype.compress=function(e){return this.flags=this.flags||{},this.flags.compress=e,this}},function(e,t,n){function r(e){if(e)return function(e){for(var t in r.prototype)e[t]=r.prototype[t];return e}(e)}e.exports=r,r.prototype.on=r.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},r.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},r.prototype.off=r.prototype.removeListener=r.prototype.removeAllListeners=r.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,r=this._callbacks["$"+e];if(!r)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var i=0;i<r.length;i++)if((n=r[i])===t||n.fn===t){r.splice(i,1);break}return this},r.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),n=this._callbacks["$"+e];if(n)for(var r=0,i=(n=n.slice(0)).length;r<i;++r)n[r].apply(this,t);return this},r.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},r.prototype.hasListeners=function(e){return!!this.listeners(e).length}},function(e,t){e.exports=function(e,t,n){return e.on(t,n),{destroy:function(){e.removeListener(t,n)}}}},function(e,t){var n=[].slice;e.exports=function(e,t){if("string"==typeof t&&(t=e[t]),"function"!=typeof t)throw new Error("bind() requires a function");var r=n.call(arguments,2);return function(){return t.apply(e,r.concat(n.call(arguments)))}}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t,n){"use strict";(function(t,r){var i=n(9);e.exports=b;var o,s=n(35);b.ReadableState=v;n(17).EventEmitter;var a=function(e,t){return e.listeners(t).length},c=n(37),u=n(10).Buffer,f=t.Uint8Array||function(){};var h=n(5);h.inherits=n(4);var l=n(88),d=void 0;d=l&&l.debuglog?l.debuglog("stream"):function(){};var p,g=n(89),m=n(38);h.inherits(b,c);var y=["error","close","destroy","pause","resume"];function v(e,t){e=e||{};var r=t instanceof(o=o||n(2));this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var i=e.highWaterMark,s=e.readableHighWaterMark,a=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:r&&(s||0===s)?s:a,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new g,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(p||(p=n(39).StringDecoder),this.decoder=new p(e.encoding),this.encoding=e.encoding)}function b(e){if(o=o||n(2),!(this instanceof b))return new b(e);this._readableState=new v(e,this),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),c.call(this)}function _(e,t,n,r,i){var o,s=e._readableState;null===t?(s.reading=!1,function(e,t){if(t.ended)return;if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,x(e)}(e,s)):(i||(o=function(e,t){var n;r=t,u.isBuffer(r)||r instanceof f||"string"==typeof t||void 0===t||e.objectMode||(n=new TypeError("Invalid non-string/buffer chunk"));var r;return n}(s,t)),o?e.emit("error",o):s.objectMode||t&&t.length>0?("string"==typeof t||s.objectMode||Object.getPrototypeOf(t)===u.prototype||(t=function(e){return u.from(e)}(t)),r?s.endEmitted?e.emit("error",new Error("stream.unshift() after end event")):w(e,s,t,!0):s.ended?e.emit("error",new Error("stream.push() after EOF")):(s.reading=!1,s.decoder&&!n?(t=s.decoder.write(t),s.objectMode||0!==t.length?w(e,s,t,!1):A(e,s)):w(e,s,t,!1))):r||(s.reading=!1));return function(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}(s)}function w(e,t,n,r){t.flowing&&0===t.length&&!t.sync?(e.emit("data",n),e.read(0)):(t.length+=t.objectMode?1:n.length,r?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&x(e)),A(e,t)}Object.defineProperty(b.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),b.prototype.destroy=m.destroy,b.prototype._undestroy=m.undestroy,b.prototype._destroy=function(e,t){this.push(null),t(e)},b.prototype.push=function(e,t){var n,r=this._readableState;return r.objectMode?n=!0:"string"==typeof e&&((t=t||r.defaultEncoding)!==r.encoding&&(e=u.from(e,t),t=""),n=!0),_(this,e,t,!1,n)},b.prototype.unshift=function(e){return _(this,e,null,!0,!1)},b.prototype.isPaused=function(){return!1===this._readableState.flowing},b.prototype.setEncoding=function(e){return p||(p=n(39).StringDecoder),this._readableState.decoder=new p(e),this._readableState.encoding=e,this};var k=8388608;function E(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=k?e=k:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function x(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(d("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?i.nextTick(S,e):S(e))}function S(e){d("emit readable"),e.emit("readable"),I(e)}function A(e,t){t.readingMore||(t.readingMore=!0,i.nextTick(C,e,t))}function C(e,t){for(var n=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(d("maybeReadMore read 0"),e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}function T(e){d("readable nexttick read 0"),e.read(0)}function B(e,t){t.reading||(d("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),I(e),t.flowing&&!t.reading&&e.read(0)}function I(e){var t=e._readableState;for(d("flow",t.flowing);t.flowing&&null!==e.read(););}function R(e,t){return 0===t.length?null:(t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):n=function(e,t,n){var r;e<t.head.data.length?(r=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):r=e===t.head.data.length?t.shift():n?function(e,t){var n=t.head,r=1,i=n.data;e-=i.length;for(;n=n.next;){var o=n.data,s=e>o.length?o.length:e;if(s===o.length?i+=o:i+=o.slice(0,e),0===(e-=s)){s===o.length?(++r,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n,n.data=o.slice(s));break}++r}return t.length-=r,i}(e,t):function(e,t){var n=u.allocUnsafe(e),r=t.head,i=1;r.data.copy(n),e-=r.data.length;for(;r=r.next;){var o=r.data,s=e>o.length?o.length:e;if(o.copy(n,n.length-e,0,s),0===(e-=s)){s===o.length?(++i,r.next?t.head=r.next:t.head=t.tail=null):(t.head=r,r.data=o.slice(s));break}++i}return t.length-=i,n}(e,t);return r}(e,t.buffer,t.decoder),n);var n}function L(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,i.nextTick(O,t,e))}function O(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function P(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}b.prototype.read=function(e){d("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return d("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?L(this):x(this),null;if(0===(e=E(e,t))&&t.ended)return 0===t.length&&L(this),null;var r,i=t.needReadable;return d("need readable",i),(0===t.length||t.length-e<t.highWaterMark)&&d("length less than watermark",i=!0),t.ended||t.reading?d("reading or ended",i=!1):i&&(d("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=E(n,t))),null===(r=e>0?R(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&L(this)),null!==r&&this.emit("data",r),r},b.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},b.prototype.pipe=function(e,t){var n=this,o=this._readableState;switch(o.pipesCount){case 0:o.pipes=e;break;case 1:o.pipes=[o.pipes,e];break;default:o.pipes.push(e)}o.pipesCount+=1,d("pipe count=%d opts=%j",o.pipesCount,t);var c=(!t||!1!==t.end)&&e!==r.stdout&&e!==r.stderr?f:b;function u(t,r){d("onunpipe"),t===n&&r&&!1===r.hasUnpiped&&(r.hasUnpiped=!0,d("cleanup"),e.removeListener("close",y),e.removeListener("finish",v),e.removeListener("drain",h),e.removeListener("error",m),e.removeListener("unpipe",u),n.removeListener("end",f),n.removeListener("end",b),n.removeListener("data",g),l=!0,!o.awaitDrain||e._writableState&&!e._writableState.needDrain||h())}function f(){d("onend"),e.end()}o.endEmitted?i.nextTick(c):n.once("end",c),e.on("unpipe",u);var h=function(e){return function(){var t=e._readableState;d("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&a(e,"data")&&(t.flowing=!0,I(e))}}(n);e.on("drain",h);var l=!1;var p=!1;function g(t){d("ondata"),p=!1,!1!==e.write(t)||p||((1===o.pipesCount&&o.pipes===e||o.pipesCount>1&&-1!==P(o.pipes,e))&&!l&&(d("false write response, pause",n._readableState.awaitDrain),n._readableState.awaitDrain++,p=!0),n.pause())}function m(t){d("onerror",t),b(),e.removeListener("error",m),0===a(e,"error")&&e.emit("error",t)}function y(){e.removeListener("finish",v),b()}function v(){d("onfinish"),e.removeListener("close",y),b()}function b(){d("unpipe"),n.unpipe(e)}return n.on("data",g),function(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?s(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}(e,"error",m),e.once("close",y),e.once("finish",v),e.emit("pipe",n),o.flowing||(d("pipe resume"),n.resume()),e},b.prototype.unpipe=function(e){var t=this._readableState,n={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,n),this);if(!e){var r=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var o=0;o<i;o++)r[o].emit("unpipe",this,n);return this}var s=P(t.pipes,e);return-1===s?this:(t.pipes.splice(s,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,n),this)},b.prototype.on=function(e,t){var n=c.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var r=this._readableState;r.endEmitted||r.readableListening||(r.readableListening=r.needReadable=!0,r.emittedReadable=!1,r.reading?r.length&&x(this):i.nextTick(T,this))}return n},b.prototype.addListener=b.prototype.on,b.prototype.resume=function(){var e=this._readableState;return e.flowing||(d("resume"),e.flowing=!0,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,i.nextTick(B,e,t))}(this,e)),this},b.prototype.pause=function(){return d("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(d("pause"),this._readableState.flowing=!1,this.emit("pause")),this},b.prototype.wrap=function(e){var t=this,n=this._readableState,r=!1;for(var i in e.on("end",(function(){if(d("wrapped end"),n.decoder&&!n.ended){var e=n.decoder.end();e&&e.length&&t.push(e)}t.push(null)})),e.on("data",(function(i){(d("wrapped data"),n.decoder&&(i=n.decoder.write(i)),n.objectMode&&null==i)||(n.objectMode||i&&i.length)&&(t.push(i)||(r=!0,e.pause()))})),e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));for(var o=0;o<y.length;o++)e.on(y[o],this.emit.bind(this,y[o]));return this._read=function(t){d("wrapped _read",t),r&&(r=!1,e.resume())},this},Object.defineProperty(b.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),b._fromList=R}).call(this,n(0),n(1))},function(e,t,n){e.exports=n(17).EventEmitter},function(e,t,n){"use strict";var r=n(9);function i(e,t){e.emit("error",t)}e.exports={destroy:function(e,t){var n=this,o=this._readableState&&this._readableState.destroyed,s=this._writableState&&this._writableState.destroyed;return o||s?(t?t(e):!e||this._writableState&&this._writableState.errorEmitted||r.nextTick(i,this,e),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,(function(e){!t&&e?(r.nextTick(i,n,e),n._writableState&&(n._writableState.errorEmitted=!0)):t&&t(e)})),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},function(e,t,n){"use strict";var r=n(10).Buffer,i=r.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function o(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(r.isEncoding===i||!i(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=c,this.end=u,t=4;break;case"utf8":this.fillLast=a,t=4;break;case"base64":this.text=f,this.end=h,t=3;break;default:return this.write=l,void(this.end=d)}this.lastNeed=0,this.lastTotal=0,this.lastChar=r.allocUnsafe(t)}function s(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function a(e){var t=this.lastTotal-this.lastNeed,n=function(e,t,n){if(128!=(192&t[0]))return e.lastNeed=0,"";if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"";if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,""}}(this,e);return void 0!==n?n:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function c(e,t){if((e.length-t)%2==0){var n=e.toString("utf16le",t);if(n){var r=n.charCodeAt(n.length-1);if(r>=55296&&r<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],n.slice(0,-1)}return n}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function u(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var n=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,n)}return t}function f(e,t){var n=(e.length-t)%3;return 0===n?e.toString("base64",t):(this.lastNeed=3-n,this.lastTotal=3,1===n?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-n))}function h(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function l(e){return e.toString(this.encoding)}function d(e){return e&&e.length?this.write(e):""}t.StringDecoder=o,o.prototype.write=function(e){if(0===e.length)return"";var t,n;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";n=this.lastNeed,this.lastNeed=0}else n=0;return n<e.length?t?t+this.text(e,n):this.text(e,n):t||""},o.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"":t},o.prototype.text=function(e,t){var n=function(e,t,n){var r=t.length-1;if(r<n)return 0;var i=s(t[r]);if(i>=0)return i>0&&(e.lastNeed=i-1),i;if(--r<n||-2===i)return 0;if((i=s(t[r]))>=0)return i>0&&(e.lastNeed=i-2),i;if(--r<n||-2===i)return 0;if((i=s(t[r]))>=0)return i>0&&(2===i?i=0:e.lastNeed=i-3),i;return 0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=n;var r=e.length-(n-this.lastNeed);return e.copy(this.lastChar,0,r),e.toString("utf8",t,r)},o.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},function(e,t,n){"use strict";e.exports=s;var r=n(2),i=n(5);function o(e,t){var n=this._transformState;n.transforming=!1;var r=n.writecb;if(!r)return this.emit("error",new Error("write callback called multiple times"));n.writechunk=null,n.writecb=null,null!=t&&this.push(t),r(e);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function s(e){if(!(this instanceof s))return new s(e);r.call(this,e),this._transformState={afterTransform:o.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",a)}function a(){var e=this;"function"==typeof this._flush?this._flush((function(t,n){c(e,t,n)})):c(this,null,null)}function c(e,t,n){if(t)return e.emit("error",t);if(null!=n&&e.push(n),e._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(e._transformState.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}i.inherits=n(4),i.inherits(s,r),s.prototype.push=function(e,t){return this._transformState.needTransform=!1,r.prototype.push.call(this,e,t)},s.prototype._transform=function(e,t,n){throw new Error("_transform() is not implemented")},s.prototype._write=function(e,t,n){var r=this._transformState;if(r.writecb=n,r.writechunk=e,r.writeencoding=t,!r.transforming){var i=this._readableState;(r.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},s.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},s.prototype._destroy=function(e,t){var n=this;r.prototype._destroy.call(this,e,(function(e){t(e),n.emit("close")}))}},function(e,t,n){"use strict";(function(n,r){var i,o,s,a;function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(n){"object"==c(t)&&void 0!==e?e.exports=n():(o=[],void 0===(s="function"==typeof(i=n)?i.apply(t,o):i)||(e.exports=s))}((function(){return function e(t,n,r){function i(s,c){if(!n[s]){if(!t[s]){if(!c&&("function"==typeof a&&a))return a(s,!0);if(o)return o(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var f=n[s]={exports:{}};t[s][0].call(f.exports,(function(e){return i(t[s][1][e]||e)}),f,f.exports,e,t,n,r)}return n[s].exports}for(var o="function"==typeof a&&a,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(e,t,n){function r(e,t){s.Readable.call(this,t),this.destroyed=!1,this._torrent=e._torrent;var n=t&&t.start||0,r=t&&t.end&&t.end<e.length?t.end:e.length-1,i=e._torrent.pieceLength;this._startPiece=(n+e.offset)/i|0,this._endPiece=(r+e.offset)/i|0,this._piece=this._startPiece,this._offset=n+e.offset-this._startPiece*i,this._missing=r-n+1,this._reading=!1,this._notifying=!1,this._criticalLength=Math.min(1048576/i|0,2)}t.exports=r;var i=e("debug")("webtorrent:file-stream"),o=e("inherits"),s=e("readable-stream");o(r,s.Readable),r.prototype._read=function(){this._reading||(this._reading=!0,this._notify())},r.prototype._notify=function(){var e=this;if(e._reading&&0!==e._missing){if(!e._torrent.bitfield.get(e._piece))return e._torrent.critical(e._piece,e._piece+e._criticalLength);if(!e._notifying){e._notifying=!0;var t=e._piece;e._torrent.store.get(t,(function(n,r){if(e._notifying=!1,!e.destroyed){if(n)return e._destroy(n);i("read %s (length %s) (err %s)",t,r.length,n&&n.message),e._offset&&(r=r.slice(e._offset),e._offset=0),e._missing<r.length&&(r=r.slice(0,e._missing)),e._missing-=r.length,i("pushing buffer of length %s",r.length),e._reading=!1,e.push(r),0===e._missing&&e.push(null)}})),e._piece+=1}}},r.prototype.destroy=function(e){this._destroy(null,e)},r.prototype._destroy=function(e,t){this.destroyed||(this.destroyed=!0,this._torrent.destroyed||this._torrent.deselect(this._startPiece,this._endPiece,!0),e&&this.emit("error",e),this.emit("close"),t&&t())}},{debug:30,inherits:41,"readable-stream":82}],2:[function(e,t,n){(function(n){function r(e,t){o.call(this),this._torrent=e,this._destroyed=!1,this.name=t.name,this.path=t.path,this.length=t.length,this.offset=t.offset,this.done=!1;var n=t.offset,r=n+t.length-1;this._startPiece=n/this._torrent.pieceLength|0,this._endPiece=r/this._torrent.pieceLength|0,0===this.length&&(this.done=!0,this.emit("done"))}t.exports=r;var i=e("end-of-stream"),o=e("events").EventEmitter,s=e("./file-stream"),a=e("inherits"),c=e("path"),u=e("render-media"),f=e("readable-stream"),h=e("stream-to-blob"),l=e("stream-to-blob-url"),d=e("stream-with-known-length-to-buffer");a(r,o),Object.defineProperty(r.prototype,"downloaded",{get:function(){if(!this._torrent.bitfield)return 0;for(var e=0,t=this._startPiece;t<=this._endPiece;++t)if(this._torrent.bitfield.get(t))e+=this._torrent.pieceLength;else{var n=this._torrent.pieces[t];e+=n.length-n.missing}return e}}),r.prototype.select=function(e){0!==this.length&&this._torrent.select(this._startPiece,this._endPiece,e)},r.prototype.deselect=function(){0!==this.length&&this._torrent.deselect(this._startPiece,this._endPiece,!1)},r.prototype.createReadStream=function(e){var t=this;if(0===this.length){var r=new f.PassThrough;return n.nextTick((function(){r.end()})),r}var o=new s(t,e);return t._torrent.select(o._startPiece,o._endPiece,!0,(function(){o._notify()})),i(o,(function(){t._destroyed||t._torrent.destroyed||t._torrent.deselect(o._startPiece,o._endPiece,!0)})),o},r.prototype.getBuffer=function(e){d(this.createReadStream(),this.length,e)},r.prototype.getBlob=function(e){if("undefined"==typeof window)throw new Error("browser-only method");h(this.createReadStream(),this._getMimeType(),e)},r.prototype.getBlobURL=function(e){if("undefined"==typeof window)throw new Error("browser-only method");l(this.createReadStream(),this._getMimeType(),e)},r.prototype.appendTo=function(e,t,n){if("undefined"==typeof window)throw new Error("browser-only method");u.append(this,e,t,n)},r.prototype.renderTo=function(e,t,n){if("undefined"==typeof window)throw new Error("browser-only method");u.render(this,e,t,n)},r.prototype._getMimeType=function(){return u.mime[c.extname(this.name).toLowerCase()]},r.prototype._destroy=function(){this._destroyed=!0,this._torrent=null}}).call(this,e("_process"))},{"./file-stream":1,_process:66,"end-of-stream":33,events:34,inherits:41,path:63,"readable-stream":82,"render-media":83,"stream-to-blob":100,"stream-to-blob-url":99,"stream-with-known-length-to-buffer":101}],3:[function(e,t,n){function r(e,t){var n=this;n.id=e,n.type=t,s("new Peer %s",e),n.addr=null,n.conn=null,n.swarm=null,n.wire=null,n.connected=!1,n.destroyed=!1,n.timeout=null,n.retries=0,n.sentHandshake=!1}function i(){}var o=e("unordered-array-remove"),s=e("debug")("webtorrent:peer"),a=e("bittorrent-protocol"),c=e("./webconn");n.createWebRTCPeer=function(e,t){var n=new r(e.id,"webrtc");return n.conn=e,n.swarm=t,n.conn.connected?n.onConnect():(n.conn.once("connect",(function(){n.onConnect()})),n.conn.once("error",(function(e){n.destroy(e)})),n.startConnectTimeout()),n},n.createTCPIncomingPeer=function(e){var t=e.remoteAddress+":"+e.remotePort,n=new r(t,"tcpIncoming");return n.conn=e,n.addr=t,n.onConnect(),n},n.createTCPOutgoingPeer=function(e,t){var n=new r(e,"tcpOutgoing");return n.addr=e,n.swarm=t,n},n.createWebSeedPeer=function(e,t){var n=new r(e,"webSeed");return n.swarm=t,n.conn=new c(e,t),n.onConnect(),n},r.prototype.onConnect=function(){var e=this;if(!e.destroyed){e.connected=!0,s("Peer %s connected",e.id),clearTimeout(e.connectTimeout);var t=e.conn;t.once("end",(function(){e.destroy()})),t.once("close",(function(){e.destroy()})),t.once("finish",(function(){e.destroy()})),t.once("error",(function(t){e.destroy(t)}));var n=e.wire=new a;n.type=e.type,n.once("end",(function(){e.destroy()})),n.once("close",(function(){e.destroy()})),n.once("finish",(function(){e.destroy()})),n.once("error",(function(t){e.destroy(t)})),n.once("handshake",(function(t,n){e.onHandshake(t,n)})),e.startHandshakeTimeout(),t.pipe(n).pipe(t),e.swarm&&!e.sentHandshake&&e.handshake()}},r.prototype.onHandshake=function(e,t){var n=this;if(n.swarm&&!n.destroyed){if(n.swarm.destroyed)return n.destroy(new Error("swarm already destroyed"));if(e!==n.swarm.infoHash)return n.destroy(new Error("unexpected handshake info hash for this swarm"));if(t===n.swarm.peerId)return n.destroy(new Error("refusing to connect to ourselves"));s("Peer %s got handshake %s",n.id,e),clearTimeout(n.handshakeTimeout),n.retries=0;var r=n.addr;!r&&n.conn.remoteAddress&&(r=n.conn.remoteAddress+":"+n.conn.remotePort),n.swarm._onWire(n.wire,r),n.swarm&&!n.swarm.destroyed&&(n.sentHandshake||n.handshake())}},r.prototype.handshake=function(){var e=this,t={dht:!e.swarm.private&&!!e.swarm.client.dht};e.wire.handshake(e.swarm.infoHash,e.swarm.client.peerId,t),e.sentHandshake=!0},r.prototype.startConnectTimeout=function(){var e=this;clearTimeout(e.connectTimeout),e.connectTimeout=setTimeout((function(){e.destroy(new Error("connect timeout"))}),"webrtc"===e.type?25e3:5e3),e.connectTimeout.unref&&e.connectTimeout.unref()},r.prototype.startHandshakeTimeout=function(){var e=this;clearTimeout(e.handshakeTimeout),e.handshakeTimeout=setTimeout((function(){e.destroy(new Error("handshake timeout"))}),25e3),e.handshakeTimeout.unref&&e.handshakeTimeout.unref()},r.prototype.destroy=function(e){var t=this;if(!t.destroyed){t.destroyed=!0,t.connected=!1,s("destroy %s (error: %s)",t.id,e&&(e.message||e)),clearTimeout(t.connectTimeout),clearTimeout(t.handshakeTimeout);var n=t.swarm,r=t.conn,a=t.wire;t.swarm=null,t.conn=null,t.wire=null,n&&a&&o(n.wires,n.wires.indexOf(a)),r&&(r.on("error",i),r.destroy()),a&&a.destroy(),n&&n.removePeer(t.id)}}},{"./webconn":6,"bittorrent-protocol":14,debug:30,"unordered-array-remove":111}],4:[function(e,t,n){function r(e){var t=this;t._torrent=e,t._numPieces=e.pieces.length,t._pieces=[],t._onWire=function(e){t.recalculate(),t._initWire(e)},t._onWireHave=function(e){t._pieces[e]+=1},t._onWireBitfield=function(){t.recalculate()},t._torrent.wires.forEach((function(e){t._initWire(e)})),t._torrent.on("wire",t._onWire),t.recalculate()}function i(){return!0}t.exports=r,r.prototype.getRarestPiece=function(e){e||(e=i);for(var t=[],n=1/0,r=0;r<this._numPieces;++r)if(e(r)){var o=this._pieces[r];o===n?t.push(r):o<n&&(t=[r],n=o)}return t.length>0?t[Math.random()*t.length|0]:-1},r.prototype.destroy=function(){var e=this;e._torrent.removeListener("wire",e._onWire),e._torrent.wires.forEach((function(t){e._cleanupWireEvents(t)})),e._torrent=null,e._pieces=null,e._onWire=null,e._onWireHave=null,e._onWireBitfield=null},r.prototype._initWire=function(e){var t=this;e._onClose=function(){t._cleanupWireEvents(e);for(var n=0;n<this._numPieces;++n)t._pieces[n]-=e.peerPieces.get(n)},e.on("have",t._onWireHave),e.on("bitfield",t._onWireBitfield),e.once("close",e._onClose)},r.prototype.recalculate=function(){var e;for(e=0;e<this._numPieces;++e)this._pieces[e]=0;var t=this._torrent.wires.length;for(e=0;e<t;++e)for(var n=this._torrent.wires[e],r=0;r<this._numPieces;++r)this._pieces[r]+=n.peerPieces.get(r)},r.prototype._cleanupWireEvents=function(e){e.removeListener("have",this._onWireHave),e.removeListener("bitfield",this._onWireBitfield),e._onClose&&e.removeListener("close",e._onClose),e._onClose=null}},{}],5:[function(e,t,r){(function(n,r){function i(e,t,n){d.call(this),this._debugId="unknown infohash",this.client=t,this.announce=n.announce,this.urlList=n.urlList,this.path=n.path,this._store=n.store||y,this._getAnnounceOpts=n.getAnnounceOpts,this.strategy=n.strategy||"sequential",this.maxWebConns=n.maxWebConns||4,this._rechokeNumSlots=!1===n.uploads||0===n.uploads?0:+n.uploads||10,this._rechokeOptimisticWire=null,this._rechokeOptimisticTime=0,this._rechokeIntervalId=null,this.ready=!1,this.destroyed=!1,this.paused=!1,this.done=!1,this.metadata=null,this.store=null,this.files=[],this.pieces=[],this._amInterested=!1,this._selections=[],this._critical=[],this.wires=[],this._queue=[],this._peers={},this._peersLength=0,this.received=0,this.uploaded=0,this._downloadSpeed=L(),this._uploadSpeed=L(),this._servers=[],this._xsRequests=[],this._fileModtimes=n.fileModtimes,null!==e&&this._onTorrentId(e),this._debug("new torrent")}function o(e,t){return 2+Math.ceil(t*e.downloadSpeed()/T.BLOCK_LENGTH)}function s(){}t.exports=i;var a,c=e("addr-to-ip-port"),u=e("bitfield"),f=e("chunk-store-stream/write"),h=e("debug")("webtorrent:torrent"),l=e("torrent-discovery"),d=e("events").EventEmitter,p=e("xtend"),g=e("xtend/mutable"),m=e("fs"),y=e("fs-chunk-store"),v=e("simple-get"),b=e("immediate-chunk-store"),_=e("inherits"),w=e("multistream"),k=e("net"),E=e("os"),x=e("run-parallel"),S=e("run-parallel-limit"),A=e("parse-torrent"),C=e("path"),T=e("torrent-piece"),B=e("pump"),I=e("random-iterate"),R=e("simple-sha1"),L=e("speedometer"),O=e("uniq"),P=e("ut_metadata"),U=e("ut_pex"),M=e("./file"),j=e("./peer"),N=e("./rarity-map"),D=e("./server"),q=5e3,H=3*T.BLOCK_LENGTH,F=[1e3,5e3,15e3],z="WebTorrent/"+e("../package.json").version+" (https://webtorrent.io)";try{a=C.join(m.statSync("/tmp")&&"/tmp","webtorrent")}catch(e){a=C.join("function"==typeof E.tmpdir?E.tmpdir():"/","webtorrent")}_(i,d),Object.defineProperty(i.prototype,"timeRemaining",{get:function(){return this.done?0:0===this.downloadSpeed?1/0:(this.length-this.downloaded)/this.downloadSpeed*1e3}}),Object.defineProperty(i.prototype,"downloaded",{get:function(){if(!this.bitfield)return 0;for(var e=0,t=0,n=this.pieces.length;t<n;++t)if(this.bitfield.get(t))e+=t===n-1?this.lastPieceLength:this.pieceLength;else{var r=this.pieces[t];e+=r.length-r.missing}return e}}),Object.defineProperty(i.prototype,"downloadSpeed",{get:function(){return this._downloadSpeed()}}),Object.defineProperty(i.prototype,"uploadSpeed",{get:function(){return this._uploadSpeed()}}),Object.defineProperty(i.prototype,"progress",{get:function(){return this.length?this.downloaded/this.length:0}}),Object.defineProperty(i.prototype,"ratio",{get:function(){return this.uploaded/(this.received||1)}}),Object.defineProperty(i.prototype,"numPeers",{get:function(){return this.wires.length}}),Object.defineProperty(i.prototype,"torrentFileBlobURL",{get:function(){if("undefined"==typeof window)throw new Error("browser-only property");return this.torrentFile?URL.createObjectURL(new Blob([this.torrentFile],{type:"application/x-bittorrent"})):null}}),Object.defineProperty(i.prototype,"_numQueued",{get:function(){return this._queue.length+(this._peersLength-this._numConns)}}),Object.defineProperty(i.prototype,"_numConns",{get:function(){var e=0;for(var t in this._peers)this._peers[t].connected&&(e+=1);return e}}),Object.defineProperty(i.prototype,"swarm",{get:function(){return console.warn("WebTorrent: `torrent.swarm` is deprecated. Use `torrent` directly instead."),this}}),i.prototype._onTorrentId=function(e){var t=this;if(!t.destroyed){var r;try{r=A(e)}catch(e){}r?(t.infoHash=r.infoHash,t._debugId=r.infoHash.toString("hex").substring(0,7),n.nextTick((function(){t.destroyed||t._onParsedTorrent(r)}))):A.remote(e,(function(e,n){if(!t.destroyed)return e?t._destroy(e):void t._onParsedTorrent(n)}))}},i.prototype._onParsedTorrent=function(e){var t=this;if(!t.destroyed){if(t._processParsedTorrent(e),!t.infoHash)return t._destroy(new Error("Malformed torrent data: No info hash"));t.path||(t.path=C.join(a,t.infoHash)),t._rechokeIntervalId=setInterval((function(){t._rechoke()}),1e4),t._rechokeIntervalId.unref&&t._rechokeIntervalId.unref(),t.emit("_infoHash",t.infoHash),t.destroyed||(t.emit("infoHash",t.infoHash),t.destroyed||(t.client.listening?t._onListening():t.client.once("listening",(function(){t._onListening()}))))}},i.prototype._processParsedTorrent=function(e){this._debugId=e.infoHash.toString("hex").substring(0,7),this.announce&&(e.announce=e.announce.concat(this.announce)),this.client.tracker&&r.WEBTORRENT_ANNOUNCE&&!this.private&&(e.announce=e.announce.concat(r.WEBTORRENT_ANNOUNCE)),this.urlList&&(e.urlList=e.urlList.concat(this.urlList)),O(e.announce),O(e.urlList),g(this,e),this.magnetURI=A.toMagnetURI(e),this.torrentFile=A.toTorrentFile(e)},i.prototype._onListening=function(){var e=this;if(!e.discovery&&!e.destroyed){var t=e.client.tracker;t&&(t=p(e.client.tracker,{getAnnounceOpts:function(){var t={uploaded:e.uploaded,downloaded:e.downloaded,left:Math.max(e.length-e.downloaded,0)};return e.client.tracker.getAnnounceOpts&&g(t,e.client.tracker.getAnnounceOpts()),e._getAnnounceOpts&&g(t,e._getAnnounceOpts()),t}})),e.discovery=new l({infoHash:e.infoHash,announce:e.announce,peerId:e.client.peerId,dht:!e.private&&e.client.dht,tracker:t,port:e.client.torrentPort,userAgent:z}),e.discovery.on("error",(function(t){e._destroy(t)})),e.discovery.on("peer",(function(t){"string"==typeof t&&e.done||e.addPeer(t)})),e.discovery.on("trackerAnnounce",(function(){e.emit("trackerAnnounce"),0===e.numPeers&&e.emit("noPeers","tracker")})),e.discovery.on("dhtAnnounce",(function(){e.emit("dhtAnnounce"),0===e.numPeers&&e.emit("noPeers","dht")})),e.discovery.on("warning",(function(t){e.emit("warning",t)})),e.info?e._onMetadata(e):e.xs&&e._getMetadataFromServer()}},i.prototype._getMetadataFromServer=function(){function e(e,n){if(0!==e.indexOf("http://")&&0!==e.indexOf("https://"))return t.emit("warning",new Error("skipping non-http xs param: "+e)),n(null);var r,i={url:e,method:"GET",headers:{"user-agent":z}};try{r=v.concat(i,(function(r,i,o){if(t.destroyed)return n(null);if(t.metadata)return n(null);if(r)return t.emit("warning",new Error("http error from xs param: "+e)),n(null);if(200!==i.statusCode)return t.emit("warning",new Error("non-200 status code "+i.statusCode+" from xs param: "+e)),n(null);var s;try{s=A(o)}catch(r){}return s?s.infoHash!==t.infoHash?(t.emit("warning",new Error("got torrent file with incorrect info hash from xs param: "+e)),n(null)):(t._onMetadata(s),void n(null)):(t.emit("warning",new Error("got invalid torrent file from xs param: "+e)),n(null))}))}catch(r){return t.emit("warning",new Error("skipping invalid url xs param: "+e)),n(null)}t._xsRequests.push(r)}var t=this,n=(Array.isArray(t.xs)?t.xs:[t.xs]).map((function(t){return function(n){e(t,n)}}));x(n)},i.prototype._onMetadata=function(e){var t=this;if(!t.metadata&&!t.destroyed){var n;if(t._debug("got metadata"),t._xsRequests.forEach((function(e){e.abort()})),t._xsRequests=[],e&&e.infoHash)n=e;else try{n=A(e)}catch(e){return t._destroy(e)}t._processParsedTorrent(n),t.metadata=t.torrentFile,t.client.enableWebSeeds&&t.urlList.forEach((function(e){t.addWebSeed(e)})),0!==t.pieces.length&&t.select(0,t.pieces.length-1,!1),t._rarityMap=new N(t),t.store=new b(new t._store(t.pieceLength,{torrent:{infoHash:t.infoHash},files:t.files.map((function(e){return{path:C.join(t.path,e.path),length:e.length,offset:e.offset}})),length:t.length})),t.files=t.files.map((function(e){return new M(t,e)})),t._hashes=t.pieces,t.pieces=t.pieces.map((function(e,n){var r=n===t.pieces.length-1?t.lastPieceLength:t.pieceLength;return new T(r)})),t._reservations=t.pieces.map((function(){return[]})),t.bitfield=new u(t.pieces.length),t.wires.forEach((function(e){e.ut_metadata&&e.ut_metadata.setMetadata(t.metadata),t._onWireWithMetadata(e)})),t._debug("verifying existing torrent data"),t._fileModtimes&&t._store===y?t.getFileModtimes((function(e,n){if(e)return t._destroy(e);if(t.files.map((function(e,r){return n[r]===t._fileModtimes[r]})).every((function(e){return e}))){for(var r=0;r<t.pieces.length;r++)t._markVerified(r);t._onStore()}else t._verifyPieces()})):t._verifyPieces(),t.emit("metadata")}},i.prototype.getFileModtimes=function(e){var t=this,n=[];S(t.files.map((function(e,r){return function(i){m.stat(C.join(t.path,e.path),(function(e,t){if(e&&"ENOENT"!==e.code)return i(e);n[r]=t&&t.mtime.getTime(),i(null)}))}})),2,(function(r){t._debug("done getting file modtimes"),e(r,n)}))},i.prototype._verifyPieces=function(){var e=this;S(e.pieces.map((function(t,r){return function(t){if(e.destroyed)return t(new Error("torrent is destroyed"));e.store.get(r,(function(i,o){return e.destroyed?t(new Error("torrent is destroyed")):i?n.nextTick(t,null):void R(o,(function(n){if(e.destroyed)return t(new Error("torrent is destroyed"));if(n===e._hashes[r]){if(!e.pieces[r])return;e._debug("piece verified %s",r),e._markVerified(r)}else e._debug("piece invalid %s",r);t(null)}))}))}})),2,(function(t){if(t)return e._destroy(t);e._debug("done verifying"),e._onStore()}))},i.prototype._markVerified=function(e){this.pieces[e]=null,this._reservations[e]=null,this.bitfield.set(e,!0)},i.prototype._onStore=function(){var e=this;e.destroyed||(e._debug("on store"),e.ready=!0,e.emit("ready"),e._checkDone(),e._updateSelections())},i.prototype.destroy=function(e){this._destroy(null,e)},i.prototype._destroy=function(e,t){var n=this;if(!n.destroyed){for(var r in n.destroyed=!0,n._debug("destroy"),n.client._remove(n),clearInterval(n._rechokeIntervalId),n._xsRequests.forEach((function(e){e.abort()})),n._rarityMap&&n._rarityMap.destroy(),n._peers)n.removePeer(r);n.files.forEach((function(e){e instanceof M&&e._destroy()}));var i=n._servers.map((function(e){return function(t){e.destroy(t)}}));n.discovery&&i.push((function(e){n.discovery.destroy(e)})),n.store&&i.push((function(e){n.store.close(e)})),x(i,t),e&&(0===n.listenerCount("error")?n.client.emit("error",e):n.emit("error",e)),n.emit("close"),n.client=null,n.files=[],n.discovery=null,n.store=null,n._rarityMap=null,n._peers=null,n._servers=null,n._xsRequests=null}},i.prototype.addPeer=function(e){var t=this;if(t.destroyed)throw new Error("torrent is destroyed");if(!t.infoHash)throw new Error("addPeer() must not be called before the `infoHash` event");if(t.client.blocked){var n;if("string"==typeof e){var r;try{r=c(e)}catch(n){return t._debug("ignoring peer: invalid %s",e),t.emit("invalidPeer",e),!1}n=r[0]}else"string"==typeof e.remoteAddress&&(n=e.remoteAddress);if(n&&t.client.blocked.contains(n))return t._debug("ignoring peer: blocked %s",e),"string"!=typeof e&&e.destroy(),t.emit("blockedPeer",e),!1}var i=!!t._addPeer(e);return i?t.emit("peer",e):t.emit("invalidPeer",e),i},i.prototype._addPeer=function(e){var t=this;if(t.destroyed)return"string"!=typeof e&&e.destroy(),null;if("string"==typeof e&&!t._validAddr(e))return t._debug("ignoring peer: invalid %s",e),null;var n,r=e&&e.id||e;return t._peers[r]?(t._debug("ignoring peer: duplicate (%s)",r),"string"!=typeof e&&e.destroy(),null):t.paused?(t._debug("ignoring peer: torrent is paused"),"string"!=typeof e&&e.destroy(),null):(t._debug("add peer %s",r),n="string"==typeof e?j.createTCPOutgoingPeer(e,t):j.createWebRTCPeer(e,t),t._peers[n.id]=n,t._peersLength+=1,"string"==typeof e&&(t._queue.push(n),t._drain()),n)},i.prototype.addWebSeed=function(e){if(this.destroyed)throw new Error("torrent is destroyed");if(!/^https?:\/\/.+/.test(e))return this.emit("warning",new Error("ignoring invalid web seed: "+e)),void this.emit("invalidPeer",e);if(this._peers[e])return this.emit("warning",new Error("ignoring duplicate web seed: "+e)),void this.emit("invalidPeer",e);this._debug("add web seed %s",e);var t=j.createWebSeedPeer(e,this);this._peers[t.id]=t,this._peersLength+=1,this.emit("peer",e)},i.prototype._addIncomingPeer=function(e){var t=this;return t.destroyed?e.destroy(new Error("torrent is destroyed")):t.paused?e.destroy(new Error("torrent is paused")):(this._debug("add incoming peer %s",e.id),t._peers[e.id]=e,void(t._peersLength+=1))},i.prototype.removePeer=function(e){var t=this,n=e&&e.id||e;(e=t._peers[n])&&(this._debug("removePeer %s",n),delete t._peers[n],t._peersLength-=1,e.destroy(),t._drain())},i.prototype.select=function(e,t,n,r){var i=this;if(i.destroyed)throw new Error("torrent is destroyed");if(e<0||t<e||i.pieces.length<=t)throw new Error("invalid selection ",e,":",t);n=Number(n)||0,i._debug("select %s-%s (priority %s)",e,t,n),i._selections.push({from:e,to:t,offset:0,priority:n,notify:r||s}),i._selections.sort((function(e,t){return t.priority-e.priority})),i._updateSelections()},i.prototype.deselect=function(e,t,n){var r=this;if(r.destroyed)throw new Error("torrent is destroyed");n=Number(n)||0,r._debug("deselect %s-%s (priority %s)",e,t,n);for(var i=0;i<r._selections.length;++i){var o=r._selections[i];if(o.from===e&&o.to===t&&o.priority===n){r._selections.splice(i,1);break}}r._updateSelections()},i.prototype.critical=function(e,t){var n=this;if(n.destroyed)throw new Error("torrent is destroyed");n._debug("critical %s-%s",e,t);for(var r=e;r<=t;++r)n._critical[r]=!0;n._updateSelections()},i.prototype._onWire=function(e,t){var r=this;if(r._debug("got wire %s (%s)",e._debugId,t||"Unknown"),e.on("download",(function(e){r.destroyed||(r.received+=e,r._downloadSpeed(e),r.client._downloadSpeed(e),r.emit("download",e),r.client.emit("download",e))})),e.on("upload",(function(e){r.destroyed||(r.uploaded+=e,r._uploadSpeed(e),r.client._uploadSpeed(e),r.emit("upload",e),r.client.emit("upload",e))})),r.wires.push(e),t){var i=c(t);e.remoteAddress=i[0],e.remotePort=i[1]}r.client.dht&&r.client.dht.listening&&e.on("port",(function(n){if(!r.destroyed&&!r.client.dht.destroyed){if(!e.remoteAddress)return r._debug("ignoring PORT from peer with no address");if(0===n||n>65536)return r._debug("ignoring invalid PORT from peer");r._debug("port: %s (from %s)",n,t),r.client.dht.addNode({host:e.remoteAddress,port:n})}})),e.on("timeout",(function(){r._debug("wire timeout (%s)",t),e.destroy()})),e.setTimeout(3e4,!0),e.setKeepAlive(!0),e.use(P(r.metadata)),e.ut_metadata.on("warning",(function(e){r._debug("ut_metadata warning: %s",e.message)})),r.metadata||(e.ut_metadata.on("metadata",(function(e){r._debug("got metadata via ut_metadata"),r._onMetadata(e)})),e.ut_metadata.fetch()),"function"!=typeof U||r.private||(e.use(U()),e.ut_pex.on("peer",(function(e){r.done||(r._debug("ut_pex: got peer: %s (from %s)",e,t),r.addPeer(e))})),e.ut_pex.on("dropped",(function(e){var n=r._peers[e];n&&!n.connected&&(r._debug("ut_pex: dropped peer: %s (from %s)",e,t),r.removePeer(e))})),e.once("close",(function(){e.ut_pex.reset()}))),r.emit("wire",e,t),r.metadata&&n.nextTick((function(){r._onWireWithMetadata(e)}))},i.prototype._onWireWithMetadata=function(e){function t(){i.destroyed||e.destroyed||(i._numQueued>2*(i._numConns-i.numPeers)&&e.amInterested?e.destroy():(o=setTimeout(t,q)).unref&&o.unref())}function n(){if(e.peerPieces.buffer.length===i.bitfield.buffer.length){for(r=0;r<i.pieces.length;++r)if(!e.peerPieces.get(r))return;e.isSeeder=!0,e.choke()}}var r,i=this,o=null;e.on("bitfield",(function(){n(),i._update()})),e.on("have",(function(){n(),i._update()})),e.once("interested",(function(){e.unchoke()})),e.once("close",(function(){clearTimeout(o)})),e.on("choke",(function(){clearTimeout(o),(o=setTimeout(t,q)).unref&&o.unref()})),e.on("unchoke",(function(){clearTimeout(o),i._update()})),e.on("request",(function(t,n,r,o){if(r>131072)return e.destroy();i.pieces[t]||i.store.get(t,{offset:n,length:r},o)})),e.bitfield(i.bitfield),e.interested(),e.peerExtensions.dht&&i.client.dht&&i.client.dht.listening&&e.port(i.client.dht.address().port),"webSeed"!==e.type&&((o=setTimeout(t,q)).unref&&o.unref()),e.isSeeder=!1,n()},i.prototype._updateSelections=function(){var e=this;e.ready&&!e.destroyed&&(n.nextTick((function(){e._gcSelections()})),e._updateInterest(),e._update())},i.prototype._gcSelections=function(){for(var e=this,t=0;t<e._selections.length;++t){for(var n=e._selections[t],r=n.offset;e.bitfield.get(n.from+n.offset)&&n.from+n.offset<n.to;)n.offset+=1;r!==n.offset&&n.notify(),n.to===n.from+n.offset&&e.bitfield.get(n.from+n.offset)&&(e._selections.splice(t,1),t-=1,n.notify(),e._updateInterest())}e._selections.length||e.emit("idle")},i.prototype._updateInterest=function(){var e=this,t=e._amInterested;e._amInterested=!!e._selections.length,e.wires.forEach((function(t){e._amInterested?t.interested():t.uninterested()})),t!==e._amInterested&&(e._amInterested?e.emit("interested"):e.emit("uninterested"))},i.prototype._update=function(){var e=this;if(!e.destroyed)for(var t,n=I(e.wires);t=n();)e._updateWire(t)},i.prototype._updateWire=function(e){function t(t,n,r,i){return function(o){return o>=t&&o<=n&&!(o in r)&&e.peerPieces.get(o)&&(!i||i(o))}}function n(e){for(var t=e,n=e;n<i._selections.length&&i._selections[n].priority;n++)t=n;var r=i._selections[e];i._selections[e]=i._selections[t],i._selections[t]=r}function r(r){if(e.requests.length>=a)return!0;for(var o=function(){var t=e.downloadSpeed()||1;if(t>H)return function(){return!0};var n=Math.max(1,e.requests.length)*T.BLOCK_LENGTH/t,r=10,o=0;return function(e){if(!r||i.bitfield.get(e))return!0;for(var s=i.pieces[e].missing;o<i.wires.length;o++){var a=i.wires[o],c=a.downloadSpeed();if(!(c<H)&&!(c<=t)&&a.peerPieces.get(e)&&!((s-=c*n)>0))return r--,!1}return!0}}(),s=0;s<i._selections.length;s++){var c,u=i._selections[s];if("rarest"===i.strategy)for(var f=u.from+u.offset,h=u.to,l=h-f+1,d={},p=0,g=t(f,h,d,o);p<l&&!((c=i._rarityMap.getRarestPiece(g))<0);){for(;i._request(e,c,i._critical[c]||r););if(!(e.requests.length<a))return u.priority&&n(s),!0;d[c]=!0,p++}else for(c=u.from+u.offset;c<=u.to;c++)if(e.peerPieces.get(c)&&o(c)){for(;i._request(e,c,i._critical[c]||r););if(!(e.requests.length<a))return u.priority&&n(s),!0}}return!1}var i=this;if(!e.peerChoking){if(!e.downloaded)return function(){if(!e.requests.length)for(var n=i._selections.length;n--;){var r,o=i._selections[n];if("rarest"===i.strategy)for(var s=o.from+o.offset,a=o.to,c=a-s+1,u={},f=0,h=t(s,a,u);f<c&&!((r=i._rarityMap.getRarestPiece(h))<0);){if(i._request(e,r,!1))return;u[r]=!0,f+=1}else for(r=o.to;r>=o.from+o.offset;--r)if(e.peerPieces.get(r)&&i._request(e,r,!1))return}}();var s=o(e,.5);if(!(e.requests.length>=s)){var a=o(e,1);r(!1)||r(!0)}}},i.prototype._rechoke=function(){var e=this;if(e.ready){e._rechokeOptimisticTime>0?e._rechokeOptimisticTime-=1:e._rechokeOptimisticWire=null;var t=[];e.wires.forEach((function(n){n.isSeeder||n===e._rechokeOptimisticWire||t.push({wire:n,downloadSpeed:n.downloadSpeed(),uploadSpeed:n.uploadSpeed(),salt:Math.random(),isChoked:!0})})),t.sort((function(e,t){return e.downloadSpeed!==t.downloadSpeed?t.downloadSpeed-e.downloadSpeed:e.uploadSpeed!==t.uploadSpeed?t.uploadSpeed-e.uploadSpeed:e.wire.amChoking!==t.wire.amChoking?e.wire.amChoking?1:-1:e.salt-t.salt}));for(var n=0,r=0;r<t.length&&n<e._rechokeNumSlots;++r)t[r].isChoked=!1,t[r].wire.peerInterested&&(n+=1);if(!e._rechokeOptimisticWire&&r<t.length&&e._rechokeNumSlots){var i=t.slice(r).filter((function(e){return e.wire.peerInterested})),o=i[function(e){return Math.random()*e|0}(i.length)];o&&(o.isChoked=!1,e._rechokeOptimisticWire=o.wire,e._rechokeOptimisticTime=2)}t.forEach((function(e){e.wire.amChoking!==e.isChoked&&(e.isChoked?e.wire.choke():e.wire.unchoke())}))}},i.prototype._hotswap=function(e,t){var n=this,r=e.downloadSpeed();if(r<T.BLOCK_LENGTH)return!1;if(!n._reservations[t])return!1;var i=n._reservations[t];if(!i)return!1;var o,s,a=1/0;for(s=0;s<i.length;s++){var c=i[s];if(c&&c!==e){var u=c.downloadSpeed();u>=H||2*u>r||u>a||(o=c,a=u)}}if(!o)return!1;for(s=0;s<i.length;s++)i[s]===o&&(i[s]=null);for(s=0;s<o.requests.length;s++){var f=o.requests[s];f.piece===t&&n.pieces[t].cancel(f.offset/T.BLOCK_LENGTH|0)}return n.emit("hotswap",o,e,t),!0},i.prototype._request=function(e,t,r){function i(){n.nextTick((function(){s._update()}))}var s=this,a=e.requests.length,c="webSeed"===e.type;if(s.bitfield.get(t))return!1;if(a>=(c?Math.min(function(e,t,n){return 1+Math.ceil(t*e.downloadSpeed()/n)}(e,1,s.pieceLength),s.maxWebConns):o(e,1)))return!1;var u=s.pieces[t],f=c?u.reserveRemaining():u.reserve();if(-1===f&&r&&s._hotswap(e,t)&&(f=c?u.reserveRemaining():u.reserve()),-1===f)return!1;var h=s._reservations[t];h||(h=s._reservations[t]=[]);var l=h.indexOf(null);-1===l&&(l=h.length),h[l]=e;var d=u.chunkOffset(f),p=c?u.chunkLengthRemaining(f):u.chunkLength(f);return e.request(t,d,p,(function n(r,o){if(!s.destroyed){if(!s.ready)return s.once("ready",(function(){n(r,o)}));if(h[l]===e&&(h[l]=null),u!==s.pieces[t])return i();if(r)return s._debug("error getting piece %s (offset: %s length: %s) from %s: %s",t,d,p,e.remoteAddress+":"+e.remotePort,r.message),c?u.cancelRemaining(f):u.cancel(f),void i();if(s._debug("got piece %s (offset: %s length: %s) from %s",t,d,p,e.remoteAddress+":"+e.remotePort),!u.set(f,o,e))return i();var a=u.flush();R(a,(function(e){if(!s.destroyed){if(e===s._hashes[t]){if(!s.pieces[t])return;s._debug("piece verified %s",t),s.pieces[t]=null,s._reservations[t]=null,s.bitfield.set(t,!0),s.store.put(t,a),s.wires.forEach((function(e){e.have(t)})),s._checkDone()&&!s.destroyed&&s.discovery.complete()}else s.pieces[t]=new T(u.length),s.emit("warning",new Error("Piece "+t+" failed verification"));i()}}))}})),!0},i.prototype._checkDone=function(){var e=this;if(!e.destroyed){e.files.forEach((function(t){if(!t.done){for(var n=t._startPiece;n<=t._endPiece;++n)if(!e.bitfield.get(n))return;t.done=!0,t.emit("done"),e._debug("file done: "+t.name)}}));for(var t=!0,n=0;n<e._selections.length;n++){for(var r=e._selections[n],i=r.from;i<=r.to;i++)if(!e.bitfield.get(i)){t=!1;break}if(!t)break}return!e.done&&t&&(e.done=!0,e._debug("torrent done: "+e.infoHash),e.emit("done")),e._gcSelections(),t}},i.prototype.load=function(e,t){var n=this;if(n.destroyed)throw new Error("torrent is destroyed");if(!n.ready)return n.once("ready",(function(){n.load(e,t)}));Array.isArray(e)||(e=[e]),t||(t=s);var r=new w(e),i=new f(n.store,n.pieceLength);B(r,i,(function(e){if(e)return t(e);n.pieces.forEach((function(e,t){n.pieces[t]=null,n._reservations[t]=null,n.bitfield.set(t,!0)})),n._checkDone(),t(null)}))},i.prototype.createServer=function(e){if("function"!=typeof D)throw new Error("node.js-only method");if(this.destroyed)throw new Error("torrent is destroyed");var t=new D(this,e);return this._servers.push(t),t},i.prototype.pause=function(){this.destroyed||(this._debug("pause"),this.paused=!0)},i.prototype.resume=function(){this.destroyed||(this._debug("resume"),this.paused=!1,this._drain())},i.prototype._debug=function(){var e=[].slice.call(arguments);e[0]="["+this.client._debugId+"] ["+this._debugId+"] "+e[0],h.apply(null,e)},i.prototype._drain=function(){var e=this;if(this._debug("_drain numConns %s maxConns %s",e._numConns,e.client.maxConns),!("function"!=typeof k.connect||e.destroyed||e.paused||e._numConns>=e.client.maxConns)){this._debug("drain (%s queued, %s/%s peers)",e._numQueued,e.numPeers,e.client.maxConns);var t=e._queue.shift();if(t){this._debug("tcp connect attempt to %s",t.addr);var n=c(t.addr),r={host:n[0],port:n[1]},i=t.conn=k.connect(r);i.once("connect",(function(){t.onConnect()})),i.once("error",(function(e){t.destroy(e)})),t.startConnectTimeout(),i.on("close",(function(){if(!e.destroyed){if(t.retries>=F.length)return void e._debug("conn %s closed: will not re-add (max %s attempts)",t.addr,F.length);var n=F[t.retries];e._debug("conn %s closed: will re-add to queue in %sms (attempt %s)",t.addr,n,t.retries+1);var r=setTimeout((function(){var n=e._addPeer(t.addr);n&&(n.retries=t.retries+1)}),n);r.unref&&r.unref()}}))}}},i.prototype._validAddr=function(e){var t;try{t=c(e)}catch(e){return!1}var n=t[0],r=t[1];return r>0&&r<65535&&!("127.0.0.1"===n&&r===this.client.torrentPort)}}).call(this,e("_process"),void 0!==n?n:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../package.json":122,"./file":2,"./peer":3,"./rarity-map":4,"./server":21,_process:66,"addr-to-ip-port":7,bitfield:13,"chunk-store-stream/write":26,debug:30,events:34,fs:22,"fs-chunk-store":50,"immediate-chunk-store":40,inherits:41,multistream:58,net:21,os:21,"parse-torrent":62,path:63,pump:67,"random-iterate":72,"run-parallel":86,"run-parallel-limit":85,"simple-get":90,"simple-sha1":92,speedometer:94,"torrent-discovery":106,"torrent-piece":107,uniq:110,ut_metadata:114,ut_pex:21,xtend:119,"xtend/mutable":120}],6:[function(e,t,n){function r(e,t){f.call(this),this.url=e,this.webPeerId=u.sync(e),this._torrent=t,this._init()}t.exports=r;var i=e("bitfield"),o=e("safe-buffer").Buffer,s=e("debug")("webtorrent:webconn"),a=e("simple-get"),c=e("inherits"),u=e("simple-sha1"),f=e("bittorrent-protocol"),h=e("../package.json").version;c(r,f),r.prototype._init=function(){var e=this;e.setKeepAlive(!0),e.once("handshake",(function(t,n){if(!e.destroyed){e.handshake(t,e.webPeerId);for(var r=e._torrent.pieces.length,o=new i(r),s=0;s<=r;s++)o.set(s,!0);e.bitfield(o)}})),e.once("interested",(function(){s("interested"),e.unchoke()})),e.on("uninterested",(function(){s("uninterested")})),e.on("choke",(function(){s("choke")})),e.on("unchoke",(function(){s("unchoke")})),e.on("bitfield",(function(){s("bitfield")})),e.on("request",(function(t,n,r,i){s("request pieceIndex=%d offset=%d length=%d",t,n,r),e.httpRequest(t,n,r,i)}))},r.prototype.httpRequest=function(e,t,n,r){var i,c=this,u=e*c._torrent.pieceLength+t,f=u+n-1,l=c._torrent.files;if(l.length<=1)i=[{url:c.url,start:u,end:f}];else{var d=l.filter((function(e){return e.offset<=f&&e.offset+e.length>u}));if(d.length<1)return r(new Error("Could not find file corresponnding to web seed range request"));i=d.map((function(e){var t=e.offset+e.length-1;return{url:c.url+("/"===c.url[c.url.length-1]?"":"/")+e.path,fileOffsetInRange:Math.max(e.offset-u,0),start:Math.max(u-e.offset,0),end:Math.min(t,f-e.offset)}}))}var p,g=0,m=!1;i.length>1&&(p=o.alloc(n)),i.forEach((function(o){function c(e,t){if(e.statusCode<200||e.statusCode>=300)return m=!0,r(new Error("Unexpected HTTP status code "+e.statusCode));s("Got data of length %d",t.length),1===i.length?r(null,t):(t.copy(p,o.fileOffsetInRange),++g===i.length&&r(null,p))}var u=o.url,f=o.start,l=o.end;s("Requesting url=%s pieceIndex=%d offset=%d length=%d start=%d end=%d",u,e,t,n,f,l);var d={url:u,method:"GET",headers:{"user-agent":"WebTorrent/"+h+" (https://webtorrent.io)",range:"bytes="+f+"-"+l}};a.concat(d,(function(e,t,n){if(!m)return e?"undefined"==typeof window||u.startsWith(window.location.origin+"/")?(m=!0,r(e)):a.head(u,(function(t,n){if(!m){if(t)return m=!0,r(t);if(n.statusCode<200||n.statusCode>=300)return m=!0,r(new Error("Unexpected HTTP status code "+n.statusCode));if(n.url===u)return m=!0,r(e);d.url=n.url,a.concat(d,(function(e,t,n){if(!m)return e?(m=!0,r(e)):void c(t,n)}))}})):void c(t,n)}))}))},r.prototype.destroy=function(){f.prototype.destroy.call(this),this._torrent=null}},{"../package.json":122,bitfield:13,"bittorrent-protocol":14,debug:30,inherits:41,"safe-buffer":88,"simple-get":90,"simple-sha1":92}],7:[function(e,t,n){var r=/^\[?([^\]]+)\]?:(\d+)$/,i={},o=0;t.exports=function(e){if(1e5===o&&t.exports.reset(),!i[e]){var n=r.exec(e);if(!n)throw new Error("invalid addr: "+e);i[e]=[n[1],Number(n[2])],o+=1}return i[e]},t.exports.reset=function(){i={},o=0}},{}],8:[function(e,t,n){function r(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===e[t-2]?2:"="===e[t-1]?1:0}function i(e){return s[e>>18&63]+s[e>>12&63]+s[e>>6&63]+s[63&e]}function o(e,t,n){for(var r,o=[],s=t;s<n;s+=3)r=(e[s]<<16)+(e[s+1]<<8)+e[s+2],o.push(i(r));return o.join("")}n.byteLength=function(e){return 3*e.length/4-r(e)},n.toByteArray=function(e){var t,n,i,o,s,u,f=e.length;s=r(e),u=new c(3*f/4-s),i=s>0?f-4:f;var h=0;for(t=0,n=0;t<i;t+=4,n+=3)o=a[e.charCodeAt(t)]<<18|a[e.charCodeAt(t+1)]<<12|a[e.charCodeAt(t+2)]<<6|a[e.charCodeAt(t+3)],u[h++]=o>>16&255,u[h++]=o>>8&255,u[h++]=255&o;return 2===s?(o=a[e.charCodeAt(t)]<<2|a[e.charCodeAt(t+1)]>>4,u[h++]=255&o):1===s&&(o=a[e.charCodeAt(t)]<<10|a[e.charCodeAt(t+1)]<<4|a[e.charCodeAt(t+2)]>>2,u[h++]=o>>8&255,u[h++]=255&o),u},n.fromByteArray=function(e){for(var t,n=e.length,r=n%3,i="",a=[],c=0,u=n-r;c<u;c+=16383)a.push(o(e,c,c+16383>u?u:c+16383));return 1===r?(t=e[n-1],i+=s[t>>2],i+=s[t<<4&63],i+="=="):2===r&&(t=(e[n-2]<<8)+e[n-1],i+=s[t>>10],i+=s[t>>4&63],i+=s[t<<2&63],i+="="),a.push(i),a.join("")};for(var s=[],a=[],c="undefined"!=typeof Uint8Array?Uint8Array:Array,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",f=0,h=u.length;f<h;++f)s[f]=u[f],a[u.charCodeAt(f)]=f;a["-".charCodeAt(0)]=62,a["_".charCodeAt(0)]=63},{}],9:[function(e,t,n){(function(e){function n(e,t,n){for(var r=0,i=1,o=t;o<n;o++){var s=e[o];if(s<58&&s>=48)r=10*r+(s-48);else if(o!==t||43!==s){if(o!==t||45!==s){if(46===s)break;throw new Error("not a number: buffer["+o+"] = "+s)}i=-1}}return r*i}function r(t,n,i,o){return null==t||0===t.length?null:("number"!=typeof n&&null==o&&(o=n,n=void 0),"number"!=typeof i&&null==o&&(o=i,i=void 0),r.position=0,r.encoding=o||null,r.data=e.isBuffer(t)?t.slice(n,i):new e(t),r.bytes=r.data.length,r.next())}r.bytes=0,r.position=0,r.data=null,r.encoding=null,r.next=function(){switch(r.data[r.position]){case 100:return r.dictionary();case 108:return r.list();case 105:return r.integer();default:return r.buffer()}},r.find=function(e){for(var t=r.position,n=r.data.length,i=r.data;t<n;){if(i[t]===e)return t;t++}throw new Error('Invalid data: Missing delimiter "'+String.fromCharCode(e)+'" [0x'+e.toString(16)+"]")},r.dictionary=function(){r.position++;for(var e={};101!==r.data[r.position];)e[r.buffer()]=r.next();return r.position++,e},r.list=function(){r.position++;for(var e=[];101!==r.data[r.position];)e.push(r.next());return r.position++,e},r.integer=function(){var e=r.find(101),t=n(r.data,r.position+1,e);return r.position+=e+1-r.position,t},r.buffer=function(){var e=r.find(58),t=n(r.data,r.position,e),i=++e+t;return r.position=i,r.encoding?r.data.toString(r.encoding,e,i):r.data.slice(e,i)},t.exports=r}).call(this,e("buffer").Buffer)},{buffer:24}],10:[function(e,t,n){(function(e){function n(t,r,i){var o=[],s=null;return n._encode(o,t),s=e.concat(o),n.bytes=s.length,e.isBuffer(r)?(s.copy(r,i),r):s}n.bytes=-1,n._floatConversionDetected=!1,n._encode=function(t,r){if(e.isBuffer(r))return t.push(new e(r.length+":")),void t.push(r);if(null!=r)switch(c(r)){case"string":n.buffer(t,r);break;case"number":n.number(t,r);break;case"object":r.constructor===Array?n.list(t,r):n.dict(t,r);break;case"boolean":n.number(t,r?1:0)}};var r=new e("e"),i=new e("d"),o=new e("l");n.buffer=function(t,n){t.push(new e(e.byteLength(n)+":"+n))},n.number=function(t,r){var i=2147483648*(r/2147483648<<0)+(r%2147483648<<0);t.push(new e("i"+i+"e")),i===r||n._floatConversionDetected||(n._floatConversionDetected=!0,console.warn('WARNING: Possible data corruption detected with value "'+r+'":','Bencoding only defines support for integers, value was converted to "'+i+'"'),console.trace())},n.dict=function(e,t){e.push(i);for(var o,s=0,a=Object.keys(t).sort(),c=a.length;s<c;s++)null!=t[o=a[s]]&&(n.buffer(e,o),n._encode(e,t[o]));e.push(r)},n.list=function(e,t){var i=0,s=t.length;for(e.push(o);i<s;i++)null!=t[i]&&n._encode(e,t[i]);e.push(r)},t.exports=n}).call(this,e("buffer").Buffer)},{buffer:24}],11:[function(e,t,n){var r=t.exports;r.encode=e("./encode"),r.decode=e("./decode"),r.byteLength=r.encodingLength=function(e){return r.encode(e).length}},{"./decode":9,"./encode":10}],12:[function(e,t,n){t.exports=function(e,t,n,r,i){var o,s;if(void 0===r)r=0;else if((r|=0)<0||r>=e.length)throw new RangeError("invalid lower bound");if(void 0===i)i=e.length-1;else if((i|=0)<r||i>=e.length)throw new RangeError("invalid upper bound");for(;r<=i;)if((s=+n(e[o=r+(i-r>>1)],t,o,e))<0)r=o+1;else{if(!(s>0))return o;i=o-1}return~r}},{}],13:[function(e,t,n){(function(e){function n(e,t){if(!(this instanceof n))return new n(e,t);0===arguments.length&&(e=0),this.grow=t&&(isFinite(t.grow)&&r(t.grow)||t.grow)||0,"number"!=typeof e&&void 0!==e||(e=new i(r(e))).fill&&!e._isBuffer&&e.fill(0),this.buffer=e}function r(e){var t=e>>3;return e%8!=0&&t++,t}var i=void 0!==e?e:"undefined"!=typeof Int8Array?Int8Array:function(e){for(var t=new Array(e),n=0;n<e;n++)t[n]=0};n.prototype.get=function(e){var t=e>>3;return t<this.buffer.length&&!!(this.buffer[t]&128>>e%8)},n.prototype.set=function(e,t){var n=e>>3;t||1===arguments.length?(this.buffer.length<n+1&&this._grow(Math.max(n+1,Math.min(2*this.buffer.length,this.grow))),this.buffer[n]|=128>>e%8):n<this.buffer.length&&(this.buffer[n]&=~(128>>e%8))},n.prototype._grow=function(e){if(this.buffer.length<e&&e<=this.grow){var t=new i(e);if(t.fill&&t.fill(0),this.buffer.copy)this.buffer.copy(t,0);else for(var n=0;n<this.buffer.length;n++)t[n]=this.buffer[n];this.buffer=t}},void 0!==t&&(t.exports=n)}).call(this,e("buffer").Buffer)},{buffer:24}],14:[function(e,t,n){function r(e,t,n,r){this.piece=e,this.offset=t,this.length=n,this.callback=r}function i(){if(!(this instanceof i))return new i;m.Duplex.call(this),this._debugId=p(4).toString("hex"),this._debug("new wire"),this.peerId=null,this.peerIdBuffer=null,this.type=null,this.amChoking=!0,this.amInterested=!1,this.peerChoking=!0,this.peerInterested=!1,this.peerPieces=new u(0,{grow:y}),this.peerExtensions={},this.requests=[],this.peerRequests=[],this.extendedMapping={},this.peerExtendedMapping={},this.extendedHandshake={},this.peerExtendedHandshake={},this._ext={},this._nextExt=1,this.uploaded=0,this.downloaded=0,this.uploadSpeed=g(),this.downloadSpeed=g(),this._keepAliveInterval=null,this._timeout=null,this._timeoutMs=0,this.destroyed=!1,this._finished=!1,this._parserSize=0,this._parser=null,this._buffer=[],this._bufferSize=0,this.on("finish",this._onFinish),this._parseHandshake()}function o(e,t,n,r){for(var i=0;i<e.length;i++){var o=e[i];if(o.piece===t&&o.offset===n&&o.length===r)return s(e,i),o}return null}t.exports=i;var s=e("unordered-array-remove"),a=e("bencode"),u=e("bitfield"),f=e("safe-buffer").Buffer,h=e("debug")("bittorrent-protocol"),l=e("xtend"),d=e("inherits"),p=e("randombytes"),g=e("speedometer"),m=e("readable-stream"),y=4e5,v=f.from("BitTorrent protocol"),b=f.from([0,0,0,0]),_=f.from([0,0,0,1,0]),w=f.from([0,0,0,1,1]),k=f.from([0,0,0,1,2]),E=f.from([0,0,0,1,3]),x=[0,0,0,0,0,0,0,0],S=[0,0,0,3,9,0,0];d(i,m.Duplex),i.prototype.setKeepAlive=function(e){var t=this;t._debug("setKeepAlive %s",e),clearInterval(t._keepAliveInterval),!1!==e&&(t._keepAliveInterval=setInterval((function(){t.keepAlive()}),55e3))},i.prototype.setTimeout=function(e,t){this._debug("setTimeout ms=%d unref=%s",e,t),this._clearTimeout(),this._timeoutMs=e,this._timeoutUnref=!!t,this._updateTimeout()},i.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,this._debug("destroy"),this.emit("close"),this.end())},i.prototype.end=function(){this._debug("end"),this._onUninterested(),this._onChoke(),m.Duplex.prototype.end.apply(this,arguments)},i.prototype.use=function(e){function t(){}var n=e.prototype.name;if(!n)throw new Error('Extension class requires a "name" property on the prototype');this._debug("use extension.name=%s",n);var r=this._nextExt,i=new e(this);"function"!=typeof i.onHandshake&&(i.onHandshake=t),"function"!=typeof i.onExtendedHandshake&&(i.onExtendedHandshake=t),"function"!=typeof i.onMessage&&(i.onMessage=t),this.extendedMapping[r]=n,this._ext[n]=i,this[n]=i,this._nextExt+=1},i.prototype.keepAlive=function(){this._debug("keep-alive"),this._push(b)},i.prototype.handshake=function(e,t,n){var r,i;if("string"==typeof e?r=f.from(e,"hex"):e=(r=e).toString("hex"),"string"==typeof t?i=f.from(t,"hex"):t=(i=t).toString("hex"),20!==r.length||20!==i.length)throw new Error("infoHash and peerId MUST have length 20");this._debug("handshake i=%s p=%s exts=%o",e,t,n);var o=f.from(x);o[5]|=16,n&&n.dht&&(o[7]|=1),this._push(f.concat([v,o,r,i])),this._handshakeSent=!0,this.peerExtensions.extended&&!this._extendedHandshakeSent&&this._sendExtendedHandshake()},i.prototype._sendExtendedHandshake=function(){var e=l(this.extendedHandshake);for(var t in e.m={},this.extendedMapping){var n=this.extendedMapping[t];e.m[n]=Number(t)}this.extended(0,a.encode(e)),this._extendedHandshakeSent=!0},i.prototype.choke=function(){if(!this.amChoking){for(this.amChoking=!0,this._debug("choke");this.peerRequests.length;)this.peerRequests.pop();this._push(_)}},i.prototype.unchoke=function(){this.amChoking&&(this.amChoking=!1,this._debug("unchoke"),this._push(w))},i.prototype.interested=function(){this.amInterested||(this.amInterested=!0,this._debug("interested"),this._push(k))},i.prototype.uninterested=function(){this.amInterested&&(this.amInterested=!1,this._debug("uninterested"),this._push(E))},i.prototype.have=function(e){this._debug("have %d",e),this._message(4,[e],null)},i.prototype.bitfield=function(e){this._debug("bitfield"),f.isBuffer(e)||(e=e.buffer),this._message(5,[],e)},i.prototype.request=function(e,t,n,i){return i||(i=function(){}),this._finished?i(new Error("wire is closed")):this.peerChoking?i(new Error("peer is choking")):(this._debug("request index=%d offset=%d length=%d",e,t,n),this.requests.push(new r(e,t,n,i)),this._updateTimeout(),void this._message(6,[e,t,n],null))},i.prototype.piece=function(e,t,n){this._debug("piece index=%d offset=%d",e,t),this.uploaded+=n.length,this.uploadSpeed(n.length),this.emit("upload",n.length),this._message(7,[e,t],n)},i.prototype.cancel=function(e,t,n){this._debug("cancel index=%d offset=%d length=%d",e,t,n),this._callback(o(this.requests,e,t,n),new Error("request was cancelled"),null),this._message(8,[e,t,n],null)},i.prototype.port=function(e){this._debug("port %d",e);var t=f.from(S);t.writeUInt16BE(e,5),this._push(t)},i.prototype.extended=function(e,t){if(this._debug("extended ext=%s",e),"string"==typeof e&&this.peerExtendedMapping[e]&&(e=this.peerExtendedMapping[e]),"number"!=typeof e)throw new Error("Unrecognized extension: "+e);var n=f.from([e]),r=f.isBuffer(t)?t:a.encode(t);this._message(20,[],f.concat([n,r]))},i.prototype._read=function(){},i.prototype._message=function(e,t,n){var r=n?n.length:0,i=f.allocUnsafe(5+4*t.length);i.writeUInt32BE(i.length+r-4,0),i[4]=e;for(var o=0;o<t.length;o++)i.writeUInt32BE(t[o],5+4*o);this._push(i),n&&this._push(n)},i.prototype._push=function(e){if(!this._finished)return this.push(e)},i.prototype._onKeepAlive=function(){this._debug("got keep-alive"),this.emit("keep-alive")},i.prototype._onHandshake=function(e,t,n){var r,i=e.toString("hex"),o=t.toString("hex");for(r in this._debug("got handshake i=%s p=%s exts=%o",i,o,n),this.peerId=o,this.peerIdBuffer=t,this.peerExtensions=n,this.emit("handshake",i,o,n),this._ext)this._ext[r].onHandshake(i,o,n);n.extended&&this._handshakeSent&&!this._extendedHandshakeSent&&this._sendExtendedHandshake()},i.prototype._onChoke=function(){for(this.peerChoking=!0,this._debug("got choke"),this.emit("choke");this.requests.length;)this._callback(this.requests.pop(),new Error("peer is choking"),null)},i.prototype._onUnchoke=function(){this.peerChoking=!1,this._debug("got unchoke"),this.emit("unchoke")},i.prototype._onInterested=function(){this.peerInterested=!0,this._debug("got interested"),this.emit("interested")},i.prototype._onUninterested=function(){this.peerInterested=!1,this._debug("got uninterested"),this.emit("uninterested")},i.prototype._onHave=function(e){this.peerPieces.get(e)||(this._debug("got have %d",e),this.peerPieces.set(e,!0),this.emit("have",e))},i.prototype._onBitField=function(e){this.peerPieces=new u(e),this._debug("got bitfield"),this.emit("bitfield",this.peerPieces)},i.prototype._onRequest=function(e,t,n){var i=this;if(!i.amChoking){i._debug("got request index=%d offset=%d length=%d",e,t,n);var s=function(r,s){if(a===o(i.peerRequests,e,t,n))return r?i._debug("error satisfying request index=%d offset=%d length=%d (%s)",e,t,n,r.message):void i.piece(e,t,s)},a=new r(e,t,n,s);i.peerRequests.push(a),i.emit("request",e,t,n,s)}},i.prototype._onPiece=function(e,t,n){this._debug("got piece index=%d offset=%d",e,t),this._callback(o(this.requests,e,t,n.length),null,n),this.downloaded+=n.length,this.downloadSpeed(n.length),this.emit("download",n.length),this.emit("piece",e,t,n)},i.prototype._onCancel=function(e,t,n){this._debug("got cancel index=%d offset=%d length=%d",e,t,n),o(this.peerRequests,e,t,n),this.emit("cancel",e,t,n)},i.prototype._onPort=function(e){this._debug("got port %d",e),this.emit("port",e)},i.prototype._onExtended=function(e,t){if(0===e){var n,r;try{n=a.decode(t)}catch(e){this._debug("ignoring invalid extended handshake: %s",e.message||e)}if(!n)return;if(this.peerExtendedHandshake=n,"object"==c(n.m))for(r in n.m)this.peerExtendedMapping[r]=Number(n.m[r].toString());for(r in this._ext)this.peerExtendedMapping[r]&&this._ext[r].onExtendedHandshake(this.peerExtendedHandshake);this._debug("got extended handshake"),this.emit("extended","handshake",this.peerExtendedHandshake)}else this.extendedMapping[e]&&(e=this.extendedMapping[e],this._ext[e]&&this._ext[e].onMessage(t)),this._debug("got extended message ext=%s",e),this.emit("extended",e,t)},i.prototype._onTimeout=function(){this._debug("request timed out"),this._callback(this.requests.shift(),new Error("request has timed out"),null),this.emit("timeout")},i.prototype._write=function(e,t,n){for(this._bufferSize+=e.length,this._buffer.push(e);this._bufferSize>=this._parserSize;){var r=1===this._buffer.length?this._buffer[0]:f.concat(this._buffer);this._bufferSize-=this._parserSize,this._buffer=this._bufferSize?[r.slice(this._parserSize)]:[],this._parser(r.slice(0,this._parserSize))}n(null)},i.prototype._callback=function(e,t,n){e&&(this._clearTimeout(),this.peerChoking||this._finished||this._updateTimeout(),e.callback(t,n))},i.prototype._clearTimeout=function(){this._timeout&&(clearTimeout(this._timeout),this._timeout=null)},i.prototype._updateTimeout=function(){var e=this;e._timeoutMs&&e.requests.length&&!e._timeout&&(e._timeout=setTimeout((function(){e._onTimeout()}),e._timeoutMs),e._timeoutUnref&&e._timeout.unref&&e._timeout.unref())},i.prototype._parse=function(e,t){this._parserSize=e,this._parser=t},i.prototype._onMessageLength=function(e){var t=e.readUInt32BE(0);t>0?this._parse(t,this._onMessage):(this._onKeepAlive(),this._parse(4,this._onMessageLength))},i.prototype._onMessage=function(e){switch(this._parse(4,this._onMessageLength),e[0]){case 0:return this._onChoke();case 1:return this._onUnchoke();case 2:return this._onInterested();case 3:return this._onUninterested();case 4:return this._onHave(e.readUInt32BE(1));case 5:return this._onBitField(e.slice(1));case 6:return this._onRequest(e.readUInt32BE(1),e.readUInt32BE(5),e.readUInt32BE(9));case 7:return this._onPiece(e.readUInt32BE(1),e.readUInt32BE(5),e.slice(9));case 8:return this._onCancel(e.readUInt32BE(1),e.readUInt32BE(5),e.readUInt32BE(9));case 9:return this._onPort(e.readUInt16BE(1));case 20:return this._onExtended(e.readUInt8(1),e.slice(2));default:return this._debug("got unknown message"),this.emit("unknownmessage",e)}},i.prototype._parseHandshake=function(){var e=this;e._parse(1,(function(t){var n=t.readUInt8(0);e._parse(n+48,(function(t){var r=t.slice(0,n);if("BitTorrent protocol"!==r.toString())return e._debug("Error: wire not speaking BitTorrent protocol (%s)",r.toString()),void e.end();t=t.slice(n),e._onHandshake(t.slice(8,28),t.slice(28,48),{dht:!!(1&t[7]),extended:!!(16&t[5])}),e._parse(4,e._onMessageLength)}))}))},i.prototype._onFinish=function(){for(this._finished=!0,this.push(null);this.read(););for(clearInterval(this._keepAliveInterval),this._parse(Number.MAX_VALUE,(function(){}));this.peerRequests.length;)this.peerRequests.pop();for(;this.requests.length;)this._callback(this.requests.pop(),new Error("wire was closed"),null)},i.prototype._debug=function(){var e=[].slice.call(arguments);e[0]="["+this._debugId+"] "+e[0],h.apply(null,e)}},{bencode:11,bitfield:13,debug:30,inherits:41,randombytes:73,"readable-stream":82,"safe-buffer":88,speedometer:94,"unordered-array-remove":111,xtend:119}],15:[function(e,t,n){(function(n){function r(e){function t(e){n.nextTick((function(){a.emit("warning",e)}))}var a=this;if(!(a instanceof r))return new r(e);if(s.call(a),e||(e={}),!e.peerId)throw new Error("Option `peerId` is required");if(!e.infoHash)throw new Error("Option `infoHash` is required");if(!e.announce)throw new Error("Option `announce` is required");if(!n.browser&&!e.port)throw new Error("Option `port` is required");a.peerId="string"==typeof e.peerId?e.peerId:e.peerId.toString("hex"),a._peerIdBuffer=i.from(a.peerId,"hex"),a._peerIdBinary=a._peerIdBuffer.toString("binary"),a.infoHash="string"==typeof e.infoHash?e.infoHash:e.infoHash.toString("hex"),a._infoHashBuffer=i.from(a.infoHash,"hex"),a._infoHashBinary=a._infoHashBuffer.toString("binary"),o("new client %s",a.infoHash),a.destroyed=!1,a._port=e.port,a._getAnnounceOpts=e.getAnnounceOpts,a._rtcConfig=e.rtcConfig,a._userAgent=e.userAgent,a._wrtc="function"==typeof e.wrtc?e.wrtc():e.wrtc;var c="string"==typeof e.announce?[e.announce]:null==e.announce?[]:e.announce;c=c.map((function(e){return"/"===(e=e.toString())[e.length-1]&&(e=e.substring(0,e.length-1)),e})),c=l(c);var u=!1!==a._wrtc&&(!!a._wrtc||h.WEBRTC_SUPPORT);a._trackers=c.map((function(e){var n=d.parse(e).protocol;return"http:"!==n&&"https:"!==n||"function"!=typeof g?"udp:"===n&&"function"==typeof m?new m(a,e):"ws:"!==n&&"wss:"!==n||!u?(t(new Error("Unsupported tracker protocol: "+e)),null):"ws:"===n&&"undefined"!=typeof window&&"https:"===window.location.protocol?(t(new Error("Unsupported tracker protocol: "+e)),null):new y(a,e):new g(a,e)})).filter(Boolean)}t.exports=r;var i=e("safe-buffer").Buffer,o=e("debug")("bittorrent-tracker:client"),s=e("events").EventEmitter,a=e("xtend"),c=e("inherits"),u=e("once"),f=e("run-parallel"),h=e("simple-peer"),l=e("uniq"),d=e("url"),p=e("./lib/common"),g=e("./lib/client/http-tracker"),m=e("./lib/client/udp-tracker"),y=e("./lib/client/websocket-tracker");c(r,s),r.scrape=function(e,t){if(t=u(t),!e.infoHash)throw new Error("Option `infoHash` is required");if(!e.announce)throw new Error("Option `announce` is required");var n=new r(a(e,{infoHash:Array.isArray(e.infoHash)?e.infoHash[0]:e.infoHash,peerId:i.from("01234567890123456789"),port:6881}));n.once("error",t),n.once("warning",t);var o=Array.isArray(e.infoHash)?e.infoHash.length:1,s={};return n.on("scrape",(function(e){if(o-=1,s[e.infoHash]=e,0===o){n.destroy();var r=Object.keys(s);1===r.length?t(null,s[r[0]]):t(null,s)}})),e.infoHash=Array.isArray(e.infoHash)?e.infoHash.map((function(e){return i.from(e,"hex")})):i.from(e.infoHash,"hex"),n.scrape({infoHash:e.infoHash}),n},r.prototype.start=function(e){var t=this;o("send `start`"),(e=t._defaultAnnounceOpts(e)).event="started",t._announce(e),t._trackers.forEach((function(e){e.setInterval()}))},r.prototype.stop=function(e){o("send `stop`"),(e=this._defaultAnnounceOpts(e)).event="stopped",this._announce(e)},r.prototype.complete=function(e){o("send `complete`"),e||(e={}),(e=this._defaultAnnounceOpts(e)).event="completed",this._announce(e)},r.prototype.update=function(e){o("send `update`"),(e=this._defaultAnnounceOpts(e)).event&&delete e.event,this._announce(e)},r.prototype._announce=function(e){this._trackers.forEach((function(t){t.announce(e)}))},r.prototype.scrape=function(e){o("send `scrape`"),e||(e={}),this._trackers.forEach((function(t){t.scrape(e)}))},r.prototype.setInterval=function(e){o("setInterval %d",e),this._trackers.forEach((function(t){t.setInterval(e)}))},r.prototype.destroy=function(e){var t=this;if(!t.destroyed){t.destroyed=!0,o("destroy");var n=t._trackers.map((function(e){return function(t){e.destroy(t)}}));f(n,e),t._trackers=[],t._getAnnounceOpts=null}},r.prototype._defaultAnnounceOpts=function(e){return e||(e={}),null==e.numwant&&(e.numwant=p.DEFAULT_ANNOUNCE_PEERS),null==e.uploaded&&(e.uploaded=0),null==e.downloaded&&(e.downloaded=0),this._getAnnounceOpts&&(e=a(e,this._getAnnounceOpts())),e}}).call(this,e("_process"))},{"./lib/client/http-tracker":21,"./lib/client/udp-tracker":21,"./lib/client/websocket-tracker":17,"./lib/common":18,_process:66,debug:30,events:34,inherits:41,once:60,"run-parallel":86,"safe-buffer":88,"simple-peer":91,uniq:110,url:112,xtend:119}],16:[function(e,t,n){function r(e,t){var n=this;i.call(n),n.client=e,n.announceUrl=t,n.interval=null,n.destroyed=!1}t.exports=r;var i=e("events").EventEmitter;e("inherits")(r,i),r.prototype.setInterval=function(e){var t=this;null==e&&(e=t.DEFAULT_ANNOUNCE_INTERVAL),clearInterval(t.interval),e&&(t.interval=setInterval((function(){t.announce(t.client._defaultAnnounceOpts())}),e),t.interval.unref&&t.interval.unref())}},{events:34,inherits:41}],17:[function(e,t,n){function r(e,t,n){var r=this;l.call(r,e,t),o("new websocket tracker %s",t),r.peers={},r.socket=null,r.reconnecting=!1,r.retries=0,r.reconnectTimer=null,r.expectingResponse=!1,r._openSocket()}function i(){}t.exports=r;var o=e("debug")("bittorrent-tracker:websocket-tracker"),s=e("xtend"),a=e("inherits"),c=e("simple-peer"),u=e("randombytes"),f=e("simple-websocket"),h=e("../common"),l=e("./tracker"),d={};a(r,l),r.prototype.DEFAULT_ANNOUNCE_INTERVAL=3e4,r.prototype.announce=function(e){var t=this;if(!t.destroyed&&!t.reconnecting){if(!t.socket.connected)return void t.socket.once("connect",(function(){t.announce(e)}));var n=s(e,{action:"announce",info_hash:t.client._infoHashBinary,peer_id:t.client._peerIdBinary});if(t._trackerId&&(n.trackerid=t._trackerId),"stopped"===e.event||"completed"===e.event)t._send(n);else{var r=Math.min(e.numwant,10);t._generateOffers(r,(function(e){n.numwant=r,n.offers=e,t._send(n)}))}}},r.prototype.scrape=function(e){var t=this;if(!t.destroyed&&!t.reconnecting){if(!t.socket.connected)return void t.socket.once("connect",(function(){t.scrape(e)}));var n={action:"scrape",info_hash:Array.isArray(e.infoHash)&&e.infoHash.length>0?e.infoHash.map((function(e){return e.toString("binary")})):e.infoHash&&e.infoHash.toString("binary")||t.client._infoHashBinary};t._send(n)}},r.prototype.destroy=function(e){function t(){a&&(clearTimeout(a),a=null),s.removeListener("data",t),s.destroy(),s=null}var n=this;if(e||(e=i),n.destroyed)return e(null);for(var r in n.destroyed=!0,clearInterval(n.interval),clearTimeout(n.reconnectTimer),n.peers){var o=n.peers[r];clearTimeout(o.trackerTimeout),o.destroy()}if(n.peers=null,n.socket&&(n.socket.removeListener("connect",n._onSocketConnectBound),n.socket.removeListener("data",n._onSocketDataBound),n.socket.removeListener("close",n._onSocketCloseBound),n.socket.removeListener("error",n._onSocketErrorBound),n.socket=null),n._onSocketConnectBound=null,n._onSocketErrorBound=null,n._onSocketDataBound=null,n._onSocketCloseBound=null,d[n.announceUrl]&&(d[n.announceUrl].consumers-=1),d[n.announceUrl].consumers>0)return e();var s=d[n.announceUrl];if(delete d[n.announceUrl],s.on("error",i),s.once("close",e),!n.expectingResponse)return t();var a=setTimeout(t,h.DESTROY_TIMEOUT);s.once("data",t)},r.prototype._openSocket=function(){var e=this;e.destroyed=!1,e.peers||(e.peers={}),e._onSocketConnectBound=function(){e._onSocketConnect()},e._onSocketErrorBound=function(t){e._onSocketError(t)},e._onSocketDataBound=function(t){e._onSocketData(t)},e._onSocketCloseBound=function(){e._onSocketClose()},e.socket=d[e.announceUrl],e.socket?d[e.announceUrl].consumers+=1:(e.socket=d[e.announceUrl]=new f(e.announceUrl),e.socket.consumers=1,e.socket.once("connect",e._onSocketConnectBound)),e.socket.on("data",e._onSocketDataBound),e.socket.once("close",e._onSocketCloseBound),e.socket.once("error",e._onSocketErrorBound)},r.prototype._onSocketConnect=function(){var e=this;e.destroyed||e.reconnecting&&(e.reconnecting=!1,e.retries=0,e.announce(e.client._defaultAnnounceOpts()))},r.prototype._onSocketData=function(e){var t=this;if(!t.destroyed){t.expectingResponse=!1;try{e=JSON.parse(e)}catch(e){return void t.client.emit("warning",new Error("Invalid tracker response"))}"announce"===e.action?t._onAnnounceResponse(e):"scrape"===e.action?t._onScrapeResponse(e):t._onSocketError(new Error("invalid action in WS response: "+e.action))}},r.prototype._onAnnounceResponse=function(e){var t=this;if(e.info_hash===t.client._infoHashBinary){if(!e.peer_id||e.peer_id!==t.client._peerIdBinary){o("received %s from %s for %s",JSON.stringify(e),t.announceUrl,t.client.infoHash);var n=e["failure reason"];if(n)return t.client.emit("warning",new Error(n));var r=e["warning message"];r&&t.client.emit("warning",new Error(r));var i=e.interval||e["min interval"];i&&t.setInterval(1e3*i);var s,a=e["tracker id"];if(a&&(t._trackerId=a),null!=e.complete){var c=Object.assign({},e,{announce:t.announceUrl,infoHash:h.binaryToHex(e.info_hash)});t.client.emit("update",c)}if(e.offer&&e.peer_id&&(o("creating peer (from remote offer)"),(s=t._createPeer()).id=h.binaryToHex(e.peer_id),s.once("signal",(function(n){var r={action:"announce",info_hash:t.client._infoHashBinary,peer_id:t.client._peerIdBinary,to_peer_id:e.peer_id,answer:n,offer_id:e.offer_id};t._trackerId&&(r.trackerid=t._trackerId),t._send(r)})),s.signal(e.offer),t.client.emit("peer",s)),e.answer&&e.peer_id){var u=h.binaryToHex(e.offer_id);(s=t.peers[u])?(s.id=h.binaryToHex(e.peer_id),s.signal(e.answer),t.client.emit("peer",s),clearTimeout(s.trackerTimeout),s.trackerTimeout=null,delete t.peers[u]):o("got unexpected answer: "+JSON.stringify(e.answer))}}}else o("ignoring websocket data from %s for %s (looking for %s: reused socket)",t.announceUrl,h.binaryToHex(e.info_hash),t.client.infoHash)},r.prototype._onScrapeResponse=function(e){var t=this;e=e.files||{};var n=Object.keys(e);0!==n.length?n.forEach((function(n){var r=Object.assign(e[n],{announce:t.announceUrl,infoHash:h.binaryToHex(n)});t.client.emit("scrape",r)})):t.client.emit("warning",new Error("invalid scrape response"))},r.prototype._onSocketClose=function(){var e=this;e.destroyed||(e.destroy(),e._startReconnectTimer())},r.prototype._onSocketError=function(e){var t=this;t.destroyed||(t.destroy(),t.client.emit("warning",e),t._startReconnectTimer())},r.prototype._startReconnectTimer=function(){var e=this,t=Math.floor(3e4*Math.random())+Math.min(15e3*Math.pow(2,e.retries),18e5);e.reconnecting=!0,clearTimeout(e.reconnectTimer),e.reconnectTimer=setTimeout((function(){e.retries++,e._openSocket()}),t),e.reconnectTimer.unref&&e.reconnectTimer.unref(),o("reconnecting socket in %s ms",t)},r.prototype._send=function(e){var t=this;if(!t.destroyed){t.expectingResponse=!0;var n=JSON.stringify(e);o("send %s",n),t.socket.send(n)}},r.prototype._generateOffers=function(e,t){function n(){i.length===e&&(o("generated %s offers",e),t(i))}var r=this,i=[];o("generating %s offers",e);for(var s=0;s<e;++s)!function(){var e=u(20).toString("hex");o("creating peer (from _generateOffers)");var t=r.peers[e]=r._createPeer({initiator:!0});t.once("signal",(function(t){i.push({offer:t,offer_id:h.hexToBinary(e)}),n()})),t.trackerTimeout=setTimeout((function(){o("tracker timeout: destroying peer"),t.trackerTimeout=null,delete r.peers[e],t.destroy()}),5e4),t.trackerTimeout.unref&&t.trackerTimeout.unref()}();n()},r.prototype._createPeer=function(e){function t(e){n.client.emit("warning",new Error("Connection error: "+e.message)),r.destroy()}var n=this;e=Object.assign({trickle:!1,config:n.client._rtcConfig,wrtc:n.client._wrtc},e);var r=new c(e);return r.once("error",t),r.once("connect",(function e(){r.removeListener("error",t),r.removeListener("connect",e)})),r}},{"../common":18,"./tracker":16,debug:30,inherits:41,randombytes:73,"simple-peer":91,"simple-websocket":93,xtend:119}],18:[function(e,t,n){var r=e("safe-buffer").Buffer,i=e("xtend/mutable");n.DEFAULT_ANNOUNCE_PEERS=50,n.MAX_ANNOUNCE_PEERS=82,n.binaryToHex=function(e){return"string"!=typeof e&&(e=String(e)),r.from(e,"binary").toString("hex")},n.hexToBinary=function(e){return"string"!=typeof e&&(e=String(e)),r.from(e,"hex").toString("binary")},i(n,e("./common-node"))},{"./common-node":21,"safe-buffer":88,"xtend/mutable":120}],19:[function(e,t,n){(function(e){t.exports=function(t,n){if("undefined"==typeof Blob||!(t instanceof Blob))throw new Error("first argument must be a Blob");if("function"!=typeof n)throw new Error("second argument must be a function");var r=new FileReader;r.addEventListener("loadend",(function t(i){r.removeEventListener("loadend",t,!1),i.error?n(i.error):n(null,new e(r.result))}),!1),r.readAsArrayBuffer(t)}}).call(this,e("buffer").Buffer)},{buffer:24}],20:[function(e,t,n){(function(n){function r(e,t){if(!(this instanceof r))return new r(e,t);o.call(this),t||(t={}),"object"==c(e)&&(e=(t=e).size),this.size=e||512,t.nopad?this._zeroPadding=!1:this._zeroPadding=s(t.zeroPadding,!0),this._buffered=[],this._bufferedBytes=0}var i=e("inherits"),o=e("readable-stream").Transform,s=e("defined");t.exports=r,i(r,o),r.prototype._transform=function(e,t,r){for(this._bufferedBytes+=e.length,this._buffered.push(e);this._bufferedBytes>=this.size;){var i=n.concat(this._buffered);this._bufferedBytes-=this.size,this.push(i.slice(0,this.size)),this._buffered=[i.slice(this.size,i.length)]}r()},r.prototype._flush=function(){if(this._bufferedBytes&&this._zeroPadding){var e=new n(this.size-this._bufferedBytes);e.fill(0),this._buffered.push(e),this.push(n.concat(this._buffered)),this._buffered=null}else this._bufferedBytes&&(this.push(n.concat(this._buffered)),this._buffered=null);this.push(null)}}).call(this,e("buffer").Buffer)},{buffer:24,defined:32,inherits:41,"readable-stream":82}],21:[function(e,t,n){},{}],22:[function(e,t,n){arguments[4][21][0].apply(n,arguments)},{dup:21}],23:[function(e,t,r){(function(t){var n=e("buffer"),i=n.Buffer,o=n.SlowBuffer,s=n.kMaxLength||2147483647;r.alloc=function(e,t,n){if("function"==typeof i.alloc)return i.alloc(e,t,n);if("number"==typeof n)throw new TypeError("encoding must not be number");if("number"!=typeof e)throw new TypeError("size must be a number");if(e>s)throw new RangeError("size is too large");var r=n,o=t;void 0===o&&(r=void 0,o=0);var a=new i(e);if("string"==typeof o)for(var c=new i(o,r),u=c.length,f=-1;++f<e;)a[f]=c[f%u];else a.fill(o);return a},r.allocUnsafe=function(e){if("function"==typeof i.allocUnsafe)return i.allocUnsafe(e);if("number"!=typeof e)throw new TypeError("size must be a number");if(e>s)throw new RangeError("size is too large");return new i(e)},r.from=function(e,n,r){if("function"==typeof i.from&&(!t.Uint8Array||Uint8Array.from!==i.from))return i.from(e,n,r);if("number"==typeof e)throw new TypeError('"value" argument must not be a number');if("string"==typeof e)return new i(e,n);if("undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer){var o=n;if(1===arguments.length)return new i(e);void 0===o&&(o=0);var s=r;if(void 0===s&&(s=e.byteLength-o),o>=e.byteLength)throw new RangeError("'offset' is out of bounds");if(s>e.byteLength-o)throw new RangeError("'length' is out of bounds");return new i(e.slice(o,o+s))}if(i.isBuffer(e)){var a=new i(e.length);return e.copy(a,0,0,e.length),a}if(e){if(Array.isArray(e)||"undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return new i(e);if("Buffer"===e.type&&Array.isArray(e.data))return new i(e.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")},r.allocUnsafeSlow=function(e){if("function"==typeof i.allocUnsafeSlow)return i.allocUnsafeSlow(e);if("number"!=typeof e)throw new TypeError("size must be a number");if(e>=s)throw new RangeError("size is too large");return new o(e)}}).call(this,void 0!==n?n:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{buffer:24}],24:[function(e,t,n){function r(e){if(e>q)throw new RangeError("Invalid typed array length");var t=new Uint8Array(e);return t.__proto__=i.prototype,t}function i(e,t,n){if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return a(e)}return o(e,t,n)}function o(e,t,n){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return e instanceof ArrayBuffer?function(e,t,n){if(t<0||e.byteLength<t)throw new RangeError("'offset' is out of bounds");if(e.byteLength<t+(n||0))throw new RangeError("'length' is out of bounds");var r;return(r=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n)).__proto__=i.prototype,r}(e,t,n):"string"==typeof e?function(e,t){if("string"==typeof t&&""!==t||(t="utf8"),!i.isEncoding(t))throw new TypeError('"encoding" must be a valid string encoding');var n=0|f(e,t),o=r(n),s=o.write(e,t);return s!==n&&(o=o.slice(0,s)),o}(e,t):function(e){if(i.isBuffer(e)){var t=0|u(e.length),n=r(t);return 0===n.length?n:(e.copy(n,0,0,t),n)}if(e){if(M(e)||"length"in e)return"number"!=typeof e.length||j(e.length)?r(0):c(e);if("Buffer"===e.type&&Array.isArray(e.data))return c(e.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e)}function s(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function a(e){return s(e),r(e<0?0:0|u(e))}function c(e){for(var t=e.length<0?0:0|u(e.length),n=r(t),i=0;i<t;i+=1)n[i]=255&e[i];return n}function u(e){if(e>=q)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+q.toString(16)+" bytes");return 0|e}function f(e,t){if(i.isBuffer(e))return e.length;if(M(e)||e instanceof ArrayBuffer)return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return O(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return P(e).length;default:if(r)return O(e).length;t=(""+t).toLowerCase(),r=!0}}function h(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return S(this,t,n);case"utf8":case"utf-8":return k(this,t,n);case"ascii":return E(this,t,n);case"latin1":case"binary":return x(this,t,n);case"base64":return w(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return A(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function l(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function d(e,t,n,r,o){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),j(n=+n)&&(n=o?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(o)return-1;n=e.length-1}else if(n<0){if(!o)return-1;n=0}if("string"==typeof t&&(t=i.from(t,r)),i.isBuffer(t))return 0===t.length?-1:p(e,t,n,r,o);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?o?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):p(e,[t],n,r,o);throw new TypeError("val must be string, number or Buffer")}function p(e,t,n,r,i){function o(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}var s,a=1,c=e.length,u=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;a=2,c/=2,u/=2,n/=2}if(i){var f=-1;for(s=n;s<c;s++)if(o(e,s)===o(t,-1===f?0:s-f)){if(-1===f&&(f=s),s-f+1===u)return f*a}else-1!==f&&(s-=s-f),f=-1}else for(n+u>c&&(n=c-u),s=n;s>=0;s--){for(var h=!0,l=0;l<u;l++)if(o(e,s+l)!==o(t,l)){h=!1;break}if(h)return s}return-1}function g(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");r>o/2&&(r=o/2);for(var s=0;s<r;++s){var a=parseInt(t.substr(2*s,2),16);if(j(a))return s;e[n+s]=a}return s}function m(e,t,n,r){return U(O(t,e.length-n),e,n,r)}function y(e,t,n,r){return U(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function v(e,t,n,r){return y(e,t,n,r)}function b(e,t,n,r){return U(P(t),e,n,r)}function _(e,t,n,r){return U(function(e,t){for(var n,r,i,o=[],s=0;s<e.length&&!((t-=2)<0);++s)n=e.charCodeAt(s),r=n>>8,i=n%256,o.push(i),o.push(r);return o}(t,e.length-n),e,n,r)}function w(e,t,n){return 0===t&&n===e.length?N.fromByteArray(e):N.fromByteArray(e.slice(t,n))}function k(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var o,s,a,c,u=e[i],f=null,h=u>239?4:u>223?3:u>191?2:1;if(i+h<=n)switch(h){case 1:u<128&&(f=u);break;case 2:128==(192&(o=e[i+1]))&&(c=(31&u)<<6|63&o)>127&&(f=c);break;case 3:o=e[i+1],s=e[i+2],128==(192&o)&&128==(192&s)&&(c=(15&u)<<12|(63&o)<<6|63&s)>2047&&(c<55296||c>57343)&&(f=c);break;case 4:o=e[i+1],s=e[i+2],a=e[i+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&(c=(15&u)<<18|(63&o)<<12|(63&s)<<6|63&a)>65535&&c<1114112&&(f=c)}null===f?(f=65533,h=1):f>65535&&(f-=65536,r.push(f>>>10&1023|55296),f=56320|1023&f),r.push(f),i+=h}return function(e){var t=e.length;if(t<=H)return String.fromCharCode.apply(String,e);for(var n="",r=0;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=H));return n}(r)}function E(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function x(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function S(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",o=t;o<n;++o)i+=L(e[o]);return i}function A(e,t,n){for(var r=e.slice(t,n),i="",o=0;o<r.length;o+=2)i+=String.fromCharCode(r[o]+256*r[o+1]);return i}function C(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function T(e,t,n,r,o,s){if(!i.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>o||t<s)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function B(e,t,n,r,i,o){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function I(e,t,n,r,i){return t=+t,n>>>=0,i||B(e,0,n,4),D.write(e,t,n,r,23,4),n+4}function R(e,t,n,r,i){return t=+t,n>>>=0,i||B(e,0,n,8),D.write(e,t,n,r,52,8),n+8}function L(e){return e<16?"0"+e.toString(16):e.toString(16)}function O(e,t){t=t||1/0;for(var n,r=e.length,i=null,o=[],s=0;s<r;++s){if((n=e.charCodeAt(s))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(s+1===r){(t-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function P(e){return N.toByteArray(function(e){if((e=e.trim().replace(F,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function U(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}function M(e){return"function"==typeof ArrayBuffer.isView&&ArrayBuffer.isView(e)}function j(e){return e!=e}var N=e("base64-js"),D=e("ieee754");n.Buffer=i,n.SlowBuffer=function(e){return+e!=e&&(e=0),i.alloc(+e)},n.INSPECT_MAX_BYTES=50;var q=2147483647;n.kMaxLength=q,i.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()}catch(e){return!1}}(),i.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),"undefined"!=typeof Symbol&&Symbol.species&&i[Symbol.species]===i&&Object.defineProperty(i,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),i.poolSize=8192,i.from=function(e,t,n){return o(e,t,n)},i.prototype.__proto__=Uint8Array.prototype,i.__proto__=Uint8Array,i.alloc=function(e,t,n){return function(e,t,n){return s(e),e<=0?r(e):void 0!==t?"string"==typeof n?r(e).fill(t,n):r(e).fill(t):r(e)}(e,t,n)},i.allocUnsafe=function(e){return a(e)},i.allocUnsafeSlow=function(e){return a(e)},i.isBuffer=function(e){return null!=e&&!0===e._isBuffer},i.compare=function(e,t){if(!i.isBuffer(e)||!i.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,o=0,s=Math.min(n,r);o<s;++o)if(e[o]!==t[o]){n=e[o],r=t[o];break}return n<r?-1:r<n?1:0},i.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},i.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return i.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=i.allocUnsafe(t),o=0;for(n=0;n<e.length;++n){var s=e[n];if(!i.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(r,o),o+=s.length}return r},i.byteLength=f,i.prototype._isBuffer=!0,i.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)l(this,t,t+1);return this},i.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)l(this,t,t+3),l(this,t+1,t+2);return this},i.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)l(this,t,t+7),l(this,t+1,t+6),l(this,t+2,t+5),l(this,t+3,t+4);return this},i.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?k(this,0,e):h.apply(this,arguments)},i.prototype.equals=function(e){if(!i.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===i.compare(this,e)},i.prototype.inspect=function(){var e="",t=n.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,t).match(/.{2}/g).join(" "),this.length>t&&(e+=" ... ")),"<Buffer "+e+">"},i.prototype.compare=function(e,t,n,r,o){if(!i.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===o&&(o=this.length),t<0||n>e.length||r<0||o>this.length)throw new RangeError("out of range index");if(r>=o&&t>=n)return 0;if(r>=o)return-1;if(t>=n)return 1;if(this===e)return 0;for(var s=(o>>>=0)-(r>>>=0),a=(n>>>=0)-(t>>>=0),c=Math.min(s,a),u=this.slice(r,o),f=e.slice(t,n),h=0;h<c;++h)if(u[h]!==f[h]){s=u[h],a=f[h];break}return s<a?-1:a<s?1:0},i.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},i.prototype.indexOf=function(e,t,n){return d(this,e,t,n,!0)},i.prototype.lastIndexOf=function(e,t,n){return d(this,e,t,n,!1)},i.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return g(this,e,t,n);case"utf8":case"utf-8":return m(this,e,t,n);case"ascii":return y(this,e,t,n);case"latin1":case"binary":return v(this,e,t,n);case"base64":return b(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return _(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},i.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var H=4096;i.prototype.slice=function(e,t){var n=this.length;(e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e);var r=this.subarray(e,t);return r.__proto__=i.prototype,r},i.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||C(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r},i.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||C(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},i.prototype.readUInt8=function(e,t){return e>>>=0,t||C(e,1,this.length),this[e]},i.prototype.readUInt16LE=function(e,t){return e>>>=0,t||C(e,2,this.length),this[e]|this[e+1]<<8},i.prototype.readUInt16BE=function(e,t){return e>>>=0,t||C(e,2,this.length),this[e]<<8|this[e+1]},i.prototype.readUInt32LE=function(e,t){return e>>>=0,t||C(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},i.prototype.readUInt32BE=function(e,t){return e>>>=0,t||C(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},i.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||C(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},i.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||C(e,t,this.length);for(var r=t,i=1,o=this[e+--r];r>0&&(i*=256);)o+=this[e+--r]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},i.prototype.readInt8=function(e,t){return e>>>=0,t||C(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},i.prototype.readInt16LE=function(e,t){e>>>=0,t||C(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},i.prototype.readInt16BE=function(e,t){e>>>=0,t||C(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},i.prototype.readInt32LE=function(e,t){return e>>>=0,t||C(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},i.prototype.readInt32BE=function(e,t){return e>>>=0,t||C(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},i.prototype.readFloatLE=function(e,t){return e>>>=0,t||C(e,4,this.length),D.read(this,e,!0,23,4)},i.prototype.readFloatBE=function(e,t){return e>>>=0,t||C(e,4,this.length),D.read(this,e,!1,23,4)},i.prototype.readDoubleLE=function(e,t){return e>>>=0,t||C(e,8,this.length),D.read(this,e,!0,52,8)},i.prototype.readDoubleBE=function(e,t){return e>>>=0,t||C(e,8,this.length),D.read(this,e,!1,52,8)},i.prototype.writeUIntLE=function(e,t,n,r){e=+e,t>>>=0,n>>>=0,r||T(this,e,t,n,Math.pow(2,8*n)-1,0);var i=1,o=0;for(this[t]=255&e;++o<n&&(i*=256);)this[t+o]=e/i&255;return t+n},i.prototype.writeUIntBE=function(e,t,n,r){e=+e,t>>>=0,n>>>=0,r||T(this,e,t,n,Math.pow(2,8*n)-1,0);var i=n-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+n},i.prototype.writeUInt8=function(e,t,n){return e=+e,t>>>=0,n||T(this,e,t,1,255,0),this[t]=255&e,t+1},i.prototype.writeUInt16LE=function(e,t,n){return e=+e,t>>>=0,n||T(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},i.prototype.writeUInt16BE=function(e,t,n){return e=+e,t>>>=0,n||T(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},i.prototype.writeUInt32LE=function(e,t,n){return e=+e,t>>>=0,n||T(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},i.prototype.writeUInt32BE=function(e,t,n){return e=+e,t>>>=0,n||T(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},i.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t>>>=0,!r){var i=Math.pow(2,8*n-1);T(this,e,t,n,i-1,-i)}var o=0,s=1,a=0;for(this[t]=255&e;++o<n&&(s*=256);)e<0&&0===a&&0!==this[t+o-1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+n},i.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t>>>=0,!r){var i=Math.pow(2,8*n-1);T(this,e,t,n,i-1,-i)}var o=n-1,s=1,a=0;for(this[t+o]=255&e;--o>=0&&(s*=256);)e<0&&0===a&&0!==this[t+o+1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+n},i.prototype.writeInt8=function(e,t,n){return e=+e,t>>>=0,n||T(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},i.prototype.writeInt16LE=function(e,t,n){return e=+e,t>>>=0,n||T(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},i.prototype.writeInt16BE=function(e,t,n){return e=+e,t>>>=0,n||T(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},i.prototype.writeInt32LE=function(e,t,n){return e=+e,t>>>=0,n||T(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},i.prototype.writeInt32BE=function(e,t,n){return e=+e,t>>>=0,n||T(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},i.prototype.writeFloatLE=function(e,t,n){return I(this,e,t,!0,n)},i.prototype.writeFloatBE=function(e,t,n){return I(this,e,t,!1,n)},i.prototype.writeDoubleLE=function(e,t,n){return R(this,e,t,!0,n)},i.prototype.writeDoubleBE=function(e,t,n){return R(this,e,t,!1,n)},i.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i,o=r-n;if(this===e&&n<t&&t<r)for(i=o-1;i>=0;--i)e[i+t]=this[i+n];else if(o<1e3)for(i=0;i<o;++i)e[i+t]=this[i+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+o),t);return o},i.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length){var o=e.charCodeAt(0);o<256&&(e=o)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!i.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var s;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(s=t;s<n;++s)this[s]=e;else{var a=i.isBuffer(e)?e:new i(e,r),c=a.length;for(s=0;s<n-t;++s)this[s+t]=a[s%c]}return this};var F=/[^+\/0-9A-Za-z-_]/g},{"base64-js":8,ieee754:39}],25:[function(e,t,n){t.exports={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",208:"Already Reported",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",308:"Permanent Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Payload Too Large",414:"URI Too Long",415:"Unsupported Media Type",416:"Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",421:"Misdirected Request",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Unordered Collection",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",451:"Unavailable For Legal Reasons",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",508:"Loop Detected",509:"Bandwidth Limit Exceeded",510:"Not Extended",511:"Network Authentication Required"}},{}],26:[function(e,t,n){function r(e,t,n){var o=this;if(!(o instanceof r))return new r(e,t,n);if(s.Writable.call(o,n),n||(n={}),!e||!e.put||!e.get)throw new Error("First argument must be an abstract-chunk-store compliant store");if(!(t=Number(t)))throw new Error("Second argument must be a chunk length");o._blockstream=new i(t,{zeroPadding:!1}),o._blockstream.on("data",(function(t){o.destroyed||(e.put(a,t),a+=1)})).on("error",(function(e){o.destroy(e)}));var a=0;o.on("finish",(function(){this._blockstream.end()}))}t.exports=r;var i=e("block-stream2"),o=e("inherits"),s=e("readable-stream");o(r,s.Writable),r.prototype._write=function(e,t,n){this._blockstream.write(e,t,n)},r.prototype.destroy=function(e){this.destroyed||(this.destroyed=!0,e&&this.emit("error",e),this.emit("close"))}},{"block-stream2":20,inherits:41,"readable-stream":82}],27:[function(e,t,n){var r=Math.abs;t.exports=function(e,t,n){for(var i,o,s,a=1/0,c=0,u=t.length-1;c<=u&&((s=t[i=c+(u-c>>1)]-e)<0?c=i+1:s>0&&(u=i-1),(s=r(s))<a&&(a=s,o=i),t[i]!==e););return n?o:t[o]}},{}],28:[function(e,t,n){(function(e){function t(e){return Object.prototype.toString.call(e)}n.isArray=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===t(e)},n.isBoolean=function(e){return"boolean"==typeof e},n.isNull=function(e){return null===e},n.isNullOrUndefined=function(e){return null==e},n.isNumber=function(e){return"number"==typeof e},n.isString=function(e){return"string"==typeof e},n.isSymbol=function(e){return"symbol"==c(e)},n.isUndefined=function(e){return void 0===e},n.isRegExp=function(e){return"[object RegExp]"===t(e)},n.isObject=function(e){return"object"==c(e)&&null!==e},n.isDate=function(e){return"[object Date]"===t(e)},n.isError=function(e){return"[object Error]"===t(e)||e instanceof Error},n.isFunction=function(e){return"function"==typeof e},n.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==c(e)||void 0===e},n.isBuffer=e.isBuffer}).call(this,{isBuffer:e("../../is-buffer/index.js")})},{"../../is-buffer/index.js":43}],29:[function(e,t,r){(function(n,r,i){function o(e,t,r){function o(){C(e.map((function(e){return function(t){var n={};if(d(e))n.getStream=function(e){return function(){return new _(e)}}(e),n.length=e.size;else if(i.isBuffer(e))n.getStream=function(e){return function(){var t=new B.PassThrough;return t.end(e),t}}(e),n.length=e.length;else{if(!p(e)){if("string"==typeof e){if("function"!=typeof k.stat)throw new Error("filesystem paths do not work in the browser");return void s(e,c>1||f,t)}throw new Error("invalid input type")}n.getStream=function(e,t){return function(){var n=new B.Transform;return n._transform=function(e,n,r){t.length+=e.length,this.push(e),r()},e.pipe(n),n}}(e,n),n.length=0}n.path=e.path,t(null,n)}})),(function(e,t){if(e)return r(e);t=w(t),r(null,t,f)}))}if(Array.isArray(e)&&0===e.length)throw new Error("invalid input type");(function(e){return"undefined"!=typeof FileList&&e instanceof FileList})(e)&&(e=Array.prototype.slice.call(e)),Array.isArray(e)||(e=[e]),1!==(e=e.map((function(e){return d(e)&&"string"==typeof e.path&&"function"==typeof k.stat?e.path:e}))).length||"string"==typeof e[0]||e[0].name||(e[0].name=t.name);var a=null;e.forEach((function(t,n){if("string"!=typeof t){var r=t.fullPath||t.name;r||(r="Unknown File "+(n+1),t.unknownName=!0),t.path=r.split("/"),t.path[0]||t.path.shift(),t.path.length<2?a=null:0===n&&e.length>1?a=t.path[0]:t.path[0]!==a&&(a=null)}})),e=e.filter((function(e){if("string"==typeof e)return!0;var t=e.path[e.path.length-1];return u(t)&&x.not(t)})),a&&e.forEach((function(e){var t=(i.isBuffer(e)||p(e))&&!e.path;"string"==typeof e||t||e.path.shift()})),!t.name&&a&&(t.name=a),t.name||e.some((function(e){return"string"==typeof e?(t.name=v.basename(e),!0):e.unknownName?void 0:(t.name=e.path[e.path.length-1],!0)})),t.name||(t.name="Unnamed Torrent "+Date.now());var c=e.reduce((function(e,t){return e+Number("string"==typeof t)}),0),f=1===e.length;if(1===e.length&&"string"==typeof e[0]){if("function"!=typeof k.stat)throw new Error("filesystem paths do not work in the browser");E(e[0],(function(e,t){if(e)return r(e);f=t,o()}))}else n.nextTick((function(){o()}))}function s(e,t,n){!function e(t,n,r){k.stat(t,(function(i,o){if(i)return r(i);o.isDirectory()?k.readdir(t,(function(i,o){if(i)return r(i);C(o.filter(u).filter(x.not).map((function(r){return function(i){e(v.join(t,r),n,i)}})),r)})):o.isFile()&&n(t,r)}))}(e,a,(function(r,i){if(r)return n(r);i=Array.isArray(i)?w(i):[i],e=v.normalize(e),t&&(e=e.slice(0,e.lastIndexOf(v.sep)+1)),e[e.length-1]!==v.sep&&(e+=v.sep),i.forEach((function(t){t.getStream=function(e){return function(){return k.createReadStream(e)}}(t.path),t.path=t.path.replace(e,"").split(v.sep)})),n(null,i)}))}function a(e,t){t=A(t),k.stat(e,(function(n,r){if(n)return t(n);var i={length:r.size,path:e};t(null,i)}))}function u(e){return"."!==e[0]}function f(e,t,n){function r(e){f+=e.length;var t=d;T(e,(function(e){u[t]=e,l-=1,c()})),l+=1,d+=1}function o(){p=!0,c()}function s(e){a(),n(e)}function a(){g.removeListener("error",s),y.removeListener("data",r),y.removeListener("end",o),y.removeListener("error",s)}function c(){p&&0===l&&(a(),n(null,i.from(u.join(""),"hex"),f))}n=A(n);var u=[],f=0,h=e.map((function(e){return e.getStream})),l=0,d=0,p=!1,g=new S(h),y=new m(t,{zeroPadding:!1});g.on("error",s),g.pipe(y).on("data",r).on("end",o).on("error",s)}function h(e,n,i){var o=n.announceList;o||("string"==typeof n.announce?o=[[n.announce]]:Array.isArray(n.announce)&&(o=n.announce.map((function(e){return[e]})))),o||(o=[]),r.WEBTORRENT_ANNOUNCE&&("string"==typeof r.WEBTORRENT_ANNOUNCE?o.push([[r.WEBTORRENT_ANNOUNCE]]):Array.isArray(r.WEBTORRENT_ANNOUNCE)&&(o=o.concat(r.WEBTORRENT_ANNOUNCE.map((function(e){return[e]}))))),void 0===n.announce&&void 0===n.announceList&&(o=o.concat(t.exports.announceList)),"string"==typeof n.urlList&&(n.urlList=[n.urlList]);var s={info:{name:n.name},"creation date":Math.ceil((Number(n.creationDate)||Date.now())/1e3),encoding:"UTF-8"};0!==o.length&&(s.announce=o[0][0],s["announce-list"]=o),void 0!==n.comment&&(s.comment=n.comment),void 0!==n.createdBy&&(s["created by"]=n.createdBy),void 0!==n.private&&(s.info.private=Number(n.private)),void 0!==n.sslCert&&(s.info["ssl-cert"]=n.sslCert),void 0!==n.urlList&&(s["url-list"]=n.urlList);var a=n.pieceLength||y(e.reduce(l,0));s.info["piece length"]=a,f(e,a,(function(t,r,o){if(t)return i(t);s.info.pieces=r,e.forEach((function(e){delete e.getStream})),n.singleFileTorrent?s.info.length=o:s.info.files=e,i(null,g.encode(s))}))}function l(e,t){return e+t.length}function d(e){return"undefined"!=typeof Blob&&e instanceof Blob}function p(e){return"object"==c(e)&&null!=e&&"function"==typeof e.pipe}t.exports=function e(t,n,r){if("function"==typeof n)return e(t,null,n);o(t,n=n?b(n):{},(function(e,t,i){if(e)return r(e);n.singleFileTorrent=i,h(t,n,r)}))},t.exports.parseInput=function e(t,n,r){if("function"==typeof n)return e(t,null,n);o(t,n=n?b(n):{},r)},t.exports.announceList=[["udp://tracker.leechers-paradise.org:6969"],["udp://tracker.coppersurfer.tk:6969"],["udp://tracker.opentrackr.org:1337"],["udp://explodie.org:6969"],["udp://tracker.empire-js.us:1337"],["wss://tracker.btorrent.xyz"],["wss://tracker.openwebtorrent.com"],["wss://tracker.fastcast.nz"]];var g=e("bencode"),m=e("block-stream2"),y=e("piece-length"),v=e("path"),b=e("xtend"),_=e("filestream/read"),w=e("flatten"),k=e("fs"),E=e("is-file"),x=e("junk"),S=e("multistream"),A=e("once"),C=e("run-parallel"),T=e("simple-sha1"),B=e("readable-stream")}).call(this,e("_process"),void 0!==n?n:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer)},{_process:66,bencode:11,"block-stream2":20,buffer:24,"filestream/read":35,flatten:36,fs:22,"is-file":44,junk:47,multistream:58,once:60,path:63,"piece-length":64,"readable-stream":82,"run-parallel":86,"simple-sha1":92,xtend:119}],30:[function(e,t,n){(function(r){function i(){var e;try{e=n.storage.debug}catch(e){}return!e&&void 0!==r&&"env"in r&&(e=r.env.DEBUG),e}(n=t.exports=e("./debug")).log=function(){return"object"==("undefined"==typeof console?"undefined":c(console))&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},n.formatArgs=function(e){var t=this.useColors;if(e[0]=(t?"%c":"")+this.namespace+(t?" %c":" ")+e[0]+(t?"%c ":" ")+"+"+n.humanize(this.diff),t){var r="color: "+this.color;e.splice(1,0,r,"color: inherit");var i=0,o=0;e[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(i++,"%c"===e&&(o=i))})),e.splice(o,0,r)}},n.save=function(e){try{null==e?n.storage.removeItem("debug"):n.storage.debug=e}catch(e){}},n.load=i,n.useColors=function(){return!("undefined"==typeof window||!window||void 0===window.process||"renderer"!==window.process.type)||"undefined"!=typeof document&&document&&"WebkitAppearance"in document.documentElement.style||"undefined"!=typeof window&&window&&window.console&&(console.firebug||console.exception&&console.table)||"undefined"!=typeof navigator&&navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},n.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),n.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],n.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},n.enable(i())}).call(this,e("_process"))},{"./debug":31,_process:66}],31:[function(e,t,n){function r(e){function t(){if(t.enabled){var e=t,r=+new Date,o=r-(i||r);e.diff=o,e.prev=i,e.curr=r,i=r;for(var s=new Array(arguments.length),a=0;a<s.length;a++)s[a]=arguments[a];s[0]=n.coerce(s[0]),"string"!=typeof s[0]&&s.unshift("%O");var c=0;s[0]=s[0].replace(/%([a-zA-Z%])/g,(function(t,r){if("%%"===t)return t;c++;var i=n.formatters[r];if("function"==typeof i){var o=s[c];t=i.call(e,o),s.splice(c,1),c--}return t})),n.formatArgs.call(e,s),(t.log||n.log||console.log.bind(console)).apply(e,s)}}return t.namespace=e,t.enabled=n.enabled(e),t.useColors=n.useColors(),t.color=function(e){var t,r=0;for(t in e)r=(r<<5)-r+e.charCodeAt(t),r|=0;return n.colors[Math.abs(r)%n.colors.length]}(e),"function"==typeof n.init&&n.init(t),t}var i;(n=t.exports=r.debug=r.default=r).coerce=function(e){return e instanceof Error?e.stack||e.message:e},n.disable=function(){n.enable("")},n.enable=function(e){n.save(e),n.names=[],n.skips=[];for(var t=(e||"").split(/[\s,]+/),r=t.length,i=0;i<r;i++)t[i]&&("-"===(e=t[i].replace(/\*/g,".*?"))[0]?n.skips.push(new RegExp("^"+e.substr(1)+"$")):n.names.push(new RegExp("^"+e+"$")))},n.enabled=function(e){var t,r;for(t=0,r=n.skips.length;t<r;t++)if(n.skips[t].test(e))return!1;for(t=0,r=n.names.length;t<r;t++)if(n.names[t].test(e))return!0;return!1},n.humanize=e("ms"),n.names=[],n.skips=[],n.formatters={}},{ms:57}],32:[function(e,t,n){t.exports=function(){for(var e=0;e<arguments.length;e++)if(void 0!==arguments[e])return arguments[e]}},{}],33:[function(e,t,n){var r=e("once"),i=function(){};t.exports=function e(t,n,o){if("function"==typeof n)return e(t,null,n);n||(n={}),o=r(o||i);var s=t._writableState,a=t._readableState,c=n.readable||!1!==n.readable&&t.readable,u=n.writable||!1!==n.writable&&t.writable,f=function(){t.writable||h()},h=function(){u=!1,c||o.call(t)},l=function(){c=!1,u||o.call(t)},d=function(e){o.call(t,e?new Error("exited with error code: "+e):null)},p=function(){return(!c||a&&a.ended)&&(!u||s&&s.ended)?void 0:o.call(t,new Error("premature close"))},g=function(){t.req.on("finish",h)};return function(e){return e.setHeader&&"function"==typeof e.abort}(t)?(t.on("complete",h),t.on("abort",p),t.req?g():t.on("request",g)):u&&!s&&(t.on("end",f),t.on("close",f)),function(e){return e.stdio&&Array.isArray(e.stdio)&&3===e.stdio.length}(t)&&t.on("exit",d),t.on("end",l),t.on("finish",h),!1!==n.error&&t.on("error",o),t.on("close",p),function(){t.removeListener("complete",h),t.removeListener("abort",p),t.removeListener("request",g),t.req&&t.req.removeListener("finish",h),t.removeListener("end",f),t.removeListener("close",f),t.removeListener("finish",h),t.removeListener("exit",d),t.removeListener("end",l),t.removeListener("error",o),t.removeListener("close",p)}}},{once:60}],34:[function(e,t,n){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(e){return"function"==typeof e}function o(e){return"object"==c(e)&&null!==e}function s(e){return void 0===e}t.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(e){if(!function(e){return"number"==typeof e}(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},r.prototype.emit=function(e){var t,n,r,a,c,u;if(this._events||(this._events={}),"error"===e&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var f=new Error('Uncaught, unspecified "error" event. ('+t+")");throw f.context=t,f}if(s(n=this._events[e]))return!1;if(i(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),n.apply(this,a)}else if(o(n))for(a=Array.prototype.slice.call(arguments,1),r=(u=n.slice()).length,c=0;c<r;c++)u[c].apply(this,a);return!0},r.prototype.addListener=function(e,t){var n;if(!i(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,i(t.listener)?t.listener:t),this._events[e]?o(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,o(this._events[e])&&!this._events[e].warned&&(n=s(this._maxListeners)?r.defaultMaxListeners:this._maxListeners)&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(e,t){function n(){this.removeListener(e,n),r||(r=!0,t.apply(this,arguments))}if(!i(t))throw TypeError("listener must be a function");var r=!1;return n.listener=t,this.on(e,n),this},r.prototype.removeListener=function(e,t){var n,r,s,a;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(s=(n=this._events[e]).length,r=-1,n===t||i(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(o(n)){for(a=s;a-- >0;)if(n[a]===t||n[a].listener&&n[a].listener===t){r=a;break}if(r<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(r,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},r.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(i(n=this._events[e]))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},r.prototype.listeners=function(e){return this._events&&this._events[e]?i(this._events[e])?[this._events[e]]:this._events[e].slice():[]},r.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(i(t))return 1;if(t)return t.length}return 0},r.listenerCount=function(e,t){return e.listenerCount(t)}},{}],35:[function(e,t,n){function r(e,t){var n=this;if(!(this instanceof r))return new r(e,t);t=t||{},i.call(this,t),this._offset=0,this._ready=!1,this._file=e,this._size=e.size,this._chunkSize=t.chunkSize||Math.max(this._size/1e3,204800),this.reader=new FileReader,this._generateHeaderBlocks(e,t,(function(e,t){if(e)return n.emit("error",e);Array.isArray(t)&&t.forEach((function(e){n.push(e)})),n._ready=!0,n.emit("_ready")}))}var i=e("readable-stream").Readable,o=e("inherits"),s=e("typedarray-to-buffer");o(r,i),t.exports=r,r.prototype._generateHeaderBlocks=function(e,t,n){n(null,[])},r.prototype._read=function(){if(this._ready){var e=this,t=this.reader,n=this._offset,r=this._offset+this._chunkSize;if(r>this._size&&(r=this._size),n===this._size)return this.destroy(),void this.push(null);t.onload=function(){e._offset=r,e.push(s(t.result))},t.onerror=function(){e.emit("error",t.error)},t.readAsArrayBuffer(this._file.slice(n,r))}else this.once("_ready",this._read.bind(this))},r.prototype.destroy=function(){if(this._file=null,this.reader){this.reader.onload=null,this.reader.onerror=null;try{this.reader.abort()}catch(e){}}this.reader=null}},{inherits:41,"readable-stream":82,"typedarray-to-buffer":108}],36:[function(e,t,n){t.exports=function(e,t){return(t="number"==typeof t?t:1/0)?function e(n,r){return n.reduce((function(n,i){return Array.isArray(i)&&r<t?n.concat(e(i,r+1)):n.concat(i)}),[])}(e,1):Array.isArray(e)?e.map((function(e){return e})):e}},{}],37:[function(e,t,n){t.exports=function(){if("undefined"==typeof window)return null;var e={RTCPeerConnection:window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,RTCSessionDescription:window.RTCSessionDescription||window.mozRTCSessionDescription||window.webkitRTCSessionDescription,RTCIceCandidate:window.RTCIceCandidate||window.mozRTCIceCandidate||window.webkitRTCIceCandidate};return e.RTCPeerConnection?e:null}},{}],38:[function(e,t,n){function r(e){if("string"==typeof e&&(e=o.parse(e)),e.protocol||(e.protocol="https:"),"https:"!==e.protocol)throw new Error('Protocol "'+e.protocol+'" not supported. Expected "https:"');return e}var i=e("http"),o=e("url"),s=t.exports;for(var a in i)i.hasOwnProperty(a)&&(s[a]=i[a]);s.request=function(e,t){return e=r(e),i.request.call(this,e,t)},s.get=function(e,t){return e=r(e),i.get.call(this,e,t)}},{http:95,url:112}],39:[function(e,t,n){n.read=function(e,t,n,r,i){var o,s,a=8*i-r-1,c=(1<<a)-1,u=c>>1,f=-7,h=n?i-1:0,l=n?-1:1,d=e[t+h];for(h+=l,o=d&(1<<-f)-1,d>>=-f,f+=a;f>0;o=256*o+e[t+h],h+=l,f-=8);for(s=o&(1<<-f)-1,o>>=-f,f+=r;f>0;s=256*s+e[t+h],h+=l,f-=8);if(0===o)o=1-u;else{if(o===c)return s?NaN:1/0*(d?-1:1);s+=Math.pow(2,r),o-=u}return(d?-1:1)*s*Math.pow(2,o-r)},n.write=function(e,t,n,r,i,o){var s,a,c,u=8*o-i-1,f=(1<<u)-1,h=f>>1,l=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:o-1,p=r?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=f):(s=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-s))<1&&(s--,c*=2),(t+=s+h>=1?l/c:l*Math.pow(2,1-h))*c>=2&&(s++,c/=2),s+h>=f?(a=0,s=f):s+h>=1?(a=(t*c-1)*Math.pow(2,i),s+=h):(a=t*Math.pow(2,h-1)*Math.pow(2,i),s=0));i>=8;e[n+d]=255&a,d+=p,a/=256,i-=8);for(s=s<<i|a,u+=i;u>0;e[n+d]=255&s,d+=p,s/=256,u-=8);e[n+d-p]|=128*g}},{}],40:[function(e,t,n){(function(e){function n(e){if(!(this instanceof n))return new n(e);if(this.store=e,this.chunkLength=e.chunkLength,!this.store||!this.store.get||!this.store.put)throw new Error("First argument must be abstract-chunk-store compliant");this.mem=[]}function r(t,n,r){e.nextTick((function(){t&&t(n,r)}))}t.exports=n,n.prototype.put=function(e,t,n){var r=this;r.mem[e]=t,r.store.put(e,t,(function(t){r.mem[e]=null,n&&n(t)}))},n.prototype.get=function(e,t,n){if("function"==typeof t)return this.get(e,null,t);var i=t&&t.offset||0,o=t&&t.length&&i+t.length,s=this.mem[e];if(s)return r(n,null,t?s.slice(i,o):s);this.store.get(e,t,n)},n.prototype.close=function(e){this.store.close(e)},n.prototype.destroy=function(e){this.store.destroy(e)}}).call(this,e("_process"))},{_process:66}],41:[function(e,t,n){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],42:[function(e,t,n){t.exports=function(e){for(var t=0,n=e.length;t<n;++t)if(e.charCodeAt(t)>127)return!1;return!0}},{}],43:[function(e,t,n){function r(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}t.exports=function(e){return null!=e&&(r(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&r(e.slice(0,0))}(e)||!!e._isBuffer)}},{}],44:[function(e,t,n){function r(e){return i.existsSync(e)&&i.statSync(e).isFile()}var i=e("fs");t.exports=function(e,t){if(!t)return r(e);i.stat(e,(function(e,n){return e?t(e):t(null,n.isFile())}))},t.exports.sync=r},{fs:22}],45:[function(e,t,n){function r(e){return i(e)||o(e)}function i(e){return e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array}function o(e){return a[s.call(e)]}t.exports=r,r.strict=i,r.loose=o;var s=Object.prototype.toString,a={"[object Int8Array]":!0,"[object Int16Array]":!0,"[object Int32Array]":!0,"[object Uint8Array]":!0,"[object Uint8ClampedArray]":!0,"[object Uint16Array]":!0,"[object Uint32Array]":!0,"[object Float32Array]":!0,"[object Float64Array]":!0}},{}],46:[function(e,t,n){var r={}.toString;t.exports=Array.isArray||function(e){return"[object Array]"==r.call(e)}},{}],47:[function(e,t,n){n.re=/^npm-debug\.log$|^\..*\.swp$|^\.DS_Store$|^\.AppleDouble$|^\.LSOverride$|^Icon\r$|^\._.*|^\.Spotlight-V100$|\.Trashes|^__MACOSX$|~$|^Thumbs\.db$|^ehthumbs\.db$|^Desktop\.ini$/,n.is=function(e){return n.re.test(e)},n.not=n.isnt=function(e){return!n.is(e)}},{}],48:[function(e,t,n){(function(n){function r(e){var t,r={},o=e.split("magnet:?")[1];return(o&&o.length>=0?o.split("&"):[]).forEach((function(e){var t=e.split("=");if(2===t.length){var n=t[0],i=t[1];if("dn"===n&&(i=decodeURIComponent(i).replace(/\+/g," ")),"tr"!==n&&"xs"!==n&&"as"!==n&&"ws"!==n||(i=decodeURIComponent(i)),"kt"===n&&(i=decodeURIComponent(i).split("+")),"ix"===n&&(i=Number(i)),r[n])if(Array.isArray(r[n]))r[n].push(i);else{var o=r[n];r[n]=[o,i]}else r[n]=i}})),r.xt&&(Array.isArray(r.xt)?r.xt:[r.xt]).forEach((function(e){if(t=e.match(/^urn:btih:(.{40})/))r.infoHash=t[1].toLowerCase();else if(t=e.match(/^urn:btih:(.{32})/)){var o=i.decode(t[1]);r.infoHash=n.from(o,"binary").toString("hex")}})),r.infoHash&&(r.infoHashBuffer=n.from(r.infoHash,"hex")),r.dn&&(r.name=r.dn),r.kt&&(r.keywords=r.kt),"string"==typeof r.tr?r.announce=[r.tr]:Array.isArray(r.tr)?r.announce=r.tr:r.announce=[],r.urlList=[],("string"==typeof r.as||Array.isArray(r.as))&&(r.urlList=r.urlList.concat(r.as)),("string"==typeof r.ws||Array.isArray(r.ws))&&(r.urlList=r.urlList.concat(r.ws)),s(r.announce),s(r.urlList),r}t.exports=r,t.exports.decode=r,t.exports.encode=function(e){(e=o(e)).infoHashBuffer&&(e.xt="urn:btih:"+e.infoHashBuffer.toString("hex")),e.infoHash&&(e.xt="urn:btih:"+e.infoHash),e.name&&(e.dn=e.name),e.keywords&&(e.kt=e.keywords),e.announce&&(e.tr=e.announce),e.urlList&&(e.ws=e.urlList,delete e.as);var t="magnet:?";return Object.keys(e).filter((function(e){return 2===e.length})).forEach((function(n,r){(Array.isArray(e[n])?e[n]:[e[n]]).forEach((function(e,i){!(r>0||i>0)||"kt"===n&&0!==i||(t+="&"),"dn"===n&&(e=encodeURIComponent(e).replace(/%20/g,"+")),"tr"!==n&&"xs"!==n&&"as"!==n&&"ws"!==n||(e=encodeURIComponent(e)),"kt"===n&&(e=encodeURIComponent(e)),t+="kt"===n&&i>0?"+"+e:n+"="+e}))})),t};var i=e("thirty-two"),o=e("xtend"),s=e("uniq")}).call(this,e("buffer").Buffer)},{buffer:24,"thirty-two":103,uniq:110,xtend:119}],49:[function(e,t,n){function r(e,t){var n=this;if(!(n instanceof r))return new r(e,t);if(!c)throw new Error("web browser lacks MediaSource support");t||(t={}),n._bufferDuration=t.bufferDuration||u,n._elem=e,n._mediaSource=new c,n._streams=[],n.detailedError=null,n._errorHandler=function(){n._elem.removeEventListener("error",n._errorHandler),n._streams.slice().forEach((function(e){e.destroy(n._elem.error)}))},n._elem.addEventListener("error",n._errorHandler),n._elem.src=window.URL.createObjectURL(n._mediaSource)}function i(e,t){var n=this;if(s.Writable.call(n),n._wrapper=e,n._elem=e._elem,n._mediaSource=e._mediaSource,n._allStreams=e._streams,n._allStreams.push(n),n._bufferDuration=e._bufferDuration,n._sourceBuffer=null,n._openHandler=function(){n._onSourceOpen()},n._flowHandler=function(){n._flow()},"string"==typeof t)n._type=t,"open"===n._mediaSource.readyState?n._createSourceBuffer():n._mediaSource.addEventListener("sourceopen",n._openHandler);else if(null===t._sourceBuffer)t.destroy(),n._type=t._type,n._mediaSource.addEventListener("sourceopen",n._openHandler);else{if(!t._sourceBuffer)throw new Error("The argument to MediaElementWrapper.createWriteStream must be a string or a previous stream returned from that function");t.destroy(),n._type=t._type,n._sourceBuffer=t._sourceBuffer,n._sourceBuffer.addEventListener("updateend",n._flowHandler)}n._elem.addEventListener("timeupdate",n._flowHandler),n.on("error",(function(e){n._wrapper.error(e)})),n.on("finish",(function(){if(!n.destroyed&&(n._finished=!0,n._allStreams.every((function(e){return e._finished}))))try{n._mediaSource.endOfStream()}catch(e){}}))}t.exports=r;var o=e("inherits"),s=e("readable-stream"),a=e("to-arraybuffer"),c="undefined"!=typeof window&&window.MediaSource,u=60;r.prototype.createWriteStream=function(e){return new i(this,e)},r.prototype.error=function(e){var t=this;t.detailedError||(t.detailedError=e);try{t._mediaSource.endOfStream("decode")}catch(e){}},o(i,s.Writable),i.prototype._onSourceOpen=function(){var e=this;e.destroyed||(e._mediaSource.removeEventListener("sourceopen",e._openHandler),e._createSourceBuffer())},i.prototype.destroy=function(e){var t=this;t.destroyed||(t.destroyed=!0,t._allStreams.splice(t._allStreams.indexOf(t),1),t._mediaSource.removeEventListener("sourceopen",t._openHandler),t._elem.removeEventListener("timeupdate",t._flowHandler),t._sourceBuffer&&(t._sourceBuffer.removeEventListener("updateend",t._flowHandler),"open"===t._mediaSource.readyState&&t._sourceBuffer.abort()),e&&t.emit("error",e),t.emit("close"))},i.prototype._createSourceBuffer=function(){var e=this;if(!e.destroyed)if(c.isTypeSupported(e._type)){if(e._sourceBuffer=e._mediaSource.addSourceBuffer(e._type),e._sourceBuffer.addEventListener("updateend",e._flowHandler),e._cb){var t=e._cb;e._cb=null,t()}}else e.destroy(new Error("The provided type is not supported"))},i.prototype._write=function(e,t,n){var r=this;if(!r.destroyed){if(!r._sourceBuffer)return void(r._cb=function(i){if(i)return n(i);r._write(e,t,n)});if(r._sourceBuffer.updating)return n(new Error("Cannot append buffer while source buffer updating"));try{r._sourceBuffer.appendBuffer(a(e))}catch(e){return void r.destroy(e)}r._cb=n}},i.prototype._flow=function(){var e=this;if(!e.destroyed&&e._sourceBuffer&&!e._sourceBuffer.updating&&!("open"===e._mediaSource.readyState&&e._getBufferDuration()>e._bufferDuration)&&e._cb){var t=e._cb;e._cb=null,t()}},i.prototype._getBufferDuration=function(){for(var e=this._sourceBuffer.buffered,t=this._elem.currentTime,n=-1,r=0;r<e.length;r++){var i=e.start(r),o=e.end(r)+0;if(i>t)break;(n>=0||t<=o)&&(n=o)}var s=n-t;return s<0&&(s=0),s}},{inherits:41,"readable-stream":82,"to-arraybuffer":105}],50:[function(e,t,n){(function(e){function n(e,t){if(!(this instanceof n))return new n(e,t);if(t||(t={}),this.chunkLength=Number(e),!this.chunkLength)throw new Error("First argument must be a chunk length");this.chunks=[],this.closed=!1,this.length=Number(t.length)||1/0,this.length!==1/0&&(this.lastChunkLength=this.length%this.chunkLength||this.chunkLength,this.lastChunkIndex=Math.ceil(this.length/this.chunkLength)-1)}function r(t,n,r){e.nextTick((function(){t&&t(n,r)}))}t.exports=n,n.prototype.put=function(e,t,n){if(this.closed)return r(n,new Error("Storage is closed"));var i=e===this.lastChunkIndex;return i&&t.length!==this.lastChunkLength?r(n,new Error("Last chunk length must be "+this.lastChunkLength)):i||t.length===this.chunkLength?(this.chunks[e]=t,void r(n,null)):r(n,new Error("Chunk length must be "+this.chunkLength))},n.prototype.get=function(e,t,n){if("function"==typeof t)return this.get(e,null,t);if(this.closed)return r(n,new Error("Storage is closed"));var i=this.chunks[e];if(!i)return r(n,new Error("Chunk not found"));if(!t)return r(n,null,i);var o=t.offset||0,s=t.length||i.length-o;r(n,null,i.slice(o,s+o))},n.prototype.close=n.prototype.destroy=function(e){if(this.closed)return r(e,new Error("Storage is closed"));this.closed=!0,this.chunks=null,r(e,null)}}).call(this,e("_process"))},{_process:66}],51:[function(e,t,n){(function(t){function r(e,t,n){for(var r=t;r<n;r++)e[r]=0}function i(e,t,n){t.writeUInt32BE(Math.floor((e.getTime()+p)/1e3),n)}function o(e,t,n){t.writeUInt16BE(Math.floor(e)%65536,n),t.writeUInt16BE(Math.floor(256*e*256)%65536,n+2)}function s(e,t,n){e||(e=[0,0,0,0,0,0,0,0,0]);for(var r=0;r<e.length;r++)o(e[r],t,n+4*r)}function a(e){for(var t=new Array(e.length/4),n=0;n<t.length;n++)t[n]=u(e,4*n);return t}function c(e,t){return new Date(1e3*e.readUInt32BE(t)-p)}function u(e,t){return e.readUInt16BE(t)+e.readUInt16BE(t+2)/65536}function f(e,t){return e[t]+e[t+1]/256}function h(e,t,n){var r;for(r=0;r<n&&0!==e[t+r];r++);return e.toString("utf8",t,t+r)}var l=e("./index"),d=e("./descriptor"),p=20828448e5;n.fullBoxes={},["mvhd","tkhd","mdhd","vmhd","smhd","stsd","esds","stsz","stco","stss","stts","ctts","stsc","dref","elst","hdlr","mehd","trex","mfhd","tfhd","tfdt","trun"].forEach((function(e){n.fullBoxes[e]=!0})),n.ftyp={},n.ftyp.encode=function(e,r,i){r=r?r.slice(i):new t(n.ftyp.encodingLength(e));var o=e.compatibleBrands||[];r.write(e.brand,0,4,"ascii"),r.writeUInt32BE(e.brandVersion,4);for(var s=0;s<o.length;s++)r.write(o[s],8+4*s,4,"ascii");return n.ftyp.encode.bytes=8+4*o.length,r},n.ftyp.decode=function(e,t){for(var n=(e=e.slice(t)).toString("ascii",0,4),r=e.readUInt32BE(4),i=[],o=8;o<e.length;o+=4)i.push(e.toString("ascii",o,o+4));return{brand:n,brandVersion:r,compatibleBrands:i}},n.ftyp.encodingLength=function(e){return 8+4*(e.compatibleBrands||[]).length},n.mvhd={},n.mvhd.encode=function(e,a,c){return a=a?a.slice(c):new t(96),i(e.ctime||new Date,a,0),i(e.mtime||new Date,a,4),a.writeUInt32BE(e.timeScale||0,8),a.writeUInt32BE(e.duration||0,12),o(e.preferredRate||0,a,16),function(e,t,n){t[n]=Math.floor(e)%256,t[n+1]=Math.floor(256*e)%256}(e.preferredVolume||0,a,20),r(a,22,32),s(e.matrix,a,32),a.writeUInt32BE(e.previewTime||0,68),a.writeUInt32BE(e.previewDuration||0,72),a.writeUInt32BE(e.posterTime||0,76),a.writeUInt32BE(e.selectionTime||0,80),a.writeUInt32BE(e.selectionDuration||0,84),a.writeUInt32BE(e.currentTime||0,88),a.writeUInt32BE(e.nextTrackId||0,92),n.mvhd.encode.bytes=96,a},n.mvhd.decode=function(e,t){return{ctime:c(e=e.slice(t),0),mtime:c(e,4),timeScale:e.readUInt32BE(8),duration:e.readUInt32BE(12),preferredRate:u(e,16),preferredVolume:f(e,20),matrix:a(e.slice(32,68)),previewTime:e.readUInt32BE(68),previewDuration:e.readUInt32BE(72),posterTime:e.readUInt32BE(76),selectionTime:e.readUInt32BE(80),selectionDuration:e.readUInt32BE(84),currentTime:e.readUInt32BE(88),nextTrackId:e.readUInt32BE(92)}},n.mvhd.encodingLength=function(e){return 96},n.tkhd={},n.tkhd.encode=function(e,o,a){return o=o?o.slice(a):new t(80),i(e.ctime||new Date,o,0),i(e.mtime||new Date,o,4),o.writeUInt32BE(e.trackId||0,8),r(o,12,16),o.writeUInt32BE(e.duration||0,16),r(o,20,28),o.writeUInt16BE(e.layer||0,28),o.writeUInt16BE(e.alternateGroup||0,30),o.writeUInt16BE(e.volume||0,32),s(e.matrix,o,36),o.writeUInt32BE(e.trackWidth||0,72),o.writeUInt32BE(e.trackHeight||0,76),n.tkhd.encode.bytes=80,o},n.tkhd.decode=function(e,t){return{ctime:c(e=e.slice(t),0),mtime:c(e,4),trackId:e.readUInt32BE(8),duration:e.readUInt32BE(16),layer:e.readUInt16BE(28),alternateGroup:e.readUInt16BE(30),volume:e.readUInt16BE(32),matrix:a(e.slice(36,72)),trackWidth:e.readUInt32BE(72),trackHeight:e.readUInt32BE(76)}},n.tkhd.encodingLength=function(e){return 80},n.mdhd={},n.mdhd.encode=function(e,r,o){return r=r?r.slice(o):new t(20),i(e.ctime||new Date,r,0),i(e.mtime||new Date,r,4),r.writeUInt32BE(e.timeScale||0,8),r.writeUInt32BE(e.duration||0,12),r.writeUInt16BE(e.language||0,16),r.writeUInt16BE(e.quality||0,18),n.mdhd.encode.bytes=20,r},n.mdhd.decode=function(e,t){return{ctime:c(e=e.slice(t),0),mtime:c(e,4),timeScale:e.readUInt32BE(8),duration:e.readUInt32BE(12),language:e.readUInt16BE(16),quality:e.readUInt16BE(18)}},n.mdhd.encodingLength=function(e){return 20},n.vmhd={},n.vmhd.encode=function(e,r,i){(r=r?r.slice(i):new t(8)).writeUInt16BE(e.graphicsMode||0,0);var o=e.opcolor||[0,0,0];return r.writeUInt16BE(o[0],2),r.writeUInt16BE(o[1],4),r.writeUInt16BE(o[2],6),n.vmhd.encode.bytes=8,r},n.vmhd.decode=function(e,t){return{graphicsMode:(e=e.slice(t)).readUInt16BE(0),opcolor:[e.readUInt16BE(2),e.readUInt16BE(4),e.readUInt16BE(6)]}},n.vmhd.encodingLength=function(e){return 8},n.smhd={},n.smhd.encode=function(e,i,o){return(i=i?i.slice(o):new t(4)).writeUInt16BE(e.balance||0,0),r(i,2,4),n.smhd.encode.bytes=4,i},n.smhd.decode=function(e,t){return{balance:(e=e.slice(t)).readUInt16BE(0)}},n.smhd.encodingLength=function(e){return 4},n.stsd={},n.stsd.encode=function(e,r,i){r=r?r.slice(i):new t(n.stsd.encodingLength(e));var o=e.entries||[];r.writeUInt32BE(o.length,0);for(var s=4,a=0;a<o.length;a++){var c=o[a];l.encode(c,r,s),s+=l.encode.bytes}return n.stsd.encode.bytes=s,r},n.stsd.decode=function(e,t,n){for(var r=(e=e.slice(t)).readUInt32BE(0),i=new Array(r),o=4,s=0;s<r;s++){var a=l.decode(e,o,n);i[s]=a,o+=a.length}return{entries:i}},n.stsd.encodingLength=function(e){var t=4;if(!e.entries)return t;for(var n=0;n<e.entries.length;n++)t+=l.encodingLength(e.entries[n]);return t},n.avc1=n.VisualSampleEntry={},n.VisualSampleEntry.encode=function(e,i,o){r(i=i?i.slice(o):new t(n.VisualSampleEntry.encodingLength(e)),0,6),i.writeUInt16BE(e.dataReferenceIndex||0,6),r(i,8,24),i.writeUInt16BE(e.width||0,24),i.writeUInt16BE(e.height||0,26),i.writeUInt32BE(e.hResolution||4718592,28),i.writeUInt32BE(e.vResolution||4718592,32),r(i,36,40),i.writeUInt16BE(e.frameCount||1,40);var s=e.compressorName||"",a=Math.min(s.length,31);i.writeUInt8(a,42),i.write(s,43,a,"utf8"),i.writeUInt16BE(e.depth||24,74),i.writeInt16BE(-1,76);var c=78;(e.children||[]).forEach((function(e){l.encode(e,i,c),c+=l.encode.bytes})),n.VisualSampleEntry.encode.bytes=c},n.VisualSampleEntry.decode=function(e,t,n){e=e.slice(t);for(var r=n-t,i=Math.min(e.readUInt8(42),31),o={dataReferenceIndex:e.readUInt16BE(6),width:e.readUInt16BE(24),height:e.readUInt16BE(26),hResolution:e.readUInt32BE(28),vResolution:e.readUInt32BE(32),frameCount:e.readUInt16BE(40),compressorName:e.toString("utf8",43,43+i),depth:e.readUInt16BE(74),children:[]},s=78;r-s>=8;){var a=l.decode(e,s,r);o.children.push(a),o[a.type]=a,s+=a.length}return o},n.VisualSampleEntry.encodingLength=function(e){var t=78;return(e.children||[]).forEach((function(e){t+=l.encodingLength(e)})),t},n.avcC={},n.avcC.encode=function(e,r,i){r=r?r.slice(i):t(e.buffer.length),e.buffer.copy(r),n.avcC.encode.bytes=e.buffer.length},n.avcC.decode=function(e,n,r){return{mimeCodec:(e=e.slice(n,r)).toString("hex",1,4),buffer:new t(e)}},n.avcC.encodingLength=function(e){return e.buffer.length},n.mp4a=n.AudioSampleEntry={},n.AudioSampleEntry.encode=function(e,i,o){r(i=i?i.slice(o):new t(n.AudioSampleEntry.encodingLength(e)),0,6),i.writeUInt16BE(e.dataReferenceIndex||0,6),r(i,8,16),i.writeUInt16BE(e.channelCount||2,16),i.writeUInt16BE(e.sampleSize||16,18),r(i,20,24),i.writeUInt32BE(e.sampleRate||0,24);var s=28;(e.children||[]).forEach((function(e){l.encode(e,i,s),s+=l.encode.bytes})),n.AudioSampleEntry.encode.bytes=s},n.AudioSampleEntry.decode=function(e,t,n){for(var r=n-t,i={dataReferenceIndex:(e=e.slice(t,n)).readUInt16BE(6),channelCount:e.readUInt16BE(16),sampleSize:e.readUInt16BE(18),sampleRate:e.readUInt32BE(24),children:[]},o=28;r-o>=8;){var s=l.decode(e,o,r);i.children.push(s),i[s.type]=s,o+=s.length}return i},n.AudioSampleEntry.encodingLength=function(e){var t=28;return(e.children||[]).forEach((function(e){t+=l.encodingLength(e)})),t},n.esds={},n.esds.encode=function(e,r,i){r=r?r.slice(i):t(e.buffer.length),e.buffer.copy(r,0),n.esds.encode.bytes=e.buffer.length},n.esds.decode=function(e,n,r){e=e.slice(n,r);var i=d.Descriptor.decode(e,0,e.length),o=("ESDescriptor"===i.tagName?i:{}).DecoderConfigDescriptor||{},s=o.oti||0,a=o.DecoderSpecificInfo,c=a?(248&a.buffer.readUInt8(0))>>3:0,u=null;return s&&(u=s.toString(16),c&&(u+="."+c)),{mimeCodec:u,buffer:new t(e.slice(0))}},n.esds.encodingLength=function(e){return e.buffer.length},n.stsz={},n.stsz.encode=function(e,r,i){var o=e.entries||[];(r=r?r.slice(i):t(n.stsz.encodingLength(e))).writeUInt32BE(0,0),r.writeUInt32BE(o.length,4);for(var s=0;s<o.length;s++)r.writeUInt32BE(o[s],4*s+8);return n.stsz.encode.bytes=8+4*o.length,r},n.stsz.decode=function(e,t){for(var n=(e=e.slice(t)).readUInt32BE(0),r=e.readUInt32BE(4),i=new Array(r),o=0;o<r;o++)i[o]=0===n?e.readUInt32BE(4*o+8):n;return{entries:i}},n.stsz.encodingLength=function(e){return 8+4*e.entries.length},n.stss=n.stco={},n.stco.encode=function(e,r,i){var o=e.entries||[];(r=r?r.slice(i):new t(n.stco.encodingLength(e))).writeUInt32BE(o.length,0);for(var s=0;s<o.length;s++)r.writeUInt32BE(o[s],4*s+4);return n.stco.encode.bytes=4+4*o.length,r},n.stco.decode=function(e,t){for(var n=(e=e.slice(t)).readUInt32BE(0),r=new Array(n),i=0;i<n;i++)r[i]=e.readUInt32BE(4*i+4);return{entries:r}},n.stco.encodingLength=function(e){return 4+4*e.entries.length},n.stts={},n.stts.encode=function(e,r,i){var o=e.entries||[];(r=r?r.slice(i):new t(n.stts.encodingLength(e))).writeUInt32BE(o.length,0);for(var s=0;s<o.length;s++){var a=8*s+4;r.writeUInt32BE(o[s].count||0,a),r.writeUInt32BE(o[s].duration||0,a+4)}return n.stts.encode.bytes=4+8*e.entries.length,r},n.stts.decode=function(e,t){for(var n=(e=e.slice(t)).readUInt32BE(0),r=new Array(n),i=0;i<n;i++){var o=8*i+4;r[i]={count:e.readUInt32BE(o),duration:e.readUInt32BE(o+4)}}return{entries:r}},n.stts.encodingLength=function(e){return 4+8*e.entries.length},n.ctts={},n.ctts.encode=function(e,r,i){var o=e.entries||[];(r=r?r.slice(i):new t(n.ctts.encodingLength(e))).writeUInt32BE(o.length,0);for(var s=0;s<o.length;s++){var a=8*s+4;r.writeUInt32BE(o[s].count||0,a),r.writeUInt32BE(o[s].compositionOffset||0,a+4)}return n.ctts.encode.bytes=4+8*o.length,r},n.ctts.decode=function(e,t){for(var n=(e=e.slice(t)).readUInt32BE(0),r=new Array(n),i=0;i<n;i++){var o=8*i+4;r[i]={count:e.readUInt32BE(o),compositionOffset:e.readInt32BE(o+4)}}return{entries:r}},n.ctts.encodingLength=function(e){return 4+8*e.entries.length},n.stsc={},n.stsc.encode=function(e,r,i){var o=e.entries||[];(r=r?r.slice(i):new t(n.stsc.encodingLength(e))).writeUInt32BE(o.length,0);for(var s=0;s<o.length;s++){var a=12*s+4;r.writeUInt32BE(o[s].firstChunk||0,a),r.writeUInt32BE(o[s].samplesPerChunk||0,a+4),r.writeUInt32BE(o[s].sampleDescriptionId||0,a+8)}return n.stsc.encode.bytes=4+12*o.length,r},n.stsc.decode=function(e,t){for(var n=(e=e.slice(t)).readUInt32BE(0),r=new Array(n),i=0;i<n;i++){var o=12*i+4;r[i]={firstChunk:e.readUInt32BE(o),samplesPerChunk:e.readUInt32BE(o+4),sampleDescriptionId:e.readUInt32BE(o+8)}}return{entries:r}},n.stsc.encodingLength=function(e){return 4+12*e.entries.length},n.dref={},n.dref.encode=function(e,r,i){r=r?r.slice(i):new t(n.dref.encodingLength(e));var o=e.entries||[];r.writeUInt32BE(o.length,0);for(var s=4,a=0;a<o.length;a++){var c=o[a],u=(c.buf?c.buf.length:0)+4+4;r.writeUInt32BE(u,s),s+=4,r.write(c.type,s,4,"ascii"),s+=4,c.buf&&(c.buf.copy(r,s),s+=c.buf.length)}return n.dref.encode.bytes=s,r},n.dref.decode=function(e,t){for(var n=(e=e.slice(t)).readUInt32BE(0),r=new Array(n),i=4,o=0;o<n;o++){var s=e.readUInt32BE(i),a=e.toString("ascii",i+4,i+8),c=e.slice(i+8,i+s);i+=s,r[o]={type:a,buf:c}}return{entries:r}},n.dref.encodingLength=function(e){var t=4;if(!e.entries)return t;for(var n=0;n<e.entries.length;n++){var r=e.entries[n].buf;t+=(r?r.length:0)+4+4}return t},n.elst={},n.elst.encode=function(e,r,i){var s=e.entries||[];(r=r?r.slice(i):new t(n.elst.encodingLength(e))).writeUInt32BE(s.length,0);for(var a=0;a<s.length;a++){var c=12*a+4;r.writeUInt32BE(s[a].trackDuration||0,c),r.writeUInt32BE(s[a].mediaTime||0,c+4),o(s[a].mediaRate||0,r,c+8)}return n.elst.encode.bytes=4+12*s.length,r},n.elst.decode=function(e,t){for(var n=(e=e.slice(t)).readUInt32BE(0),r=new Array(n),i=0;i<n;i++){var o=12*i+4;r[i]={trackDuration:e.readUInt32BE(o),mediaTime:e.readInt32BE(o+4),mediaRate:u(e,o+8)}}return{entries:r}},n.elst.encodingLength=function(e){return 4+12*e.entries.length},n.hdlr={},n.hdlr.encode=function(e,r,i){r=r?r.slice(i):new t(n.hdlr.encodingLength(e));var o=21+(e.name||"").length;return r.fill(0,0,o),r.write(e.handlerType||"",4,4,"ascii"),function(e,n,r){var i=new t(e,"utf8");i.copy(n,r),n[r+i.length]=0}(e.name||"",r,20),n.hdlr.encode.bytes=o,r},n.hdlr.decode=function(e,t,n){return{handlerType:(e=e.slice(t)).toString("ascii",4,8),name:h(e,20,n)}},n.hdlr.encodingLength=function(e){return 21+(e.name||"").length},n.mehd={},n.mehd.encode=function(e,r,i){return(r=r?r.slice(i):new t(4)).writeUInt32BE(e.fragmentDuration||0,0),n.mehd.encode.bytes=4,r},n.mehd.decode=function(e,t){return{fragmentDuration:(e=e.slice(t)).readUInt32BE(0)}},n.mehd.encodingLength=function(e){return 4},n.trex={},n.trex.encode=function(e,r,i){return(r=r?r.slice(i):new t(20)).writeUInt32BE(e.trackId||0,0),r.writeUInt32BE(e.defaultSampleDescriptionIndex||0,4),r.writeUInt32BE(e.defaultSampleDuration||0,8),r.writeUInt32BE(e.defaultSampleSize||0,12),r.writeUInt32BE(e.defaultSampleFlags||0,16),n.trex.encode.bytes=20,r},n.trex.decode=function(e,t){return{trackId:(e=e.slice(t)).readUInt32BE(0),defaultSampleDescriptionIndex:e.readUInt32BE(4),defaultSampleDuration:e.readUInt32BE(8),defaultSampleSize:e.readUInt32BE(12),defaultSampleFlags:e.readUInt32BE(16)}},n.trex.encodingLength=function(e){return 20},n.mfhd={},n.mfhd.encode=function(e,r,i){return(r=r?r.slice(i):new t(4)).writeUInt32BE(e.sequenceNumber||0,0),n.mfhd.encode.bytes=4,r},n.mfhd.decode=function(e,t){return{sequenceNumber:e.readUint32BE(0)}},n.mfhd.encodingLength=function(e){return 4},n.tfhd={},n.tfhd.encode=function(e,r,i){return(r=r?r.slice(i):new t(4)).writeUInt32BE(e.trackId,0),n.tfhd.encode.bytes=4,r},n.tfhd.decode=function(e,t){},n.tfhd.encodingLength=function(e){return 4},n.tfdt={},n.tfdt.encode=function(e,r,i){return(r=r?r.slice(i):new t(4)).writeUInt32BE(e.baseMediaDecodeTime||0,0),n.tfdt.encode.bytes=4,r},n.tfdt.decode=function(e,t){},n.tfdt.encodingLength=function(e){return 4},n.trun={},n.trun.encode=function(e,r,i){(r=r?r.slice(i):new t(8+16*e.entries.length)).writeUInt32BE(e.entries.length,0),r.writeInt32BE(e.dataOffset,4);for(var o=8,s=0;s<e.entries.length;s++){var a=e.entries[s];r.writeUInt32BE(a.sampleDuration,o),o+=4,r.writeUInt32BE(a.sampleSize,o),o+=4,r.writeUInt32BE(a.sampleFlags,o),o+=4,r.writeUInt32BE(a.sampleCompositionTimeOffset,o),o+=4}n.trun.encode.bytes=o},n.trun.decode=function(e,t){},n.trun.encodingLength=function(e){return 8+16*e.entries.length},n.mdat={},n.mdat.encode=function(e,t,r){e.buffer?(e.buffer.copy(t,r),n.mdat.encode.bytes=e.buffer.length):n.mdat.encode.bytes=n.mdat.encodingLength(e)},n.mdat.decode=function(e,n,r){return{buffer:new t(e.slice(n,r))}},n.mdat.encodingLength=function(e){return e.buffer?e.buffer.length:e.contentLength}}).call(this,e("buffer").Buffer)},{"./descriptor":52,"./index":53,buffer:24}],52:[function(e,t,n){(function(e){var t={3:"ESDescriptor",4:"DecoderConfigDescriptor",5:"DecoderSpecificInfo",6:"SLConfigDescriptor"};n.Descriptor={},n.Descriptor.decode=function(r,i,o){var s,a=r.readUInt8(i),c=i+1,u=0;do{u=u<<7|127&(s=r.readUInt8(c++))}while(128&s);var f,h=t[a];return(f=n[h]?n[h].decode(r,c,o):{buffer:new e(r.slice(c,c+u))}).tag=a,f.tagName=h,f.length=c-i+u,f.contentsLen=u,f},n.DescriptorArray={},n.DescriptorArray.decode=function(e,r,i){for(var o=r,s={};o+2<=i;){var a=n.Descriptor.decode(e,o,i);o+=a.length,s[t[a.tag]||"Descriptor"+a.tag]=a}return s},n.ESDescriptor={},n.ESDescriptor.decode=function(e,t,r){var i=e.readUInt8(t+2),o=t+3;return 128&i&&(o+=2),64&i&&(o+=e.readUInt8(o)+1),32&i&&(o+=2),n.DescriptorArray.decode(e,o,r)},n.DecoderConfigDescriptor={},n.DecoderConfigDescriptor.decode=function(e,t,r){var i=e.readUInt8(t),o=n.DescriptorArray.decode(e,t+13,r);return o.oti=i,o}}).call(this,e("buffer").Buffer)},{buffer:24}],53:[function(e,t,n){(function(t){var r=e("uint64be"),i=e("./boxes"),o=n,s=n.containers={moov:["mvhd","meta","traks","mvex"],trak:["tkhd","tref","trgr","edts","meta","mdia","udta"],edts:["elst"],mdia:["mdhd","hdlr","elng","minf"],minf:["vmhd","smhd","hmhd","sthd","nmhd","dinf","stbl"],dinf:["dref"],stbl:["stsd","stts","ctts","cslg","stsc","stsz","stz2","stco","co64","stss","stsh","padb","stdp","sdtp","sbgps","sgpds","subss","saizs","saios"],mvex:["mehd","trexs","leva"],moof:["mfhd","meta","trafs"],traf:["tfhd","trun","sbgps","sgpds","subss","saizs","saios","tfdt","meta"]};o.encode=function(e,n,r){return o.encodingLength(e),r=r||0,n=n||new t(e.length),o._encode(e,n,r)},o._encode=function(e,t,n){var a=e.type,c=e.length;c>4294967295&&(c=1),t.writeUInt32BE(c,n),t.write(e.type,n+4,4,"ascii");var u=n+8;if(1===c&&(r.encode(e.length,t,u),u+=8),i.fullBoxes[a]&&(t.writeUInt32BE(e.flags||0,u),t.writeUInt8(e.version||0,u),u+=4),s[a])s[a].forEach((function(n){if(5===n.length){var r=e[n]||[];n=n.substr(0,4),r.forEach((function(e){o._encode(e,t,u),u+=o.encode.bytes}))}else e[n]&&(o._encode(e[n],t,u),u+=o.encode.bytes)})),e.otherBoxes&&e.otherBoxes.forEach((function(e){o._encode(e,t,u),u+=o.encode.bytes}));else if(i[a]){var f=i[a].encode;f(e,t,u),u+=f.bytes}else{if(!e.buffer)throw new Error("Either `type` must be set to a known type (not'"+a+"') or `buffer` must be set");e.buffer.copy(t,u),u+=e.buffer.length}return o.encode.bytes=u-n,t},o.readHeaders=function(e,t,n){if(t=t||0,(n=n||e.length)-t<8)return 8;var o,s,a=e.readUInt32BE(t),c=e.toString("ascii",t+4,t+8),u=t+8;if(1===a){if(n-t<16)return 16;a=r.decode(e,u),u+=8}return i.fullBoxes[c]&&(o=e.readUInt8(u),s=16777215&e.readUInt32BE(u),u+=4),{length:a,headersLen:u-t,contentLen:a-(u-t),type:c,version:o,flags:s}},o.decode=function(e,t,n){t=t||0,n=n||e.length;var r=o.readHeaders(e,t,n);if(!r||r.length>n-t)throw new Error("Data too short");return o.decodeWithoutHeaders(r,e,t+r.headersLen,t+r.length)},o.decodeWithoutHeaders=function(e,n,r,a){r=r||0,a=a||n.length;var c=e.type,u={};if(s[c]){u.otherBoxes=[];for(var f=s[c],h=r;a-h>=8;){var l=o.decode(n,h,a);if(h+=l.length,f.indexOf(l.type)>=0)u[l.type]=l;else if(f.indexOf(l.type+"s")>=0){var d=l.type+"s";(u[d]=u[d]||[]).push(l)}else u.otherBoxes.push(l)}}else if(i[c]){u=(0,i[c].decode)(n,r,a)}else u.buffer=new t(n.slice(r,a));return u.length=e.length,u.contentLen=e.contentLen,u.type=e.type,u.version=e.version,u.flags=e.flags,u},o.encodingLength=function(e){var t=e.type,n=8;if(i.fullBoxes[t]&&(n+=4),s[t])s[t].forEach((function(t){if(5===t.length){var r=e[t]||[];t=t.substr(0,4),r.forEach((function(e){e.type=t,n+=o.encodingLength(e)}))}else if(e[t]){var i=e[t];i.type=t,n+=o.encodingLength(i)}})),e.otherBoxes&&e.otherBoxes.forEach((function(e){n+=o.encodingLength(e)}));else if(i[t])n+=i[t].encodingLength(e);else{if(!e.buffer)throw new Error("Either `type` must be set to a known type (not'"+t+"') or `buffer` must be set");n+=e.buffer.length}return n>4294967295&&(n+=8),e.length=n,n}}).call(this,e("buffer").Buffer)},{"./boxes":51,buffer:24,uint64be:109}],54:[function(e,t,n){(function(n){function r(){if(!(this instanceof r))return new r;o.Writable.call(this),this.destroyed=!1,this._pending=0,this._missing=0,this._buf=null,this._str=null,this._cb=null,this._ondrain=null,this._writeBuffer=null,this._writeCb=null,this._ondrain=null,this._kick()}function i(e){this._parent=e,this.destroyed=!1,o.PassThrough.call(this)}var o=e("readable-stream"),s=e("inherits"),a=e("next-event"),c=e("mp4-box-encoding"),u=new n(0);t.exports=r,s(r,o.Writable),r.prototype.destroy=function(e){this.destroyed||(this.destroyed=!0,e&&this.emit("error",e),this.emit("close"))},r.prototype._write=function(e,t,n){if(!this.destroyed){for(var r=!this._str||!this._str._writableState.needDrain;e.length&&!this.destroyed;){if(!this._missing)return this._writeBuffer=e,void(this._writeCb=n);var i=e.length<this._missing?e.length:this._missing;if(this._buf?e.copy(this._buf,this._buf.length-this._missing):this._str&&(r=this._str.write(i===e.length?e:e.slice(0,i))),this._missing-=i,!this._missing){var o=this._buf,s=this._cb,a=this._str;this._buf=this._cb=this._str=this._ondrain=null,r=!0,a&&a.end(),s&&s(o)}e=i===e.length?u:e.slice(i)}if(this._pending&&!this._missing)return this._writeBuffer=e,void(this._writeCb=n);r?n():this._ondrain(n)}},r.prototype._buffer=function(e,t){this._missing=e,this._buf=new n(e),this._cb=t},r.prototype._stream=function(e,t){var n=this;return this._missing=e,this._str=new i(this),this._ondrain=a(this._str,"drain"),this._pending++,this._str.on("end",(function(){n._pending--,n._kick()})),this._cb=t,this._str},r.prototype._readBox=function(){var e=this;!function t(r,i){e._buffer(r,(function(r){i=i?n.concat([i,r]):r;var o=c.readHeaders(i);"number"==typeof o?t(o-i.length,i):(e._pending++,e._headers=o,e.emit("box",o))}))}(8)},r.prototype.stream=function(){var e=this;if(!e._headers)throw new Error("this function can only be called once after 'box' is emitted");var t=e._headers;return e._headers=null,e._stream(t.contentLen,null)},r.prototype.decode=function(e){var t=this;if(!t._headers)throw new Error("this function can only be called once after 'box' is emitted");var n=t._headers;t._headers=null,t._buffer(n.contentLen,(function(r){var i=c.decodeWithoutHeaders(n,r);e(i),t._pending--,t._kick()}))},r.prototype.ignore=function(){var e=this;if(!e._headers)throw new Error("this function can only be called once after 'box' is emitted");var t=e._headers;e._headers=null,this._missing=t.contentLen,this._cb=function(){e._pending--,e._kick()}},r.prototype._kick=function(){if(!this._pending&&(this._buf||this._str||this._readBox(),this._writeBuffer)){var e=this._writeCb,t=this._writeBuffer;this._writeBuffer=null,this._writeCb=null,this._write(t,null,e)}},s(i,o.PassThrough),i.prototype.destroy=function(e){this.destroyed||(this.destroyed=!0,this._parent.destroy(e),e&&this.emit("error",e),this.emit("close"))}}).call(this,e("buffer").Buffer)},{buffer:24,inherits:41,"mp4-box-encoding":53,"next-event":59,"readable-stream":82}],55:[function(e,t,n){(function(n,r){function i(){}function o(){if(!(this instanceof o))return new o;a.Readable.call(this),this.destroyed=!1,this._reading=!1,this._stream=null,this._drain=null,this._want=!1,this._onreadable=function(){e._want&&(e._want=!1,e._read())},this._onend=function(){e._stream=null};var e=this}function s(e){this._parent=e,this.destroyed=!1,a.PassThrough.call(this)}var a=e("readable-stream"),c=e("inherits"),u=e("mp4-box-encoding");t.exports=o,c(o,a.Readable),o.prototype.mediaData=o.prototype.mdat=function(e,t){var n=new s(this);return this.box({type:"mdat",contentLength:e,encodeBufferLen:8,stream:n},t),n},o.prototype.box=function(e,t){if(t||(t=i),this.destroyed)return t(new Error("Encoder is destroyed"));var o;if(e.encodeBufferLen&&(o=new r(e.encodeBufferLen)),e.stream)e.buffer=null,o=u.encode(e,o),this.push(o),this._stream=e.stream,this._stream.on("readable",this._onreadable),this._stream.on("end",this._onend),this._stream.on("end",t),this._forward();else{if(o=u.encode(e,o),this.push(o))return n.nextTick(t);this._drain=t}},o.prototype.destroy=function(e){if(!this.destroyed){if(this.destroyed=!0,this._stream&&this._stream.destroy&&this._stream.destroy(),this._stream=null,this._drain){var t=this._drain;this._drain=null,t(e)}e&&this.emit("error",e),this.emit("close")}},o.prototype.finalize=function(){this.push(null)},o.prototype._forward=function(){if(this._stream)for(;!this.destroyed;){var e=this._stream.read();if(!e)return void(this._want=!!this._stream);if(!this.push(e))return}},o.prototype._read=function(){if(!this._reading&&!this.destroyed){if(this._reading=!0,this._stream&&this._forward(),this._drain){var e=this._drain;this._drain=null,e()}this._reading=!1}},c(s,a.PassThrough),s.prototype.destroy=function(e){this.destroyed||(this.destroyed=!0,this._parent.destroy(e),e&&this.emit("error",e),this.emit("close"))}}).call(this,e("_process"),e("buffer").Buffer)},{_process:66,buffer:24,inherits:41,"mp4-box-encoding":53,"readable-stream":82}],56:[function(e,t,n){n.decode=e("./decode"),n.encode=e("./encode")},{"./decode":54,"./encode":55}],57:[function(e,t,n){function r(e,t,n){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}var i=1e3,o=60*i,s=60*o,a=24*s,u=365.25*a;t.exports=function(e,t){t=t||{};var n=c(e);if("string"===n&&e.length>0)return function(e){if(!((e=String(e)).length>1e4)){var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(t){var n=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return n*u;case"days":case"day":case"d":return n*a;case"hours":case"hour":case"hrs":case"hr":case"h":return n*s;case"minutes":case"minute":case"mins":case"min":case"m":return n*o;case"seconds":case"second":case"secs":case"sec":case"s":return n*i;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}(e);if("number"===n&&!1===isNaN(e))return t.long?function(e){return r(e,a,"day")||r(e,s,"hour")||r(e,o,"minute")||r(e,i,"second")||e+" ms"}(e):function(e){return e>=a?Math.round(e/a)+"d":e>=s?Math.round(e/s)+"h":e>=o?Math.round(e/o)+"m":e>=i?Math.round(e/i)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},{}],58:[function(e,t,n){function r(e,t){var n=this;if(!(n instanceof r))return new r(e,t);s.Readable.call(n,t),n.destroyed=!1,n._drained=!1,n._forwarding=!1,n._current=null,"function"==typeof e?n._queue=e:(n._queue=e.map(i),n._queue.forEach((function(e){"function"!=typeof e&&n._attachErrorListener(e)}))),n._next()}function i(e){if(!e||"function"==typeof e||e._readableState)return e;var t=(new s.Readable).wrap(e);return e.destroy&&(t.destroy=e.destroy.bind(e)),t}t.exports=r;var o=e("inherits"),s=e("readable-stream");o(r,s.Readable),r.obj=function(e){return new r(e,{objectMode:!0,highWaterMark:16})},r.prototype._read=function(){this._drained=!0,this._forward()},r.prototype._forward=function(){if(!this._forwarding&&this._drained&&this._current){this._forwarding=!0;for(var e;null!==(e=this._current.read());)this._drained=this.push(e);this._forwarding=!1}},r.prototype.destroy=function(e){this.destroyed||(this.destroyed=!0,this._current&&this._current.destroy&&this._current.destroy(),"function"!=typeof this._queue&&this._queue.forEach((function(e){e.destroy&&e.destroy()})),e&&this.emit("error",e),this.emit("close"))},r.prototype._next=function(){var e=this;if(e._current=null,"function"==typeof e._queue)e._queue((function(t,n){if(t)return e.destroy(t);n=i(n),e._attachErrorListener(n),e._gotNextStream(n)}));else{var t=e._queue.shift();"function"==typeof t&&(t=i(t()),e._attachErrorListener(t)),e._gotNextStream(t)}},r.prototype._gotNextStream=function(e){function t(){r._forward()}function n(){e._readableState.ended||r.destroy()}var r=this;if(!e)return r.push(null),void r.destroy();r._current=e,r._forward(),e.on("readable",t),e.once("end",(function i(){r._current=null,e.removeListener("readable",t),e.removeListener("end",i),e.removeListener("close",n),r._next()})),e.once("close",n)},r.prototype._attachErrorListener=function(e){var t=this;e&&e.once("error",(function n(r){e.removeListener("error",n),t.destroy(r)}))}},{inherits:41,"readable-stream":82}],59:[function(e,t,n){t.exports=function(e,t){var n=null;return e.on(t,(function(e){if(n){var t=n;n=null,t(e)}})),function(e){n=e}}},{}],60:[function(e,t,n){function r(e){var t=function t(){return t.called?t.value:(t.called=!0,t.value=e.apply(this,arguments))};return t.called=!1,t}function i(e){var t=function t(){if(t.called)throw new Error(t.onceError);return t.called=!0,t.value=e.apply(this,arguments)},n=e.name||"Function wrapped with `once`";return t.onceError=n+" shouldn't be called more than once",t.called=!1,t}var o=e("wrappy");t.exports=o(r),t.exports.strict=o(i),r.proto=r((function(){Object.defineProperty(Function.prototype,"once",{value:function(){return r(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return i(this)},configurable:!0})}))},{wrappy:118}],61:[function(e,t,n){(function(n){function r(e){n.isBuffer(e)&&(e=s.decode(e)),o(e.info,"info"),o(e.info["name.utf-8"]||e.info.name,"info.name"),o(e.info["piece length"],"info['piece length']"),o(e.info.pieces,"info.pieces"),e.info.files?e.info.files.forEach((function(e){o("number"==typeof e.length,"info.files[0].length"),o(e["path.utf-8"]||e.path,"info.files[0].path")})):o("number"==typeof e.info.length,"info.length");var t={};t.info=e.info,t.infoBuffer=s.encode(e.info),t.infoHash=c.sync(t.infoBuffer),t.infoHashBuffer=new n(t.infoHash,"hex"),t.name=(e.info["name.utf-8"]||e.info.name).toString(),void 0!==e.info.private&&(t.private=!!e.info.private),e["creation date"]&&(t.created=new Date(1e3*e["creation date"])),e["created by"]&&(t.createdBy=e["created by"].toString()),n.isBuffer(e.comment)&&(t.comment=e.comment.toString()),t.announce=[],e["announce-list"]&&e["announce-list"].length?e["announce-list"].forEach((function(e){e.forEach((function(e){t.announce.push(e.toString())}))})):e.announce&&t.announce.push(e.announce.toString()),n.isBuffer(e["url-list"])&&(e["url-list"]=e["url-list"].length>0?[e["url-list"]]:[]),t.urlList=(e["url-list"]||[]).map((function(e){return e.toString()})),u(t.announce),u(t.urlList);var r=e.info.files||[e.info];t.files=r.map((function(e,n){var o=[].concat(t.name,e["path.utf-8"]||e.path||[]).map((function(e){return e.toString()}));return{path:a.join.apply(null,[a.sep].concat(o)).slice(1),name:o[o.length-1],length:e.length,offset:r.slice(0,n).reduce(i,0)}})),t.length=r.reduce(i,0);var f=t.files[t.files.length-1];return t.pieceLength=e.info["piece length"],t.lastPieceLength=(f.offset+f.length)%t.pieceLength||t.pieceLength,t.pieces=function(e){for(var t=[],n=0;n<e.length;n+=20)t.push(e.slice(n,n+20).toString("hex"));return t}(e.info.pieces),t}function i(e,t){return e+t.length}function o(e,t){if(!e)throw new Error("Torrent is missing required field: "+t)}t.exports=r,t.exports.decode=r,t.exports.encode=function(e){var t={info:e.info};return t["announce-list"]=(e.announce||[]).map((function(e){return t.announce||(t.announce=e),[e=new n(e,"utf8")]})),t["url-list"]=e.urlList||[],e.created&&(t["creation date"]=e.created.getTime()/1e3|0),e.createdBy&&(t["created by"]=e.createdBy),e.comment&&(t.comment=e.comment),s.encode(t)};var s=e("bencode"),a=e("path"),c=e("simple-sha1"),u=e("uniq")}).call(this,e("buffer").Buffer)},{bencode:11,buffer:24,path:63,"simple-sha1":92,uniq:110}],62:[function(e,t,n){(function(n,r){function i(e){if("string"==typeof e&&/^(stream-)?magnet:/.test(e))return c(e);if("string"==typeof e&&(/^[a-f0-9]{40}$/i.test(e)||/^[a-z2-7]{32}$/i.test(e)))return c("magnet:?xt=urn:btih:"+e);if(r.isBuffer(e)&&20===e.length)return c("magnet:?xt=urn:btih:"+e.toString("hex"));if(r.isBuffer(e))return u(e);if(e&&e.infoHash)return e.announce||(e.announce=[]),"string"==typeof e.announce&&(e.announce=[e.announce]),e.urlList||(e.urlList=[]),e;throw new Error("Invalid torrent identifier")}t.exports=i,t.exports.remote=function(e,t){function r(e){try{c=i(e)}catch(e){return t(e)}c&&c.infoHash?t(null,c):t(new Error("Invalid torrent identifier"))}var c;if("function"!=typeof t)throw new Error("second argument must be a Function");try{c=i(e)}catch(e){}c&&c.infoHash?n.nextTick((function(){t(null,c)})):function(e){return"undefined"!=typeof Blob&&e instanceof Blob}(e)?o(e,(function(e,n){if(e)return t(new Error("Error converting Blob: "+e.message));r(n)})):"function"==typeof a&&/^https?:/.test(e)?a.concat({url:e,timeout:3e4,headers:{"user-agent":"WebTorrent (http://webtorrent.io)"}},(function(e,n,i){if(e)return t(new Error("Error downloading torrent: "+e.message));r(i)})):"function"==typeof s.readFile&&"string"==typeof e?s.readFile(e,(function(e,n){if(e)return t(new Error("Invalid torrent identifier"));r(n)})):n.nextTick((function(){t(new Error("Invalid torrent identifier"))}))};var o=e("blob-to-buffer"),s=e("fs"),a=e("simple-get"),c=e("magnet-uri"),u=e("parse-torrent-file");t.exports.toMagnetURI=c.encode,t.exports.toTorrentFile=u.encode,r.alloc(0)}).call(this,e("_process"),e("buffer").Buffer)},{_process:66,"blob-to-buffer":19,buffer:24,fs:22,"magnet-uri":48,"parse-torrent-file":61,"simple-get":90}],63:[function(e,t,n){(function(e){function t(e,t){for(var n=0,r=e.length-1;r>=0;r--){var i=e[r];"."===i?e.splice(r,1):".."===i?(e.splice(r,1),n++):n&&(e.splice(r,1),n--)}if(t)for(;n--;n)e.unshift("..");return e}function r(e,t){if(e.filter)return e.filter(t);for(var n=[],r=0;r<e.length;r++)t(e[r],r,e)&&n.push(e[r]);return n}var i=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,o=function(e){return i.exec(e).slice(1)};n.resolve=function(){for(var n="",i=!1,o=arguments.length-1;o>=-1&&!i;o--){var s=o>=0?arguments[o]:e.cwd();if("string"!=typeof s)throw new TypeError("Arguments to path.resolve must be strings");s&&(n=s+"/"+n,i="/"===s.charAt(0))}return(i?"/":"")+(n=t(r(n.split("/"),(function(e){return!!e})),!i).join("/"))||"."},n.normalize=function(e){var i=n.isAbsolute(e),o="/"===s(e,-1);return(e=t(r(e.split("/"),(function(e){return!!e})),!i).join("/"))||i||(e="."),e&&o&&(e+="/"),(i?"/":"")+e},n.isAbsolute=function(e){return"/"===e.charAt(0)},n.join=function(){var e=Array.prototype.slice.call(arguments,0);return n.normalize(r(e,(function(e,t){if("string"!=typeof e)throw new TypeError("Arguments to path.join must be strings");return e})).join("/"))},n.relative=function(e,t){function r(e){for(var t=0;t<e.length&&""===e[t];t++);for(var n=e.length-1;n>=0&&""===e[n];n--);return t>n?[]:e.slice(t,n-t+1)}e=n.resolve(e).substr(1),t=n.resolve(t).substr(1);for(var i=r(e.split("/")),o=r(t.split("/")),s=Math.min(i.length,o.length),a=s,c=0;c<s;c++)if(i[c]!==o[c]){a=c;break}var u=[];for(c=a;c<i.length;c++)u.push("..");return(u=u.concat(o.slice(a))).join("/")},n.sep="/",n.delimiter=":",n.dirname=function(e){var t=o(e),n=t[0],r=t[1];return n||r?(r&&(r=r.substr(0,r.length-1)),n+r):"."},n.basename=function(e,t){var n=o(e)[2];return t&&n.substr(-1*t.length)===t&&(n=n.substr(0,n.length-t.length)),n},n.extname=function(e){return o(e)[3]};var s="b"==="ab".substr(-1)?function(e,t,n){return e.substr(t,n)}:function(e,t,n){return t<0&&(t=e.length+t),e.substr(t,n)}}).call(this,e("_process"))},{_process:66}],64:[function(e,t,n){for(var r=e("closest-to"),i=Math.pow(2,10),o=13,s=[];o++<22;)s.push(Math.pow(2,o));t.exports=function(e){return r(e/i,s)}},{"closest-to":27}],65:[function(e,t,n){(function(e){!e.version||0===e.version.indexOf("v0.")||0===e.version.indexOf("v1.")&&0!==e.version.indexOf("v1.8.")?t.exports=function(t,n,r,i){if("function"!=typeof t)throw new TypeError('"callback" argument must be a function');var o,s,a=arguments.length;switch(a){case 0:case 1:return e.nextTick(t);case 2:return e.nextTick((function(){t.call(null,n)}));case 3:return e.nextTick((function(){t.call(null,n,r)}));case 4:return e.nextTick((function(){t.call(null,n,r,i)}));default:for(o=new Array(a-1),s=0;s<o.length;)o[s++]=arguments[s];return e.nextTick((function(){t.apply(null,o)}))}}:t.exports=e.nextTick}).call(this,e("_process"))},{_process:66}],66:[function(e,t,n){function r(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function o(e){if(f===setTimeout)return setTimeout(e,0);if((f===r||!f)&&setTimeout)return f=setTimeout,setTimeout(e,0);try{return f(e,0)}catch(t){try{return f.call(null,e,0)}catch(t){return f.call(this,e,0)}}}function s(){g&&d&&(g=!1,d.length?p=d.concat(p):m=-1,p.length&&a())}function a(){if(!g){var e=o(s);g=!0;for(var t=p.length;t;){for(d=p,p=[];++m<t;)d&&d[m].run();m=-1,t=p.length}d=null,g=!1,function(e){if(h===clearTimeout)return clearTimeout(e);if((h===i||!h)&&clearTimeout)return h=clearTimeout,clearTimeout(e);try{h(e)}catch(t){try{return h.call(null,e)}catch(t){return h.call(this,e)}}}(e)}}function c(e,t){this.fun=e,this.array=t}function u(){}var f,h,l=t.exports={};!function(){try{f="function"==typeof setTimeout?setTimeout:r}catch(e){f=r}try{h="function"==typeof clearTimeout?clearTimeout:i}catch(e){h=i}}();var d,p=[],g=!1,m=-1;l.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];p.push(new c(e,t)),1!==p.length||g||o(a)},c.prototype.run=function(){this.fun.apply(null,this.array)},l.title="browser",l.browser=!0,l.env={},l.argv=[],l.version="",l.versions={},l.on=u,l.addListener=u,l.once=u,l.off=u,l.removeListener=u,l.removeAllListeners=u,l.emit=u,l.binding=function(e){throw new Error("process.binding is not supported")},l.cwd=function(){return"/"},l.chdir=function(e){throw new Error("process.chdir is not supported")},l.umask=function(){return 0}},{}],67:[function(e,t,n){var r=e("once"),i=e("end-of-stream"),o=e("fs"),s=function(){},a=function(e){return"function"==typeof e},c=function(e){return!!o&&(e instanceof(o.ReadStream||s)||e instanceof(o.WriteStream||s))&&a(e.close)},u=function(e,t,n,o){o=r(o);var s=!1;e.on("close",(function(){s=!0})),i(e,{readable:t,writable:n},(function(e){if(e)return o(e);s=!0,o()}));var u=!1;return function(t){if(!s&&!u)return u=!0,c(e)?e.close():function(e){return e.setHeader&&a(e.abort)}(e)?e.abort():a(e.destroy)?e.destroy():void o(t||new Error("stream was destroyed"))}},f=function(e){e()},h=function(e,t){return e.pipe(t)};t.exports=function(){var e=Array.prototype.slice.call(arguments),t=a(e[e.length-1]||s)&&e.pop()||s;if(Array.isArray(e[0])&&(e=e[0]),e.length<2)throw new Error("pump requires two streams per minimum");var n,r=e.map((function(i,o){var s=o<e.length-1;return u(i,s,o>0,(function(e){n||(n=e),e&&r.forEach(f),s||(r.forEach(f),t(n))}))}));return e.reduce(h)}},{"end-of-stream":33,fs:21,once:60}],68:[function(e,t,r){(function(e){!function(n){function i(e){throw new RangeError(L[e])}function o(e,t){for(var n=e.length,r=[];n--;)r[n]=t(e[n]);return r}function s(e,t){var n=e.split("@"),r="";return n.length>1&&(r=n[0]+"@",e=n[1]),r+o((e=e.replace(R,".")).split("."),t).join(".")}function a(e){for(var t,n,r=[],i=0,o=e.length;i<o;)(t=e.charCodeAt(i++))>=55296&&t<=56319&&i<o?56320==(64512&(n=e.charCodeAt(i++)))?r.push(((1023&t)<<10)+(1023&n)+65536):(r.push(t),i--):r.push(t);return r}function u(e){return o(e,(function(e){var t="";return e>65535&&(t+=U((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+U(e)})).join("")}function f(e){return e-48<10?e-22:e-65<26?e-65:e-97<26?e-97:w}function h(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function l(e,t,n){var r=0;for(e=n?P(e/S):e>>1,e+=P(e/t);e>O*E>>1;r+=w)e=P(e/O);return P(r+(O+1)*e/(e+x))}function d(e){var t,n,r,o,s,a,c,h,d,p,g=[],m=e.length,y=0,v=C,b=A;for((n=e.lastIndexOf(T))<0&&(n=0),r=0;r<n;++r)e.charCodeAt(r)>=128&&i("not-basic"),g.push(e.charCodeAt(r));for(o=n>0?n+1:0;o<m;){for(s=y,a=1,c=w;o>=m&&i("invalid-input"),((h=f(e.charCodeAt(o++)))>=w||h>P((_-y)/a))&&i("overflow"),y+=h*a,!(h<(d=c<=b?k:c>=b+E?E:c-b));c+=w)a>P(_/(p=w-d))&&i("overflow"),a*=p;b=l(y-s,t=g.length+1,0==s),P(y/t)>_-v&&i("overflow"),v+=P(y/t),y%=t,g.splice(y++,0,v)}return u(g)}function p(e){var t,n,r,o,s,c,u,f,d,p,g,m,y,v,b,x=[];for(m=(e=a(e)).length,t=C,n=0,s=A,c=0;c<m;++c)(g=e[c])<128&&x.push(U(g));for(r=o=x.length,o&&x.push(T);r<m;){for(u=_,c=0;c<m;++c)(g=e[c])>=t&&g<u&&(u=g);for(u-t>P((_-n)/(y=r+1))&&i("overflow"),n+=(u-t)*y,t=u,c=0;c<m;++c)if((g=e[c])<t&&++n>_&&i("overflow"),g==t){for(f=n,d=w;!(f<(p=d<=s?k:d>=s+E?E:d-s));d+=w)b=f-p,v=w-p,x.push(U(h(p+b%v,0))),f=P(b/v);x.push(U(h(f,0))),s=l(n,y,r==o),n=0,++r}++n,++t}return x.join("")}var g="object"==c(r)&&r&&!r.nodeType&&r,m="object"==c(t)&&t&&!t.nodeType&&t,y="object"==c(e)&&e;y.global!==y&&y.window!==y&&y.self!==y||(n=y);var v,b,_=2147483647,w=36,k=1,E=26,x=38,S=700,A=72,C=128,T="-",B=/^xn--/,I=/[^\x20-\x7E]/,R=/[\x2E\u3002\uFF0E\uFF61]/g,L={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},O=w-k,P=Math.floor,U=String.fromCharCode;if(v={version:"1.4.1",ucs2:{decode:a,encode:u},decode:d,encode:p,toASCII:function(e){return s(e,(function(e){return I.test(e)?"xn--"+p(e):e}))},toUnicode:function(e){return s(e,(function(e){return B.test(e)?d(e.slice(4).toLowerCase()):e}))}},g&&m)if(t.exports==g)m.exports=v;else for(b in v)v.hasOwnProperty(b)&&(g[b]=v[b]);else n.punycode=v}(this)}).call(this,void 0!==n?n:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],69:[function(e,t,n){function r(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.exports=function(e,t,n,o){t=t||"&",n=n||"=";var s={};if("string"!=typeof e||0===e.length)return s;e=e.split(t);var a=1e3;o&&"number"==typeof o.maxKeys&&(a=o.maxKeys);var c=e.length;a>0&&c>a&&(c=a);for(var u=0;u<c;++u){var f,h,l,d,p=e[u].replace(/\+/g,"%20"),g=p.indexOf(n);g>=0?(f=p.substr(0,g),h=p.substr(g+1)):(f=p,h=""),l=decodeURIComponent(f),d=decodeURIComponent(h),r(s,l)?i(s[l])?s[l].push(d):s[l]=[s[l],d]:s[l]=d}return s};var i=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},{}],70:[function(e,t,n){function r(e,t){if(e.map)return e.map(t);for(var n=[],r=0;r<e.length;r++)n.push(t(e[r],r));return n}var i=function(e){switch(c(e)){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};t.exports=function(e,t,n,a){return t=t||"&",n=n||"=",null===e&&(e=void 0),"object"==c(e)?r(s(e),(function(s){var a=encodeURIComponent(i(s))+n;return o(e[s])?r(e[s],(function(e){return a+encodeURIComponent(i(e))})).join(t):a+encodeURIComponent(i(e[s]))})).join(t):a?encodeURIComponent(i(a))+n+encodeURIComponent(i(e)):""};var o=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},s=Object.keys||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t}},{}],71:[function(e,t,n){n.decode=n.parse=e("./decode"),n.encode=n.stringify=e("./encode")},{"./decode":69,"./encode":70}],72:[function(e,t,n){t.exports=function(e){var t=0;return function(){if(t===e.length)return null;var n=e.length-t,r=Math.random()*n|0,i=e[t+r],o=e[t];return e[t]=i,e[t+r]=o,t++,i}}},{}],73:[function(e,t,r){(function(e,n,r){var i=n.crypto||n.msCrypto;i&&i.getRandomValues?t.exports=function(t,o){if(t>65536)throw new Error("requested too many random bytes");var s=new n.Uint8Array(t);t>0&&i.getRandomValues(s);var a=new r(s.buffer);return"function"==typeof o?e.nextTick((function(){o(null,a)})):a}:t.exports=function(){throw new Error("secure random number generation not supported by this browser\nuse chrome, FireFox or Internet Explorer 11")}}).call(this,e("_process"),void 0!==n?n:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer)},{_process:66,buffer:24}],74:[function(e,t,n){function r(e,t){var n=this;if(!(n instanceof r))return new r(e);o.Writable.call(n,t),n.destroyed=!1,n._queue=[],n._position=e||0,n._cb=null,n._buffer=null,n._out=null}var i=e("inherits"),o=e("readable-stream");t.exports=r,i(r,o.Writable),r.prototype._write=function(e,t,n){for(var r=this,i=!0;;){if(r.destroyed)return;if(0===r._queue.length)return r._buffer=e,void(r._cb=n);r._buffer=null;var o,s=r._queue[0],a=Math.max(s.start-r._position,0),c=s.end-r._position;if(a>=e.length)return r._position+=e.length,n(null);if(c>e.length){r._position+=e.length,o=0===a?e:e.slice(a),i=s.stream.write(o)&&i;break}r._position+=c,o=0===a&&c===e.length?e:e.slice(a,c),i=s.stream.write(o)&&i,s.last&&s.stream.end(),e=e.slice(c),r._queue.shift()}i?n(null):s.stream.once("drain",n.bind(null,null))},r.prototype.slice=function(e){var t=this;if(t.destroyed)return null;e instanceof Array||(e=[e]);var n=new o.PassThrough;return e.forEach((function(r,i){t._queue.push({start:r.start,end:r.end,stream:n,last:i===e.length-1})})),t._buffer&&t._write(t._buffer,null,t._cb),n},r.prototype.destroy=function(e){var t=this;t.destroyed||(t.destroyed=!0,e&&t.emit("error",e))}},{inherits:41,"readable-stream":82}],75:[function(e,t,n){function r(e){if(!(this instanceof r))return new r(e);u.call(this,e),f.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",i)}function i(){this.allowHalfOpen||this._writableState.ended||a(o,this)}function o(e){e.end()}var s=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};t.exports=r;var a=e("process-nextick-args"),c=e("core-util-is");c.inherits=e("inherits");var u=e("./_stream_readable"),f=e("./_stream_writable");c.inherits(r,u);for(var h=s(f.prototype),l=0;l<h.length;l++){var d=h[l];r.prototype[d]||(r.prototype[d]=f.prototype[d])}},{"./_stream_readable":77,"./_stream_writable":79,"core-util-is":28,inherits:41,"process-nextick-args":65}],76:[function(e,t,n){function r(e){if(!(this instanceof r))return new r(e);i.call(this,e)}t.exports=r;var i=e("./_stream_transform"),o=e("core-util-is");o.inherits=e("inherits"),o.inherits(r,i),r.prototype._transform=function(e,t,n){n(null,e)}},{"./_stream_transform":78,"core-util-is":28,inherits:41}],77:[function(e,t,n){(function(n){function r(t,n){y=y||e("./_stream_duplex"),t=t||{},this.objectMode=!!t.objectMode,n instanceof y&&(this.objectMode=this.objectMode||!!t.readableObjectMode);var r=t.highWaterMark,i=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:i,this.highWaterMark=~~this.highWaterMark,this.buffer=new T,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(C||(C=e("string_decoder/").StringDecoder),this.decoder=new C(t.encoding),this.encoding=t.encoding)}function i(t){if(y=y||e("./_stream_duplex"),!(this instanceof i))return new i(t);this._readableState=new r(t,this),this.readable=!0,t&&"function"==typeof t.read&&(this._read=t.read),w.call(this)}function o(e,t,n,r,i){var o=function(e,t){var n=null;return k.isBuffer(t)||"string"==typeof t||null==t||e.objectMode||(n=new TypeError("Invalid non-string/buffer chunk")),n}(t,n);if(o)e.emit("error",o);else if(null===n)t.reading=!1,function(e,t){if(!t.ended){if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,a(e)}}(e,t);else if(t.objectMode||n&&n.length>0)if(t.ended&&!i){var s=new Error("stream.push() after EOF");e.emit("error",s)}else if(t.endEmitted&&i){var c=new Error("stream.unshift() after end event");e.emit("error",c)}else{var f;!t.decoder||i||r||(n=t.decoder.write(n),f=!t.objectMode&&0===n.length),i||(t.reading=!1),f||(t.flowing&&0===t.length&&!t.sync?(e.emit("data",n),e.read(0)):(t.length+=t.objectMode?1:n.length,i?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&a(e))),function(e,t){t.readingMore||(t.readingMore=!0,v(u,e,t))}(e,t)}else i||(t.reading=!1);return function(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}(t)}function s(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=I?e=I:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function a(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(A("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?v(c,e):c(e))}function c(e){A("emit readable"),e.emit("readable"),l(e)}function u(e,t){for(var n=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(A("maybeReadMore read 0"),e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}function f(e){A("readable nexttick read 0"),e.read(0)}function h(e,t){t.reading||(A("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),l(e),t.flowing&&!t.reading&&e.read(0)}function l(e){var t=e._readableState;for(A("flow",t.flowing);t.flowing&&null!==e.read(););}function d(e,t){return 0===t.length?null:(t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):n=function(e,t,n){var r;return e<t.head.data.length?(r=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):r=e===t.head.data.length?t.shift():n?function(e,t){var n=t.head,r=1,i=n.data;for(e-=i.length;n=n.next;){var o=n.data,s=e>o.length?o.length:e;if(s===o.length?i+=o:i+=o.slice(0,e),0==(e-=s)){s===o.length?(++r,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n,n.data=o.slice(s));break}++r}return t.length-=r,i}(e,t):function(e,t){var n=E.allocUnsafe(e),r=t.head,i=1;for(r.data.copy(n),e-=r.data.length;r=r.next;){var o=r.data,s=e>o.length?o.length:e;if(o.copy(n,n.length-e,0,s),0==(e-=s)){s===o.length?(++i,r.next?t.head=r.next:t.head=t.tail=null):(t.head=r,r.data=o.slice(s));break}++i}return t.length-=i,n}(e,t),r}(e,t.buffer,t.decoder),n);var n}function p(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,v(g,t,e))}function g(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function m(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}t.exports=i;var y,v=e("process-nextick-args"),b=e("isarray");i.ReadableState=r;var _=(e("events").EventEmitter,function(e,t){return e.listeners(t).length}),w=e("./internal/streams/stream"),k=e("buffer").Buffer,E=e("buffer-shims"),x=e("core-util-is");x.inherits=e("inherits");var S=e("util"),A=void 0;A=S&&S.debuglog?S.debuglog("stream"):function(){};var C,T=e("./internal/streams/BufferList");x.inherits(i,w);var B=["error","close","destroy","pause","resume"];i.prototype.push=function(e,t){var n=this._readableState;return n.objectMode||"string"!=typeof e||(t=t||n.defaultEncoding)!==n.encoding&&(e=E.from(e,t),t=""),o(this,n,e,t,!1)},i.prototype.unshift=function(e){return o(this,this._readableState,e,"",!0)},i.prototype.isPaused=function(){return!1===this._readableState.flowing},i.prototype.setEncoding=function(t){return C||(C=e("string_decoder/").StringDecoder),this._readableState.decoder=new C(t),this._readableState.encoding=t,this};var I=8388608;i.prototype.read=function(e){A("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return A("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?p(this):a(this),null;if(0===(e=s(e,t))&&t.ended)return 0===t.length&&p(this),null;var r,i=t.needReadable;return A("need readable",i),(0===t.length||t.length-e<t.highWaterMark)&&A("length less than watermark",i=!0),t.ended||t.reading?A("reading or ended",i=!1):i&&(A("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=s(n,t))),null===(r=e>0?d(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&p(this)),null!==r&&this.emit("data",r),r},i.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},i.prototype.pipe=function(e,t){function r(e){A("onunpipe"),e===h&&o()}function i(){A("onend"),e.end()}function o(){A("cleanup"),e.removeListener("close",c),e.removeListener("finish",u),e.removeListener("drain",g),e.removeListener("error",a),e.removeListener("unpipe",r),h.removeListener("end",i),h.removeListener("end",o),h.removeListener("data",s),y=!0,!d.awaitDrain||e._writableState&&!e._writableState.needDrain||g()}function s(t){A("ondata"),w=!1,!1!==e.write(t)||w||((1===d.pipesCount&&d.pipes===e||d.pipesCount>1&&-1!==m(d.pipes,e))&&!y&&(A("false write response, pause",h._readableState.awaitDrain),h._readableState.awaitDrain++,w=!0),h.pause())}function a(t){A("onerror",t),f(),e.removeListener("error",a),0===_(e,"error")&&e.emit("error",t)}function c(){e.removeListener("finish",u),f()}function u(){A("onfinish"),e.removeListener("close",c),f()}function f(){A("unpipe"),h.unpipe(e)}var h=this,d=this._readableState;switch(d.pipesCount){case 0:d.pipes=e;break;case 1:d.pipes=[d.pipes,e];break;default:d.pipes.push(e)}d.pipesCount+=1,A("pipe count=%d opts=%j",d.pipesCount,t);var p=(!t||!1!==t.end)&&e!==n.stdout&&e!==n.stderr?i:o;d.endEmitted?v(p):h.once("end",p),e.on("unpipe",r);var g=function(e){return function(){var t=e._readableState;A("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&_(e,"data")&&(t.flowing=!0,l(e))}}(h);e.on("drain",g);var y=!1,w=!1;return h.on("data",s),function(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?b(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}(e,"error",a),e.once("close",c),e.once("finish",u),e.emit("pipe",h),d.flowing||(A("pipe resume"),h.resume()),e},i.prototype.unpipe=function(e){var t=this._readableState;if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes?this:(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this),this);if(!e){var n=t.pipes,r=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var i=0;i<r;i++)n[i].emit("unpipe",this);return this}var o=m(t.pipes,e);return-1===o?this:(t.pipes.splice(o,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this),this)},i.prototype.on=function(e,t){var n=w.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var r=this._readableState;r.endEmitted||r.readableListening||(r.readableListening=r.needReadable=!0,r.emittedReadable=!1,r.reading?r.length&&a(this):v(f,this))}return n},i.prototype.addListener=i.prototype.on,i.prototype.resume=function(){var e=this._readableState;return e.flowing||(A("resume"),e.flowing=!0,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,v(h,e,t))}(this,e)),this},i.prototype.pause=function(){return A("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(A("pause"),this._readableState.flowing=!1,this.emit("pause")),this},i.prototype.wrap=function(e){var t=this._readableState,n=!1,r=this;for(var i in e.on("end",(function(){if(A("wrapped end"),t.decoder&&!t.ended){var e=t.decoder.end();e&&e.length&&r.push(e)}r.push(null)})),e.on("data",(function(i){A("wrapped data"),t.decoder&&(i=t.decoder.write(i)),t.objectMode&&null==i||!(t.objectMode||i&&i.length)||r.push(i)||(n=!0,e.pause())})),e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));for(var o=0;o<B.length;o++)e.on(B[o],r.emit.bind(r,B[o]));return r._read=function(t){A("wrapped _read",t),n&&(n=!1,e.resume())},r},i._fromList=d}).call(this,e("_process"))},{"./_stream_duplex":75,"./internal/streams/BufferList":80,"./internal/streams/stream":81,_process:66,buffer:24,"buffer-shims":23,"core-util-is":28,events:34,inherits:41,isarray:46,"process-nextick-args":65,"string_decoder/":102,util:21}],78:[function(e,t,n){function r(e){this.afterTransform=function(t,n){return function(e,t,n){var r=e._transformState;r.transforming=!1;var i=r.writecb;if(!i)return e.emit("error",new Error("no writecb in Transform class"));r.writechunk=null,r.writecb=null,null!=n&&e.push(n),i(t);var o=e._readableState;o.reading=!1,(o.needReadable||o.length<o.highWaterMark)&&e._read(o.highWaterMark)}(e,t,n)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null,this.writeencoding=null}function i(e){if(!(this instanceof i))return new i(e);s.call(this,e),this._transformState=new r(this);var t=this;this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.once("prefinish",(function(){"function"==typeof this._flush?this._flush((function(e,n){o(t,e,n)})):o(t)}))}function o(e,t,n){if(t)return e.emit("error",t);null!=n&&e.push(n);var r=e._writableState,i=e._transformState;if(r.length)throw new Error("Calling transform done when ws.length != 0");if(i.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}t.exports=i;var s=e("./_stream_duplex"),a=e("core-util-is");a.inherits=e("inherits"),a.inherits(i,s),i.prototype.push=function(e,t){return this._transformState.needTransform=!1,s.prototype.push.call(this,e,t)},i.prototype._transform=function(e,t,n){throw new Error("_transform() is not implemented")},i.prototype._write=function(e,t,n){var r=this._transformState;if(r.writecb=n,r.writechunk=e,r.writeencoding=t,!r.transforming){var i=this._readableState;(r.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},i.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0}},{"./_stream_duplex":75,"core-util-is":28,inherits:41}],79:[function(e,t,n){(function(n){function i(){}function o(e,t,n){this.chunk=e,this.encoding=t,this.callback=n,this.next=null}function s(t,n){m=m||e("./_stream_duplex"),t=t||{},this.objectMode=!!t.objectMode,n instanceof m&&(this.objectMode=this.objectMode||!!t.writableObjectMode);var r=t.highWaterMark,i=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:i,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var o=!1===t.decodeStrings;this.decodeStrings=!o,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var n=e._writableState,r=n.sync,i=n.writecb;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(n),t)!function(e,t,n,r,i){--t.pendingcb,n?y(i,r):i(r),e._writableState.errorEmitted=!0,e.emit("error",r)}(e,n,r,t,i);else{var o=l(n);o||n.corked||n.bufferProcessing||!n.bufferedRequest||h(e,n),r?v(f,e,n,o,i):f(e,n,o,i)}}(n,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new g(this)}function a(t){if(m=m||e("./_stream_duplex"),!(_.call(a,this)||this instanceof m))return new a(t);this._writableState=new s(t,this),this.writable=!0,t&&("function"==typeof t.write&&(this._write=t.write),"function"==typeof t.writev&&(this._writev=t.writev)),k.call(this)}function c(e,t,n,r,i,s){n||(r=function(e,t,n){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=x.from(t,n)),t}(t,r,i),E.isBuffer(r)&&(i="buffer"));var a=t.objectMode?1:r.length;t.length+=a;var c=t.length<t.highWaterMark;if(c||(t.needDrain=!0),t.writing||t.corked){var f=t.lastBufferedRequest;t.lastBufferedRequest=new o(r,i,s),f?f.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else u(e,t,!1,a,r,i,s);return c}function u(e,t,n,r,i,o,s){t.writelen=r,t.writecb=s,t.writing=!0,t.sync=!0,n?e._writev(i,t.onwrite):e._write(i,o,t.onwrite),t.sync=!1}function f(e,t,n,r){n||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,r(),p(e,t)}function h(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var r=t.bufferedRequestCount,i=new Array(r),o=t.corkedRequestsFree;o.entry=n;for(var s=0;n;)i[s]=n,n=n.next,s+=1;u(e,t,!0,t.length,i,"",o.finish),t.pendingcb++,t.lastBufferedRequest=null,o.next?(t.corkedRequestsFree=o.next,o.next=null):t.corkedRequestsFree=new g(t)}else{for(;n;){var a=n.chunk,c=n.encoding,f=n.callback;if(u(e,t,!1,t.objectMode?1:a.length,a,c,f),n=n.next,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequestCount=0,t.bufferedRequest=n,t.bufferProcessing=!1}function l(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function d(e,t){t.prefinished||(t.prefinished=!0,e.emit("prefinish"))}function p(e,t){var n=l(t);return n&&(0===t.pendingcb?(d(e,t),t.finished=!0,e.emit("finish")):d(e,t)),n}function g(e){var t=this;this.next=null,this.entry=null,this.finish=function(n){var r=t.entry;for(t.entry=null;r;){var i=r.callback;e.pendingcb--,i(n),r=r.next}e.corkedRequestsFree?e.corkedRequestsFree.next=t:e.corkedRequestsFree=t}}t.exports=a;var m,y=e("process-nextick-args"),v=!n.browser&&["v0.10","v0.9."].indexOf(n.version.slice(0,5))>-1?r:y;a.WritableState=s;var b=e("core-util-is");b.inherits=e("inherits");var _,w={deprecate:e("util-deprecate")},k=e("./internal/streams/stream"),E=e("buffer").Buffer,x=e("buffer-shims");b.inherits(a,k),s.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(s.prototype,"buffer",{get:w.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(_=Function.prototype[Symbol.hasInstance],Object.defineProperty(a,Symbol.hasInstance,{value:function(e){return!!_.call(this,e)||e&&e._writableState instanceof s}})):_=function(e){return e instanceof this},a.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},a.prototype.write=function(e,t,n){var r=this._writableState,o=!1,s=E.isBuffer(e);return"function"==typeof t&&(n=t,t=null),s?t="buffer":t||(t=r.defaultEncoding),"function"!=typeof n&&(n=i),r.ended?function(e,t){var n=new Error("write after end");e.emit("error",n),y(t,n)}(this,n):(s||function(e,t,n,r){var i=!0,o=!1;return null===n?o=new TypeError("May not write null values to stream"):"string"==typeof n||void 0===n||t.objectMode||(o=new TypeError("Invalid non-string/buffer chunk")),o&&(e.emit("error",o),y(r,o),i=!1),i}(this,r,e,n))&&(r.pendingcb++,o=c(this,r,s,e,t,n)),o},a.prototype.cork=function(){this._writableState.corked++},a.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||h(this,e))},a.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},a.prototype._write=function(e,t,n){n(new Error("_write() is not implemented"))},a.prototype._writev=null,a.prototype.end=function(e,t,n){var r=this._writableState;"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!=e&&this.write(e,t),r.corked&&(r.corked=1,this.uncork()),r.ending||r.finished||function(e,t,n){t.ending=!0,p(e,t),n&&(t.finished?y(n):e.once("finish",n)),t.ended=!0,e.writable=!1}(this,r,n)}}).call(this,e("_process"))},{"./_stream_duplex":75,"./internal/streams/stream":81,_process:66,buffer:24,"buffer-shims":23,"core-util-is":28,inherits:41,"process-nextick-args":65,"util-deprecate":115}],80:[function(e,t,n){function r(){this.head=null,this.tail=null,this.length=0}var i=(e("buffer").Buffer,e("buffer-shims"));t.exports=r,r.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},r.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},r.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},r.prototype.clear=function(){this.head=this.tail=null,this.length=0},r.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n},r.prototype.concat=function(e){if(0===this.length)return i.alloc(0);if(1===this.length)return this.head.data;for(var t=i.allocUnsafe(e>>>0),n=this.head,r=0;n;)n.data.copy(t,r),r+=n.data.length,n=n.next;return t}},{buffer:24,"buffer-shims":23}],81:[function(e,t,n){t.exports=e("events").EventEmitter},{events:34}],82:[function(e,t,n){(n=t.exports=e("./lib/_stream_readable.js")).Stream=n,n.Readable=n,n.Writable=e("./lib/_stream_writable.js"),n.Duplex=e("./lib/_stream_duplex.js"),n.Transform=e("./lib/_stream_transform.js"),n.PassThrough=e("./lib/_stream_passthrough.js")},{"./lib/_stream_duplex.js":75,"./lib/_stream_passthrough.js":76,"./lib/_stream_readable.js":77,"./lib/_stream_transform.js":78,"./lib/_stream_writable.js":79}],83:[function(e,t,n){function r(e,t,n,r){function o(){k.removeEventListener("loadstart",o),n.autoplay&&k.play()}function a(){k.removeEventListener("canplay",a),r(null,k)}function l(){k=t("iframe"),i(e,(function(e,t){if(e)return _(e);k.src=t,".pdf"!==E&&(k.sandbox="allow-forms allow-scripts"),r(null,k)}))}function _(t){t.message='Error rendering file "'+e.name+'": '+t.message,c(t.message),r(t)}var k,E=h.extname(e.name).toLowerCase(),x=0;m.indexOf(E)>=0?function(){function r(){c("Use MediaSource API for "+e.name),m(),k.addEventListener("error",l),k.addEventListener("loadstart",o),k.addEventListener("canplay",a);var t=new f(k).createWriteStream(s(e.name));e.createReadStream().pipe(t),x&&(k.currentTime=x)}function u(){c("Use Blob URL for "+e.name),m(),k.addEventListener("error",_),k.addEventListener("loadstart",o),k.addEventListener("canplay",a),i(e,(function(e,t){if(e)return _(e);k.src=t,x&&(k.currentTime=x)}))}function h(e){c("videostream error: fallback to MediaSource API: %o",e.message||e),k.removeEventListener("error",h),k.removeEventListener("canplay",a),r()}function l(t){if(c("MediaSource API error: fallback to Blob URL: %o",t.message||t),"number"==typeof e.length&&e.length>n.maxBlobLength)return c("File length too large for Blob URL approach: %d (max: %d)",e.length,n.maxBlobLength),_(new Error("File length too large for Blob URL approach: "+e.length+" (max: "+n.maxBlobLength+")"));k.removeEventListener("error",l),k.removeEventListener("canplay",a),u()}function m(){k||(k=t(y)).addEventListener("progress",(function(){x=k.currentTime}))}var y=g.indexOf(E)>=0?"video":"audio";w?p.indexOf(E)>=0?(c("Use `videostream` package for "+e.name),m(),k.addEventListener("error",h),k.addEventListener("loadstart",o),k.addEventListener("canplay",a),d(e,k)):r():u()}():y.indexOf(E)>=0?(k=t("audio"),i(e,(function(e,t){if(e)return _(e);k.addEventListener("error",_),k.addEventListener("loadstart",o),k.addEventListener("canplay",a),k.src=t}))):v.indexOf(E)>=0?(k=t("img"),i(e,(function(t,n){if(t)return _(t);k.src=n,k.alt=e.name,r(null,k)}))):b.indexOf(E)>=0?l():function(){c('Unknown file extension "%s" - will attempt to render into iframe',E);var t="";e.createReadStream({start:0,end:1e3}).setEncoding("utf8").on("data",(function(e){t+=e})).on("end",(function(){u(t)?(c('File extension "%s" appears ascii, so will render.',E),l()):(c('File extension "%s" appears non-ascii, will not render.',E),r(new Error('Unsupported file type "'+E+'": Cannot append to DOM')))})).on("error",r)}()}function i(e,t){var r=h.extname(e.name).toLowerCase();l(e.createReadStream(),n.mime[r],t)}function o(e){if(null==e)throw new Error("file cannot be null or undefined");if("string"!=typeof e.name)throw new Error("missing or invalid file.name property");if("function"!=typeof e.createReadStream)throw new Error("missing or invalid file.createReadStream property")}function s(e){return{".m4a":'audio/mp4; codecs="mp4a.40.5"',".m4v":'video/mp4; codecs="avc1.640029, mp4a.40.5"',".mkv":'video/webm; codecs="avc1.640029, mp4a.40.5"',".mp3":"audio/mpeg",".mp4":'video/mp4; codecs="avc1.640029, mp4a.40.5"',".webm":'video/webm; codecs="vorbis, vp8"'}[h.extname(e).toLowerCase()]}function a(e){null==e.autoplay&&(e.autoplay=!0),null==e.controls&&(e.controls=!0),null==e.maxBlobLength&&(e.maxBlobLength=_)}n.render=function(e,t,n,i){"function"==typeof n&&(i=n,n={}),n||(n={}),i||(i=function(){}),o(e),a(n),"string"==typeof t&&(t=document.querySelector(t)),r(e,(function(n){if(t.nodeName!==n.toUpperCase()){var r=h.extname(e.name).toLowerCase();throw new Error('Cannot render "'+r+'" inside a "'+t.nodeName.toLowerCase()+'" element, expected "'+n+'"')}return t}),n,i)},n.append=function(e,t,n,i){function s(e){var n=document.createElement(e);return t.appendChild(n),n}if("function"==typeof n&&(i=n,n={}),n||(n={}),i||(i=function(){}),o(e),a(n),"string"==typeof t&&(t=document.querySelector(t)),t&&("VIDEO"===t.nodeName||"AUDIO"===t.nodeName))throw new Error("Invalid video/audio node argument. Argument must be root element that video/audio tag will be appended to.");r(e,(function(e){return"video"===e||"audio"===e?function(e){var r=s(e);return n.controls&&(r.controls=!0),n.autoplay&&(r.autoplay=!0),t.appendChild(r),r}(e):s(e)}),n,(function(e,t){e&&t&&t.remove(),i(e,t)}))},n.mime=e("./lib/mime.json");var c=e("debug")("render-media"),u=e("is-ascii"),f=e("mediasource"),h=e("path"),l=e("stream-to-blob-url"),d=e("videostream"),p=[".m4a",".m4v",".mp4"],g=[".m4v",".mkv",".mp4",".webm"],m=[].concat(g,[".m4a",".mp3"]),y=[".aac",".oga",".ogg",".wav"],v=[".bmp",".gif",".jpeg",".jpg",".png",".svg"],b=[".css",".html",".js",".md",".pdf",".txt"],_=2e8,w="undefined"!=typeof window&&window.MediaSource},{"./lib/mime.json":84,debug:30,"is-ascii":42,mediasource:49,path:63,"stream-to-blob-url":99,videostream:117}],84:[function(e,t,n){t.exports={".3gp":"video/3gpp",".aac":"audio/aac",".aif":"audio/x-aiff",".aiff":"audio/x-aiff",".atom":"application/atom+xml",".avi":"video/x-msvideo",".bmp":"image/bmp",".bz2":"application/x-bzip2",".conf":"text/plain",".css":"text/css",".csv":"text/plain",".diff":"text/x-diff",".doc":"application/msword",".flv":"video/x-flv",".gif":"image/gif",".gz":"application/x-gzip",".htm":"text/html",".html":"text/html",".ico":"image/vnd.microsoft.icon",".ics":"text/calendar",".iso":"application/octet-stream",".jar":"application/java-archive",".jpeg":"image/jpeg",".jpg":"image/jpeg",".js":"application/javascript",".json":"application/json",".less":"text/css",".log":"text/plain",".m3u":"audio/x-mpegurl",".m4a":"audio/mp4",".m4v":"video/mp4",".manifest":"text/cache-manifest",".markdown":"text/x-markdown",".mathml":"application/mathml+xml",".md":"text/x-markdown",".mid":"audio/midi",".midi":"audio/midi",".mov":"video/quicktime",".mp3":"audio/mpeg",".mp4":"video/mp4",".mp4v":"video/mp4",".mpeg":"video/mpeg",".mpg":"video/mpeg",".odp":"application/vnd.oasis.opendocument.presentation",".ods":"application/vnd.oasis.opendocument.spreadsheet",".odt":"application/vnd.oasis.opendocument.text",".oga":"audio/ogg",".ogg":"application/ogg",".pdf":"application/pdf",".png":"image/png",".pps":"application/vnd.ms-powerpoint",".ppt":"application/vnd.ms-powerpoint",".ps":"application/postscript",".psd":"image/vnd.adobe.photoshop",".qt":"video/quicktime",".rar":"application/x-rar-compressed",".rdf":"application/rdf+xml",".rss":"application/rss+xml",".rtf":"application/rtf",".svg":"image/svg+xml",".svgz":"image/svg+xml",".swf":"application/x-shockwave-flash",".tar":"application/x-tar",".tbz":"application/x-bzip-compressed-tar",".text":"text/plain",".tif":"image/tiff",".tiff":"image/tiff",".torrent":"application/x-bittorrent",".ttf":"application/x-font-ttf",".txt":"text/plain",".wav":"audio/wav",".webm":"video/webm",".wma":"audio/x-ms-wma",".wmv":"video/x-ms-wmv",".xls":"application/vnd.ms-excel",".xml":"application/xml",".yaml":"text/yaml",".yml":"text/yaml",".zip":"application/zip"}},{}],85:[function(e,t,n){(function(e){t.exports=function(t,n,r){function i(t){function n(){r&&r(t,s),r=null}h?e.nextTick(n):n()}function o(e,n,r){if(s[e]=r,n&&(f=!0),0==--c||n)i(n);else if(!f&&l<a){var h;u?(h=u[l],l+=1,t[h]((function(e,t){o(h,e,t)}))):(h=l,l+=1,t[h]((function(e,t){o(h,e,t)})))}}if("number"!=typeof n)throw new Error("second argument must be a Number");var s,a,c,u,f,h=!0;Array.isArray(t)?(s=[],c=a=t.length):(u=Object.keys(t),s={},c=a=u.length);var l=n;c?u?u.some((function(e,r){if(t[e]((function(t,n){o(e,t,n)})),r===n-1)return!0})):t.some((function(e,t){if(e((function(e,n){o(t,e,n)})),t===n-1)return!0})):i(null),h=!1}}).call(this,e("_process"))},{_process:66}],86:[function(e,t,n){(function(e){t.exports=function(t,n){function r(t){function r(){n&&n(t,o),n=null}c?e.nextTick(r):r()}function i(e,t,n){o[e]=n,(0==--s||t)&&r(t)}var o,s,a,c=!0;Array.isArray(t)?(o=[],s=t.length):(a=Object.keys(t),o={},s=a.length),s?a?a.forEach((function(e){t[e]((function(t,n){i(e,t,n)}))})):t.forEach((function(e,t){e((function(e,n){i(t,e,n)}))})):r(null),c=!1}}).call(this,e("_process"))},{_process:66}],87:[function(e,t,r){(function(e){!function(){function n(e){for(var t={fill:0},o=function(e){for(e+=9;e%64>0;e+=1);return e},s=function(e,t,n,r,i){var o,s=this,a=i%4,c=(r+a)%4,u=r-c;switch(a){case 0:e[i]=s.charCodeAt(n+3);case 1:e[i+1-(a<<1)|0]=s.charCodeAt(n+2);case 2:e[i+2-(a<<1)|0]=s.charCodeAt(n+1);case 3:e[i+3-(a<<1)|0]=s.charCodeAt(n)}if(!(r<c+a)){for(o=4-a;o<u;o=o+4|0)t[i+o>>2]=s.charCodeAt(n+o)<<24|s.charCodeAt(n+o+1)<<16|s.charCodeAt(n+o+2)<<8|s.charCodeAt(n+o+3);switch(c){case 3:e[i+u+1|0]=s.charCodeAt(n+u+2);case 2:e[i+u+2|0]=s.charCodeAt(n+u+1);case 1:e[i+u+3|0]=s.charCodeAt(n+u)}}},a=function(e,t,n,r,i){var o,s=this,a=i%4,c=(r+a)%4,u=r-c;switch(a){case 0:e[i]=s[n+3];case 1:e[i+1-(a<<1)|0]=s[n+2];case 2:e[i+2-(a<<1)|0]=s[n+1];case 3:e[i+3-(a<<1)|0]=s[n]}if(!(r<c+a)){for(o=4-a;o<u;o=o+4|0)t[i+o>>2|0]=s[n+o]<<24|s[n+o+1]<<16|s[n+o+2]<<8|s[n+o+3];switch(c){case 3:e[i+u+1|0]=s[n+u+2];case 2:e[i+u+2|0]=s[n+u+1];case 1:e[i+u+3|0]=s[n+u]}}},c=function(e,t,n,r,o){var s,a=o%4,c=(r+a)%4,u=r-c,f=new Uint8Array(i.readAsArrayBuffer(this.slice(n,n+r)));switch(a){case 0:e[o]=f[3];case 1:e[o+1-(a<<1)|0]=f[2];case 2:e[o+2-(a<<1)|0]=f[1];case 3:e[o+3-(a<<1)|0]=f[0]}if(!(r<c+a)){for(s=4-a;s<u;s=s+4|0)t[o+s>>2|0]=f[s]<<24|f[s+1]<<16|f[s+2]<<8|f[s+3];switch(c){case 3:e[o+u+1|0]=f[u+2];case 2:e[o+u+2|0]=f[u+1];case 1:e[o+u+3|0]=f[u]}}},u=function(e){switch(r.getDataType(e)){case"string":return s.bind(e);case"array":case"buffer":return a.bind(e);case"arraybuffer":return a.bind(new Uint8Array(e));case"view":return a.bind(new Uint8Array(e.buffer,e.byteOffset,e.byteLength));case"blob":return c.bind(e)}},f=new Array(256),h=0;h<256;h++)f[h]=(h<16?"0":"")+h.toString(16);var l=function(e){for(var t=new Uint8Array(e),n=new Array(e.byteLength),r=0;r<n.length;r++)n[r]=f[t[r]];return n.join("")};!function(e){if(e%64>0)throw new Error("Chunk size must be a multiple of 128 bit");t.offset=0,t.maxChunkLen=e,t.padMaxChunkLen=o(e),t.heap=new ArrayBuffer(function(e){var t;if(e<=65536)return 65536;if(e<16777216)for(t=1;t<e;t<<=1);else for(t=16777216;t<e;t+=16777216);return t}(t.padMaxChunkLen+320+20)),t.h32=new Int32Array(t.heap),t.h8=new Int8Array(t.heap),t.core=new n._core({Int32Array:Int32Array,DataView:DataView},{},t.heap),t.buffer=null}(e||65536);var d=function(e,n){t.offset=0;var r=new Int32Array(e,n+320,5);r[0]=1732584193,r[1]=-271733879,r[2]=-1732584194,r[3]=271733878,r[4]=-1009589776},p=function(e,n){var r=o(e),i=new Int32Array(t.heap,0,r>>2);return function(e,t){var n=new Uint8Array(e.buffer),r=t%4,i=t-r;switch(r){case 0:n[i+3]=0;case 1:n[i+2]=0;case 2:n[i+1]=0;case 3:n[i+0]=0}for(var o=1+(t>>2);o<e.length;o++)e[o]=0}(i,e),function(e,t,n){e[t>>2]|=128<<24-(t%4<<3),e[14+(2+(t>>2)&-16)]=n/(1<<29)|0,e[15+(2+(t>>2)&-16)]=n<<3}(i,e,n),r},g=function(e,n,r,i){u(e)(t.h8,t.h32,n,r,i||0)},m=function(e,n,r,i,o){var s=r;g(e,n,r),o&&(s=p(r,i)),t.core.hash(s,t.padMaxChunkLen)},y=function(e,t){var n=new Int32Array(e,t+320,5),r=new Int32Array(5),i=new DataView(r.buffer);return i.setInt32(0,n[0],!1),i.setInt32(4,n[1],!1),i.setInt32(8,n[2],!1),i.setInt32(12,n[3],!1),i.setInt32(16,n[4],!1),r},v=this.rawDigest=function(e){var n=e.byteLength||e.length||e.size||0;d(t.heap,t.padMaxChunkLen);var r=0,i=t.maxChunkLen;for(r=0;n>r+i;r+=i)m(e,r,i,n,!1);return m(e,r,n-r,n,!0),y(t.heap,t.padMaxChunkLen)};this.digest=this.digestFromString=this.digestFromBuffer=this.digestFromArrayBuffer=function(e){return l(v(e).buffer)},this.resetState=function(){return d(t.heap,t.padMaxChunkLen),this},this.append=function(e){var n,r=0,i=e.byteLength||e.length||e.size||0,o=t.offset%t.maxChunkLen;for(t.offset+=i;r<i;)n=Math.min(i-r,t.maxChunkLen-o),g(e,r,n,o),r+=n,(o+=n)===t.maxChunkLen&&(t.core.hash(t.maxChunkLen,t.padMaxChunkLen),o=0);return this},this.getState=function(){var e;if(t.offset%t.maxChunkLen)e=t.heap.slice(0);else{var n=new Int32Array(t.heap,t.padMaxChunkLen+320,5);e=n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength)}return{offset:t.offset,heap:e}},this.setState=function(e){return t.offset=e.offset,20===e.heap.byteLength?new Int32Array(t.heap,t.padMaxChunkLen+320,5).set(new Int32Array(e.heap)):t.h32.set(new Int32Array(e.heap)),this};var b=this.rawEnd=function(){var e=t.offset,n=e%t.maxChunkLen,r=p(n,e);t.core.hash(r,t.padMaxChunkLen);var i=y(t.heap,t.padMaxChunkLen);return d(t.heap,t.padMaxChunkLen),i};this.end=function(){return l(b().buffer)}}var r={getDataType:function(t){if("string"==typeof t)return"string";if(t instanceof Array)return"array";if(void 0!==e&&e.Buffer&&e.Buffer.isBuffer(t))return"buffer";if(t instanceof ArrayBuffer)return"arraybuffer";if(t.buffer instanceof ArrayBuffer)return"view";if(t instanceof Blob)return"blob";throw new Error("Unsupported data type.")}};if(n._core=function(e,t,n){"use asm";var r=new e.Int32Array(n);function i(e,t){e=e|0;t=t|0;var n=0,i=0,o=0,s=0,a=0,c=0,u=0,f=0,h=0,l=0,d=0,p=0,g=0,m=0;o=r[t+320>>2]|0;a=r[t+324>>2]|0;u=r[t+328>>2]|0;h=r[t+332>>2]|0;d=r[t+336>>2]|0;for(n=0;(n|0)<(e|0);n=n+64|0){s=o;c=a;f=u;l=h;p=d;for(i=0;(i|0)<64;i=i+4|0){m=r[n+i>>2]|0;g=((o<<5|o>>>27)+(a&u|~a&h)|0)+((m+d|0)+1518500249|0)|0;d=h;h=u;u=a<<30|a>>>2;a=o;o=g;r[e+i>>2]=m}for(i=e+64|0;(i|0)<(e+80|0);i=i+4|0){m=(r[i-12>>2]^r[i-32>>2]^r[i-56>>2]^r[i-64>>2])<<1|(r[i-12>>2]^r[i-32>>2]^r[i-56>>2]^r[i-64>>2])>>>31;g=((o<<5|o>>>27)+(a&u|~a&h)|0)+((m+d|0)+1518500249|0)|0;d=h;h=u;u=a<<30|a>>>2;a=o;o=g;r[i>>2]=m}for(i=e+80|0;(i|0)<(e+160|0);i=i+4|0){m=(r[i-12>>2]^r[i-32>>2]^r[i-56>>2]^r[i-64>>2])<<1|(r[i-12>>2]^r[i-32>>2]^r[i-56>>2]^r[i-64>>2])>>>31;g=((o<<5|o>>>27)+(a^u^h)|0)+((m+d|0)+1859775393|0)|0;d=h;h=u;u=a<<30|a>>>2;a=o;o=g;r[i>>2]=m}for(i=e+160|0;(i|0)<(e+240|0);i=i+4|0){m=(r[i-12>>2]^r[i-32>>2]^r[i-56>>2]^r[i-64>>2])<<1|(r[i-12>>2]^r[i-32>>2]^r[i-56>>2]^r[i-64>>2])>>>31;g=((o<<5|o>>>27)+(a&u|a&h|u&h)|0)+((m+d|0)-1894007588|0)|0;d=h;h=u;u=a<<30|a>>>2;a=o;o=g;r[i>>2]=m}for(i=e+240|0;(i|0)<(e+320|0);i=i+4|0){m=(r[i-12>>2]^r[i-32>>2]^r[i-56>>2]^r[i-64>>2])<<1|(r[i-12>>2]^r[i-32>>2]^r[i-56>>2]^r[i-64>>2])>>>31;g=((o<<5|o>>>27)+(a^u^h)|0)+((m+d|0)-899497514|0)|0;d=h;h=u;u=a<<30|a>>>2;a=o;o=g;r[i>>2]=m}o=o+s|0;a=a+c|0;u=u+f|0;h=h+l|0;d=d+p|0}r[t+320>>2]=o;r[t+324>>2]=a;r[t+328>>2]=u;r[t+332>>2]=h;r[t+336>>2]=d}return{hash:i}},void 0!==t?t.exports=n:"undefined"!=typeof window&&(window.Rusha=n),"undefined"!=typeof FileReaderSync){var i=new FileReaderSync,o=new n(4194304);self.onmessage=function(e){var t,n=e.data.data;try{t=o.digest(n),self.postMessage({id:e.data.id,hash:t})}catch(t){self.postMessage({id:e.data.id,error:t.name})}}}}()}).call(this,void 0!==n?n:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],88:[function(e,t,n){t.exports=e("buffer")},{buffer:24}],89:[function(e,t,n){(function(e){t.exports=function(t,n){var r=[];t.on("data",(function(e){r.push(e)})),t.once("end",(function(){n&&n(null,e.concat(r)),n=null})),t.once("error",(function(e){n&&n(e),n=null}))}}).call(this,e("buffer").Buffer)},{buffer:24}],90:[function(e,t,n){(function(n){function r(e,t){var o;e="string"==typeof e?{url:e}:Object.assign({},e),t=c(t),e.url&&i(e),null==e.headers&&(e.headers={}),null==e.maxRedirects&&(e.maxRedirects=10),e.form&&(o="string"==typeof e.form?e.form:u.stringify(e.form)),e.body&&(o=e.json?JSON.stringify(e.body):e.body),e.json&&(e.headers.accept="application/json"),e.json&&o&&(e.headers["content-type"]="application/json"),e.form&&(e.headers["content-type"]="application/x-www-form-urlencoded"),o&&(e.headers["content-length"]=n.byteLength(o)),delete e.body,delete e.form,o&&!e.method&&(e.method="POST"),e.method&&(e.method=e.method.toUpperCase()),Object.keys(e.headers).some((function(e){return"accept-encoding"===e.toLowerCase()}))||(e.headers["accept-encoding"]="gzip, deflate");var h=("https:"===e.protocol?a:s).request(e,(function(n){if(n.statusCode>=300&&n.statusCode<400&&"location"in n.headers)return e.url=n.headers.location,n.resume(),void(e.maxRedirects>0?(e.maxRedirects-=1,r(e,t)):t(new Error("too many redirects")));var i="function"==typeof f&&"HEAD"!==e.method;t(null,i?f(n):n)}));return h.on("timeout",(function(){h.abort(),t(new Error("Request timed out"))})),h.on("error",t),h.end(o),h}function i(e){var t=h.parse(e.url);t.hostname&&(e.hostname=t.hostname),t.port&&(e.port=t.port),t.protocol&&(e.protocol=t.protocol),t.auth&&(e.auth=t.auth),e.path=t.path,delete e.url}t.exports=r;var o=e("simple-concat"),s=e("http"),a=e("https"),c=e("once"),u=e("querystring"),f=e("unzip-response"),h=e("url");r.concat=function(e,t){return r(e,(function(n,r){if(n)return t(n);o(r,(function(n,i){if(n)return t(n);if(e.json)try{i=JSON.parse(i.toString())}catch(n){return t(n,r,i)}t(null,r,i)}))}))},["get","post","put","patch","head","delete"].forEach((function(e){r[e]=function(t,n){return"string"==typeof t&&(t={url:t}),t.method=e.toUpperCase(),r(t,n)}}))}).call(this,e("buffer").Buffer)},{buffer:24,http:95,https:38,once:60,querystring:71,"simple-concat":89,"unzip-response":21,url:112}],91:[function(e,t,n){(function(n){function r(e){var t=this;if(!(t instanceof r))return new r(e);if(t._id=u(4).toString("hex").slice(0,7),t._debug("new peer %o",e),e=Object.assign({allowHalfOpen:!1},e),f.Duplex.call(t,e),t.channelName=e.initiator?e.channelName||u(20).toString("hex"):null,t._isChromium="undefined"!=typeof window&&!!window.webkitRTCPeerConnection,t.initiator=e.initiator||!1,t.channelConfig=e.channelConfig||r.channelConfig,t.config=e.config||r.config,t.constraints=t._transformConstraints(e.constraints||r.constraints),t.offerConstraints=t._transformConstraints(e.offerConstraints||{}),t.answerConstraints=t._transformConstraints(e.answerConstraints||{}),t.reconnectTimer=e.reconnectTimer||!1,t.sdpTransform=e.sdpTransform||function(e){return e},t.stream=e.stream||!1,t.trickle=void 0===e.trickle||e.trickle,t.destroyed=!1,t.connected=!1,t.remoteAddress=void 0,t.remoteFamily=void 0,t.remotePort=void 0,t.localAddress=void 0,t.localPort=void 0,t._wrtc=e.wrtc&&"object"==c(e.wrtc)?e.wrtc:s(),!t._wrtc)throw"undefined"==typeof window?new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"):new Error("No WebRTC support: Not a supported browser");if(t._pcReady=!1,t._channelReady=!1,t._iceComplete=!1,t._channel=null,t._pendingCandidates=[],t._previousStreams=[],t._chunk=null,t._cb=null,t._interval=null,t._reconnectTimeout=null,t._pc=new t._wrtc.RTCPeerConnection(t.config,t.constraints),t._isWrtc=Array.isArray(t._pc.RTCIceConnectionStates),t._isReactNativeWebrtc="number"==typeof t._pc._peerConnectionId,t._pc.oniceconnectionstatechange=function(){t._onIceStateChange()},t._pc.onicegatheringstatechange=function(){t._onIceStateChange()},t._pc.onsignalingstatechange=function(){t._onSignalingStateChange()},t._pc.onicecandidate=function(e){t._onIceCandidate(e)},t.initiator){var n=!1;t._pc.onnegotiationneeded=function(){n||t._createOffer(),n=!0},t._setupData({channel:t._pc.createDataChannel(t.channelName,t.channelConfig)})}else t._pc.ondatachannel=function(e){t._setupData(e)};"addTrack"in t._pc?(t.stream&&t.stream.getTracks().forEach((function(e){t._pc.addTrack(e,t.stream)})),t._pc.ontrack=function(e){t._onTrack(e)}):(t.stream&&t._pc.addStream(t.stream),t._pc.onaddstream=function(e){t._onAddStream(e)}),t.initiator&&t._isWrtc&&t._pc.onnegotiationneeded(),t._onFinishBound=function(){t._onFinish()},t.once("finish",t._onFinishBound)}function i(){}t.exports=r;var o=e("debug")("simple-peer"),s=e("get-browser-rtc"),a=e("inherits"),u=e("randombytes"),f=e("readable-stream");a(r,f.Duplex),r.WEBRTC_SUPPORT=!!s(),r.config={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:global.stun.twilio.com:3478?transport=udp"}]},r.constraints={},r.channelConfig={},Object.defineProperty(r.prototype,"bufferSize",{get:function(){return this._channel&&this._channel.bufferedAmount||0}}),r.prototype.address=function(){return{port:this.localPort,family:"IPv4",address:this.localAddress}},r.prototype.signal=function(e){var t=this;if(t.destroyed)throw new Error("cannot signal after peer is destroyed");if("string"==typeof e)try{e=JSON.parse(e)}catch(t){e={}}t._debug("signal()"),e.candidate&&(t._pc.remoteDescription?t._addIceCandidate(e.candidate):t._pendingCandidates.push(e.candidate)),e.sdp&&t._pc.setRemoteDescription(new t._wrtc.RTCSessionDescription(e),(function(){t.destroyed||(t._pendingCandidates.forEach((function(e){t._addIceCandidate(e)})),t._pendingCandidates=[],"offer"===t._pc.remoteDescription.type&&t._createAnswer())}),(function(e){t._destroy(e)})),e.sdp||e.candidate||t._destroy(new Error("signal() called with invalid signal data"))},r.prototype._addIceCandidate=function(e){var t=this;try{t._pc.addIceCandidate(new t._wrtc.RTCIceCandidate(e),i,(function(e){t._destroy(e)}))}catch(e){t._destroy(new Error("error adding candidate: "+e.message))}},r.prototype.send=function(e){this._isWrtc&&n.isBuffer(e)&&(e=new Uint8Array(e)),this._channel.send(e)},r.prototype.destroy=function(e){this._destroy(null,e)},r.prototype._destroy=function(e,t){var n=this;if(!n.destroyed){if(t&&n.once("close",t),n._debug("destroy (error: %s)",e&&(e.message||e)),n.readable=n.writable=!1,n._readableState.ended||n.push(null),n._writableState.finished||n.end(),n.destroyed=!0,n.connected=!1,n._pcReady=!1,n._channelReady=!1,n._previousStreams=null,clearInterval(n._interval),clearTimeout(n._reconnectTimeout),n._interval=null,n._reconnectTimeout=null,n._chunk=null,n._cb=null,n._onFinishBound&&n.removeListener("finish",n._onFinishBound),n._onFinishBound=null,n._pc){try{n._pc.close()}catch(e){}n._pc.oniceconnectionstatechange=null,n._pc.onicegatheringstatechange=null,n._pc.onsignalingstatechange=null,n._pc.onicecandidate=null,"addTrack"in n._pc?n._pc.ontrack=null:n._pc.onaddstream=null,n._pc.onnegotiationneeded=null,n._pc.ondatachannel=null}if(n._channel){try{n._channel.close()}catch(e){}n._channel.onmessage=null,n._channel.onopen=null,n._channel.onclose=null,n._channel.onerror=null}n._pc=null,n._channel=null,e&&n.emit("error",e),n.emit("close")}},r.prototype._setupData=function(e){var t=this;if(!e.channel)return t._destroy(new Error("Data channel event is missing `channel` property"));t._channel=e.channel,t._channel.binaryType="arraybuffer","number"==typeof t._channel.bufferedAmountLowThreshold&&(t._channel.bufferedAmountLowThreshold=65536),t.channelName=t._channel.label,t._channel.onmessage=function(e){t._onChannelMessage(e)},t._channel.onbufferedamountlow=function(){t._onChannelBufferedAmountLow()},t._channel.onopen=function(){t._onChannelOpen()},t._channel.onclose=function(){t._onChannelClose()},t._channel.onerror=function(e){t._destroy(e)}},r.prototype._read=function(){},r.prototype._write=function(e,t,n){var r=this;if(r.destroyed)return n(new Error("cannot write after peer is destroyed"));if(r.connected){try{r.send(e)}catch(e){return r._destroy(e)}r._channel.bufferedAmount>65536?(r._debug("start backpressure: bufferedAmount %d",r._channel.bufferedAmount),r._cb=n):n(null)}else r._debug("write before connect"),r._chunk=e,r._cb=n},r.prototype._onFinish=function(){function e(){setTimeout((function(){t._destroy()}),1e3)}var t=this;t.destroyed||(t.connected?e():t.once("connect",e))},r.prototype._createOffer=function(){var e=this;e.destroyed||e._pc.createOffer((function(t){function n(){var n=e._pc.localDescription||t;e._debug("signal"),e.emit("signal",{type:n.type,sdp:n.sdp})}e.destroyed||(t.sdp=e.sdpTransform(t.sdp),e._pc.setLocalDescription(t,(function(){e.destroyed||(e.trickle||e._iceComplete?n():e.once("_iceComplete",n))}),(function(t){e._destroy(t)})))}),(function(t){e._destroy(t)}),e.offerConstraints)},r.prototype._createAnswer=function(){var e=this;e.destroyed||e._pc.createAnswer((function(t){function n(){var n=e._pc.localDescription||t;e._debug("signal"),e.emit("signal",{type:n.type,sdp:n.sdp})}e.destroyed||(t.sdp=e.sdpTransform(t.sdp),e._pc.setLocalDescription(t,(function(){e.destroyed||(e.trickle||e._iceComplete?n():e.once("_iceComplete",n))}),(function(t){e._destroy(t)})))}),(function(t){e._destroy(t)}),e.answerConstraints)},r.prototype._onIceStateChange=function(){var e=this;if(!e.destroyed){var t=e._pc.iceConnectionState,n=e._pc.iceGatheringState;e._debug("iceStateChange (connection: %s) (gathering: %s)",t,n),e.emit("iceStateChange",t,n),"connected"!==t&&"completed"!==t||(clearTimeout(e._reconnectTimeout),e._pcReady=!0,e._maybeReady()),"disconnected"===t&&(e.reconnectTimer?(clearTimeout(e._reconnectTimeout),e._reconnectTimeout=setTimeout((function(){e._destroy()}),e.reconnectTimer)):e._destroy()),"failed"===t&&e._destroy(new Error("Ice connection failed.")),"closed"===t&&e._destroy()}},r.prototype.getStats=function(e){var t=this;0===t._pc.getStats.length?t._pc.getStats().then((function(t){var n=[];t.forEach((function(e){n.push(e)})),e(null,n)}),(function(t){e(t)})):t._isReactNativeWebrtc?t._pc.getStats(null,(function(t){var n=[];t.forEach((function(e){n.push(e)})),e(null,n)}),(function(t){e(t)})):t._pc.getStats.length>0?t._pc.getStats((function(t){var n=[];t.result().forEach((function(e){var t={};e.names().forEach((function(n){t[n]=e.stat(n)})),t.id=e.id,t.type=e.type,t.timestamp=e.timestamp,n.push(t)})),e(null,n)}),(function(t){e(t)})):e(null,[])},r.prototype._maybeReady=function(){var e=this;e._debug("maybeReady pc %s channel %s",e._pcReady,e._channelReady),!e.connected&&!e._connecting&&e._pcReady&&e._channelReady&&(e._connecting=!0,e.getStats((function(t,n){function r(t){var n=o[t.localCandidateId];n&&n.ip?(e.localAddress=n.ip,e.localPort=Number(n.port)):n&&n.ipAddress?(e.localAddress=n.ipAddress,e.localPort=Number(n.portNumber)):"string"==typeof t.googLocalAddress&&(n=t.googLocalAddress.split(":"),e.localAddress=n[0],e.localPort=Number(n[1]));var r=i[t.remoteCandidateId];r&&r.ip?(e.remoteAddress=r.ip,e.remotePort=Number(r.port)):r&&r.ipAddress?(e.remoteAddress=r.ipAddress,e.remotePort=Number(r.portNumber)):"string"==typeof t.googRemoteAddress&&(r=t.googRemoteAddress.split(":"),e.remoteAddress=r[0],e.remotePort=Number(r[1])),e.remoteFamily="IPv4",e._debug("connect local: %s:%s remote: %s:%s",e.localAddress,e.localPort,e.remoteAddress,e.remotePort)}if(!e.destroyed){t&&(n=[]),e._connecting=!1,e.connected=!0;var i={},o={},s={};if(n.forEach((function(e){"remotecandidate"!==e.type&&"remote-candidate"!==e.type||(i[e.id]=e),"localcandidate"!==e.type&&"local-candidate"!==e.type||(o[e.id]=e),"candidatepair"!==e.type&&"candidate-pair"!==e.type||(s[e.id]=e)})),n.forEach((function(e){"transport"===e.type&&r(s[e.selectedCandidatePairId]),("googCandidatePair"===e.type&&"true"===e.googActiveConnection||("candidatepair"===e.type||"candidate-pair"===e.type)&&e.selected)&&r(e)})),e._chunk){try{e.send(e._chunk)}catch(t){return e._destroy(t)}e._chunk=null,e._debug('sent chunk from "write before connect"');var a=e._cb;e._cb=null,a(null)}"number"!=typeof e._channel.bufferedAmountLowThreshold&&(e._interval=setInterval((function(){e._onInterval()}),150),e._interval.unref&&e._interval.unref()),e._debug("connect"),e.emit("connect")}})))},r.prototype._onInterval=function(){!this._cb||!this._channel||this._channel.bufferedAmount>65536||this._onChannelBufferedAmountLow()},r.prototype._onSignalingStateChange=function(){var e=this;e.destroyed||(e._debug("signalingStateChange %s",e._pc.signalingState),e.emit("signalingStateChange",e._pc.signalingState))},r.prototype._onIceCandidate=function(e){var t=this;t.destroyed||(e.candidate&&t.trickle?t.emit("signal",{candidate:{candidate:e.candidate.candidate,sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid}}):e.candidate||(t._iceComplete=!0,t.emit("_iceComplete")))},r.prototype._onChannelMessage=function(e){if(!this.destroyed){var t=e.data;t instanceof ArrayBuffer&&(t=n.from(t)),this.push(t)}},r.prototype._onChannelBufferedAmountLow=function(){var e=this;if(!e.destroyed&&e._cb){e._debug("ending backpressure: bufferedAmount %d",e._channel.bufferedAmount);var t=e._cb;e._cb=null,t(null)}},r.prototype._onChannelOpen=function(){var e=this;e.connected||e.destroyed||(e._debug("on channel open"),e._channelReady=!0,e._maybeReady())},r.prototype._onChannelClose=function(){var e=this;e.destroyed||(e._debug("on channel close"),e._destroy())},r.prototype._onAddStream=function(e){var t=this;t.destroyed||(t._debug("on add stream"),t.emit("stream",e.stream))},r.prototype._onTrack=function(e){var t=this;if(!t.destroyed){t._debug("on track");var n=e.streams[0].id;-1===t._previousStreams.indexOf(n)&&(t._previousStreams.push(n),t.emit("stream",e.streams[0]))}},r.prototype._debug=function(){var e=this,t=[].slice.call(arguments);t[0]="["+e._id+"] "+t[0],o.apply(null,t)},r.prototype._transformConstraints=function(e){if(0===Object.keys(e).length)return e;if((e.mandatory||e.optional)&&!this._isChromium){var t=Object.assign({},e.optional,e.mandatory);return void 0!==t.OfferToReceiveVideo&&(t.offerToReceiveVideo=t.OfferToReceiveVideo,delete t.OfferToReceiveVideo),void 0!==t.OfferToReceiveAudio&&(t.offerToReceiveAudio=t.OfferToReceiveAudio,delete t.OfferToReceiveAudio),t}return e.mandatory||e.optional||!this._isChromium?e:(void 0!==e.offerToReceiveVideo&&(e.OfferToReceiveVideo=e.offerToReceiveVideo,delete e.offerToReceiveVideo),void 0!==e.offerToReceiveAudio&&(e.OfferToReceiveAudio=e.offerToReceiveAudio,delete e.offerToReceiveAudio),{mandatory:e})}}).call(this,e("buffer").Buffer)},{buffer:24,debug:30,"get-browser-rtc":37,inherits:41,randombytes:73,"readable-stream":82}],92:[function(e,t,n){function r(e){return i.digest(e)}var i=new(e("rusha")),o="undefined"!=typeof window?window:self,s=o.crypto||o.msCrypto||{},a=s.subtle||s.webkitSubtle;try{a.digest({name:"sha-1"},new Uint8Array).catch((function(){a=!1}))}catch(e){a=!1}t.exports=function(e,t){a?("string"==typeof e&&(e=function(e){for(var t=e.length,n=new Uint8Array(t),r=0;r<t;r++)n[r]=e.charCodeAt(r);return n}(e)),a.digest({name:"sha-1"},e).then((function(e){t(function(e){for(var t=e.length,n=[],r=0;r<t;r++){var i=e[r];n.push((i>>>4).toString(16)),n.push((15&i).toString(16))}return n.join("")}(new Uint8Array(e)))}),(function(n){t(r(e))}))):setTimeout(t,0,r(e))},t.exports.sync=r},{rusha:87}],93:[function(e,t,n){(function(n){function r(e){var t=this;if(!(t instanceof r))return new r(e);if(e||(e={}),"string"==typeof e&&(e={url:e}),null==e.url&&null==e.socket)throw new Error("Missing required `url` or `socket` option");if(null!=e.url&&null!=e.socket)throw new Error("Must specify either `url` or `socket` option, not both");if(t._id=a(4).toString("hex").slice(0,7),t._debug("new websocket: %o",e),e=Object.assign({allowHalfOpen:!1},e),c.Duplex.call(t,e),t.connected=!1,t.destroyed=!1,t._chunk=null,t._cb=null,t._interval=null,e.socket)t.url=e.socket.url,t._ws=e.socket;else{t.url=e.url;try{t._ws="function"==typeof u?new f(e.url,e):new f(e.url)}catch(e){return void n.nextTick((function(){t._destroy(e)}))}}t._ws.binaryType="arraybuffer",t._ws.onopen=function(){t._onOpen()},t._ws.onmessage=function(e){t._onMessage(e)},t._ws.onclose=function(){t._onClose()},t._ws.onerror=function(){t._destroy(new Error("connection error to "+t.url))},t._onFinishBound=function(){t._onFinish()},t.once("finish",t._onFinishBound)}t.exports=r;var i=e("safe-buffer").Buffer,o=e("debug")("simple-websocket"),s=e("inherits"),a=e("randombytes"),c=e("readable-stream"),u=e("ws"),f="function"!=typeof u?WebSocket:u;s(r,c.Duplex),r.WEBSOCKET_SUPPORT=!!f,r.prototype.send=function(e){this._ws.send(e)},r.prototype.destroy=function(e){this._destroy(null,e)},r.prototype._destroy=function(e,t){var n=this;if(!n.destroyed){if(t&&n.once("close",t),n._debug("destroy (error: %s)",e&&(e.message||e)),n.readable=n.writable=!1,n._readableState.ended||n.push(null),n._writableState.finished||n.end(),n.connected=!1,n.destroyed=!0,clearInterval(n._interval),n._interval=null,n._chunk=null,n._cb=null,n._onFinishBound&&n.removeListener("finish",n._onFinishBound),n._onFinishBound=null,n._ws){var r=n._ws,i=function(){r.onclose=null};if(r.readyState===f.CLOSED)i();else try{r.onclose=i,r.close()}catch(e){i()}r.onopen=null,r.onmessage=null,r.onerror=null}n._ws=null,e&&n.emit("error",e),n.emit("close")}},r.prototype._read=function(){},r.prototype._write=function(e,t,n){if(this.destroyed)return n(new Error("cannot write after socket is destroyed"));if(this.connected){try{this.send(e)}catch(e){return this._destroy(e)}"function"!=typeof u&&this._ws.bufferedAmount>65536?(this._debug("start backpressure: bufferedAmount %d",this._ws.bufferedAmount),this._cb=n):n(null)}else this._debug("write before connect"),this._chunk=e,this._cb=n},r.prototype._onFinish=function(){function e(){setTimeout((function(){t._destroy()}),1e3)}var t=this;t.destroyed||(t.connected?e():t.once("connect",e))},r.prototype._onMessage=function(e){if(!this.destroyed){var t=e.data;t instanceof ArrayBuffer&&(t=i.from(t)),this.push(t)}},r.prototype._onOpen=function(){var e=this;if(!e.connected&&!e.destroyed){if(e.connected=!0,e._chunk){try{e.send(e._chunk)}catch(t){return e._destroy(t)}e._chunk=null,e._debug('sent chunk from "write before connect"');var t=e._cb;e._cb=null,t(null)}"function"!=typeof u&&(e._interval=setInterval((function(){e._onInterval()}),150),e._interval.unref&&e._interval.unref()),e._debug("connect"),e.emit("connect")}},r.prototype._onInterval=function(){if(this._cb&&this._ws&&!(this._ws.bufferedAmount>65536)){this._debug("ending backpressure: bufferedAmount %d",this._ws.bufferedAmount);var e=this._cb;this._cb=null,e(null)}},r.prototype._onClose=function(){this.destroyed||(this._debug("on close"),this._destroy())},r.prototype._debug=function(){var e=[].slice.call(arguments);e[0]="["+this._id+"] "+e[0],o.apply(null,e)}}).call(this,e("_process"))},{_process:66,debug:30,inherits:41,randombytes:73,"readable-stream":82,"safe-buffer":88,ws:21}],94:[function(e,t,n){var r=1,i=setInterval((function(){r=r+1&65535}),250);i.unref&&i.unref(),t.exports=function(e){var t=4*(e||5),n=[0],i=1,o=r-1&65535;return function(e){var s=r-o&65535;for(s>t&&(s=t),o=r;s--;)i===t&&(i=0),n[i]=n[0===i?t-1:i-1],i++;e&&(n[i-1]+=e);var a=n[i-1],c=n.length<t?0:n[i===t?0:i];return n.length<4?a:4*(a-c)/n.length}}},{}],95:[function(e,t,r){(function(t){var n=e("./lib/request"),i=e("xtend"),o=e("builtin-status-codes"),s=e("url"),a=r;a.request=function(e,r){e="string"==typeof e?s.parse(e):i(e);var o=-1===t.location.protocol.search(/^https?:$/)?"http:":"",a=e.protocol||o,c=e.hostname||e.host,u=e.port,f=e.path||"/";c&&-1!==c.indexOf(":")&&(c="["+c+"]"),e.url=(c?a+"//"+c:"")+(u?":"+u:"")+f,e.method=(e.method||"GET").toUpperCase(),e.headers=e.headers||{};var h=new n(e);return r&&h.on("response",r),h},a.get=function(e,t){var n=a.request(e,t);return n.end(),n},a.Agent=function(){},a.Agent.defaultMaxSockets=4,a.STATUS_CODES=o,a.METHODS=["CHECKOUT","CONNECT","COPY","DELETE","GET","HEAD","LOCK","M-SEARCH","MERGE","MKACTIVITY","MKCOL","MOVE","NOTIFY","OPTIONS","PATCH","POST","PROPFIND","PROPPATCH","PURGE","PUT","REPORT","SEARCH","SUBSCRIBE","TRACE","UNLOCK","UNSUBSCRIBE"]}).call(this,void 0!==n?n:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./lib/request":97,"builtin-status-codes":25,url:112,xtend:119}],96:[function(e,t,r){(function(e){function t(){if(void 0!==o)return o;if(e.XMLHttpRequest){o=new e.XMLHttpRequest;try{o.open("GET",e.XDomainRequest?"/":"https://example.com")}catch(e){o=null}}else o=null;return o}function n(e){var n=t();if(!n)return!1;try{return n.responseType=e,n.responseType===e}catch(e){}return!1}function i(e){return"function"==typeof e}r.fetch=i(e.fetch)&&i(e.ReadableStream),r.blobConstructor=!1;try{new Blob([new ArrayBuffer(1)]),r.blobConstructor=!0}catch(e){}var o,s=void 0!==e.ArrayBuffer,a=s&&i(e.ArrayBuffer.prototype.slice);r.arraybuffer=r.fetch||s&&n("arraybuffer"),r.msstream=!r.fetch&&a&&n("ms-stream"),r.mozchunkedarraybuffer=!r.fetch&&s&&n("moz-chunked-arraybuffer"),r.overrideMimeType=r.fetch||!!t()&&i(t().overrideMimeType),r.vbArray=i(e.VBArray),o=null}).call(this,void 0!==n?n:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],97:[function(e,t,r){(function(n,r,i){var o=e("./capability"),s=e("inherits"),a=e("./response"),c=e("readable-stream"),u=e("to-arraybuffer"),f=a.IncomingMessage,h=a.readyStates,l=t.exports=function(e){var t=this;c.Writable.call(t),t._opts=e,t._body=[],t._headers={},e.auth&&t.setHeader("Authorization","Basic "+new i(e.auth).toString("base64")),Object.keys(e.headers).forEach((function(n){t.setHeader(n,e.headers[n])}));var n,r=!0;if("disable-fetch"===e.mode||"timeout"in e)r=!1,n=!0;else if("prefer-streaming"===e.mode)n=!1;else if("allow-wrong-content-type"===e.mode)n=!o.overrideMimeType;else{if(e.mode&&"default"!==e.mode&&"prefer-fast"!==e.mode)throw new Error("Invalid value for opts.mode");n=!0}t._mode=function(e,t){return o.fetch&&t?"fetch":o.mozchunkedarraybuffer?"moz-chunked-arraybuffer":o.msstream?"ms-stream":o.arraybuffer&&e?"arraybuffer":o.vbArray&&e?"text:vbarray":"text"}(n,r),t.on("finish",(function(){t._onFinish()}))};s(l,c.Writable),l.prototype.setHeader=function(e,t){var n=e.toLowerCase();-1===d.indexOf(n)&&(this._headers[n]={name:e,value:t})},l.prototype.getHeader=function(e){return this._headers[e.toLowerCase()].value},l.prototype.removeHeader=function(e){delete this._headers[e.toLowerCase()]},l.prototype._onFinish=function(){var e=this;if(!e._destroyed){var t=e._opts,s=e._headers,a=null;"GET"!==t.method&&"HEAD"!==t.method&&(a=o.blobConstructor?new r.Blob(e._body.map((function(e){return u(e)})),{type:(s["content-type"]||{}).value||""}):i.concat(e._body).toString());var c=[];if(Object.keys(s).forEach((function(e){var t=s[e].name,n=s[e].value;Array.isArray(n)?n.forEach((function(e){c.push([t,e])})):c.push([t,n])})),"fetch"===e._mode)r.fetch(e._opts.url,{method:e._opts.method,headers:c,body:a||void 0,mode:"cors",credentials:t.withCredentials?"include":"same-origin"}).then((function(t){e._fetchResponse=t,e._connect()}),(function(t){e.emit("error",t)}));else{var f=e._xhr=new r.XMLHttpRequest;try{f.open(e._opts.method,e._opts.url,!0)}catch(t){return void n.nextTick((function(){e.emit("error",t)}))}"responseType"in f&&(f.responseType=e._mode.split(":")[0]),"withCredentials"in f&&(f.withCredentials=!!t.withCredentials),"text"===e._mode&&"overrideMimeType"in f&&f.overrideMimeType("text/plain; charset=x-user-defined"),"timeout"in t&&(f.timeout=t.timeout,f.ontimeout=function(){e.emit("timeout")}),c.forEach((function(e){f.setRequestHeader(e[0],e[1])})),e._response=null,f.onreadystatechange=function(){switch(f.readyState){case h.LOADING:case h.DONE:e._onXHRProgress()}},"moz-chunked-arraybuffer"===e._mode&&(f.onprogress=function(){e._onXHRProgress()}),f.onerror=function(){e._destroyed||e.emit("error",new Error("XHR error"))};try{f.send(a)}catch(t){return void n.nextTick((function(){e.emit("error",t)}))}}}},l.prototype._onXHRProgress=function(){var e=this;(function(e){try{var t=e.status;return null!==t&&0!==t}catch(e){return!1}})(e._xhr)&&!e._destroyed&&(e._response||e._connect(),e._response._onXHRProgress())},l.prototype._connect=function(){var e=this;e._destroyed||(e._response=new f(e._xhr,e._fetchResponse,e._mode),e._response.on("error",(function(t){e.emit("error",t)})),e.emit("response",e._response))},l.prototype._write=function(e,t,n){this._body.push(e),n()},l.prototype.abort=l.prototype.destroy=function(){var e=this;e._destroyed=!0,e._response&&(e._response._destroyed=!0),e._xhr&&e._xhr.abort()},l.prototype.end=function(e,t,n){"function"==typeof e&&(n=e,e=void 0),c.Writable.prototype.end.call(this,e,t,n)},l.prototype.flushHeaders=function(){},l.prototype.setTimeout=function(){},l.prototype.setNoDelay=function(){},l.prototype.setSocketKeepAlive=function(){};var d=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","date","dnt","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","user-agent","via"]}).call(this,e("_process"),void 0!==n?n:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer)},{"./capability":96,"./response":98,_process:66,buffer:24,inherits:41,"readable-stream":82,"to-arraybuffer":105}],98:[function(e,t,r){(function(t,n,i){var o=e("./capability"),s=e("inherits"),a=e("readable-stream"),c=r.readyStates={UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4},u=r.IncomingMessage=function(e,n,r){var s=this;if(a.Readable.call(s),s._mode=r,s.headers={},s.rawHeaders=[],s.trailers={},s.rawTrailers=[],s.on("end",(function(){t.nextTick((function(){s.emit("close")}))})),"fetch"===r){s._fetchResponse=n,s.url=n.url,s.statusCode=n.status,s.statusMessage=n.statusText,n.headers.forEach((function(e,t){s.headers[t.toLowerCase()]=e,s.rawHeaders.push(t,e)}));var c=n.body.getReader();!function e(){c.read().then((function(t){if(!s._destroyed){if(t.done)return void s.push(null);s.push(new i(t.value)),e()}})).catch((function(e){s.emit("error",e)}))}()}else if(s._xhr=e,s._pos=0,s.url=e.responseURL,s.statusCode=e.status,s.statusMessage=e.statusText,e.getAllResponseHeaders().split(/\r?\n/).forEach((function(e){var t=e.match(/^([^:]+):\s*(.*)/);if(t){var n=t[1].toLowerCase();"set-cookie"===n?(void 0===s.headers[n]&&(s.headers[n]=[]),s.headers[n].push(t[2])):void 0!==s.headers[n]?s.headers[n]+=", "+t[2]:s.headers[n]=t[2],s.rawHeaders.push(t[1],t[2])}})),s._charset="x-user-defined",!o.overrideMimeType){var u=s.rawHeaders["mime-type"];if(u){var f=u.match(/;\s*charset=([^;])(;|$)/);f&&(s._charset=f[1].toLowerCase())}s._charset||(s._charset="utf-8")}};s(u,a.Readable),u.prototype._read=function(){},u.prototype._onXHRProgress=function(){var e=this,t=e._xhr,r=null;switch(e._mode){case"text:vbarray":if(t.readyState!==c.DONE)break;try{r=new n.VBArray(t.responseBody).toArray()}catch(e){}if(null!==r){e.push(new i(r));break}case"text":try{r=t.responseText}catch(t){e._mode="text:vbarray";break}if(r.length>e._pos){var o=r.substr(e._pos);if("x-user-defined"===e._charset){for(var s=new i(o.length),a=0;a<o.length;a++)s[a]=255&o.charCodeAt(a);e.push(s)}else e.push(o,e._charset);e._pos=r.length}break;case"arraybuffer":if(t.readyState!==c.DONE||!t.response)break;r=t.response,e.push(new i(new Uint8Array(r)));break;case"moz-chunked-arraybuffer":if(r=t.response,t.readyState!==c.LOADING||!r)break;e.push(new i(new Uint8Array(r)));break;case"ms-stream":if(r=t.response,t.readyState!==c.LOADING)break;var u=new n.MSStreamReader;u.onprogress=function(){u.result.byteLength>e._pos&&(e.push(new i(new Uint8Array(u.result.slice(e._pos)))),e._pos=u.result.byteLength)},u.onload=function(){e.push(null)},u.readAsArrayBuffer(r)}e._xhr.readyState===c.DONE&&"ms-stream"!==e._mode&&e.push(null)}}).call(this,e("_process"),void 0!==n?n:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e("buffer").Buffer)},{"./capability":96,_process:66,buffer:24,inherits:41,"readable-stream":82}],99:[function(e,t,n){var r=e("stream-to-blob");t.exports=function e(t,n,i){if("function"==typeof n)return e(t,null,n);r(t,n,(function(e,t){if(e)return i(e);var n=URL.createObjectURL(t);i(null,n)}))}},{"stream-to-blob":100}],100:[function(e,t,n){var r=e("once");t.exports=function e(t,n,i){if("function"==typeof n)return e(t,null,n);i=r(i);var o=[];t.on("data",(function(e){o.push(e)})).on("end",(function(){var e=n?new Blob(o,{type:n}):new Blob(o);i(null,e)})).on("error",i)}},{once:60}],101:[function(e,t,n){(function(n){var r=e("once");t.exports=function(e,t,i){i=r(i);var o=new n(t),s=0;e.on("data",(function(e){e.copy(o,s),s+=e.length})).on("end",(function(){i(null,o)})).on("error",i)}}).call(this,e("buffer").Buffer)},{buffer:24,once:60}],102:[function(e,t,n){function r(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(l.isEncoding===p||!p(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=s,this.end=a,t=4;break;case"utf8":this.fillLast=o,t=4;break;case"base64":this.text=c,this.end=u,t=3;break;default:return this.write=f,void(this.end=h)}this.lastNeed=0,this.lastTotal=0,this.lastChar=d.allocUnsafe(t)}function i(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:-1}function o(e){var t=this.lastTotal-this.lastNeed,n=function(e,t,n){if(128!=(192&t[0]))return e.lastNeed=0,"".repeat(n);if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"".repeat(n+1);if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,"".repeat(n+2)}}(this,e,t);return void 0!==n?n:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function s(e,t){if((e.length-t)%2==0){var n=e.toString("utf16le",t);if(n){var r=n.charCodeAt(n.length-1);if(r>=55296&&r<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],n.slice(0,-1)}return n}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function a(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var n=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,n)}return t}function c(e,t){var n=(e.length-t)%3;return 0===n?e.toString("base64",t):(this.lastNeed=3-n,this.lastTotal=3,1===n?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-n))}function u(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function f(e){return e.toString(this.encoding)}function h(e){return e&&e.length?this.write(e):""}var l=e("buffer").Buffer,d=e("buffer-shims"),p=l.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};n.StringDecoder=r,r.prototype.write=function(e){if(0===e.length)return"";var t,n;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";n=this.lastNeed,this.lastNeed=0}else n=0;return n<e.length?t?t+this.text(e,n):this.text(e,n):t||""},r.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"".repeat(this.lastTotal-this.lastNeed):t},r.prototype.text=function(e,t){var n=function(e,t,n){var r=t.length-1;if(r<n)return 0;var o=i(t[r]);return o>=0?(o>0&&(e.lastNeed=o-1),o):--r<n?0:(o=i(t[r]))>=0?(o>0&&(e.lastNeed=o-2),o):--r<n?0:(o=i(t[r]))>=0?(o>0&&(2===o?o=0:e.lastNeed=o-3),o):0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=n;var r=e.length-(n-this.lastNeed);return e.copy(this.lastChar,0,r),e.toString("utf8",t,r)},r.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},{buffer:24,"buffer-shims":23}],103:[function(e,t,n){var r=e("./thirty-two");n.encode=r.encode,n.decode=r.decode},{"./thirty-two":104}],104:[function(e,t,n){(function(e){var t=[255,255,26,27,28,29,30,31,255,255,255,255,255,255,255,255,255,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,255,255,255,255,255,255,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,255,255,255,255,255];n.encode=function(t){e.isBuffer(t)||(t=new e(t));for(var n=0,r=0,i=0,o=0,s=new e(8*function(e){var t=Math.floor(e.length/5);return e.length%5==0?t:t+1}(t));n<t.length;){var a=t[n];i>3?(o=(o=a&255>>i)<<(i=(i+5)%8)|(n+1<t.length?t[n+1]:0)>>8-i,n++):(o=a>>8-(i+5)&31,0==(i=(i+5)%8)&&n++),s[r]="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567".charCodeAt(o),r++}for(n=r;n<s.length;n++)s[n]=61;return s},n.decode=function(n){var r,i=0,o=0,s=0;e.isBuffer(n)||(n=new e(n));for(var a=new e(Math.ceil(5*n.length/8)),c=0;c<n.length&&61!==n[c];c++){var u=n[c]-48;if(!(u<t.length))throw new Error("Invalid input - it is not base32 encoded string");o=t[u],i<=3?0===(i=(i+5)%8)?(r|=o,a[s]=r,s++,r=0):r|=255&o<<8-i:(r|=255&o>>>(i=(i+5)%8),a[s]=r,s++,r=255&o<<8-i)}return a.slice(0,s)}}).call(this,e("buffer").Buffer)},{buffer:24}],105:[function(e,t,n){var r=e("buffer").Buffer;t.exports=function(e){if(e instanceof Uint8Array){if(0===e.byteOffset&&e.byteLength===e.buffer.byteLength)return e.buffer;if("function"==typeof e.buffer.slice)return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}if(r.isBuffer(e)){for(var t=new Uint8Array(e.length),n=e.length,i=0;i<n;i++)t[i]=e[i];return t.buffer}throw new Error("Argument must be a Buffer")}},{buffer:24}],106:[function(e,t,n){(function(n){function r(e){function t(e,t){var n=new o(t);return n.on("warning",i._onWarning),n.on("error",i._onError),n.listen(e),i._internalDHT=!0,n}var i=this;if(!(i instanceof r))return new r(e);if(s.call(i),!e.peerId)throw new Error("Option `peerId` is required");if(!e.infoHash)throw new Error("Option `infoHash` is required");if(!n.browser&&!e.port)throw new Error("Option `port` is required");i.peerId="string"==typeof e.peerId?e.peerId:e.peerId.toString("hex"),i.infoHash="string"==typeof e.infoHash?e.infoHash:e.infoHash.toString("hex"),i._port=e.port,i._userAgent=e.userAgent,i.destroyed=!1,i._announce=e.announce||[],i._intervalMs=e.intervalMs||9e5,i._trackerOpts=null,i._dhtAnnouncing=!1,i._dhtTimeout=!1,i._internalDHT=!1,i._onWarning=function(e){i.emit("warning",e)},i._onError=function(e){i.emit("error",e)},i._onDHTPeer=function(e,t){t.toString("hex")===i.infoHash&&i.emit("peer",e.host+":"+e.port,"dht")},i._onTrackerPeer=function(e){i.emit("peer",e,"tracker")},i._onTrackerAnnounce=function(){i.emit("trackerAnnounce")},!1===e.tracker?i.tracker=null:e.tracker&&"object"==c(e.tracker)?(i._trackerOpts=a(e.tracker),i.tracker=i._createTracker()):i.tracker=i._createTracker(),!1===e.dht||"function"!=typeof o?i.dht=null:e.dht&&"function"==typeof e.dht.addNode?i.dht=e.dht:e.dht&&"object"==c(e.dht)?i.dht=t(e.dhtPort,e.dht):i.dht=t(e.dhtPort),i.dht&&(i.dht.on("peer",i._onDHTPeer),i._dhtAnnounce())}t.exports=r;var i=e("debug")("torrent-discovery"),o=e("bittorrent-dht/client"),s=e("events").EventEmitter,a=e("xtend"),u=e("inherits"),f=e("run-parallel"),h=e("bittorrent-tracker/client");u(r,s),r.prototype.updatePort=function(e){var t=this;e!==t._port&&(t._port=e,t.dht&&t._dhtAnnounce(),t.tracker&&(t.tracker.stop(),t.tracker.destroy((function(){t.tracker=t._createTracker()}))))},r.prototype.complete=function(e){this.tracker&&this.tracker.complete(e)},r.prototype.destroy=function(e){var t=this;if(!t.destroyed){t.destroyed=!0,clearTimeout(t._dhtTimeout);var n=[];t.tracker&&(t.tracker.stop(),t.tracker.removeListener("warning",t._onWarning),t.tracker.removeListener("error",t._onError),t.tracker.removeListener("peer",t._onTrackerPeer),t.tracker.removeListener("update",t._onTrackerAnnounce),n.push((function(e){t.tracker.destroy(e)}))),t.dht&&t.dht.removeListener("peer",t._onDHTPeer),t._internalDHT&&(t.dht.removeListener("warning",t._onWarning),t.dht.removeListener("error",t._onError),n.push((function(e){t.dht.destroy(e)}))),f(n,e),t.dht=null,t.tracker=null,t._announce=null}},r.prototype._createTracker=function(){var e=a(this._trackerOpts,{infoHash:this.infoHash,announce:this._announce,peerId:this.peerId,port:this._port,userAgent:this._userAgent}),t=new h(e);return t.on("warning",this._onWarning),t.on("error",this._onError),t.on("peer",this._onTrackerPeer),t.on("update",this._onTrackerAnnounce),t.setInterval(this._intervalMs),t.start(),t},r.prototype._dhtAnnounce=function(){var e=this;e._dhtAnnouncing||(i("dht announce"),e._dhtAnnouncing=!0,clearTimeout(e._dhtTimeout),e.dht.announce(e.infoHash,e._port,(function(t){e._dhtAnnouncing=!1,i("dht announce complete"),t&&e.emit("warning",t),e.emit("dhtAnnounce"),e.destroyed||(e._dhtTimeout=setTimeout((function(){e._dhtAnnounce()}),e._intervalMs+Math.floor(Math.random()*e._intervalMs/5)),e._dhtTimeout.unref&&e._dhtTimeout.unref())})))}}).call(this,e("_process"))},{_process:66,"bittorrent-dht/client":21,"bittorrent-tracker/client":15,debug:30,events:34,inherits:41,"run-parallel":86,xtend:119}],107:[function(e,t,n){(function(e){function n(e){if(!(this instanceof n))return new n(e);this.length=e,this.missing=e,this.sources=null,this._chunks=Math.ceil(e/r),this._remainder=e%r||r,this._buffered=0,this._buffer=null,this._cancellations=null,this._reservations=0,this._flushed=!1}t.exports=n;var r=16384;n.BLOCK_LENGTH=r,n.prototype.chunkLength=function(e){return e===this._chunks-1?this._remainder:r},n.prototype.chunkLengthRemaining=function(e){return this.length-e*r},n.prototype.chunkOffset=function(e){return e*r},n.prototype.reserve=function(){return this.init()?this._cancellations.length?this._cancellations.pop():this._reservations<this._chunks?this._reservations++:-1:-1},n.prototype.reserveRemaining=function(){if(!this.init())return-1;if(this._reservations<this._chunks){var e=this._reservations;return this._reservations=this._chunks,e}return-1},n.prototype.cancel=function(e){this.init()&&this._cancellations.push(e)},n.prototype.cancelRemaining=function(e){this.init()&&(this._reservations=e)},n.prototype.get=function(e){return this.init()?this._buffer[e]:null},n.prototype.set=function(e,t,n){if(!this.init())return!1;for(var i=t.length,o=Math.ceil(i/r),s=0;s<o;s++)if(!this._buffer[e+s]){var a=s*r,c=t.slice(a,a+r);this._buffered++,this._buffer[e+s]=c,this.missing-=c.length,-1===this.sources.indexOf(n)&&this.sources.push(n)}return this._buffered===this._chunks},n.prototype.flush=function(){if(!this._buffer||this._chunks!==this._buffered)return null;var t=e.concat(this._buffer,this.length);return this._buffer=null,this._cancellations=null,this.sources=null,this._flushed=!0,t},n.prototype.init=function(){return!(this._flushed||!this._buffer&&(this._buffer=new Array(this._chunks),this._cancellations=[],this.sources=[],0))}}).call(this,e("buffer").Buffer)},{buffer:24}],108:[function(e,t,n){(function(n){var r=e("is-typedarray").strict;t.exports=function(e){if(r(e)){var t=new n(e.buffer);return e.byteLength!==e.buffer.byteLength&&(t=t.slice(e.byteOffset,e.byteOffset+e.byteLength)),t}return new n(e)}}).call(this,e("buffer").Buffer)},{buffer:24,"is-typedarray":45}],109:[function(e,t,n){(function(e){n.encodingLength=function(){return 8},n.encode=function(t,n,r){n||(n=new e(8)),r||(r=0);var i=Math.floor(t/4294967295),o=t-4294967295*i;return n.writeUInt32BE(i,r),n.writeUInt32BE(o,r+4),n},n.decode=function(t,n){return n||(n=0),t||(t=new e(4)),n||(n=0),4294967295*t.readUInt32BE(n)+t.readUInt32BE(n+4)},n.encode.bytes=8,n.decode.bytes=8}).call(this,e("buffer").Buffer)},{buffer:24}],110:[function(e,t,n){t.exports=function(e,t,n){return 0===e.length?e:t?(n||e.sort(t),function(e,t){for(var n=1,r=e.length,i=e[0],o=e[0],s=1;s<r;++s)if(o=i,t(i=e[s],o)){if(s===n){n++;continue}e[n++]=i}return e.length=n,e}(e,t)):(n||e.sort(),function(e){for(var t=1,n=e.length,r=e[0],i=e[0],o=1;o<n;++o,i=r)if(i=r,(r=e[o])!==i){if(o===t){t++;continue}e[t++]=r}return e.length=t,e}(e))}},{}],111:[function(e,t,n){t.exports=function(e,t){if(!(t>=e.length||t<0)){var n=e.pop();if(t<e.length){var r=e[t];return e[t]=n,r}return n}}},{}],112:[function(e,t,n){function r(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}function i(e,t,n){if(e&&s.isObject(e)&&e instanceof r)return e;var i=new r;return i.parse(e,t,n),i}var o=e("punycode"),s=e("./util");n.parse=i,n.resolve=function(e,t){return i(e,!1,!0).resolve(t)},n.resolveObject=function(e,t){return e?i(e,!1,!0).resolveObject(t):t},n.format=function(e){return s.isString(e)&&(e=i(e)),e instanceof r?e.format():r.prototype.format.call(e)},n.Url=r;var a=/^([a-z0-9.+-]+:)/i,u=/:[0-9]*$/,f=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,h=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),l=["'"].concat(h),d=["%","/","?",";","#"].concat(l),p=["/","?","#"],g={javascript:!0,"javascript:":!0},m={javascript:!0,"javascript:":!0},y={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},v=e("querystring");r.prototype.parse=function(e,t,n){if(!s.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+c(e));var r=e.indexOf("?"),i=-1!==r&&r<e.indexOf("#")?"?":"#",u=e.split(i);u[0]=u[0].replace(/\\/g,"/");var h=e=u.join(i);if(h=h.trim(),!n&&1===e.split("#").length){var b=f.exec(h);if(b)return this.path=h,this.href=h,this.pathname=b[1],b[2]?(this.search=b[2],this.query=t?v.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var _=a.exec(h);if(_){var w=(_=_[0]).toLowerCase();this.protocol=w,h=h.substr(_.length)}if(n||_||h.match(/^\/\/[^@\/]+@[^@\/]+/)){var k="//"===h.substr(0,2);!k||_&&m[_]||(h=h.substr(2),this.slashes=!0)}if(!m[_]&&(k||_&&!y[_])){for(var E=-1,x=0;x<p.length;x++){-1!==(C=h.indexOf(p[x]))&&(-1===E||C<E)&&(E=C)}var S,A;-1!==(A=-1===E?h.lastIndexOf("@"):h.lastIndexOf("@",E))&&(S=h.slice(0,A),h=h.slice(A+1),this.auth=decodeURIComponent(S)),E=-1;for(x=0;x<d.length;x++){var C;-1!==(C=h.indexOf(d[x]))&&(-1===E||C<E)&&(E=C)}-1===E&&(E=h.length),this.host=h.slice(0,E),h=h.slice(E),this.parseHost(),this.hostname=this.hostname||"";var T="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!T)for(var B=this.hostname.split(/\./),I=(x=0,B.length);x<I;x++){var R=B[x];if(R&&!R.match(/^[+a-z0-9A-Z_-]{0,63}$/)){for(var L="",O=0,P=R.length;O<P;O++)R.charCodeAt(O)>127?L+="x":L+=R[O];if(!L.match(/^[+a-z0-9A-Z_-]{0,63}$/)){var U=B.slice(0,x),M=B.slice(x+1),j=R.match(/^([+a-z0-9A-Z_-]{0,63})(.*)$/);j&&(U.push(j[1]),M.unshift(j[2])),M.length&&(h="/"+M.join(".")+h),this.hostname=U.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),T||(this.hostname=o.toASCII(this.hostname));var N=this.port?":"+this.port:"",D=this.hostname||"";this.host=D+N,this.href+=this.host,T&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==h[0]&&(h="/"+h))}if(!g[w])for(x=0,I=l.length;x<I;x++){var q=l[x];if(-1!==h.indexOf(q)){var H=encodeURIComponent(q);H===q&&(H=escape(q)),h=h.split(q).join(H)}}var F=h.indexOf("#");-1!==F&&(this.hash=h.substr(F),h=h.slice(0,F));var z=h.indexOf("?");if(-1!==z?(this.search=h.substr(z),this.query=h.substr(z+1),t&&(this.query=v.parse(this.query)),h=h.slice(0,z)):t&&(this.search="",this.query={}),h&&(this.pathname=h),y[w]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){N=this.pathname||"";var W=this.search||"";this.path=N+W}return this.href=this.format(),this},r.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",n=this.pathname||"",r=this.hash||"",i=!1,o="";this.host?i=e+this.host:this.hostname&&(i=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(i+=":"+this.port)),this.query&&s.isObject(this.query)&&Object.keys(this.query).length&&(o=v.stringify(this.query));var a=this.search||o&&"?"+o||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||y[t])&&!1!==i?(i="//"+(i||""),n&&"/"!==n.charAt(0)&&(n="/"+n)):i||(i=""),r&&"#"!==r.charAt(0)&&(r="#"+r),a&&"?"!==a.charAt(0)&&(a="?"+a),t+i+(n=n.replace(/[?#]/g,(function(e){return encodeURIComponent(e)})))+(a=a.replace("#","%23"))+r},r.prototype.resolve=function(e){return this.resolveObject(i(e,!1,!0)).format()},r.prototype.resolveObject=function(e){if(s.isString(e)){var t=new r;t.parse(e,!1,!0),e=t}for(var n=new r,i=Object.keys(this),o=0;o<i.length;o++){var a=i[o];n[a]=this[a]}if(n.hash=e.hash,""===e.href)return n.href=n.format(),n;if(e.slashes&&!e.protocol){for(var c=Object.keys(e),u=0;u<c.length;u++){var f=c[u];"protocol"!==f&&(n[f]=e[f])}return y[n.protocol]&&n.hostname&&!n.pathname&&(n.path=n.pathname="/"),n.href=n.format(),n}if(e.protocol&&e.protocol!==n.protocol){if(!y[e.protocol]){for(var h=Object.keys(e),l=0;l<h.length;l++){var d=h[l];n[d]=e[d]}return n.href=n.format(),n}if(n.protocol=e.protocol,e.host||m[e.protocol])n.pathname=e.pathname;else{for(var p=(e.pathname||"").split("/");p.length&&!(e.host=p.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==p[0]&&p.unshift(""),p.length<2&&p.unshift(""),n.pathname=p.join("/")}if(n.search=e.search,n.query=e.query,n.host=e.host||"",n.auth=e.auth,n.hostname=e.hostname||e.host,n.port=e.port,n.pathname||n.search){var g=n.pathname||"",v=n.search||"";n.path=g+v}return n.slashes=n.slashes||e.slashes,n.href=n.format(),n}var b=n.pathname&&"/"===n.pathname.charAt(0),_=e.host||e.pathname&&"/"===e.pathname.charAt(0),w=_||b||n.host&&e.pathname,k=w,E=n.pathname&&n.pathname.split("/")||[],x=(p=e.pathname&&e.pathname.split("/")||[],n.protocol&&!y[n.protocol]);if(x&&(n.hostname="",n.port=null,n.host&&(""===E[0]?E[0]=n.host:E.unshift(n.host)),n.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===p[0]?p[0]=e.host:p.unshift(e.host)),e.host=null),w=w&&(""===p[0]||""===E[0])),_)n.host=e.host||""===e.host?e.host:n.host,n.hostname=e.hostname||""===e.hostname?e.hostname:n.hostname,n.search=e.search,n.query=e.query,E=p;else if(p.length)E||(E=[]),E.pop(),E=E.concat(p),n.search=e.search,n.query=e.query;else if(!s.isNullOrUndefined(e.search)){if(x)n.hostname=n.host=E.shift(),(B=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=B.shift(),n.host=n.hostname=B.shift());return n.search=e.search,n.query=e.query,s.isNull(n.pathname)&&s.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.href=n.format(),n}if(!E.length)return n.pathname=null,n.search?n.path="/"+n.search:n.path=null,n.href=n.format(),n;for(var S=E.slice(-1)[0],A=(n.host||e.host||E.length>1)&&("."===S||".."===S)||""===S,C=0,T=E.length;T>=0;T--)"."===(S=E[T])?E.splice(T,1):".."===S?(E.splice(T,1),C++):C&&(E.splice(T,1),C--);if(!w&&!k)for(;C--;C)E.unshift("..");!w||""===E[0]||E[0]&&"/"===E[0].charAt(0)||E.unshift(""),A&&"/"!==E.join("/").substr(-1)&&E.push("");var B,I=""===E[0]||E[0]&&"/"===E[0].charAt(0);x&&(n.hostname=n.host=I?"":E.length?E.shift():"",(B=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=B.shift(),n.host=n.hostname=B.shift()));return(w=w||n.host&&E.length)&&!I&&E.unshift(""),E.length?n.pathname=E.join("/"):(n.pathname=null,n.path=null),s.isNull(n.pathname)&&s.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.auth=e.auth||n.auth,n.slashes=n.slashes||e.slashes,n.href=n.format(),n},r.prototype.parseHost=function(){var e=this.host,t=u.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},{"./util":113,punycode:68,querystring:71}],113:[function(e,t,n){t.exports={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==c(e)&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},{}],114:[function(e,t,n){var r=e("bencode"),i=e("bitfield"),o=e("safe-buffer").Buffer,s=e("debug")("ut_metadata"),a=e("events").EventEmitter,c=e("inherits"),u=e("simple-sha1"),f=1e3;t.exports=function(e){function t(t){a.call(this),this._wire=t,this._metadataComplete=!1,this._metadataSize=null,this._remainingRejects=null,this._fetching=!1,this._bitfield=new i(0,{grow:f}),o.isBuffer(e)&&this.setMetadata(e)}return c(t,a),t.prototype.name="ut_metadata",t.prototype.onHandshake=function(e,t,n){this._infoHash=e},t.prototype.onExtendedHandshake=function(e){return e.m&&e.m.ut_metadata?e.metadata_size?"number"!=typeof e.metadata_size||1e7<e.metadata_size||e.metadata_size<=0?this.emit("warning",new Error("Peer gave invalid metadata size")):(this._metadataSize=e.metadata_size,this._numPieces=Math.ceil(this._metadataSize/16384),this._remainingRejects=2*this._numPieces,void(this._fetching&&this._requestPieces())):this.emit("warning",new Error("Peer does not have metadata")):this.emit("warning",new Error("Peer does not support ut_metadata"))},t.prototype.onMessage=function(e){var t,n;try{var i=e.toString(),o=i.indexOf("ee")+2;t=r.decode(i.substring(0,o)),n=e.slice(o)}catch(e){return}switch(t.msg_type){case 0:this._onRequest(t.piece);break;case 1:this._onData(t.piece,n,t.total_size);break;case 2:this._onReject(t.piece)}},t.prototype.fetch=function(){this._metadataComplete||(this._fetching=!0,this._metadataSize&&this._requestPieces())},t.prototype.cancel=function(){this._fetching=!1},t.prototype.setMetadata=function(e){if(this._metadataComplete)return!0;s("set metadata");try{var t=r.decode(e).info;t&&(e=r.encode(t))}catch(e){}return!(this._infoHash&&this._infoHash!==u.sync(e)||(this.cancel(),this.metadata=e,this._metadataComplete=!0,this._metadataSize=this.metadata.length,this._wire.extendedHandshake.metadata_size=this._metadataSize,this.emit("metadata",r.encode({info:r.decode(this.metadata)})),0))},t.prototype._send=function(e,t){var n=r.encode(e);o.isBuffer(t)&&(n=o.concat([n,t])),this._wire.extended("ut_metadata",n)},t.prototype._request=function(e){this._send({msg_type:0,piece:e})},t.prototype._data=function(e,t,n){var r={msg_type:1,piece:e};"number"==typeof n&&(r.total_size=n),this._send(r,t)},t.prototype._reject=function(e){this._send({msg_type:2,piece:e})},t.prototype._onRequest=function(e){if(this._metadataComplete){var t=16384*e,n=t+16384;n>this._metadataSize&&(n=this._metadataSize);var r=this.metadata.slice(t,n);this._data(e,r,this._metadataSize)}else this._reject(e)},t.prototype._onData=function(e,t,n){t.length>16384||(t.copy(this.metadata,16384*e),this._bitfield.set(e),this._checkDone())},t.prototype._onReject=function(e){this._remainingRejects>0&&this._fetching?(this._request(e),this._remainingRejects-=1):this.emit("warning",new Error('Peer sent "reject" too much'))},t.prototype._requestPieces=function(){this.metadata=o.alloc(this._metadataSize);for(var e=0;e<this._numPieces;e++)this._request(e)},t.prototype._checkDone=function(){for(var e=!0,t=0;t<this._numPieces;t++)if(!this._bitfield.get(t)){e=!1;break}e&&(this.setMetadata(this.metadata)||this._failedMetadata())},t.prototype._failedMetadata=function(){this._bitfield=new i(0,{grow:f}),this._remainingRejects-=this._numPieces,this._remainingRejects>0?this._requestPieces():this.emit("warning",new Error("Peer sent invalid metadata"))},t}},{bencode:11,bitfield:13,debug:30,events:34,inherits:41,"safe-buffer":88,"simple-sha1":92}],115:[function(e,t,r){(function(e){function n(t){try{if(!e.localStorage)return!1}catch(e){return!1}var n=e.localStorage[t];return null!=n&&"true"===String(n).toLowerCase()}t.exports=function(e,t){if(n("noDeprecation"))return e;var r=!1;return function(){if(!r){if(n("throwDeprecation"))throw new Error(t);n("traceDeprecation")?console.trace(t):console.warn(t),r=!0}return e.apply(this,arguments)}}}).call(this,void 0!==n?n:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],116:[function(e,t,n){(function(n){function r(e){var t=this;s.call(t),t._tracks=[],t._fragmentSequence=1,t._file=e,t._decoder=null,t._findMoov(0)}function i(e,t){var n=this;n._entries=e,n._countName=t||"count",n._index=0,n._offset=0,n.value=n._entries[0]}var o=e("binary-search"),s=e("events").EventEmitter,a=e("inherits"),c=e("mp4-stream"),u=e("mp4-box-encoding"),f=e("range-slice-stream");t.exports=r,a(r,s),r.prototype._findMoov=function(e){var t=this;t._decoder&&t._decoder.destroy(),t._decoder=c.decode();var n=t._file.createReadStream({start:e});n.pipe(t._decoder),t._decoder.once("box",(function(r){"moov"===r.type?t._decoder.decode((function(e){n.destroy();try{t._processMoov(e)}catch(e){e.message="Cannot parse mp4 file: "+e.message,t.emit("error",e)}})):(n.destroy(),t._findMoov(e+r.length))}))},i.prototype.inc=function(){var e=this;e._offset++,e._offset>=e._entries[e._index][e._countName]&&(e._index++,e._offset=0),e.value=e._entries[e._index]},r.prototype._processMoov=function(e){var t=this,r=e.traks;t._tracks=[],t._hasVideo=!1,t._hasAudio=!1;for(var o=0;o<r.length;o++){var s,a,c=r[o],f=c.mdia.minf.stbl,h=f.stsd.entries[0],l=c.mdia.hdlr.handlerType;if("vide"===l&&"avc1"===h.type){if(t._hasVideo)continue;t._hasVideo=!0,s="avc1",h.avcC&&(s+="."+h.avcC.mimeCodec),a='video/mp4; codecs="'+s+'"'}else{if("soun"!==l||"mp4a"!==h.type)continue;if(t._hasAudio)continue;t._hasAudio=!0,s="mp4a",h.esds&&h.esds.mimeCodec&&(s+="."+h.esds.mimeCodec),a='audio/mp4; codecs="'+s+'"'}var d=[],p=0,g=0,m=0,y=0,v=0,b=0,_=new i(f.stts.entries),w=null;f.ctts&&(w=new i(f.ctts.entries));for(var k=0;;){var E=f.stsc.entries[v],x=f.stsz.entries[p],S=_.value.duration,A=w?w.value.compositionOffset:0,C=!0;if(f.stss&&(C=f.stss.entries[k]===p+1),d.push({size:x,duration:S,dts:b,presentationOffset:A,sync:C,offset:y+f.stco.entries[m]}),++p>=f.stsz.entries.length)break;if(y+=x,++g>=E.samplesPerChunk){g=0,y=0,m++;var T=f.stsc.entries[v+1];T&&m+1>=T.firstChunk&&v++}b+=S,_.inc(),w&&w.inc(),C&&k++}c.mdia.mdhd.duration=0,c.tkhd.duration=0;var B=E.sampleDescriptionId,I={type:"moov",mvhd:e.mvhd,traks:[{tkhd:c.tkhd,mdia:{mdhd:c.mdia.mdhd,hdlr:c.mdia.hdlr,elng:c.mdia.elng,minf:{vmhd:c.mdia.minf.vmhd,smhd:c.mdia.minf.smhd,dinf:c.mdia.minf.dinf,stbl:{stsd:f.stsd,stts:{version:0,flags:0,entries:[]},ctts:{version:0,flags:0,entries:[]},stsc:{version:0,flags:0,entries:[]},stsz:{version:0,flags:0,entries:[]},stco:{version:0,flags:0,entries:[]},stss:{version:0,flags:0,entries:[]}}}}}],mvex:{mehd:{fragmentDuration:e.mvhd.duration},trexs:[{trackId:c.tkhd.trackId,defaultSampleDescriptionIndex:B,defaultSampleDuration:0,defaultSampleSize:0,defaultSampleFlags:0}]}};t._tracks.push({trackId:c.tkhd.trackId,timeScale:c.mdia.mdhd.timeScale,samples:d,currSample:null,currTime:null,moov:I,mime:a})}if(0!==t._tracks.length){e.mvhd.duration=0,t._ftyp={type:"ftyp",brand:"iso5",brandVersion:0,compatibleBrands:["iso5"]};var R=u.encode(t._ftyp),L=t._tracks.map((function(e){var t=u.encode(e.moov);return{mime:e.mime,init:n.concat([R,t])}}));t.emit("ready",L)}else t.emit("error",new Error("no playable tracks"))},r.prototype.seek=function(e){var t=this;if(!t._tracks)throw new Error("Not ready yet; wait for 'ready' event");t._fileStream&&(t._fileStream.destroy(),t._fileStream=null);var n=-1;if(t._tracks.map((function(r,i){r.outStream&&r.outStream.destroy(),r.inStream&&(r.inStream.destroy(),r.inStream=null);var o=r.outStream=c.encode(),s=t._generateFragment(i,e);if(!s)return o.finalize();(-1===n||s.ranges[0].start<n)&&(n=s.ranges[0].start),function e(n){o.destroyed||o.box(n.moof,(function(s){if(s)return t.emit("error",s);o.destroyed||r.inStream.slice(n.ranges).pipe(o.mediaData(n.length,(function(n){if(n)return t.emit("error",n);if(!o.destroyed){var r=t._generateFragment(i);if(!r)return o.finalize();e(r)}})))}))}(s)})),n>=0){var r=t._fileStream=t._file.createReadStream({start:n});t._tracks.forEach((function(e){e.inStream=new f(n,{highWaterMark:1e7}),r.pipe(e.inStream)}))}return t._tracks.map((function(e){return e.outStream}))},r.prototype._findSampleBefore=function(e,t){var n=this._tracks[e],r=Math.floor(n.timeScale*t),i=o(n.samples,r,(function(e,t){return e.dts+e.presentationOffset-t}));for(-1===i?i=0:i<0&&(i=-i-2);!n.samples[i].sync;)i--;return i},r.prototype._generateFragment=function(e,t){var n,r=this,i=r._tracks[e];if((n=void 0!==t?r._findSampleBefore(e,t):i.currSample)>=i.samples.length)return null;for(var o=i.samples[n].dts,s=0,a=[],c=n;c<i.samples.length;c++){var u=i.samples[c];if(u.sync&&u.dts-o>=1*i.timeScale)break;s+=u.size;var f=a.length-1;f<0||a[f].end!==u.offset?a.push({start:u.offset,end:u.offset+u.size}):a[f].end+=u.size}return i.currSample=c,{moof:r._generateMoof(e,n,c),ranges:a,length:s}},r.prototype._generateMoof=function(e,t,n){for(var r=this._tracks[e],i=[],o=t;o<n;o++){var s=r.samples[o];i.push({sampleDuration:s.duration,sampleSize:s.size,sampleFlags:s.sync?33554432:16842752,sampleCompositionTimeOffset:s.presentationOffset})}var a={type:"moof",mfhd:{sequenceNumber:this._fragmentSequence++},trafs:[{tfhd:{flags:131072,trackId:r.trackId},tfdt:{baseMediaDecodeTime:r.samples[t].dts},trun:{flags:3841,dataOffset:8,entries:i}}]};return a.trafs[0].trun.dataOffset+=u.encodingLength(a),a}}).call(this,e("buffer").Buffer)},{"binary-search":12,buffer:24,events:34,inherits:41,"mp4-box-encoding":53,"mp4-stream":56,"range-slice-stream":74}],117:[function(e,t,n){function r(e,t,n){var o=this;if(!(this instanceof r))return new r(e,t,n);n=n||{},o.detailedError=null,o._elem=t,o._elemWrapper=new i(t),o._waitingFired=!1,o._trackMeta=null,o._file=e,o._tracks=null,"none"!==o._elem.preload&&o._createMuxer(),o._onError=function(e){o.detailedError=o._elemWrapper.detailedError,o.destroy()},o._onWaiting=function(){o._waitingFired=!0,o._muxer?o._tracks&&o._pump():o._createMuxer()},o._elem.addEventListener("waiting",o._onWaiting),o._elem.addEventListener("error",o._onError)}var i=e("mediasource"),o=e("pump"),s=e("./mp4-remuxer");t.exports=r,r.prototype._createMuxer=function(){var e=this;e._muxer=new s(e._file),e._muxer.on("ready",(function(t){e._tracks=t.map((function(t){var n=e._elemWrapper.createWriteStream(t.mime);n.on("error",(function(t){e._elemWrapper.error(t)}));var r={muxed:null,mediaSource:n,initFlushed:!1,onInitFlushed:null};return n.write(t.init,(function(e){r.initFlushed=!0,r.onInitFlushed&&r.onInitFlushed(e)})),r})),(e._waitingFired||"auto"===e._elem.preload)&&e._pump()})),e._muxer.on("error",(function(t){e._elemWrapper.error(t)}))},r.prototype._pump=function(){var e=this,t=e._muxer.seek(e._elem.currentTime,!e._tracks);e._tracks.forEach((function(n,r){var i=function(){n.muxed&&(n.muxed.destroy(),n.mediaSource=e._elemWrapper.createWriteStream(n.mediaSource),n.mediaSource.on("error",(function(t){e._elemWrapper.error(t)}))),n.muxed=t[r],o(n.muxed,n.mediaSource)};n.initFlushed?i():n.onInitFlushed=function(t){t?e._elemWrapper.error(t):i()}}))},r.prototype.destroy=function(){var e=this;e.destroyed||(e.destroyed=!0,e._elem.removeEventListener("waiting",e._onWaiting),e._elem.removeEventListener("error",e._onError),e._tracks&&e._tracks.forEach((function(e){e.muxed.destroy()})),e._elem.src="")}},{"./mp4-remuxer":116,mediasource:49,pump:67}],118:[function(e,t,n){t.exports=function e(t,n){function r(){for(var e=new Array(arguments.length),n=0;n<e.length;n++)e[n]=arguments[n];var r=t.apply(this,e),i=e[e.length-1];return"function"==typeof r&&r!==i&&Object.keys(i).forEach((function(e){r[e]=i[e]})),r}if(t&&n)return e(t)(n);if("function"!=typeof t)throw new TypeError("need wrapper function");return Object.keys(t).forEach((function(e){r[e]=t[e]})),r}},{}],119:[function(e,t,n){t.exports=function(){for(var e={},t=0;t<arguments.length;t++){var n=arguments[t];for(var i in n)r.call(n,i)&&(e[i]=n[i])}return e};var r=Object.prototype.hasOwnProperty},{}],120:[function(e,t,n){t.exports=function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)r.call(n,i)&&(e[i]=n[i])}return e};var r=Object.prototype.hasOwnProperty},{}],121:[function(e,t,n){t.exports=function e(t,n,r){return void 0===n?function(n,r){return e(t,n,r)}:(void 0===r&&(r="0"),(t-=n.toString().length)>0?new Array(t+(/\./.test(n)?2:1)).join(r)+n:n+"")}},{}],122:[function(e,t,n){t.exports={version:"0.98.18"}},{}],123:[function(e,t,r){(function(n,r){function i(e){function t(){s.destroyed||(s.ready=!0,s.emit("ready"))}var s=this;if(!(s instanceof i))return new i(e);h.call(s),e||(e={}),"string"==typeof e.peerId?s.peerId=e.peerId:o.isBuffer(e.peerId)?s.peerId=e.peerId.toString("hex"):s.peerId=o.from(A+b(9).toString("base64")).toString("hex"),s.peerIdBuffer=o.from(s.peerId,"hex"),"string"==typeof e.nodeId?s.nodeId=e.nodeId:o.isBuffer(e.nodeId)?s.nodeId=e.nodeId.toString("hex"):s.nodeId=b(20).toString("hex"),s.nodeIdBuffer=o.from(s.nodeId,"hex"),s._debugId=s.peerId.toString("hex").substring(0,7),s.destroyed=!1,s.listening=!1,s.torrentPort=e.torrentPort||0,s.dhtPort=e.dhtPort||0,s.tracker=void 0!==e.tracker?e.tracker:{},s.torrents=[],s.maxConns=Number(e.maxConns)||55,s._debug("new webtorrent (peerId %s, nodeId %s, port %s)",s.peerId,s.nodeId,s.torrentPort),s.tracker&&("object"!=c(s.tracker)&&(s.tracker={}),e.rtcConfig&&(console.warn("WebTorrent: opts.rtcConfig is deprecated. Use opts.tracker.rtcConfig instead"),s.tracker.rtcConfig=e.rtcConfig),e.wrtc&&(console.warn("WebTorrent: opts.wrtc is deprecated. Use opts.tracker.wrtc instead"),s.tracker.wrtc=e.wrtc),r.WRTC&&!s.tracker.wrtc&&(s.tracker.wrtc=r.WRTC)),"function"==typeof k?s._tcpPool=new k(s):n.nextTick((function(){s._onListening()})),s._downloadSpeed=_(),s._uploadSpeed=_(),!1!==e.dht&&"function"==typeof f?(s.dht=new f(l({nodeId:s.nodeId},e.dht)),s.dht.once("error",(function(e){s._destroy(e)})),s.dht.once("listening",(function(){var e=s.dht.address();e&&(s.dhtPort=e.port)})),s.dht.setMaxListeners(0),s.dht.listen(s.dhtPort)):s.dht=!1,s.enableWebSeeds=!1!==e.webSeeds,"function"==typeof p&&null!=e.blocklist?p(e.blocklist,{headers:{"user-agent":"WebTorrent/"+x+" (https://webtorrent.io)"}},(function(e,n){if(e)return s.error("Failed to load blocklist: "+e.message);s.blocked=n,t()})):n.nextTick(t)}t.exports=i;var o=e("safe-buffer").Buffer,s=e("simple-concat"),a=e("create-torrent"),u=e("debug")("webtorrent"),f=e("bittorrent-dht/client"),h=e("events").EventEmitter,l=e("xtend"),d=e("inherits"),p=e("load-ip-set"),g=e("run-parallel"),m=e("parse-torrent"),y=e("path"),v=e("simple-peer"),b=e("randombytes"),_=e("speedometer"),w=e("zero-fill"),k=e("./lib/tcp-pool"),E=e("./lib/torrent"),x=e("./package.json").version,S=x.match(/([0-9]+)/g).slice(0,2).map((function(e){return w(2,e)})).join(""),A="-WW"+S+"-";d(i,h),i.WEBRTC_SUPPORT=v.WEBRTC_SUPPORT,Object.defineProperty(i.prototype,"downloadSpeed",{get:function(){return this._downloadSpeed()}}),Object.defineProperty(i.prototype,"uploadSpeed",{get:function(){return this._uploadSpeed()}}),Object.defineProperty(i.prototype,"progress",{get:function(){var e=this.torrents.filter((function(e){return 1!==e.progress}));return e.reduce((function(e,t){return e+t.downloaded}),0)/(e.reduce((function(e,t){return e+(t.length||0)}),0)||1)}}),Object.defineProperty(i.prototype,"ratio",{get:function(){return this.torrents.reduce((function(e,t){return e+t.uploaded}),0)/(this.torrents.reduce((function(e,t){return e+t.received}),0)||1)}}),i.prototype.get=function(e){var t,n,r=this,i=r.torrents.length;if(e instanceof E){for(t=0;t<i;t++)if((n=r.torrents[t])===e)return n}else{var o;try{o=m(e)}catch(e){}if(!o)return null;if(!o.infoHash)throw new Error("Invalid torrent identifier");for(t=0;t<i;t++)if((n=r.torrents[t]).infoHash===o.infoHash)return n}return null},i.prototype.download=function(e,t,n){return console.warn("WebTorrent: client.download() is deprecated. Use client.add() instead"),this.add(e,t,n)},i.prototype.add=function(e,t,n){function r(){if(!o.destroyed)for(var e=0,t=o.torrents.length;e<t;e++){var n=o.torrents[e];if(n.infoHash===s.infoHash&&n!==s)return void s._destroy(new Error("Cannot add duplicate torrent "+s.infoHash))}}function i(){o.destroyed||("function"==typeof n&&n(s),o.emit("torrent",s))}var o=this;if(o.destroyed)throw new Error("client is destroyed");if("function"==typeof t)return o.add(e,null,t);o._debug("add"),t=t?l(t):{};var s=new E(e,o,t);return o.torrents.push(s),s.once("_infoHash",r),s.once("ready",i),s.once("close",(function e(){s.removeListener("_infoHash",r),s.removeListener("ready",i),s.removeListener("close",e)})),s},i.prototype.seed=function(e,t,n){var r=this;if(r.destroyed)throw new Error("client is destroyed");if("function"==typeof t)return r.seed(e,null,t);r._debug("seed"),t=t?l(t):{},"string"==typeof e&&(t.path=y.dirname(e)),t.createdBy||(t.createdBy="WebTorrent/"+S);var i,o=r.add(null,t,(function(e){var t=[function(t){e.load(i,t)}];r.dht&&t.push((function(t){e.once("dhtAnnounce",t)})),g(t,(function(t){if(!r.destroyed)return t?e._destroy(t):void function(e){r._debug("on seed"),"function"==typeof n&&n(e),e.emit("seed"),r.emit("seed",e)}(e)}))}));return function(e){return"undefined"!=typeof FileList&&e instanceof FileList}(e)&&(e=Array.prototype.slice.call(e)),Array.isArray(e)||(e=[e]),g(e.map((function(e){return function(t){!function(e){return"object"==c(e)&&null!=e&&"function"==typeof e.pipe}(e)?t(null,e):s(e,t)}})),(function(e,n){if(!r.destroyed)return e?o._destroy(e):void a.parseInput(n,t,(function(e,s){if(!r.destroyed){if(e)return o._destroy(e);i=s.map((function(e){return e.getStream})),a(n,t,(function(e,t){if(!r.destroyed){if(e)return o._destroy(e);var n=r.get(t);n?o._destroy(new Error("Cannot add duplicate torrent "+n.infoHash)):o._onTorrentId(t)}}))}}))})),o},i.prototype.remove=function(e,t){if(this._debug("remove"),!this.get(e))throw new Error("No torrent with id "+e);this._remove(e,t)},i.prototype._remove=function(e,t){var n=this.get(e);n&&(this.torrents.splice(this.torrents.indexOf(n),1),n.destroy(t))},i.prototype.address=function(){return this.listening?this._tcpPool?this._tcpPool.server.address():{address:"0.0.0.0",family:"IPv4",port:0}:null},i.prototype.destroy=function(e){if(this.destroyed)throw new Error("client already destroyed");this._destroy(null,e)},i.prototype._destroy=function(e,t){var n=this;n._debug("client destroy"),n.destroyed=!0;var r=n.torrents.map((function(e){return function(t){e.destroy(t)}}));n._tcpPool&&r.push((function(e){n._tcpPool.destroy(e)})),n.dht&&r.push((function(e){n.dht.destroy(e)})),g(r,t),e&&n.emit("error",e),n.torrents=[],n._tcpPool=null,n.dht=null},i.prototype._onListening=function(){if(this._debug("listening"),this.listening=!0,this._tcpPool){var e=this._tcpPool.server.address();e&&(this.torrentPort=e.port)}this.emit("listening")},i.prototype._debug=function(){var e=[].slice.call(arguments);e[0]="["+this._debugId+"] "+e[0],u.apply(null,e)}}).call(this,e("_process"),void 0!==n?n:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./lib/tcp-pool":21,"./lib/torrent":5,"./package.json":122,_process:66,"bittorrent-dht/client":21,"create-torrent":29,debug:30,events:34,inherits:41,"load-ip-set":21,"parse-torrent":62,path:63,randombytes:73,"run-parallel":86,"safe-buffer":88,"simple-concat":89,"simple-peer":91,speedometer:94,xtend:119,"zero-fill":121}]},{},[123])(123)}))}).call(this,n(0),n(20).setImmediate)},function(e,t,n){(function(e,t){!function(e,n){"use strict";if(!e.setImmediate){var r,i,o,s,a,c=1,u={},f=!1,h=e.document,l=Object.getPrototypeOf&&Object.getPrototypeOf(e);l=l&&l.setTimeout?l:e,"[object process]"==={}.toString.call(e.process)?r=function(e){t.nextTick((function(){p(e)}))}:!function(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?e.MessageChannel?((o=new MessageChannel).port1.onmessage=function(e){p(e.data)},r=function(e){o.port2.postMessage(e)}):h&&"onreadystatechange"in h.createElement("script")?(i=h.documentElement,r=function(e){var t=h.createElement("script");t.onreadystatechange=function(){p(e),t.onreadystatechange=null,i.removeChild(t),t=null},i.appendChild(t)}):r=function(e){setTimeout(p,0,e)}:(s="setImmediate$"+Math.random()+"$",a=function(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(s)&&p(+t.data.slice(s.length))},e.addEventListener?e.addEventListener("message",a,!1):e.attachEvent("onmessage",a),r=function(t){e.postMessage(s+t,"*")}),l.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var i={callback:e,args:t};return u[c]=i,r(c),c++},l.clearImmediate=d}function d(e){delete u[e]}function p(e){if(f)setTimeout(p,0,e);else{var t=u[e];if(t){f=!0;try{!function(e){var t=e.callback,r=e.args;switch(r.length){case 0:t();break;case 1:t(r[0]);break;case 2:t(r[0],r[1]);break;case 3:t(r[0],r[1],r[2]);break;default:t.apply(n,r)}}(t)}finally{d(e),f=!1}}}}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,n(0),n(1))},function(e,t,n){var r=n(44),i=n(11),o=n(25),s=n(6)("socket.io-client");e.exports=t=c;var a=t.managers={};function c(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};var n,i=r(e),c=i.source,u=i.id,f=i.path,h=a[u]&&f in a[u].nsps;return t.forceNew||t["force new connection"]||!1===t.multiplex||h?(s("ignoring socket cache for %s",c),n=o(c,t)):(a[u]||(s("new io instance for %s",c),a[u]=o(c,t)),n=a[u]),i.query&&!t.query?t.query=i.query:t&&"object"==typeof t.query&&(t.query=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")}(t.query)),n.socket(i.path,t)}t.protocol=i.protocol,t.connect=c,t.Manager=n(25),t.Socket=n(31)},function(e,t,n){(function(t){var r=n(21),i=n(6)("socket.io-client:url");e.exports=function(e,n){var o=e;n=n||t.location,null==e&&(e=n.protocol+"//"+n.host);"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?n.protocol+e:n.host+e),/^(https?|wss?):\/\//.test(e)||(i("protocol-less url %s",e),e=void 0!==n?n.protocol+"//"+e:"https://"+e),i("parse %s",e),o=r(e));o.port||(/^(http|ws)$/.test(o.protocol)?o.port="80":/^(http|ws)s$/.test(o.protocol)&&(o.port="443"));o.path=o.path||"/";var s=-1!==o.host.indexOf(":")?"["+o.host+"]":o.host;return o.id=o.protocol+"://"+s+":"+o.port,o.href=o.protocol+"://"+s+(n&&n.port===o.port?"":":"+o.port),o}}).call(this,n(0))},function(e,t,n){(t=e.exports=o.debug=o).coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable("")},t.enable=function(e){t.save(e);for(var n=(e||"").split(/[\s,]+/),r=n.length,i=0;i<r;i++)n[i]&&("-"===(e=n[i].replace(/[\\^$+?.()|[\]{}]/g,"\\$&").replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){var n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=n(46),t.names=[],t.skips=[],t.formatters={};var r,i=0;function o(e){function n(){}function o(){var e=o,n=+new Date,s=n-(r||n);e.diff=s,e.prev=r,e.curr=n,r=n,null==e.useColors&&(e.useColors=t.useColors()),null==e.color&&e.useColors&&(e.color=t.colors[i++%t.colors.length]);for(var a=new Array(arguments.length),c=0;c<a.length;c++)a[c]=arguments[c];a[0]=t.coerce(a[0]),"string"!=typeof a[0]&&(a=["%o"].concat(a));var u=0;a[0]=a[0].replace(/%([a-z%])/g,(function(n,r){if("%%"===n)return n;u++;var i=t.formatters[r];if("function"==typeof i){var o=a[u];n=i.call(e,o),a.splice(u,1),u--}return n})),a=t.formatArgs.apply(e,a),(o.log||t.log||console.log.bind(console)).apply(e,a)}n.enabled=!1,o.enabled=!0;var s=t.enabled(e)?o:n;return s.namespace=e,s}},function(e,t){var n=1e3,r=60*n,i=60*r,o=24*i,s=365.25*o;function a(e,t,n){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}e.exports=function(e,t){t=t||{};var c,u=typeof e;if("string"===u&&e.length>0)return function(e){if((e=String(e)).length>1e4)return;var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!t)return;var a=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return a*s;case"days":case"day":case"d":return a*o;case"hours":case"hour":case"hrs":case"hr":case"h":return a*i;case"minutes":case"minute":case"mins":case"min":case"m":return a*r;case"seconds":case"second":case"secs":case"sec":case"s":return a*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return a;default:return}}(e);if("number"===u&&!1===isNaN(e))return t.long?a(c=e,o,"day")||a(c,i,"hour")||a(c,r,"minute")||a(c,n,"second")||c+" ms":function(e){if(e>=o)return Math.round(e/o)+"d";if(e>=i)return Math.round(e/i)+"h";if(e>=r)return Math.round(e/r)+"m";if(e>=n)return Math.round(e/n)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,t,n){function r(){var e;try{e=t.storage.debug}catch(e){}return e}(t=e.exports=n(48)).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(){var e=arguments,n=this.useColors;if(e[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+e[0]+(n?"%c ":" ")+"+"+t.humanize(this.diff),!n)return e;var r="color: "+this.color;e=[e[0],r,"color: inherit"].concat(Array.prototype.slice.call(e,1));var i=0,o=0;return e[0].replace(/%[a-z%]/g,(function(e){"%%"!==e&&(i++,"%c"===e&&(o=i))})),e.splice(o,0,r),e},t.save=function(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}},t.load=r,t.useColors=function(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31},t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],t.formatters.j=function(e){return JSON.stringify(e)},t.enable(r())},function(e,t,n){(t=e.exports=function(e){function n(){}function o(){var e=o,n=+new Date,s=n-(r||n);e.diff=s,e.prev=r,e.curr=n,r=n,null==e.useColors&&(e.useColors=t.useColors()),null==e.color&&e.useColors&&(e.color=t.colors[i++%t.colors.length]);var a=Array.prototype.slice.call(arguments);a[0]=t.coerce(a[0]),"string"!=typeof a[0]&&(a=["%o"].concat(a));var c=0;a[0]=a[0].replace(/%([a-z%])/g,(function(n,r){if("%%"===n)return n;c++;var i=t.formatters[r];if("function"==typeof i){var o=a[c];n=i.call(e,o),a.splice(c,1),c--}return n})),"function"==typeof t.formatArgs&&(a=t.formatArgs.apply(e,a)),(o.log||t.log||console.log.bind(console)).apply(e,a)}n.enabled=!1,o.enabled=!0;var s=t.enabled(e)?o:n;return s.namespace=e,s}).coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable("")},t.enable=function(e){t.save(e);for(var n=(e||"").split(/[\s,]+/),r=n.length,i=0;i<r;i++)n[i]&&("-"===(e=n[i].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){var n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=n(49),t.names=[],t.skips=[],t.formatters={};var r,i=0},function(e,t){var n=1e3,r=60*n,i=60*r,o=24*i,s=365.25*o;function a(e,t,n){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}e.exports=function(e,t){return t=t||{},"string"==typeof e?function(e){if((e=""+e).length>1e4)return;var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!t)return;var a=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return a*s;case"days":case"day":case"d":return a*o;case"hours":case"hour":case"hrs":case"hr":case"h":return a*i;case"minutes":case"minute":case"mins":case"min":case"m":return a*r;case"seconds":case"second":case"secs":case"sec":case"s":return a*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return a}}(e):t.long?a(c=e,o,"day")||a(c,i,"hour")||a(c,r,"minute")||a(c,n,"second")||c+" ms":function(e){return e>=o?Math.round(e/o)+"d":e>=i?Math.round(e/i)+"h":e>=r?Math.round(e/r)+"m":e>=n?Math.round(e/n)+"s":e+"ms"}(e);var c}},function(e,t,n){(function(e,r){var i;/*! JSON v3.3.2 | http://bestiejs.github.io/json3 | Copyright 2012-2014, Kit Cambridge | http://kit.mit-license.org */(function(){var o=n(51),s={function:!0,object:!0},a=s[typeof t]&&t&&!t.nodeType&&t,c=s[typeof window]&&window||this,u=a&&s[typeof e]&&e&&!e.nodeType&&"object"==typeof r&&r;function f(e,t){e||(e=c.Object()),t||(t=c.Object());var n=e.Number||c.Number,r=e.String||c.String,i=e.Object||c.Object,o=e.Date||c.Date,a=e.SyntaxError||c.SyntaxError,u=e.TypeError||c.TypeError,h=e.Math||c.Math,l=e.JSON||c.JSON;"object"==typeof l&&l&&(t.stringify=l.stringify,t.parse=l.parse);var d,p,g,m=i.prototype,y=m.toString,v=new o(-0xc782b5b800cec);try{v=-109252==v.getUTCFullYear()&&0===v.getUTCMonth()&&1===v.getUTCDate()&&10==v.getUTCHours()&&37==v.getUTCMinutes()&&6==v.getUTCSeconds()&&708==v.getUTCMilliseconds()}catch(e){}function b(e){if(b[e]!==g)return b[e];var i;if("bug-string-char-index"==e)i="a"!="a"[0];else if("json"==e)i=b("json-stringify")&&b("json-parse");else{var s,a='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if("json-stringify"==e){var c=t.stringify,u="function"==typeof c&&v;if(u){(s=function(){return 1}).toJSON=s;try{u="0"===c(0)&&"0"===c(new n)&&'""'==c(new r)&&c(y)===g&&c(g)===g&&c()===g&&"1"===c(s)&&"[1]"==c([s])&&"[null]"==c([g])&&"null"==c(null)&&"[null,null,null]"==c([g,y,null])&&c({a:[s,!0,!1,null,"\0\b\n\f\r\t"]})==a&&"1"===c(null,s)&&"[\n 1,\n 2\n]"==c([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==c(new o(-864e13))&&'"+275760-09-13T00:00:00.000Z"'==c(new o(864e13))&&'"-000001-01-01T00:00:00.000Z"'==c(new o(-621987552e5))&&'"1969-12-31T23:59:59.999Z"'==c(new o(-1))}catch(e){u=!1}}i=u}if("json-parse"==e){var f=t.parse;if("function"==typeof f)try{if(0===f("0")&&!f(!1)){var h=5==(s=f(a)).a.length&&1===s.a[0];if(h){try{h=!f('"\t"')}catch(e){}if(h)try{h=1!==f("01")}catch(e){}if(h)try{h=1!==f("1.")}catch(e){}}}}catch(e){h=!1}i=h}}return b[e]=!!i}if(!b("json")){var _=b("bug-string-char-index");if(!v)var w=h.floor,k=[0,31,59,90,120,151,181,212,243,273,304,334],E=function(e,t){return k[t]+365*(e-1970)+w((e-1969+(t=+(t>1)))/4)-w((e-1901+t)/100)+w((e-1601+t)/400)};if((d=m.hasOwnProperty)||(d=function(e){var t,n={};return(n.__proto__=null,n.__proto__={toString:1},n).toString!=y?d=function(e){var t=this.__proto__,n=e in(this.__proto__=null,this);return this.__proto__=t,n}:(t=n.constructor,d=function(e){var n=(this.constructor||t).prototype;return e in this&&!(e in n&&this[e]===n[e])}),n=null,d.call(this,e)}),p=function(e,t){var n,r,i,o=0;for(i in(n=function(){this.valueOf=0}).prototype.valueOf=0,r=new n)d.call(r,i)&&o++;return n=r=null,o?p=2==o?function(e,t){var n,r={},i="[object Function]"==y.call(e);for(n in e)i&&"prototype"==n||d.call(r,n)||!(r[n]=1)||!d.call(e,n)||t(n)}:function(e,t){var n,r,i="[object Function]"==y.call(e);for(n in e)i&&"prototype"==n||!d.call(e,n)||(r="constructor"===n)||t(n);(r||d.call(e,n="constructor"))&&t(n)}:(r=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],p=function(e,t){var n,i,o="[object Function]"==y.call(e),a=!o&&"function"!=typeof e.constructor&&s[typeof e.hasOwnProperty]&&e.hasOwnProperty||d;for(n in e)o&&"prototype"==n||!a.call(e,n)||t(n);for(i=r.length;n=r[--i];a.call(e,n)&&t(n));}),p(e,t)},!b("json-stringify")){var x={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},S=function(e,t){return("000000"+(t||0)).slice(-e)},A=function(e){for(var t='"',n=0,r=e.length,i=!_||r>10,o=i&&(_?e.split(""):e);n<r;n++){var s=e.charCodeAt(n);switch(s){case 8:case 9:case 10:case 12:case 13:case 34:case 92:t+=x[s];break;default:if(s<32){t+="\\u00"+S(2,s.toString(16));break}t+=i?o[n]:e.charAt(n)}}return t+'"'},C=function(e,t,n,r,i,o,s){var a,c,f,h,l,m,v,b,_,k,x,T,B,I,R,L;try{a=t[e]}catch(e){}if("object"==typeof a&&a)if("[object Date]"!=(c=y.call(a))||d.call(a,"toJSON"))"function"==typeof a.toJSON&&("[object Number]"!=c&&"[object String]"!=c&&"[object Array]"!=c||d.call(a,"toJSON"))&&(a=a.toJSON(e));else if(a>-1/0&&a<1/0){if(E){for(l=w(a/864e5),f=w(l/365.2425)+1970-1;E(f+1,0)<=l;f++);for(h=w((l-E(f,0))/30.42);E(f,h+1)<=l;h++);l=1+l-E(f,h),v=w((m=(a%864e5+864e5)%864e5)/36e5)%24,b=w(m/6e4)%60,_=w(m/1e3)%60,k=m%1e3}else f=a.getUTCFullYear(),h=a.getUTCMonth(),l=a.getUTCDate(),v=a.getUTCHours(),b=a.getUTCMinutes(),_=a.getUTCSeconds(),k=a.getUTCMilliseconds();a=(f<=0||f>=1e4?(f<0?"-":"+")+S(6,f<0?-f:f):S(4,f))+"-"+S(2,h+1)+"-"+S(2,l)+"T"+S(2,v)+":"+S(2,b)+":"+S(2,_)+"."+S(3,k)+"Z"}else a=null;if(n&&(a=n.call(t,e,a)),null===a)return"null";if("[object Boolean]"==(c=y.call(a)))return""+a;if("[object Number]"==c)return a>-1/0&&a<1/0?""+a:"null";if("[object String]"==c)return A(""+a);if("object"==typeof a){for(I=s.length;I--;)if(s[I]===a)throw u();if(s.push(a),x=[],R=o,o+=i,"[object Array]"==c){for(B=0,I=a.length;B<I;B++)T=C(B,a,n,r,i,o,s),x.push(T===g?"null":T);L=x.length?i?"[\n"+o+x.join(",\n"+o)+"\n"+R+"]":"["+x.join(",")+"]":"[]"}else p(r||a,(function(e){var t=C(e,a,n,r,i,o,s);t!==g&&x.push(A(e)+":"+(i?" ":"")+t)})),L=x.length?i?"{\n"+o+x.join(",\n"+o)+"\n"+R+"}":"{"+x.join(",")+"}":"{}";return s.pop(),L}};t.stringify=function(e,t,n){var r,i,o,a;if(s[typeof t]&&t)if("[object Function]"==(a=y.call(t)))i=t;else if("[object Array]"==a){o={};for(var c,u=0,f=t.length;u<f;c=t[u++],("[object String]"==(a=y.call(c))||"[object Number]"==a)&&(o[c]=1));}if(n)if("[object Number]"==(a=y.call(n))){if((n-=n%1)>0)for(r="",n>10&&(n=10);r.length<n;r+=" ");}else"[object String]"==a&&(r=n.length<=10?n:n.slice(0,10));return C("",((c={})[""]=e,c),i,o,r,"",[])}}if(!b("json-parse")){var T,B,I=r.fromCharCode,R={92:"\\",34:'"',47:"/",98:"\b",116:"\t",110:"\n",102:"\f",114:"\r"},L=function(){throw T=B=null,a()},O=function(){for(var e,t,n,r,i,o=B,s=o.length;T<s;)switch(i=o.charCodeAt(T)){case 9:case 10:case 13:case 32:T++;break;case 123:case 125:case 91:case 93:case 58:case 44:return e=_?o.charAt(T):o[T],T++,e;case 34:for(e="@",T++;T<s;)if((i=o.charCodeAt(T))<32)L();else if(92==i)switch(i=o.charCodeAt(++T)){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:e+=R[i],T++;break;case 117:for(t=++T,n=T+4;T<n;T++)(i=o.charCodeAt(T))>=48&&i<=57||i>=97&&i<=102||i>=65&&i<=70||L();e+=I("0x"+o.slice(t,T));break;default:L()}else{if(34==i)break;for(i=o.charCodeAt(T),t=T;i>=32&&92!=i&&34!=i;)i=o.charCodeAt(++T);e+=o.slice(t,T)}if(34==o.charCodeAt(T))return T++,e;L();default:if(t=T,45==i&&(r=!0,i=o.charCodeAt(++T)),i>=48&&i<=57){for(48==i&&((i=o.charCodeAt(T+1))>=48&&i<=57)&&L(),r=!1;T<s&&((i=o.charCodeAt(T))>=48&&i<=57);T++);if(46==o.charCodeAt(T)){for(n=++T;n<s&&((i=o.charCodeAt(n))>=48&&i<=57);n++);n==T&&L(),T=n}if(101==(i=o.charCodeAt(T))||69==i){for(43!=(i=o.charCodeAt(++T))&&45!=i||T++,n=T;n<s&&((i=o.charCodeAt(n))>=48&&i<=57);n++);n==T&&L(),T=n}return+o.slice(t,T)}if(r&&L(),"true"==o.slice(T,T+4))return T+=4,!0;if("false"==o.slice(T,T+5))return T+=5,!1;if("null"==o.slice(T,T+4))return T+=4,null;L()}return"$"},P=function(e){var t,n;if("$"==e&&L(),"string"==typeof e){if("@"==(_?e.charAt(0):e[0]))return e.slice(1);if("["==e){for(t=[];"]"!=(e=O());n||(n=!0))n&&(","==e?"]"==(e=O())&&L():L()),","==e&&L(),t.push(P(e));return t}if("{"==e){for(t={};"}"!=(e=O());n||(n=!0))n&&(","==e?"}"==(e=O())&&L():L()),","!=e&&"string"==typeof e&&"@"==(_?e.charAt(0):e[0])&&":"==O()||L(),t[e.slice(1)]=P(O());return t}L()}return e},U=function(e,t,n){var r=M(e,t,n);r===g?delete e[t]:e[t]=r},M=function(e,t,n){var r,i=e[t];if("object"==typeof i&&i)if("[object Array]"==y.call(i))for(r=i.length;r--;)U(i,r,n);else p(i,(function(e){U(i,e,n)}));return n.call(e,t,i)};t.parse=function(e,t){var n,r;return T=0,B=""+e,n=P(O()),"$"!=O()&&L(),T=B=null,t&&"[object Function]"==y.call(t)?M(((r={})[""]=n,r),"",t):n}}}return t.runInContext=f,t}if(!u||u.global!==u&&u.window!==u&&u.self!==u||(c=u),a&&!o)f(c,a);else{var h=c.JSON,l=c.JSON3,d=!1,p=f(c,c.JSON3={noConflict:function(){return d||(d=!0,c.JSON=h,c.JSON3=l,h=l=null),p}});c.JSON={parse:p.parse,stringify:p.stringify}}o&&(void 0===(i=function(){return p}.call(t,n,t,e))||(e.exports=i))}).call(this)}).call(this,n(22)(e),n(0))},function(e,t){(function(t){e.exports=t}).call(this,{})},function(e,t){function n(e){if(e)return function(e){for(var t in n.prototype)e[t]=n.prototype[t];return e}(e)}e.exports=n,n.prototype.on=n.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks[e]=this._callbacks[e]||[]).push(t),this},n.prototype.once=function(e,t){var n=this;function r(){n.off(e,r),t.apply(this,arguments)}return this._callbacks=this._callbacks||{},r.fn=t,this.on(e,r),this},n.prototype.off=n.prototype.removeListener=n.prototype.removeAllListeners=n.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,r=this._callbacks[e];if(!r)return this;if(1==arguments.length)return delete this._callbacks[e],this;for(var i=0;i<r.length;i++)if((n=r[i])===t||n.fn===t){r.splice(i,1);break}return this},n.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),n=this._callbacks[e];if(n)for(var r=0,i=(n=n.slice(0)).length;r<i;++r)n[r].apply(this,t);return this},n.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks[e]||[]},n.prototype.hasListeners=function(e){return!!this.listeners(e).length}},function(e,t,n){(function(e){var r=n(23),i=n(24);t.deconstructPacket=function(e){var t=[],n=e.data;var o=e;return o.data=function e(n){if(!n)return n;if(i(n)){var o={_placeholder:!0,num:t.length};return t.push(n),o}if(r(n)){for(var s=new Array(n.length),a=0;a<n.length;a++)s[a]=e(n[a]);return s}if("object"==typeof n&&!(n instanceof Date)){s={};for(var c in n)s[c]=e(n[c]);return s}return n}(n),o.attachments=t.length,{packet:o,buffers:t}},t.reconstructPacket=function(e,t){return e.data=function e(n){if(n&&n._placeholder)return t[n.num];if(r(n)){for(var i=0;i<n.length;i++)n[i]=e(n[i]);return n}if(n&&"object"==typeof n){for(var o in n)n[o]=e(n[o]);return n}return n}(e.data),e.attachments=void 0,e},t.removeBlobs=function(t,n){var o=0,s=t;!function t(a,c,u){if(!a)return a;if(e.Blob&&a instanceof Blob||e.File&&a instanceof File){o++;var f=new FileReader;f.onload=function(){u?u[c]=this.result:s=this.result,--o||n(s)},f.readAsArrayBuffer(a)}else if(r(a))for(var h=0;h<a.length;h++)t(a[h],h,a);else if(a&&"object"==typeof a&&!i(a))for(var l in a)t(a[l],l,a)}(s),o||n(s)}}).call(this,n(0))},function(e,t,n){e.exports=n(55)},function(e,t,n){e.exports=n(56),e.exports.parser=n(3)},function(e,t,n){(function(t){var r=n(26),i=n(14),o=n(8)("engine.io-client:socket"),s=n(30),a=n(3),c=n(21),u=n(70),f=n(15);function h(e,n){if(!(this instanceof h))return new h(e,n);n=n||{},e&&"object"==typeof e&&(n=e,e=null),e?(e=c(e),n.hostname=e.host,n.secure="https"===e.protocol||"wss"===e.protocol,n.port=e.port,e.query&&(n.query=e.query)):n.host&&(n.hostname=c(n.host).host),this.secure=null!=n.secure?n.secure:t.location&&"https:"===location.protocol,n.hostname&&!n.port&&(n.port=this.secure?"443":"80"),this.agent=n.agent||!1,this.hostname=n.hostname||(t.location?location.hostname:"localhost"),this.port=n.port||(t.location&&location.port?location.port:this.secure?443:80),this.query=n.query||{},"string"==typeof this.query&&(this.query=f.decode(this.query)),this.upgrade=!1!==n.upgrade,this.path=(n.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!n.forceJSONP,this.jsonp=!1!==n.jsonp,this.forceBase64=!!n.forceBase64,this.enablesXDR=!!n.enablesXDR,this.timestampParam=n.timestampParam||"t",this.timestampRequests=n.timestampRequests,this.transports=n.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=n.policyPort||843,this.rememberUpgrade=n.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=n.onlyBinaryUpgrades,this.perMessageDeflate=!1!==n.perMessageDeflate&&(n.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=n.pfx||null,this.key=n.key||null,this.passphrase=n.passphrase||null,this.cert=n.cert||null,this.ca=n.ca||null,this.ciphers=n.ciphers||null,this.rejectUnauthorized=void 0===n.rejectUnauthorized?null:n.rejectUnauthorized,this.forceNode=!!n.forceNode;var r="object"==typeof t&&t;r.global===r&&(n.extraHeaders&&Object.keys(n.extraHeaders).length>0&&(this.extraHeaders=n.extraHeaders),n.localAddress&&(this.localAddress=n.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,this.open()}e.exports=h,h.priorWebsocketSuccess=!1,i(h.prototype),h.protocol=a.protocol,h.Socket=h,h.Transport=n(13),h.transports=n(26),h.parser=n(3),h.prototype.createTransport=function(e){o('creating transport "%s"',e);var t=function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}(this.query);return t.EIO=a.protocol,t.transport=e,this.id&&(t.sid=this.id),new r[e]({agent:this.agent,hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:t,forceJSONP:this.forceJSONP,jsonp:this.jsonp,forceBase64:this.forceBase64,enablesXDR:this.enablesXDR,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,policyPort:this.policyPort,socket:this,pfx:this.pfx,key:this.key,passphrase:this.passphrase,cert:this.cert,ca:this.ca,ciphers:this.ciphers,rejectUnauthorized:this.rejectUnauthorized,perMessageDeflate:this.perMessageDeflate,extraHeaders:this.extraHeaders,forceNode:this.forceNode,localAddress:this.localAddress})},h.prototype.open=function(){var e;if(this.rememberUpgrade&&h.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length){var t=this;return void setTimeout((function(){t.emit("error","No transports available")}),0)}e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)},h.prototype.setTransport=function(e){o("setting transport %s",e.name);var t=this;this.transport&&(o("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",(function(){t.onDrain()})).on("packet",(function(e){t.onPacket(e)})).on("error",(function(e){t.onError(e)})).on("close",(function(){t.onClose("transport close")}))},h.prototype.probe=function(e){o('probing transport "%s"',e);var t=this.createTransport(e,{probe:1}),n=!1,r=this;function i(){if(r.onlyBinaryUpgrades){var i=!this.supportsBinary&&r.transport.supportsBinary;n=n||i}n||(o('probe transport "%s" opened',e),t.send([{type:"ping",data:"probe"}]),t.once("packet",(function(i){if(!n)if("pong"===i.type&&"probe"===i.data){if(o('probe transport "%s" pong',e),r.upgrading=!0,r.emit("upgrading",t),!t)return;h.priorWebsocketSuccess="websocket"===t.name,o('pausing current transport "%s"',r.transport.name),r.transport.pause((function(){n||"closed"!==r.readyState&&(o("changing transport and sending upgrade packet"),l(),r.setTransport(t),t.send([{type:"upgrade"}]),r.emit("upgrade",t),t=null,r.upgrading=!1,r.flush())}))}else{o('probe transport "%s" failed',e);var s=new Error("probe error");s.transport=t.name,r.emit("upgradeError",s)}})))}function s(){n||(n=!0,l(),t.close(),t=null)}function a(n){var i=new Error("probe error: "+n);i.transport=t.name,s(),o('probe transport "%s" failed because of error: %s',e,n),r.emit("upgradeError",i)}function c(){a("transport closed")}function u(){a("socket closed")}function f(e){t&&e.name!==t.name&&(o('"%s" works - aborting "%s"',e.name,t.name),s())}function l(){t.removeListener("open",i),t.removeListener("error",a),t.removeListener("close",c),r.removeListener("close",u),r.removeListener("upgrading",f)}h.priorWebsocketSuccess=!1,t.once("open",i),t.once("error",a),t.once("close",c),this.once("close",u),this.once("upgrading",f),t.open()},h.prototype.onOpen=function(){if(o("socket open"),this.readyState="open",h.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){o("starting upgrade probes");for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}},h.prototype.onPacket=function(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(o('socket receive: type "%s", data "%s"',e.type,e.data),this.emit("packet",e),this.emit("heartbeat"),e.type){case"open":this.onHandshake(u(e.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emit("data",e.data),this.emit("message",e.data)}else o('packet received with socket readyState "%s"',this.readyState)},h.prototype.onHandshake=function(e){this.emit("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},h.prototype.onHeartbeat=function(e){clearTimeout(this.pingTimeoutTimer);var t=this;t.pingTimeoutTimer=setTimeout((function(){"closed"!==t.readyState&&t.onClose("ping timeout")}),e||t.pingInterval+t.pingTimeout)},h.prototype.setPing=function(){var e=this;clearTimeout(e.pingIntervalTimer),e.pingIntervalTimer=setTimeout((function(){o("writing ping packet - expecting pong within %sms",e.pingTimeout),e.ping(),e.onHeartbeat(e.pingTimeout)}),e.pingInterval)},h.prototype.ping=function(){var e=this;this.sendPacket("ping",(function(){e.emit("ping")}))},h.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()},h.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(o("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},h.prototype.write=h.prototype.send=function(e,t,n){return this.sendPacket("message",e,t,n),this},h.prototype.sendPacket=function(e,t,n,r){if("function"==typeof t&&(r=t,t=void 0),"function"==typeof n&&(r=n,n=null),"closing"!==this.readyState&&"closed"!==this.readyState){(n=n||{}).compress=!1!==n.compress;var i={type:e,data:t,options:n};this.emit("packetCreate",i),this.writeBuffer.push(i),r&&this.once("flush",r),this.flush()}},h.prototype.close=function(){if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";var e=this;this.writeBuffer.length?this.once("drain",(function(){this.upgrading?r():t()})):this.upgrading?r():t()}function t(){e.onClose("forced close"),o("socket closing - telling transport to close"),e.transport.close()}function n(){e.removeListener("upgrade",n),e.removeListener("upgradeError",n),t()}function r(){e.once("upgrade",n),e.once("upgradeError",n)}return this},h.prototype.onError=function(e){o("socket error %j",e),h.priorWebsocketSuccess=!1,this.emit("error",e),this.onClose("transport error",e)},h.prototype.onClose=function(e,t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){o('socket close with reason: "%s"',e);clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",e,t),this.writeBuffer=[],this.prevBufferLen=0}},h.prototype.filterUpgrades=function(e){for(var t=[],n=0,r=e.length;n<r;n++)~s(this.transports,e[n])&&t.push(e[n]);return t}}).call(this,n(0))},function(e,t){try{e.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(t){e.exports=!1}},function(e,t,n){(function(t){var r=n(12),i=n(27),o=n(14),s=n(7),a=n(8)("engine.io-client:polling-xhr");function c(){}function u(e){if(i.call(this,e),this.requestTimeout=e.requestTimeout,t.location){var n="https:"===location.protocol,r=location.port;r||(r=n?443:80),this.xd=e.hostname!==t.location.hostname||r!==e.port,this.xs=e.secure!==n}else this.extraHeaders=e.extraHeaders}function f(e){this.method=e.method||"GET",this.uri=e.uri,this.xd=!!e.xd,this.xs=!!e.xs,this.async=!1!==e.async,this.data=void 0!==e.data?e.data:null,this.agent=e.agent,this.isBinary=e.isBinary,this.supportsBinary=e.supportsBinary,this.enablesXDR=e.enablesXDR,this.requestTimeout=e.requestTimeout,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.extraHeaders=e.extraHeaders,this.create()}function h(){for(var e in f.requests)f.requests.hasOwnProperty(e)&&f.requests[e].abort()}e.exports=u,e.exports.Request=f,s(u,i),u.prototype.supportsBinary=!0,u.prototype.request=function(e){return(e=e||{}).uri=this.uri(),e.xd=this.xd,e.xs=this.xs,e.agent=this.agent||!1,e.supportsBinary=this.supportsBinary,e.enablesXDR=this.enablesXDR,e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized,e.requestTimeout=this.requestTimeout,e.extraHeaders=this.extraHeaders,new f(e)},u.prototype.doWrite=function(e,t){var n="string"!=typeof e&&void 0!==e,r=this.request({method:"POST",data:e,isBinary:n}),i=this;r.on("success",t),r.on("error",(function(e){i.onError("xhr post error",e)})),this.sendXhr=r},u.prototype.doPoll=function(){a("xhr poll");var e=this.request(),t=this;e.on("data",(function(e){t.onData(e)})),e.on("error",(function(e){t.onError("xhr poll error",e)})),this.pollXhr=e},o(f.prototype),f.prototype.create=function(){var e={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized;var n=this.xhr=new r(e),i=this;try{a("xhr open %s: %s",this.method,this.uri),n.open(this.method,this.uri,this.async);try{if(this.extraHeaders)for(var o in n.setDisableHeaderCheck(!0),this.extraHeaders)this.extraHeaders.hasOwnProperty(o)&&n.setRequestHeader(o,this.extraHeaders[o])}catch(e){}if(this.supportsBinary&&(n.responseType="arraybuffer"),"POST"===this.method)try{this.isBinary?n.setRequestHeader("Content-type","application/octet-stream"):n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{n.setRequestHeader("Accept","*/*")}catch(e){}"withCredentials"in n&&(n.withCredentials=!0),this.requestTimeout&&(n.timeout=this.requestTimeout),this.hasXDR()?(n.onload=function(){i.onLoad()},n.onerror=function(){i.onError(n.responseText)}):n.onreadystatechange=function(){4===n.readyState&&(200===n.status||1223===n.status?i.onLoad():setTimeout((function(){i.onError(n.status)}),0))},a("xhr data %s",this.data),n.send(this.data)}catch(e){return void setTimeout((function(){i.onError(e)}),0)}t.document&&(this.index=f.requestsCount++,f.requests[this.index]=this)},f.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},f.prototype.onData=function(e){this.emit("data",e),this.onSuccess()},f.prototype.onError=function(e){this.emit("error",e),this.cleanup(!0)},f.prototype.cleanup=function(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=c:this.xhr.onreadystatechange=c,e)try{this.xhr.abort()}catch(e){}t.document&&delete f.requests[this.index],this.xhr=null}},f.prototype.onLoad=function(){var e;try{var t;try{t=this.xhr.getResponseHeader("Content-Type").split(";")[0]}catch(e){}if("application/octet-stream"===t)e=this.xhr.response||this.xhr.responseText;else if(this.supportsBinary)try{e=String.fromCharCode.apply(null,new Uint8Array(this.xhr.response))}catch(t){for(var n=new Uint8Array(this.xhr.response),r=[],i=0,o=n.length;i<o;i++)r.push(n[i]);e=String.fromCharCode.apply(null,r)}else e=this.xhr.responseText}catch(e){this.onError(e)}null!=e&&this.onData(e)},f.prototype.hasXDR=function(){return void 0!==t.XDomainRequest&&!this.xs&&this.enablesXDR},f.prototype.abort=function(){this.cleanup()},f.requestsCount=0,f.requests={},t.document&&(t.attachEvent?t.attachEvent("onunload",h):t.addEventListener&&t.addEventListener("beforeunload",h,!1))}).call(this,n(0))},function(e,t){e.exports=Object.keys||function(e){var t=[],n=Object.prototype.hasOwnProperty;for(var r in e)n.call(e,r)&&t.push(r);return t}},function(e,t){e.exports=function(e,t,n){var r=e.byteLength;if(t=t||0,n=n||r,e.slice)return e.slice(t,n);if(t<0&&(t+=r),n<0&&(n+=r),n>r&&(n=r),t>=r||t>=n||0===r)return new ArrayBuffer(0);for(var i=new Uint8Array(e),o=new Uint8Array(n-t),s=t,a=0;s<n;s++,a++)o[a]=i[s];return o.buffer}},function(e,t){function n(){}e.exports=function(e,t,r){var i=!1;return r=r||n,o.count=e,0===e?t():o;function o(e,n){if(o.count<=0)throw new Error("after called too many times");--o.count,e?(i=!0,t(e),t=r):0!==o.count||i||t(null,n)}}},function(e,t,n){(function(e,r){var i;/*! https://mths.be/wtf8 v1.0.0 by @mathias */!function(o){var s=t,a=(e&&e.exports,"object"==typeof r&&r);a.global!==a&&a.window;var c,u,f,h=String.fromCharCode;function l(e){for(var t,n,r=[],i=0,o=e.length;i<o;)(t=e.charCodeAt(i++))>=55296&&t<=56319&&i<o?56320==(64512&(n=e.charCodeAt(i++)))?r.push(((1023&t)<<10)+(1023&n)+65536):(r.push(t),i--):r.push(t);return r}function d(e,t){return h(e>>t&63|128)}function p(e){if(0==(4294967168&e))return h(e);var t="";return 0==(4294965248&e)?t=h(e>>6&31|192):0==(4294901760&e)?(t=h(e>>12&15|224),t+=d(e,6)):0==(4292870144&e)&&(t=h(e>>18&7|240),t+=d(e,12),t+=d(e,6)),t+=h(63&e|128)}function g(){if(f>=u)throw Error("Invalid byte index");var e=255&c[f];if(f++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}function m(){var e,t;if(f>u)throw Error("Invalid byte index");if(f==u)return!1;if(e=255&c[f],f++,0==(128&e))return e;if(192==(224&e)){if((t=(31&e)<<6|g())>=128)return t;throw Error("Invalid continuation byte")}if(224==(240&e)){if((t=(15&e)<<12|g()<<6|g())>=2048)return t;throw Error("Invalid continuation byte")}if(240==(248&e)&&(t=(15&e)<<18|g()<<12|g()<<6|g())>=65536&&t<=1114111)return t;throw Error("Invalid WTF-8 detected")}var y={version:"1.0.0",encode:function(e){for(var t=l(e),n=t.length,r=-1,i="";++r<n;)i+=p(t[r]);return i},decode:function(e){c=l(e),u=c.length,f=0;for(var t,n=[];!1!==(t=m());)n.push(t);return function(e){for(var t,n=e.length,r=-1,i="";++r<n;)(t=e[r])>65535&&(i+=h((t-=65536)>>>10&1023|55296),t=56320|1023&t),i+=h(t);return i}(n)}};void 0===(i=function(){return y}.call(t,n,t,e))||(e.exports=i)}()}).call(this,n(22)(e),n(0))},function(e,t){!function(){"use strict";for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=new Uint8Array(256),r=0;r<e.length;r++)n[e.charCodeAt(r)]=r;t.encode=function(t){var n,r=new Uint8Array(t),i=r.length,o="";for(n=0;n<i;n+=3)o+=e[r[n]>>2],o+=e[(3&r[n])<<4|r[n+1]>>4],o+=e[(15&r[n+1])<<2|r[n+2]>>6],o+=e[63&r[n+2]];return i%3==2?o=o.substring(0,o.length-1)+"=":i%3==1&&(o=o.substring(0,o.length-2)+"=="),o},t.decode=function(e){var t,r,i,o,s,a=.75*e.length,c=e.length,u=0;"="===e[e.length-1]&&(a--,"="===e[e.length-2]&&a--);var f=new ArrayBuffer(a),h=new Uint8Array(f);for(t=0;t<c;t+=4)r=n[e.charCodeAt(t)],i=n[e.charCodeAt(t+1)],o=n[e.charCodeAt(t+2)],s=n[e.charCodeAt(t+3)],h[u++]=r<<2|i>>4,h[u++]=(15&i)<<4|o>>2,h[u++]=(3&o)<<6|63&s;return f}}()},function(e,t,n){(function(t){var n=t.BlobBuilder||t.WebKitBlobBuilder||t.MSBlobBuilder||t.MozBlobBuilder,r=function(){try{return 2===new Blob(["hi"]).size}catch(e){return!1}}(),i=r&&function(){try{return 2===new Blob([new Uint8Array([1,2])]).size}catch(e){return!1}}(),o=n&&n.prototype.append&&n.prototype.getBlob;function s(e){for(var t=0;t<e.length;t++){var n=e[t];if(n.buffer instanceof ArrayBuffer){var r=n.buffer;if(n.byteLength!==r.byteLength){var i=new Uint8Array(n.byteLength);i.set(new Uint8Array(r,n.byteOffset,n.byteLength)),r=i.buffer}e[t]=r}}}function a(e,t){t=t||{};var r=new n;s(e);for(var i=0;i<e.length;i++)r.append(e[i]);return t.type?r.getBlob(t.type):r.getBlob()}function c(e,t){return s(e),new Blob(e,t||{})}e.exports=r?i?t.Blob:c:o?a:void 0}).call(this,n(0))},function(e,t,n){(t=e.exports=o.debug=o).coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable("")},t.enable=function(e){t.save(e);for(var n=(e||"").split(/[\s,]+/),r=n.length,i=0;i<r;i++)n[i]&&("-"===(e=n[i].replace(/[\\^$+?.()|[\]{}]/g,"\\$&").replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){var n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=n(66),t.names=[],t.skips=[],t.formatters={};var r,i=0;function o(e){function n(){}function o(){var e=o,n=+new Date,s=n-(r||n);e.diff=s,e.prev=r,e.curr=n,r=n,null==e.useColors&&(e.useColors=t.useColors()),null==e.color&&e.useColors&&(e.color=t.colors[i++%t.colors.length]);for(var a=new Array(arguments.length),c=0;c<a.length;c++)a[c]=arguments[c];a[0]=t.coerce(a[0]),"string"!=typeof a[0]&&(a=["%o"].concat(a));var u=0;a[0]=a[0].replace(/%([a-z%])/g,(function(n,r){if("%%"===n)return n;u++;var i=t.formatters[r];if("function"==typeof i){var o=a[u];n=i.call(e,o),a.splice(u,1),u--}return n})),a=t.formatArgs.apply(e,a),(o.log||t.log||console.log.bind(console)).apply(e,a)}n.enabled=!1,o.enabled=!0;var s=t.enabled(e)?o:n;return s.namespace=e,s}},function(e,t){var n=1e3,r=60*n,i=60*r,o=24*i,s=365.25*o;function a(e,t,n){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}e.exports=function(e,t){t=t||{};var c,u=typeof e;if("string"===u&&e.length>0)return function(e){if((e=String(e)).length>1e4)return;var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!t)return;var a=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return a*s;case"days":case"day":case"d":return a*o;case"hours":case"hour":case"hrs":case"hr":case"h":return a*i;case"minutes":case"minute":case"mins":case"min":case"m":return a*r;case"seconds":case"second":case"secs":case"sec":case"s":return a*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return a;default:return}}(e);if("number"===u&&!1===isNaN(e))return t.long?a(c=e,o,"day")||a(c,i,"hour")||a(c,r,"minute")||a(c,n,"second")||c+" ms":function(e){if(e>=o)return Math.round(e/o)+"d";if(e>=i)return Math.round(e/i)+"h";if(e>=r)return Math.round(e/r)+"m";if(e>=n)return Math.round(e/n)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,t,n){(function(t){var r=n(27),i=n(7);e.exports=u;var o,s=/\n/g,a=/\\n/g;function c(){}function u(e){r.call(this,e),this.query=this.query||{},o||(t.___eio||(t.___eio=[]),o=t.___eio),this.index=o.length;var n=this;o.push((function(e){n.onData(e)})),this.query.j=this.index,t.document&&t.addEventListener&&t.addEventListener("beforeunload",(function(){n.script&&(n.script.onerror=c)}),!1)}i(u,r),u.prototype.supportsBinary=!1,u.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),r.prototype.doClose.call(this)},u.prototype.doPoll=function(){var e=this,t=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),t.async=!0,t.src=this.uri(),t.onerror=function(t){e.onError("jsonp poll error",t)};var n=document.getElementsByTagName("script")[0];n?n.parentNode.insertBefore(t,n):(document.head||document.body).appendChild(t),this.script=t,"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout((function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)}),100)},u.prototype.doWrite=function(e,t){var n=this;if(!this.form){var r,i=document.createElement("form"),o=document.createElement("textarea"),c=this.iframeId="eio_iframe_"+this.index;i.className="socketio",i.style.position="absolute",i.style.top="-1000px",i.style.left="-1000px",i.target=c,i.method="POST",i.setAttribute("accept-charset","utf-8"),o.name="d",i.appendChild(o),document.body.appendChild(i),this.form=i,this.area=o}function u(){f(),t()}function f(){if(n.iframe)try{n.form.removeChild(n.iframe)}catch(e){n.onError("jsonp polling iframe removal error",e)}try{var e='<iframe src="javascript:0" name="'+n.iframeId+'">';r=document.createElement(e)}catch(e){(r=document.createElement("iframe")).name=n.iframeId,r.src="javascript:0"}r.id=n.iframeId,n.form.appendChild(r),n.iframe=r}this.form.action=this.uri(),f(),e=e.replace(a,"\\\n"),this.area.value=e.replace(s,"\\n");try{this.form.submit()}catch(e){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===n.iframe.readyState&&u()}:this.iframe.onload=u}}).call(this,n(0))},function(e,t,n){(function(t){var r,i=n(13),o=n(3),s=n(15),a=n(7),c=n(29),u=n(8)("engine.io-client:websocket"),f=t.WebSocket||t.MozWebSocket;if("undefined"==typeof window)try{r=n(69)}catch(e){}var h=f;function l(e){e&&e.forceBase64&&(this.supportsBinary=!1),this.perMessageDeflate=e.perMessageDeflate,this.usingBrowserWebSocket=f&&!e.forceNode,this.usingBrowserWebSocket||(h=r),i.call(this,e)}h||"undefined"!=typeof window||(h=r),e.exports=l,a(l,i),l.prototype.name="websocket",l.prototype.supportsBinary=!0,l.prototype.doOpen=function(){if(this.check()){var e=this.uri(),t={agent:this.agent,perMessageDeflate:this.perMessageDeflate};t.pfx=this.pfx,t.key=this.key,t.passphrase=this.passphrase,t.cert=this.cert,t.ca=this.ca,t.ciphers=this.ciphers,t.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(t.headers=this.extraHeaders),this.localAddress&&(t.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket?new h(e):new h(e,void 0,t)}catch(e){return this.emit("error",e)}void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},l.prototype.addEventListeners=function(){var e=this;this.ws.onopen=function(){e.onOpen()},this.ws.onclose=function(){e.onClose()},this.ws.onmessage=function(t){e.onData(t.data)},this.ws.onerror=function(t){e.onError("websocket error",t)}},l.prototype.write=function(e){var n=this;this.writable=!1;for(var r=e.length,i=0,s=r;i<s;i++)!function(e){o.encodePacket(e,n.supportsBinary,(function(i){if(!n.usingBrowserWebSocket){var o={};if(e.options&&(o.compress=e.options.compress),n.perMessageDeflate)("string"==typeof i?t.Buffer.byteLength(i):i.length)<n.perMessageDeflate.threshold&&(o.compress=!1)}try{n.usingBrowserWebSocket?n.ws.send(i):n.ws.send(i,o)}catch(e){u("websocket closed before onclose event")}--r||a()}))}(e[i]);function a(){n.emit("flush"),setTimeout((function(){n.writable=!0,n.emit("drain")}),0)}},l.prototype.onClose=function(){i.prototype.onClose.call(this)},l.prototype.doClose=function(){void 0!==this.ws&&this.ws.close()},l.prototype.uri=function(){var e=this.query||{},t=this.secure?"wss":"ws",n="";return this.port&&("wss"===t&&443!==Number(this.port)||"ws"===t&&80!==Number(this.port))&&(n=":"+this.port),this.timestampRequests&&(e[this.timestampParam]=c()),this.supportsBinary||(e.b64=1),(e=s.encode(e)).length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+e},l.prototype.check=function(){return!(!h||"__initialize"in h&&this.name===l.prototype.name)}}).call(this,n(0))},function(e,t){},function(e,t,n){(function(t){var n=/^[\],:{}\s]*$/,r=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,i=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,o=/(?:^|:|,)(?:\s*\[)+/g,s=/^\s+/,a=/\s+$/;e.exports=function(e){return"string"==typeof e&&e?(e=e.replace(s,"").replace(a,""),t.JSON&&JSON.parse?JSON.parse(e):n.test(e.replace(r,"@").replace(i,"]").replace(o,""))?new Function("return "+e)():void 0):null}}).call(this,n(0))},function(e,t){e.exports=function(e,t){for(var n=[],r=(t=t||0)||0;r<e.length;r++)n[r-t]=e[r];return n}},function(e,t){function n(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}e.exports=n,n.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-n:e+n}return 0|Math.min(e,this.max)},n.prototype.reset=function(){this.attempts=0},n.prototype.setMin=function(e){this.ms=e},n.prototype.setMax=function(e){this.max=e},n.prototype.setJitter=function(e){this.jitter=e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;o(n(74));var r=o(n(75)),i=o(n(97));function o(e){return e&&e.__esModule?e:{default:e}}function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t,n){return t&&h(e.prototype,t),n&&h(e,n),e}RTCPeerConnection=RTCPeerConnection||mozRTCPeerConnection;var d=function(){function e(t,n,i,o,s){var a=this;f(this,e),this.hostId_=t,this.peerId_=n,this.layerNo_=i,this.isInitiator_=o,this.dataChannelIsOk_=!1,this.callbacks_=s,this.isKeyFrame=!1,this.simplePeer_=new r.default({initiator:o}),this.simplePeer_.on("signal",(function(e){console.log("send signal"),a.callbacks_.onSignal(a.peerId_,e)})),this.simplePeer_.on("connect",(function(){a.dataChannelIsOk_=!0,a.callbacks_.onConnect&&a.callbacks_.onConnect(a)})),this.simplePeer_.on("error",(function(e){a.dataChannelIsOk_=!1,a.callbacks_.onError&&a.callbacks_.onError(a,e)})),this.simplePeer_.on("data",(function(e){e.type&&"data"!=e.type?"isKeyFrame"==e.type?a.isKeyFrame=!0:a.callbacks_.onMsg&&a.callbacks_.onMsg(a,e):(a.callbacks_.onData&&a.callbacks_.onData(a,a.isKeyFrame,e),a.isKeyFrame=!1)})),this.simplePeer_.on("close",(function(){a.callbacks_.onClose&&a.callbacks_.onClose(a)}))}return l(e,[{key:"isInitiator",value:function(){return this.isInitiator_}},{key:"getPeerId",value:function(){return this.peerId_}},{key:"getLayerNo",value:function(){return this.layerNo_}},{key:"setLayerNo",value:function(e){this.layerNo_=e}},{key:"signal",value:function(e){console.log("received signal"),this.simplePeer_.signal(e)}},{key:"sendMessage",value:function(e){this.simplePeer_.send(e)}},{key:"sendData",value:function(e){this.simplePeer_.send(e)}}]),e}(),p=function(e){function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};f(this,t),(n=function(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?c(e):t}(this,a(t).call(this))).opts_=r,n.almId_,n.layerNo_=1,n.isRoot_,n.total={downloaded:0,uploaded:0},"string"==typeof r.peerId&&(n.selfPeeId_=r.peerId),n.pusher_,n.backupPusher_,n.partners_=new Map,n.receivers_=new Map,n.candidates_=new Map,n.socket_=e,n.socket_.on("signal",(function(e,t){var r=n._findPeerNode(e);r||(console.log("Received signal from RP, create peer node for not find user: ",e),r=new d(n.selfPeeId_,e,-1,!1,n.peerCallbacks_),n.candidates_.set(e,r),console.log("find this peer:",n.candidates_.has(e)),console.log("onSignal,candidate size ",n.candidates_.size)),r.signal(t)})),n.peerCallbacks_={onSignal:n._onPeerSignal.bind(c(n)),onData:n._onPeerReceivedData.bind(c(n)),onMsg:n._onPeerReceivedMessage.bind(c(n)),onConnect:n._onPeerConnect.bind(c(n)),onError:n._onPeerError.bind(c(n)),onClose:n._onPeerClose.bind(c(n))},n.lastSeq_=0,n.datas_=new Map;return n.timerId=setInterval((function(){return n._onTimeCheck}),500),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,e),l(t,[{key:"deconstructor",value:function(){clearInterval(this.timerId)}},{key:"_isPeerExisted",value:function(e){return this.pusher_&&e==this.pusher_.getPeerId()||this.backupPusher_&&e==this.backupPusher_.getPeerId()||this.partners_.has(e)||this.candidates_.has(e)||this.receivers_.has(e)}},{key:"_findPeerNode",value:function(e){return this.pusher_&&e==this.pusher_.getPeerId()?this.pusher_:this.backupPusher_&&e==this.backupPusher_.getPeerId()?this.backupPusher_:this.partners_.has(e)?this.partners_.get(e):this.candidates_.has(e)?this.candidates_.get(e):this.receivers_.has(e)?this.receivers_.get(e):void 0}},{key:"create",value:function(e){this.almId_=e,this.sendBySocket("create",this.selfPeeId_,e),this.isRoot_=!0,this.layerNo_=0,this.socket_.on("createResp",this._onCreate.bind(this))}},{key:"_onCreate",value:function(e){console.log("received create response."),this.emit("create",e)}},{key:"join",value:function(e){this.almId_=e,this.isRoot_=!1,this.sendBySocket("join",this.selfPeeId_,e),this.socket_.on("joinResp",this._onJoin.bind(this))}},{key:"_onJoin",value:function(e,t,n){if(console.log("received join response, members: ",n.length),this.emit("join",e),this.layerNo_=t,"success"==e){var r=!0,i=!1,o=void 0;try{for(var s,a=n[Symbol.iterator]();!(r=(s=a.next()).done);r=!0){var c=s.value;if(c.peerId!=this.selfPeeId_)if(this._isPeerExisted(c.peerId))console.log("Peer is already existed: ",c);else{var u=new d(this.selfPeeId_,c.peerId,c.layerNo,!0,this.peerCallbacks_);this.candidates_.set(c.peerId,u),console.log("Add a candidate: ",c)}else console.log("Why self info!")}}catch(e){i=!0,o=e}finally{try{r||null==a.return||a.return()}finally{if(i)throw o}}}}},{key:"getId",value:function(){return this.almId_}},{key:"quit",value:function(e){e&&e();var t=!0,n=!1,r=void 0;try{for(var i,o=this.receivers_.values()[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){i.value.sendMessage({type:"quit"})}}catch(e){n=!0,r=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}this.sendBySocket("quit")}},{key:"_onTimeCheck",value:function(){}},{key:"_onPeerClose",value:function(e){console.log("close for user",e.getPeerId()),this._peerQuit(e)}},{key:"_onPeerError",value:function(e,t){console.log("error",t),this._peerQuit(e)}},{key:"_onPeerConnect",value:function(e){var t=e.getPeerId();e.isInitiator()&&e.sendMessage({type:"desc",info:{layerNo:this.layerNo_}}),console.log("onopenconnect, candidate size ",this.candidates_.size),!this.isRoot_&&this.candidates_.has(t)?(e.isInitiator()&&e.getLayerNo()<this.layerNo_&&(this.pusher_?this.backupPusher_?this.partners_.set(t,e):this.backupPusher_=e:(e.sendMessage({type:"pushReq",layer:this.layerNo_,startSeq:this.lastSeq_}),this.pusher_=e),this.candidates_.delete(t)),console.log("A peer with id:"+t+", data channel is ok, my layno is "+this.layerNo_+", candidate of layno is "+e.getLayerNo())):this.isRoot_||console.log("user is not candicated, when user connect: ",t)}},{key:"_onPeerSignal",value:function(e,t){this.sendBySocket("signal",this.selfPeeId_,e,t)}},{key:"_onPeerReceivedMessage",value:function(e,t){var n=e.getPeerId();switch(console.log("Received peer message: ".concat(t.type," from: ").concat(n)),t.type){case"quit":this._peerQuit(e);break;case"pushReq":this.pusher_&&e==this.pusher_||this.backupPusher_&&e==this.backupPusher_?(console.log("pusher can not be receiver: ",n),e.sendMessage({type:"pushResp",code:2,info:"Is pusher"})):(this.partners_.has(n)||this.candidates_.has(n))&&(console.log("receive push req from user: ".concat(n,", layno: ").concat(t.layer,".")),e.setLayerNo(t.layer),t.layer>=this.layerNo_?this.receivers_.size>2?e.sendMessage({type:"pushResp",code:3}):(e.sendMessage({type:"pushResp",code:0}),console.log("add a receive: ",n),this.receivers_.set(n,e),this.candidates_.delete(n),this.partners_.delete(n)):e.sendMessage({type:"pushResp",code:1})),this.receivers_.has(n)?(console.log("send pushresp"),e.sendMessage({type:"pushResp",code:0})):console.log("User is not existed when handle pushReq.");break;case"pushResp":switch(t.code){case 0:break;case 2:case 1:case 3:this.pusher_&&e==this.pusher_?(this.pusher_=null,this.partners_.set(n,this.pusher_)):this.backupPusher_&&e==this.backupPusher_?(this.partners_.set(n,this.backupPusher_),this.backupPusher_=null):console.log("send push req at invalid peer ",n),this._updatePusher()}break;case"desc":e.setLayerNo(t.info.layerNo)}}},{key:"_onPeerReceivedData",value:function(e,t,n){console.log("received data"),this.emit("data",t,n),this._relay(t,n)}},{key:"_relay",value:function(e,t){console.log("relay data to receivers: ",this.receivers_.size);var n=!0,r=!1,i=void 0;try{for(var o,s=this.receivers_.values()[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var a=o.value;e&&a.sendMessage({type:"isKeyFrame"}),a.sendData(t)}}catch(e){r=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(r)throw i}}}},{key:"send",value:function(e,t){var n=this;console.log("send data, len: ",t.size),this.fetchAB(t,(function(t){n._relay(e,t)}))}},{key:"fetchAB",value:function(e,t){var n=new FileReader;n.onload=function(e){console.log(e.target.result),e.target.result.byteLength>0&&t(new Uint8Array(e.target.result))},n.readAsArrayBuffer(e)}},{key:"_peerQuit",value:function(e){var t=e.getPeerId();this.pusher_&&e==this.pusher_?this.pusher_=null:this.backupPusher_&&e==this.backupPusher_?this.backupPusher_=null:this.partners_.has(t)?this.partners_.delete(t):this.candidates_.has(t)?this.candidates_.delete(t):this.receivers_.has(t)&&this.receivers_.delete(t),this._updatePusher()}},{key:"_updatePusher",value:function(){if(!this.pusher_){if(this.backupPusher_)this.pusher_=this.backupPusher_;else if(this.partners_.length>0){var e=this.partners_.keys().next().value;this.pusher_=this.partners_.get(e),this.partners_.delete(e)}this.pusher_&&(console.log("Select a new pusher."),this.pusher_.sendMessage({type:"pushReq",layer:this.layerNo_,startSeq:this.lastSeq_}))}}},{key:"downloadSpeed",value:function(){}},{key:"uploadSpeed",value:function(){}},{key:"downloaded",value:function(){return this.total.downloaded}},{key:"uploaded",value:function(){return this.total.uploaded}},{key:"logError",value:function(e){console.error(e)}},{key:"sendBySocket",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.socket_).emit.apply(t,[e].concat(r))}}]),t}(i.default);t.default=p,e.exports=t.default},function(e,t,n){"use strict";e.exports=function(e,t){if("string"!=typeof e)throw new Error("type must be a string");this.type=e,this.message=t}},function(e,t,n){(function(t){e.exports=f;var r=n(78)("simple-peer"),i=n(81),o=n(82),s=n(83),a=n(84),c=n(85),u=n(87);function f(e){var t=this;if(!(t instanceof f))return new f(e);if(t._debug("new peer %o",e),e||(e={}),e.allowHalfOpen=!1,null==e.highWaterMark&&(e.highWaterMark=1048576),u.Duplex.call(t,e),t.initiator=e.initiator||!1,t.channelConfig=e.channelConfig||f.channelConfig,t.channelName=e.initiator?e.channelName||o(160):null,t.config=e.config||f.config,t.constraints=e.constraints||f.constraints,t.offerConstraints=e.offerConstraints,t.answerConstraints=e.answerConstraints,t.reconnectTimer=e.reconnectTimer||!1,t.sdpTransform=e.sdpTransform||function(e){return e},t.stream=e.stream||!1,t.trickle=void 0===e.trickle||e.trickle,t.destroyed=!1,t.connected=!1,t.remoteAddress=void 0,t.remoteFamily=void 0,t.remotePort=void 0,t.localAddress=void 0,t.localPort=void 0,t._isWrtc=!!e.wrtc,t._wrtc=e.wrtc||i(),!t._wrtc)throw"undefined"==typeof window?new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"):new Error("No WebRTC support: Not a supported browser");t._maxBufferedAmount=e.highWaterMark,t._pcReady=!1,t._channelReady=!1,t._iceComplete=!1,t._channel=null,t._pendingCandidates=[],t._chunk=null,t._cb=null,t._interval=null,t._reconnectTimeout=null,t._pc=new t._wrtc.RTCPeerConnection(t.config,t.constraints),t._pc.oniceconnectionstatechange=t._onIceConnectionStateChange.bind(t),t._pc.onsignalingstatechange=t._onSignalingStateChange.bind(t),t._pc.onicecandidate=t._onIceCandidate.bind(t),t.stream&&t._pc.addStream(t.stream),t._pc.onaddstream=t._onAddStream.bind(t),t.initiator?(t._setupData({channel:t._pc.createDataChannel(t.channelName,t.channelConfig)}),t._pc.onnegotiationneeded=c(t._createOffer.bind(t)),"undefined"!=typeof window&&window.webkitRTCPeerConnection||t._pc.onnegotiationneeded()):t._pc.ondatachannel=t._setupData.bind(t),t.on("finish",(function(){t.connected?setTimeout((function(){t._destroy()}),100):t.once("connect",(function(){setTimeout((function(){t._destroy()}),100)}))}))}function h(){}s(f,u.Duplex),f.WEBRTC_SUPPORT=!!i(),f.config={iceServers:[{url:"stun:23.21.150.121",urls:"stun:23.21.150.121"}]},f.constraints={},f.channelConfig={},Object.defineProperty(f.prototype,"bufferSize",{get:function(){return this._channel&&this._channel.bufferedAmount||0}}),f.prototype.address=function(){return{port:this.localPort,family:"IPv4",address:this.localAddress}},f.prototype.signal=function(e){var t=this;if(t.destroyed)throw new Error("cannot signal after peer is destroyed");if("string"==typeof e)try{e=JSON.parse(e)}catch(t){e={}}function n(e){try{t._pc.addIceCandidate(new t._wrtc.RTCIceCandidate(e),h,t._onError.bind(t))}catch(e){t._destroy(new Error("error adding candidate: "+e.message))}}t._debug("signal()"),e.sdp&&t._pc.setRemoteDescription(new t._wrtc.RTCSessionDescription(e),(function(){t.destroyed||("offer"===t._pc.remoteDescription.type&&t._createAnswer(),t._pendingCandidates.forEach(n),t._pendingCandidates=[])}),t._onError.bind(t)),e.candidate&&(t._pc.remoteDescription?n(e.candidate):t._pendingCandidates.push(e.candidate)),e.sdp||e.candidate||t._destroy(new Error("signal() called with invalid signal data"))},f.prototype.send=function(e){a.strict(e)||e instanceof ArrayBuffer||t.isBuffer(e)||"string"==typeof e||"undefined"!=typeof Blob&&e instanceof Blob||(e=JSON.stringify(e)),t.isBuffer(e)&&this._isWrtc&&(e=new Uint8Array(e));var n=e.length||e.byteLength||e.size;this._channel.send(e),this._debug("write: %d bytes",n)},f.prototype.destroy=function(e){this._destroy(null,e)},f.prototype._destroy=function(e,t){if(!this.destroyed){if(t&&this.once("close",t),this._debug("destroy (error: %s)",e&&e.message),this.readable=this.writable=!1,this._readableState.ended||this.push(null),this._writableState.finished||this.end(),this.destroyed=!0,this.connected=!1,this._pcReady=!1,this._channelReady=!1,this._chunk=null,this._cb=null,clearInterval(this._interval),clearTimeout(this._reconnectTimeout),this._pc){try{this._pc.close()}catch(e){}this._pc.oniceconnectionstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null}if(this._channel){try{this._channel.close()}catch(e){}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null}this._pc=null,this._channel=null,e&&this.emit("error",e),this.emit("close")}},f.prototype._setupData=function(e){this._channel=e.channel,this.channelName=this._channel.label,this._channel.binaryType="arraybuffer",this._channel.onmessage=this._onChannelMessage.bind(this),this._channel.onopen=this._onChannelOpen.bind(this),this._channel.onclose=this._onChannelClose.bind(this)},f.prototype._read=function(){},f.prototype._write=function(e,t,n){if(this.destroyed)return n(new Error("cannot write after peer is destroyed"));if(this.connected){try{this.send(e)}catch(e){return this._onError(e)}this._channel.bufferedAmount>this._maxBufferedAmount?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=n):n(null)}else this._debug("write before connect"),this._chunk=e,this._cb=n},f.prototype._createOffer=function(){var e=this;e.destroyed||e._pc.createOffer((function(t){if(!e.destroyed){t.sdp=e.sdpTransform(t.sdp),e._pc.setLocalDescription(t,h,e._onError.bind(e));var n=function(){var n=e._pc.localDescription||t;e._debug("signal"),e.emit("signal",{type:n.type,sdp:n.sdp})};e.trickle||e._iceComplete?n():e.once("_iceComplete",n)}}),e._onError.bind(e),e.offerConstraints)},f.prototype._createAnswer=function(){var e=this;e.destroyed||e._pc.createAnswer((function(t){if(!e.destroyed){t.sdp=e.sdpTransform(t.sdp),e._pc.setLocalDescription(t,h,e._onError.bind(e));var n=function(){var n=e._pc.localDescription||t;e._debug("signal"),e.emit("signal",{type:n.type,sdp:n.sdp})};e.trickle||e._iceComplete?n():e.once("_iceComplete",n)}}),e._onError.bind(e),e.answerConstraints)},f.prototype._onIceConnectionStateChange=function(){var e=this;if(!e.destroyed){var t=e._pc.iceGatheringState,n=e._pc.iceConnectionState;e._debug("iceConnectionStateChange %s %s",t,n),e.emit("iceConnectionStateChange",t,n),"connected"!==n&&"completed"!==n||(clearTimeout(e._reconnectTimeout),e._pcReady=!0,e._maybeReady()),"disconnected"===n&&(e.reconnectTimer?(clearTimeout(e._reconnectTimeout),e._reconnectTimeout=setTimeout((function(){e._destroy()}),e.reconnectTimer)):e._destroy()),"failed"===n&&e._destroy(),"closed"===n&&e._destroy()}},f.prototype.getStats=function(e){this._pc.getStats?"undefined"!=typeof window&&window.mozRTCPeerConnection?this._pc.getStats(null,(function(t){var n=[];t.forEach((function(e){n.push(e)})),e(n)}),this._onError.bind(this)):this._pc.getStats((function(t){var n=[];t.result().forEach((function(e){var t={};e.names().forEach((function(n){t[n]=e.stat(n)})),t.id=e.id,t.type=e.type,t.timestamp=e.timestamp,n.push(t)})),e(n)})):e([])},f.prototype._maybeReady=function(){var e=this;e._debug("maybeReady pc %s channel %s",e._pcReady,e._channelReady),!e.connected&&!e._connecting&&e._pcReady&&e._channelReady&&(e._connecting=!0,e.getStats((function(t){e._connecting=!1,e.connected=!0;var n={},r={};if(t.forEach((function(e){"remotecandidate"===e.type&&(n[e.id]=e),"localcandidate"===e.type&&(r[e.id]=e)})),t.forEach((function(t){("googCandidatePair"===t.type&&"true"===t.googActiveConnection||"candidatepair"===t.type&&t.selected)&&function(t){var i=r[t.localCandidateId],o=n[t.remoteCandidateId];e.remoteAddress=o.ipAddress,e.remotePort=Number(o.portNumber),e.remoteFamily="IPv4",e._debug("connect remote: %s:%s",e.remoteAddress,e.remotePort),e.localAddress=i.ipAddress,e.localPort=Number(i.portNumber),e._debug("connect local: %s:%s",e.localAddress,e.localPort)}(t)})),e._chunk){try{e.send(e._chunk)}catch(t){return e._onError(t)}e._chunk=null,e._debug('sent chunk from "write before connect"');var i=e._cb;e._cb=null,i(null)}e._interval=setInterval((function(){if(e._cb&&e._channel&&!(e._channel.bufferedAmount>e._maxBufferedAmount)){e._debug("ending backpressure: bufferedAmount %d",e._channel.bufferedAmount);var t=e._cb;e._cb=null,t(null)}}),150),e._interval.unref&&e._interval.unref(),e._debug("connect"),e.emit("connect")})))},f.prototype._onSignalingStateChange=function(){this.destroyed||(this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))},f.prototype._onIceCandidate=function(e){this.destroyed||(e.candidate&&this.trickle?this.emit("signal",{candidate:{candidate:e.candidate.candidate,sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid}}):e.candidate||(this._iceComplete=!0,this.emit("_iceComplete")))},f.prototype._onChannelMessage=function(e){if(!this.destroyed){var n=e.data;if(this._debug("read: %d bytes",n.byteLength||n.length),n instanceof ArrayBuffer)n=new t(n),this.push(n);else{try{n=JSON.parse(n)}catch(e){}this.emit("data",n)}}},f.prototype._onChannelOpen=function(){this.connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())},f.prototype._onChannelClose=function(){this.destroyed||(this._debug("on channel close"),this._destroy())},f.prototype._onAddStream=function(e){this.destroyed||(this._debug("on add stream"),this.emit("stream",e.stream))},f.prototype._onError=function(e){this.destroyed||(this._debug("error %s",e.message||e),this._destroy(e))},f.prototype._debug=function(){var e=this,t=[].slice.call(arguments),n=e.channelName&&e.channelName.substring(0,7);t[0]="["+n+"] "+t[0],r.apply(null,t)}}).call(this,n(16).Buffer)},function(e,t,n){"use strict";t.byteLength=function(e){var t=u(e),n=t[0],r=t[1];return 3*(n+r)/4-r},t.toByteArray=function(e){var t,n,r=u(e),s=r[0],a=r[1],c=new o(function(e,t,n){return 3*(t+n)/4-n}(0,s,a)),f=0,h=a>0?s-4:s;for(n=0;n<h;n+=4)t=i[e.charCodeAt(n)]<<18|i[e.charCodeAt(n+1)]<<12|i[e.charCodeAt(n+2)]<<6|i[e.charCodeAt(n+3)],c[f++]=t>>16&255,c[f++]=t>>8&255,c[f++]=255&t;2===a&&(t=i[e.charCodeAt(n)]<<2|i[e.charCodeAt(n+1)]>>4,c[f++]=255&t);1===a&&(t=i[e.charCodeAt(n)]<<10|i[e.charCodeAt(n+1)]<<4|i[e.charCodeAt(n+2)]>>2,c[f++]=t>>8&255,c[f++]=255&t);return c},t.fromByteArray=function(e){for(var t,n=e.length,i=n%3,o=[],s=0,a=n-i;s<a;s+=16383)o.push(f(e,s,s+16383>a?a:s+16383));1===i?(t=e[n-1],o.push(r[t>>2]+r[t<<4&63]+"==")):2===i&&(t=(e[n-2]<<8)+e[n-1],o.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"="));return o.join("")};for(var r=[],i=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,c=s.length;a<c;++a)r[a]=s[a],i[s.charCodeAt(a)]=a;function u(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function f(e,t,n){for(var i,o,s=[],a=t;a<n;a+=3)i=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),s.push(r[(o=i)>>18&63]+r[o>>12&63]+r[o>>6&63]+r[63&o]);return s.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,n,r,i){var o,s,a=8*i-r-1,c=(1<<a)-1,u=c>>1,f=-7,h=n?i-1:0,l=n?-1:1,d=e[t+h];for(h+=l,o=d&(1<<-f)-1,d>>=-f,f+=a;f>0;o=256*o+e[t+h],h+=l,f-=8);for(s=o&(1<<-f)-1,o>>=-f,f+=r;f>0;s=256*s+e[t+h],h+=l,f-=8);if(0===o)o=1-u;else{if(o===c)return s?NaN:1/0*(d?-1:1);s+=Math.pow(2,r),o-=u}return(d?-1:1)*s*Math.pow(2,o-r)},t.write=function(e,t,n,r,i,o){var s,a,c,u=8*o-i-1,f=(1<<u)-1,h=f>>1,l=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:o-1,p=r?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=f):(s=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-s))<1&&(s--,c*=2),(t+=s+h>=1?l/c:l*Math.pow(2,1-h))*c>=2&&(s++,c/=2),s+h>=f?(a=0,s=f):s+h>=1?(a=(t*c-1)*Math.pow(2,i),s+=h):(a=t*Math.pow(2,h-1)*Math.pow(2,i),s=0));i>=8;e[n+d]=255&a,d+=p,a/=256,i-=8);for(s=s<<i|a,u+=i;u>0;e[n+d]=255&s,d+=p,s/=256,u-=8);e[n+d-p]|=128*g}},function(e,t,n){(function(r){function i(){var e;try{e=t.storage.debug}catch(e){}return!e&&void 0!==r&&"env"in r&&(e=r.env.DEBUG),e}(t=e.exports=n(79)).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(e){var n=this.useColors;if(e[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+e[0]+(n?"%c ":" ")+"+"+t.humanize(this.diff),!n)return;var r="color: "+this.color;e.splice(1,0,r,"color: inherit");var i=0,o=0;e[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(i++,"%c"===e&&(o=i))})),e.splice(o,0,r)},t.save=function(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}},t.load=i,t.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(i())}).call(this,n(1))},function(e,t,n){var r;function i(e){function n(){if(n.enabled){var e=n,i=+new Date,o=i-(r||i);e.diff=o,e.prev=r,e.curr=i,r=i;for(var s=new Array(arguments.length),a=0;a<s.length;a++)s[a]=arguments[a];s[0]=t.coerce(s[0]),"string"!=typeof s[0]&&s.unshift("%O");var c=0;s[0]=s[0].replace(/%([a-zA-Z%])/g,(function(n,r){if("%%"===n)return n;c++;var i=t.formatters[r];if("function"==typeof i){var o=s[c];n=i.call(e,o),s.splice(c,1),c--}return n})),t.formatArgs.call(e,s),(n.log||t.log||console.log.bind(console)).apply(e,s)}}return n.namespace=e,n.enabled=t.enabled(e),n.useColors=t.useColors(),n.color=function(e){var n,r=0;for(n in e)r=(r<<5)-r+e.charCodeAt(n),r|=0;return t.colors[Math.abs(r)%t.colors.length]}(e),"function"==typeof t.init&&t.init(n),n}(t=e.exports=i.debug=i.default=i).coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable("")},t.enable=function(e){t.save(e),t.names=[],t.skips=[];for(var n=("string"==typeof e?e:"").split(/[\s,]+/),r=n.length,i=0;i<r;i++)n[i]&&("-"===(e=n[i].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){var n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=n(80),t.names=[],t.skips=[],t.formatters={}},function(e,t){var n=1e3,r=60*n,i=60*r,o=24*i,s=365.25*o;function a(e,t,n){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}e.exports=function(e,t){t=t||{};var c,u=typeof e;if("string"===u&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!t)return;var a=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return a*s;case"days":case"day":case"d":return a*o;case"hours":case"hour":case"hrs":case"hr":case"h":return a*i;case"minutes":case"minute":case"mins":case"min":case"m":return a*r;case"seconds":case"second":case"secs":case"sec":case"s":return a*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return a;default:return}}(e);if("number"===u&&!1===isNaN(e))return t.long?a(c=e,o,"day")||a(c,i,"hour")||a(c,r,"minute")||a(c,n,"second")||c+" ms":function(e){if(e>=o)return Math.round(e/o)+"d";if(e>=i)return Math.round(e/i)+"h";if(e>=r)return Math.round(e/r)+"m";if(e>=n)return Math.round(e/n)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,t){e.exports=function(){if("undefined"==typeof window)return null;var e={RTCPeerConnection:window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,RTCSessionDescription:window.RTCSessionDescription||window.mozRTCSessionDescription||window.webkitRTCSessionDescription,RTCIceCandidate:window.RTCIceCandidate||window.mozRTCIceCandidate||window.webkitRTCIceCandidate};return e.RTCPeerConnection?e:null}},function(e,t){var n=e.exports=function(e,t){if(t||(t=16),void 0===e&&(e=128),e<=0)return"0";for(var r=Math.log(Math.pow(2,e))/Math.log(t),i=2;r===1/0;i*=2)r=Math.log(Math.pow(2,e/i))/Math.log(t)*i;var o=r-Math.floor(r),s="";for(i=0;i<Math.floor(r);i++){s=Math.floor(Math.random()*t).toString(t)+s}if(o){var a=Math.pow(t,o);s=Math.floor(Math.random()*a).toString(t)+s}var c=parseInt(s,t);return c!==1/0&&c>=Math.pow(2,e)?n(e,t):s};n.rack=function(e,t,r){var i=function(i){var s=0;do{if(s++>10){if(!r)throw new Error("too many ID collisions, use more bits");e+=r}var a=n(e,t)}while(Object.hasOwnProperty.call(o,a));return o[a]=i,a},o=i.hats={};return i.get=function(e){return i.hats[e]},i.set=function(e,t){return i.hats[e]=t,i},i.bits=e||128,i.base=t||16,i}},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},function(e,t){e.exports=i,i.strict=o,i.loose=s;var n=Object.prototype.toString,r={"[object Int8Array]":!0,"[object Int16Array]":!0,"[object Int32Array]":!0,"[object Uint8Array]":!0,"[object Uint8ClampedArray]":!0,"[object Uint16Array]":!0,"[object Uint32Array]":!0,"[object Float32Array]":!0,"[object Float64Array]":!0};function i(e){return o(e)||s(e)}function o(e){return e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array}function s(e){return r[n.call(e)]}},function(e,t,n){var r=n(86);function i(e){var t=function(){return t.called?t.value:(t.called=!0,t.value=e.apply(this,arguments))};return t.called=!1,t}function o(e){var t=function(){if(t.called)throw new Error(t.onceError);return t.called=!0,t.value=e.apply(this,arguments)},n=e.name||"Function wrapped with `once`";return t.onceError=n+" shouldn't be called more than once",t.called=!1,t}e.exports=r(i),e.exports.strict=r(o),i.proto=i((function(){Object.defineProperty(Function.prototype,"once",{value:function(){return i(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return o(this)},configurable:!0})}))},function(e,t){e.exports=function e(t,n){if(t&&n)return e(t)(n);if("function"!=typeof t)throw new TypeError("need wrapper function");return Object.keys(t).forEach((function(e){r[e]=t[e]})),r;function r(){for(var e=new Array(arguments.length),n=0;n<e.length;n++)e[n]=arguments[n];var r=t.apply(this,e),i=e[e.length-1];return"function"==typeof r&&r!==i&&Object.keys(i).forEach((function(e){r[e]=i[e]})),r}}},function(e,t,n){e.exports=i;var r=n(17).EventEmitter;function i(){r.call(this)}n(4)(i,r),i.Readable=n(18),i.Writable=n(93),i.Duplex=n(94),i.Transform=n(95),i.PassThrough=n(96),i.Stream=i,i.prototype.pipe=function(e,t){var n=this;function i(t){e.writable&&!1===e.write(t)&&n.pause&&n.pause()}function o(){n.readable&&n.resume&&n.resume()}n.on("data",i),e.on("drain",o),e._isStdio||t&&!1===t.end||(n.on("end",a),n.on("close",c));var s=!1;function a(){s||(s=!0,e.end())}function c(){s||(s=!0,"function"==typeof e.destroy&&e.destroy())}function u(e){if(f(),0===r.listenerCount(this,"error"))throw e}function f(){n.removeListener("data",i),e.removeListener("drain",o),n.removeListener("end",a),n.removeListener("close",c),n.removeListener("error",u),e.removeListener("error",u),n.removeListener("end",f),n.removeListener("close",f),e.removeListener("close",f)}return n.on("error",u),e.on("error",u),n.on("end",f),n.on("close",f),e.on("close",f),e.emit("pipe",n),e}},function(e,t){},function(e,t,n){"use strict";var r=n(10).Buffer,i=n(90);e.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}return e.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},e.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},e.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},e.prototype.clear=function(){this.head=this.tail=null,this.length=0},e.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n},e.prototype.concat=function(e){if(0===this.length)return r.alloc(0);if(1===this.length)return this.head.data;for(var t,n,i,o=r.allocUnsafe(e>>>0),s=this.head,a=0;s;)t=s.data,n=o,i=a,t.copy(n,i),a+=s.data.length,s=s.next;return o},e}(),i&&i.inspect&&i.inspect.custom&&(e.exports.prototype[i.inspect.custom]=function(){var e=i.inspect({length:this.length});return this.constructor.name+" "+e})},function(e,t){},function(e,t,n){(function(t){function n(e){try{if(!t.localStorage)return!1}catch(e){return!1}var n=t.localStorage[e];return null!=n&&"true"===String(n).toLowerCase()}e.exports=function(e,t){if(n("noDeprecation"))return e;var r=!1;return function(){if(!r){if(n("throwDeprecation"))throw new Error(t);n("traceDeprecation")?console.trace(t):console.warn(t),r=!0}return e.apply(this,arguments)}}}).call(this,n(0))},function(e,t,n){"use strict";e.exports=o;var r=n(40),i=n(5);function o(e){if(!(this instanceof o))return new o(e);r.call(this,e)}i.inherits=n(4),i.inherits(o,r),o.prototype._transform=function(e,t,n){n(null,e)}},function(e,t,n){e.exports=n(19)},function(e,t,n){e.exports=n(2)},function(e,t,n){e.exports=n(18).Transform},function(e,t,n){e.exports=n(18).PassThrough},function(e,t,n){var r;
/*!
 * EventEmitter v5.2.8 - git.io/ee
 * Unlicense - http://unlicense.org/
 * Oliver Caldwell - https://oli.me.uk/
 * @preserve
 */!function(t){"use strict";function i(){}var o=i.prototype,s=t.EventEmitter;function a(e,t){for(var n=e.length;n--;)if(e[n].listener===t)return n;return-1}function c(e){return function(){return this[e].apply(this,arguments)}}o.getListeners=function(e){var t,n,r=this._getEvents();if(e instanceof RegExp)for(n in t={},r)r.hasOwnProperty(n)&&e.test(n)&&(t[n]=r[n]);else t=r[e]||(r[e]=[]);return t},o.flattenListeners=function(e){var t,n=[];for(t=0;t<e.length;t+=1)n.push(e[t].listener);return n},o.getListenersAsObject=function(e){var t,n=this.getListeners(e);return n instanceof Array&&((t={})[e]=n),t||n},o.addListener=function(e,t){if(!function e(t){return"function"==typeof t||t instanceof RegExp||!(!t||"object"!=typeof t)&&e(t.listener)}(t))throw new TypeError("listener must be a function");var n,r=this.getListenersAsObject(e),i="object"==typeof t;for(n in r)r.hasOwnProperty(n)&&-1===a(r[n],t)&&r[n].push(i?t:{listener:t,once:!1});return this},o.on=c("addListener"),o.addOnceListener=function(e,t){return this.addListener(e,{listener:t,once:!0})},o.once=c("addOnceListener"),o.defineEvent=function(e){return this.getListeners(e),this},o.defineEvents=function(e){for(var t=0;t<e.length;t+=1)this.defineEvent(e[t]);return this},o.removeListener=function(e,t){var n,r,i=this.getListenersAsObject(e);for(r in i)i.hasOwnProperty(r)&&-1!==(n=a(i[r],t))&&i[r].splice(n,1);return this},o.off=c("removeListener"),o.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},o.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},o.manipulateListeners=function(e,t,n){var r,i,o=e?this.removeListener:this.addListener,s=e?this.removeListeners:this.addListeners;if("object"!=typeof t||t instanceof RegExp)for(r=n.length;r--;)o.call(this,t,n[r]);else for(r in t)t.hasOwnProperty(r)&&(i=t[r])&&("function"==typeof i?o.call(this,r,i):s.call(this,r,i));return this},o.removeEvent=function(e){var t,n=typeof e,r=this._getEvents();if("string"===n)delete r[e];else if(e instanceof RegExp)for(t in r)r.hasOwnProperty(t)&&e.test(t)&&delete r[t];else delete this._events;return this},o.removeAllListeners=c("removeEvent"),o.emitEvent=function(e,t){var n,r,i,o,s=this.getListenersAsObject(e);for(o in s)if(s.hasOwnProperty(o))for(n=s[o].slice(0),i=0;i<n.length;i++)!0===(r=n[i]).once&&this.removeListener(e,r.listener),r.listener.apply(this,t||[])===this._getOnceReturnValue()&&this.removeListener(e,r.listener);return this},o.trigger=c("emitEvent"),o.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},o.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},o._getOnceReturnValue=function(){return!this.hasOwnProperty("_onceReturnValue")||this._onceReturnValue},o._getEvents=function(){return this._events||(this._events={})},i.noConflict=function(){return t.EventEmitter=s,i},void 0===(r=function(){return i}.call(t,n,t,e))||(e.exports=r)}("undefined"!=typeof window?window:this||{})},function(e,t,n){"use strict";s(n(41));var r=s(n(99)),i=s(n(43)),o=s(n(73));function s(e){return e&&e.__esModule?e:{default:e}}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var c=function(){function e(t,n,r,o){var s=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.recordInterval=t,this.ID_of_NodeToRenderVideo=n,this.startStreamID=r,this.stopStreamID=o,this.videoStream=null,this.socket=i.default.connect(),this.selfPeerId="broadcaster"+Math.round(1e5*Math.random()),this.createBroadcast(),this.$video=document.getElementById("broadcaster"),this.mediaSource=new MediaSource,this.sourceBuffer,this.mediaSource.addEventListener("sourceopen",(function(e){s.sourceBuffer=s.mediaSource.addSourceBuffer("video/webm; codecs=opus,vp8"),console.log("MediaSource opened, source buffer: ",s.sourceBuffer),s.sourceBuffer.mode="sequence"})),this.$video.src=window.URL.createObjectURL(this.mediaSource),this.count=0,this.startStream()}var t,n,s;return t=e,(n=[{key:"startStream",value:function(){var e,t=this,n=this.recordInterval,i=this.videoStream,s=this.$video;this.$video.defaultMuted=!0,document.getElementById("".concat(this.startStreamID)).addEventListener("click",(function(){(e=new o.default(t.socket,{peerId:t.selfPeerId})).on("error",(function(e){console.log("lalm has encountered an error",e)})),e.create("demo-alm"),e.on("create",(function(e){return console.log("Create result: ",e)})),e.on("error",(function(e){return console.log("Have error: ",e)})),navigator.getUserMedia({audio:!0,video:!0},(function(t){console.log("start media.");var o=new r.default(t);o.mimeType="video/webm",o.ondataavailable=function(t){e.send(!0,t)},o.start(n),i=t.getTracks();try{s.src=window.URL.createObjectURL(t)}catch(e){s.srcObject=t}s.play()}),(function(e){console.error("media error",e)}))})),document.getElementById("".concat(this.stopStreamID)).addEventListener("click",(function(){s.pause(),i.forEach((function(e){return e.stop()})),e.quit((function(){console.log("Stop broadcast.")}))}))}},{key:"createBroadcast",value:function(){var e=document.createElement("video");e.setAttribute("id","broadcaster"),e.autoplay=!0,e.controls=!0,document.getElementById(this.ID_of_NodeToRenderVideo).appendChild(e)}}])&&a(t.prototype,n),s&&a(t,s),e}();e.exports=c},function(e,t,n){(function(n){var r;function i(e){if(!e)throw"MediaStream is mandatory.";var t;this.start=function(n){var r;"undefined"!=typeof MediaRecorder?r=y:(h||f||u)&&(-1!==this.mimeType.indexOf("video")?r=_:-1!==this.mimeType.indexOf("audio")&&(r=v)),"image/gif"===this.mimeType&&(r=k),"audio/wav"!==this.mimeType&&"audio/pcm"!==this.mimeType||(r=v),this.recorderType&&(r=this.recorderType),(t=new r(e)).blobs=[];var i=this;t.ondataavailable=function(e){t.blobs.push(e),i.ondataavailable(e)},t.onstop=this.onstop,t.onStartedDrawingNonBlankFrames=this.onStartedDrawingNonBlankFrames,(t=function(e,t){for(var n in t)"function"!=typeof t[n]&&(e[n]=t[n]);return e}(t,this)).start(n)},this.onStartedDrawingNonBlankFrames=function(){},this.clearOldRecordedFrames=function(){t&&t.clearOldRecordedFrames()},this.stop=function(){t&&t.stop()},this.ondataavailable=function(e){console.log("ondataavailable..",e)},this.onstop=function(e){console.warn("stopped..",e)},this.save=function(e,n){if(e)d(e,n);else{if(!t)return;ConcatenateBlobs(t.blobs,t.blobs[0].type,(function(e){d(e)}))}},this.pause=function(){t&&(t.pause(),console.log("Paused recording.",this.mimeType||t.mimeType))},this.resume=function(){t&&(t.resume(),console.log("Resumed recording.",this.mimeType||t.mimeType))},this.recorderType=null,this.mimeType="video/webm",this.disableLogs=!1}i.MultiStreamRecorder=function(e){if(!e)throw"MediaStream is mandatory.";var t,n,r=this,o=m();this.stream=e,this.start=function(c){for(var u in t=new i(e),n=new i(e),t.mimeType="audio/ogg",n.mimeType="video/webm",this)"function"!=typeof this[u]&&(t[u]=n[u]=this[u]);function f(e){a++,r.ondataavailable(e)}t.ondataavailable=function(e){s[a]||(s[a]={}),s[a].audio=e,s[a].video&&!s[a].onDataAvailableEventFired&&(s[a].onDataAvailableEventFired=!0,f(s[a]))},n.ondataavailable=function(e){if(o)return r.ondataavailable({video:e,audio:e});s[a]||(s[a]={}),s[a].video=e,s[a].audio&&!s[a].onDataAvailableEventFired&&(s[a].onDataAvailableEventFired=!0,f(s[a]))},n.onstop=t.onstop=function(e){r.onstop(e)},o?n.start(c):(n.onStartedDrawingNonBlankFrames=function(){n.clearOldRecordedFrames(),t.start(c)},n.start(c))},this.stop=function(){t&&t.stop(),n&&n.stop()},this.ondataavailable=function(e){console.log("ondataavailable..",e)},this.onstop=function(e){console.warn("stopped..",e)},this.pause=function(){t&&t.pause(),n&&n.pause()},this.resume=function(){t&&t.resume(),n&&n.resume()};var s={},a=0};var o,s,a="Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45";o=void 0!==n?n:window,"undefined"==typeof window&&("undefined"==typeof window&&void 0!==n&&(n.navigator={userAgent:a,getUserMedia:function(){}},o.window=n),"undefined"==typeof document&&(o.document={},document.createElement=document.captureStream=document.mozCaptureStream=function(){return{}}),"undefined"==typeof location&&(o.location={protocol:"file:",href:"",hash:""}),"undefined"==typeof screen&&(o.screen={width:0,height:0})),void 0===(s=window.AudioContext)&&("undefined"!=typeof webkitAudioContext&&(s=webkitAudioContext),"undefined"!=typeof mozAudioContext&&(s=mozAudioContext)),"undefined"==typeof window&&(window={}),void 0===(s=window.AudioContext)&&("undefined"!=typeof webkitAudioContext&&(s=webkitAudioContext),"undefined"!=typeof mozAudioContext&&(s=mozAudioContext));var c=window.URL;void 0===c&&"undefined"!=typeof webkitURL&&(c=webkitURL),"undefined"!=typeof navigator?(void 0!==navigator.webkitGetUserMedia&&(navigator.getUserMedia=navigator.webkitGetUserMedia),void 0!==navigator.mozGetUserMedia&&(navigator.getUserMedia=navigator.mozGetUserMedia)):navigator={getUserMedia:function(){},userAgent:a};var u=!(-1===navigator.userAgent.indexOf("Edge")||!navigator.msSaveBlob&&!navigator.msSaveOrOpenBlob),f=!1;"undefined"!=typeof opera&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("OPR/")&&(f=!0);var h=!u&&!u&&!!navigator.webkitGetUserMedia,l=window.MediaStream;function d(e,t){if(!e)throw"Blob object is required.";if(!e.type)try{e.type="video/webm"}catch(e){}var n=(e.type||"video/webm").split("/")[1];if(t&&-1!==t.indexOf(".")){var r=t.split(".");t=r[0],n=r[1]}var i=(t||Math.round(9999999999*Math.random())+888888888)+"."+n;if(void 0!==navigator.msSaveOrOpenBlob)return navigator.msSaveOrOpenBlob(e,i);if(void 0!==navigator.msSaveBlob)return navigator.msSaveBlob(e,i);var o=document.createElement("a");o.href=c.createObjectURL(e),o.target="_blank",o.download=i,navigator.mozGetUserMedia&&(o.onclick=function(){(document.body||document.documentElement).removeChild(o)},(document.body||document.documentElement).appendChild(o));var s=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});o.dispatchEvent(s),navigator.mozGetUserMedia||c.revokeObjectURL(o.href)}function p(e){if(0===e)return"0 Bytes";var t=parseInt(Math.floor(Math.log(e)/Math.log(1e3)),10);return(e/Math.pow(1e3,t)).toPrecision(3)+" "+["Bytes","KB","MB","GB","TB"][t]}void 0===l&&"undefined"!=typeof webkitMediaStream&&(l=webkitMediaStream),void 0!==l&&("getVideoTracks"in l.prototype||(l.prototype.getVideoTracks=function(){if(!this.getTracks)return[];var e=[];return this.getTracks.forEach((function(t){-1!==t.kind.toString().indexOf("video")&&e.push(t)})),e},l.prototype.getAudioTracks=function(){if(!this.getTracks)return[];var e=[];return this.getTracks.forEach((function(t){-1!==t.kind.toString().indexOf("audio")&&e.push(t)})),e}),"stop"in l.prototype||(l.prototype.stop=function(){this.getAudioTracks().forEach((function(e){e.stop&&e.stop()})),this.getVideoTracks().forEach((function(e){e.stop&&e.stop()}))})),"undefined"!=typeof location&&0===location.href.indexOf("file:")&&console.error("Please load this HTML file on HTTP or HTTPS.");var g={AudioContext:s};function m(){var e=!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,t=!!window.chrome&&!e;if(void 0!==window.InstallTrigger)return!0;if(!t)return!1;navigator.appVersion;var n,r,i=navigator.userAgent,o=""+parseFloat(navigator.appVersion),s=parseInt(navigator.appVersion,10);return t&&(n=i.indexOf("Chrome"),o=i.substring(n+7)),-1!==(r=o.indexOf(";"))&&(o=o.substring(0,r)),-1!==(r=o.indexOf(" "))&&(o=o.substring(0,r)),s=parseInt(""+o,10),isNaN(s)&&(o=""+parseFloat(navigator.appVersion),s=parseInt(navigator.appVersion,10)),s>=49}g={AudioContext:window.AudioContext||window.webkitAudioContext};function y(e){var t,n=this;this.start=function(r,i){var o;(n.mimeType||(n.mimeType="video/webm"),-1!==n.mimeType.indexOf("audio"))&&(e.getVideoTracks().length&&e.getAudioTracks().length&&(navigator.mozGetUserMedia?(o=new l).addTrack(e.getAudioTracks()[0]):o=new l(e.getAudioTracks()),e=o));-1!==n.mimeType.indexOf("audio")&&(n.mimeType=h?"audio/webm":"audio/ogg"),n.dontFireOnDataAvailableEvent=!1;var s={mimeType:n.mimeType};n.disableLogs||i||console.log("Passing following params over MediaRecorder API.",s),t&&(t=null),h&&!m()&&(s="video/vp8");try{t=new MediaRecorder(e,s)}catch(n){t=new MediaRecorder(e)}"canRecordMimeType"in t&&!1===t.canRecordMimeType(n.mimeType)&&(n.disableLogs||console.warn("MediaRecorder API seems unable to record mimeType:",n.mimeType)),t.ignoreMutedMedia=n.ignoreMutedMedia||!1;var a=!1;t.ondataavailable=function(e){if(!n.dontFireOnDataAvailableEvent&&e.data&&e.data.size&&!(e.data.size<26800)&&!a){a=!0;var i=n.getNativeBlob?e.data:new Blob([e.data],{type:n.mimeType||"video/webm"});n.ondataavailable(i),n.dontFireOnDataAvailableEvent=!0,t&&(t.stop(),t=null),n.start(r,"__disableLogs")}},t.onerror=function(e){n.disableLogs||("InvalidState"===e.name?console.error("The MediaRecorder is not in a state in which the proposed operation is allowed to be executed."):"OutOfMemory"===e.name?console.error("The UA has exhaused the available memory. User agents SHOULD provide as much additional information as possible in the message attribute."):"IllegalStreamModification"===e.name?console.error("A modification to the stream has occurred that makes it impossible to continue recording. An example would be the addition of a Track while recording is occurring. User agents SHOULD provide as much additional information as possible in the message attribute."):"OtherRecordingError"===e.name?console.error("Used for an fatal error other than those listed above. User agents SHOULD provide as much additional information as possible in the message attribute."):"GenericError"===e.name?console.error("The UA cannot provide the codec or recording option that has been requested.",e):console.error("MediaRecorder Error",e)),t&&"inactive"!==t.state&&"stopped"!==t.state&&t.stop()};try{t.start(36e5)}catch(e){t=null}setTimeout((function(){t&&"recording"===t.state&&t.requestData()}),r)},this.stop=function(e){t&&"recording"===t.state&&(t.requestData(),setTimeout((function(){n.dontFireOnDataAvailableEvent=!0,t&&"recording"===t.state&&t.stop(),t=null}),2e3))},this.pause=function(){t&&"recording"===t.state&&t.pause()},this.ondataavailable=function(e){console.log("recorded-blob",e)},this.resume=function(){if(this.dontFireOnDataAvailableEvent){this.dontFireOnDataAvailableEvent=!1;var e=n.disableLogs;return n.disableLogs=!0,this.record(),void(n.disableLogs=e)}t&&"paused"===t.state&&t.resume()},this.clearRecordedData=function(){t&&(this.pause(),this.dontFireOnDataAvailableEvent=!0,this.stop())},function r(){t&&(!1!==function(){if("active"in e){if(!e.active)return!1}else if("ended"in e&&e.ended)return!1;return!0}()?setTimeout(r,1e3):n.stop())}()}function v(e){var t,n;this.start=function(r){r=r||1e3,(t=new b(e,this)).record(),n=setInterval((function(){t.requestData()}),r)},this.stop=function(){t&&(t.stop(),clearTimeout(n))},this.pause=function(){t&&t.pause()},this.resume=function(){t&&t.resume()},this.ondataavailable=function(){}}function b(e,t){var n;g.AudioContextConstructor||(g.AudioContextConstructor=new g.AudioContext),n=g.AudioContextConstructor.sampleRate;var r,i=[],o=[],s=!1,a=0,c=t.sampleRate||n,u=(t.mimeType||"audio/wav").indexOf("audio/pcm")>-1,f=t.audioChannels||2;function h(e,t){for(var n=new Float32Array(t),r=0,i=e.length,o=0;o<i;o++){var s=e[o];n.set(s,r),r+=s.length}return n}function l(e,t,n){for(var r=n.length,i=0;i<r;i++)e.setUint8(t+i,n.charCodeAt(i))}function d(e){for(var t=e.length,n=new Int16Array(t);t--;)n[t]=65535*e[t];return n.buffer}this.record=function(){s=!0,i.length=o.length=0,a=0},this.requestData=function(){if(!w)if(0!==a){_=!0;var e=i.slice(0),n=o.slice(0),r=a;i.length=o.length=[],a=0,_=!1;var s=h(e,r),g=s;if(2===f)g=function(e,t){for(var n=e.length+t.length,r=new Float32Array(n),i=0,o=0;o<n;)r[o++]=e[i],r[o++]=t[i],i++;return r}(s,h(n,r));if(u){var m=new Blob([d(g)],{type:"audio/pcm"});return console.debug("audio recorded blob size:",p(m.size)),void t.ondataavailable(m)}var y=new ArrayBuffer(44+2*g.length),v=new DataView(y);l(v,0,"RIFF"),v.setUint32(4,44+2*g.length-8,!0),l(v,8,"WAVE"),l(v,12,"fmt "),v.setUint32(16,16,!0),v.setUint16(20,1,!0),v.setUint16(22,f,!0),v.setUint32(24,c,!0),v.setUint32(28,c*f*2,!0),v.setUint16(32,2*f,!0),v.setUint16(34,16,!0),l(v,36,"data"),v.setUint32(40,2*g.length,!0);for(var b=g.length,k=44,E=0;E<b;E++)v.setInt16(k,32767*g[E],!0),k+=2;m=new Blob([v],{type:"audio/wav"});console.debug("audio recorded blob size:",p(m.size)),t.ondataavailable(m)}else _=!1},this.stop=function(){s=!1,this.requestData(),y.disconnect()};var m=g.AudioContextConstructor;g.VolumeGainNode=m.createGain();var y,v=g.VolumeGainNode;g.AudioInput=m.createMediaStreamSource(e),(y=g.AudioInput).connect(v);var b=t.bufferSize||2048;if(0===t.bufferSize&&(b=0),m.createJavaScriptNode)r=m.createJavaScriptNode(b,f,f);else{if(!m.createScriptProcessor)throw"WebAudio API has no support on this browser.";r=m.createScriptProcessor(b,f,f)}b=r.bufferSize,console.debug("using audio buffer-size:",b);var _=!1;window.scriptprocessornode=r,1===f&&console.debug("All right-channels are skipped.");var w=!1;this.pause=function(){w=!0},this.resume=function(){w=!1},r.onaudioprocess=function(e){if(s&&!_&&!w){var t=e.inputBuffer.getChannelData(0);if(i.push(new Float32Array(t)),2===f){var n=e.inputBuffer.getChannelData(1);o.push(new Float32Array(n))}a+=b}},v.connect(r),r.connect(m.destination)}function _(e){var t,n;this.start=function(r){for(var i in r=r||1e3,t=new w(e,this),this)"function"!=typeof this[i]&&(t[i]=this[i]);t.record(),n=setInterval((function(){t.requestData()}),r)},this.stop=function(){t&&(t.stop(),clearTimeout(n))},this.clearOldRecordedFrames=function(){t&&t.clearOldRecordedFrames()},this.pause=function(){t&&t.pause()},this.resume=function(){t&&t.resume()},this.ondataavailable=function(){}}function w(e,t){this.record=function(n){this.width||(this.width=320),this.height||(this.height=240),this.video&&this.video instanceof HTMLVideoElement&&(this.width||(this.width=s.videoWidth||s.clientWidth||320),this.height||(this.height=s.videoHeight||s.clientHeight||240)),this.video||(this.video={width:this.width,height:this.height}),this.canvas&&this.canvas.width&&this.canvas.height||(this.canvas={width:this.width,height:this.height}),f.width=this.canvas.width,f.height=this.canvas.height,this.video&&this.video instanceof HTMLVideoElement?(this.isHTMLObject=!0,s=this.video.cloneNode()):((s=document.createElement("video")).src=c.createObjectURL(e),s.width=this.video.width,s.height=this.video.height),s.muted=!0,s.play(),a=(new Date).getTime(),u=new E.Video(t.speed,t.quality),console.log("canvas resolutions",f.width,"*",f.height),console.log("video width/height",s.width||f.width,"*",s.height||f.height),i()},this.clearOldRecordedFrames=function(){u.frames=[]};var n=!1;this.requestData=function(){if(!d)if(u.frames.length){n=!0;var e=u.frames.slice(0);u.frames=function(e,t,n,r){var i=document.createElement("canvas");i.width=f.width,i.height=f.height;for(var o=i.getContext("2d"),s=[],a=-1===t,c=t&&t>0&&t<=e.length?t:e.length,u={r:0,g:0,b:0},h=Math.sqrt(Math.pow(255,2)+Math.pow(255,2)+Math.pow(255,2)),l=n&&n>=0&&n<=1?n:0,d=r&&r>=0&&r<=1?r:0,p=!1,g=0;g<c;g++){var m,y,v;if(!p){var b=new Image;b.src=e[g].image,o.drawImage(b,0,0,f.width,f.height);var _=o.getImageData(0,0,f.width,f.height);m=0,y=_.data.length,v=_.data.length/4;for(var w=0;w<y;w+=4){var k={r:_.data[w],g:_.data[w+1],b:_.data[w+2]};Math.sqrt(Math.pow(k.r-u.r,2)+Math.pow(k.g-u.g,2)+Math.pow(k.b-u.b,2))<=h*l&&m++}}!p&&v-m<=v*d||(a&&(p=!0),s.push(e[g]))}(s=s.concat(e.slice(c))).length<=0&&s.push(e[e.length-1]);return s}(e,-1),u.compile((function(e){t.ondataavailable(e),console.debug("video recorded blob size:",p(e.size))})),u.frames=[],n=!1}else n=!1};var r=!1;function i(){if(d)return a=(new Date).getTime(),void setTimeout(i,500);if(!o){if(n)return setTimeout(i,100);var e=(new Date).getTime()-a;if(!e)return i();a=(new Date).getTime(),!l.isHTMLObject&&s.paused&&s.play(),h.drawImage(s,0,0,f.width,f.height),o||u.frames.push({duration:e,image:f.toDataURL("image/webp")}),r||function(e,t,n){var r=document.createElement("canvas");r.width=f.width,r.height=f.height;var i,o,s,a=r.getContext("2d"),c={r:0,g:0,b:0},u=Math.sqrt(Math.pow(255,2)+Math.pow(255,2)+Math.pow(255,2)),h=t&&t>=0&&t<=1?t:0,l=n&&n>=0&&n<=1?n:0,d=new Image;d.src=e.image,a.drawImage(d,0,0,f.width,f.height);var p=a.getImageData(0,0,f.width,f.height);i=0,o=p.data.length,s=p.data.length/4;for(var g=0;g<o;g+=4){var m={r:p.data[g],g:p.data[g+1],b:p.data[g+2]};Math.sqrt(Math.pow(m.r-c.r,2)+Math.pow(m.g-c.g,2)+Math.pow(m.b-c.b,2))<=u*h&&i++}return!(s-i<=s*l)}(u.frames[u.frames.length-1])||(r=!0,t.onStartedDrawingNonBlankFrames()),setTimeout(i,10)}}var o=!1;this.stop=function(){o=!0,this.requestData()};var s,a,u,f=document.createElement("canvas"),h=f.getContext("2d"),l=this;var d=!1;this.pause=function(){d=!0},this.resume=function(){d=!1}}function k(e){if("undefined"==typeof GIFEncoder)throw"Please link: https://cdn.webrtc-experiment.com/gif-recorder.js";function t(){Date.now();var e=new Blob([new Uint8Array(u.stream().bin)],{type:"image/gif"});r.ondataavailable(e),u.stream().bin=[]}this.start=function(e){e=e||1e3;var r=this.videoWidth||320,c=this.videoHeight||240;i.width=s.width=r,i.height=s.height=c,(u=new GIFEncoder).setRepeat(0),u.setDelay(this.frameRate||this.speed||200),u.setQuality(this.quality||1),u.start(),Date.now(),h=requestAnimationFrame((function e(t){n?setTimeout(e,500,t):(h=requestAnimationFrame(e),void 0===typeof a&&(a=t),t-a<90||(s.paused&&s.play(),o.drawImage(s,0,0,r,c),u.addFrame(o),a=t))})),f=setTimeout(t,e)},this.stop=function(){h&&(cancelAnimationFrame(h),clearTimeout(f),t())};var n=!1;this.pause=function(){n=!0},this.resume=function(){n=!1},this.ondataavailable=function(){},this.onstop=function(){};var r=this,i=document.createElement("canvas"),o=i.getContext("2d"),s=document.createElement("video");s.muted=!0,s.autoplay=!0,s.src=c.createObjectURL(e),s.play();var a,u,f,h=null}i.MediaRecorderWrapper=y,i.StereoAudioRecorder=v,i.StereoAudioRecorderHelper=b,i.WhammyRecorder=_,i.WhammyRecorderHelper=w,i.GifRecorder=k;var E=function(){function e(e,t){this.frames=[],e||(e=1),this.duration=1e3/e,this.quality=t||.8}function t(e){function t(e,t,n){return[{data:e,id:231}].concat(n.map((function(e){var n=function(e){var t=0;e.keyframe&&(t|=128);e.invisible&&(t|=8);e.lacing&&(t|=e.lacing<<1);e.discardable&&(t|=1);if(e.trackNum>127)throw"TrackNumber > 127 not supported";return[128|e.trackNum,e.timecode>>8,255&e.timecode,t].map((function(e){return String.fromCharCode(e)})).join("")+e.frame}({discardable:0,frame:e.data.slice(4),invisible:0,keyframe:1,lacing:0,trackNum:1,timecode:Math.round(t)});return t+=e.duration,{data:n,id:163}})))}function n(e){for(var t=[];e>0;)t.push(255&e),e>>=8;return new Uint8Array(t.reverse())}function r(e){var t=[];e=(e.length%8?new Array(9-e.length%8).join("0"):"")+e;for(var n=0;n<e.length;n+=8)t.push(parseInt(e.substr(n,8),2));return new Uint8Array(t)}function i(e,t){return parseInt(e.substr(t+4,4).split("").map((function(e){var t=e.charCodeAt(0).toString(2);return new Array(8-t.length+1).join("0")+t})).join(""),2)}var o=new function(e){var i=function(e){if(!e[0])return void postMessage({error:"Something went wrong. Maybe WebP format is not supported in the current browser."});for(var t=e[0].width,n=e[0].height,r=e[0].duration,i=1;i<e.length;i++)r+=e[i].duration;return{duration:r,width:t,height:n}}(e);if(!i)return[];for(var o,s=[{id:440786851,data:[{data:1,id:17030},{data:1,id:17143},{data:4,id:17138},{data:8,id:17139},{data:"webm",id:17026},{data:2,id:17031},{data:2,id:17029}]},{id:408125543,data:[{id:357149030,data:[{data:1e6,id:2807729},{data:"whammy",id:19840},{data:"whammy",id:22337},{data:(o=i.duration,[].slice.call(new Uint8Array(new Float64Array([o]).buffer),0).map((function(e){return String.fromCharCode(e)})).reverse().join("")),id:17545}]},{id:374648427,data:[{id:174,data:[{data:1,id:215},{data:1,id:29637},{data:0,id:156},{data:"und",id:2274716},{data:"V_VP8",id:134},{data:"VP8",id:2459272},{data:1,id:131},{id:224,data:[{data:i.width,id:176},{data:i.height,id:186}]}]}]}]}],a=0,c=0;a<e.length;){var u=[],f=0;do{u.push(e[a]),f+=e[a].duration,a++}while(a<e.length&&f<3e4);var h={id:524531317,data:t(c,0,u)};s[1].data.push(h),c+=f}return function e(t){for(var i=[],o=0;o<t.length;o++){var s=t[o].data;"object"==typeof s&&(s=e(s)),"number"==typeof s&&(s=r(s.toString(2))),"string"==typeof s&&(s=new Uint8Array(s.split("").map((function(e){return e.charCodeAt(0)}))));var a=s.size||s.byteLength||s.length,c=Math.ceil(Math.ceil(Math.log(a)/Math.log(2))/8),u=a.toString(2),f=new Array(7*c+7+1-u.length).join("0")+u,h=new Array(c).join("0")+"1"+f;i.push(n(t[o].id)),i.push(r(h)),i.push(s)}return new Blob(i,{type:"video/webm"})}(s)}(e.map((function(e){var t=function(e){for(var t=e.RIFF[0].WEBP[0],n=t.indexOf("*"),r=0,i=[];r<4;r++)i[r]=t.charCodeAt(n+3+r);return{width:16383&(i[1]<<8|i[0]),height:16383&(i[3]<<8|i[2]),data:t,riff:e}}(function e(t){for(var n=0,r={};n<t.length;){var o=t.substr(n,4),s=i(t,n),a=t.substr(n+4+4,s);n+=8+s,r[o]=r[o]||[],"RIFF"===o||"LIST"===o?r[o].push(e(a)):r[o].push(a)}return r}(atob(e.image.slice(23))));return t.duration=e.duration,t})));postMessage(o)}return e.prototype.add=function(e,t){if("canvas"in e&&(e=e.canvas),"toDataURL"in e&&(e=e.toDataURL("image/webp",this.quality)),!/^data:image\/webp;base64,/gi.test(e))throw"Input must be formatted properly as a base64 encoded DataURI of type image/webp";this.frames.push({image:e,duration:t||this.duration})},e.prototype.compile=function(e){var n,r,i,o=(n=t,r=c.createObjectURL(new Blob([n.toString(),"this.onmessage =  function (e) {"+n.name+"(e.data);}"],{type:"application/javascript"})),i=new Worker(r),c.revokeObjectURL(r),i);o.onmessage=function(t){t.data.error?console.error(t.data.error):e(t.data)},o.postMessage(this.frames)},{Video:e}}();i.Whammy=E,window.ConcatenateBlobs=function(e,t,n){var r=[],i=0;!function o(){if(!e[i])return function(){var e=0;r.forEach((function(t){e+=t.byteLength}));var i=new Uint16Array(e),o=0;r.forEach((function(e){var t=e.byteLength;t%2!=0&&(e=e.slice(0,t-1)),i.set(new Uint16Array(e),o),o+=t}));var s=new Blob([i.buffer],{type:t});n(s)}();var s=new FileReader;s.onload=function(e){r.push(e.target.result),i++,o()},s.readAsArrayBuffer(e[i])}()},e.exports=i,void 0===(r=function(){return i}.apply(t,[]))||(e.exports=r)}).call(this,n(0))}])}));